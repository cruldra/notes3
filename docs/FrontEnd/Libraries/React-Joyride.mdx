## å®ç°æµç¨‹æ¦‚è§ˆ

ä½¿ç”¨ react-joyride å®ç°æ–°æ‰‹å¼•å¯¼åŠŸèƒ½çš„æ ¸å¿ƒæµç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **å®‰è£…ä¾èµ–å’ŒåŸºç¡€é…ç½®**
2. **å®šä¹‰å¼•å¯¼æ­¥éª¤é…ç½®**
3. **åˆ›å»ºçŠ¶æ€ç®¡ç†**
4. **å®ç°å¼•å¯¼ç»„ä»¶**
5. **é¡µé¢å…ƒç´ æ ‡è®°**
6. **é›†æˆåˆ°åº”ç”¨**
7. **è°ƒè¯•å’Œä¼˜åŒ–**

---

## ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–å’ŒåŸºç¡€é…ç½®

### 1.1 å®‰è£…å¿…è¦ä¾èµ–

```bash
pnpm add react-joyride zustand
```

### 1.2 é¡¹ç›®æ–‡ä»¶ç»“æ„

```
src/core/components/OnboardingTour/
â”œâ”€â”€ OnboardingTour.tsx          # ä¸»å¼•å¯¼ç»„ä»¶
â”œâ”€â”€ GlobalOnboarding.tsx        # å…¨å±€å¼•å¯¼ç»„ä»¶
â”œâ”€â”€ useOnboardingStore.ts       # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ useSimpleTour.ts           # å¼•å¯¼Hook
â”œâ”€â”€ tourSteps.ts               # å¼•å¯¼æ­¥éª¤é…ç½®
â””â”€â”€ debug.ts                   # è°ƒè¯•å·¥å…·
```

---

## ç¬¬äºŒæ­¥ï¼šå®šä¹‰å¼•å¯¼æ­¥éª¤é…ç½®

### 2.1 ç›´æ¥è·¯å¾„æ˜ å°„ï¼ˆæ¨èæ–¹å¼ï¼‰

åœ¨ `tourSteps.ts` ä¸­ç›´æ¥ä½¿ç”¨é¡µé¢è·¯å¾„ä½œä¸ºå¼•å¯¼æ­¥éª¤çš„é”®ï¼Œæ— éœ€é¢å¤–çš„ç±»å‹è½¬æ¢ã€‚

**ä¼˜åŠ¿ï¼š**

- ğŸ¯ **ç›´è§‚æ˜ç¡®**ï¼šè·¯å¾„å³é…ç½®ï¼Œä¸€ç›®äº†ç„¶
- ğŸš€ **æ€§èƒ½æ›´å¥½**ï¼šå‡å°‘äº†ä¸­é—´è½¬æ¢å±‚ï¼Œæå‡æ€§èƒ½
- ğŸ”§ **ç»´æŠ¤ç®€å•**ï¼šæ— éœ€ç»´æŠ¤è·¯å¾„åˆ°ç±»å‹çš„æ˜ å°„å…³ç³»
- ğŸ“ˆ **æ‰©å±•æ€§å¼º**ï¼šæ–°å¢é¡µé¢åªéœ€æ·»åŠ å¯¹åº”è·¯å¾„çš„é…ç½®
- ğŸ› **è°ƒè¯•å‹å¥½**ï¼šç›´æ¥é€šè¿‡è·¯å¾„å°±èƒ½æ‰¾åˆ°å¯¹åº”é…ç½®

```typescript
// tourSteps.ts
import { Step } from "react-joyride";

/**
 * æ ¹æ®è·¯å¾„è·å–åŒ¹é…çš„å¼•å¯¼æ­¥éª¤é”®
 * æ”¯æŒç²¾ç¡®åŒ¹é…å’Œå‰ç¼€åŒ¹é…
 */
export const getStepKeyFromPath = (pathname: string): string => {
  // ç²¾ç¡®åŒ¹é…
  if (tourSteps[pathname]) {
    return pathname;
  }

  // å‰ç¼€åŒ¹é… - æ‰¾åˆ°æœ€é•¿åŒ¹é…çš„è·¯å¾„
  const matchingPaths = Object.keys(tourSteps).filter(
    (path) => pathname.startsWith(path) && path !== "/"
  );

  if (matchingPaths.length > 0) {
    // è¿”å›æœ€é•¿åŒ¹é…çš„è·¯å¾„
    return matchingPaths.reduce((longest, current) =>
      current.length > longest.length ? current : longest
    );
  }

  return "";
};
```

### 2.2 å®šä¹‰å¼•å¯¼æ­¥éª¤

ç›´æ¥ä½¿ç”¨é¡µé¢è·¯å¾„ä½œä¸ºé”®æ¥å®šä¹‰å¼•å¯¼æ­¥éª¤ï¼š

```typescript
/**
 * å¼•å¯¼æ­¥éª¤é…ç½® - ç›´æ¥åŸºäºé¡µé¢è·¯å¾„æ˜ å°„
 */
export const tourSteps: { [key: string]: Step[] } = {
  // å¯¹è¯é¡µé¢å¼•å¯¼
  "/chat": [
    {
      target: '[data-tour="chat-input"]',
      content: "åœ¨è¿™é‡Œè¾“å…¥æ‚¨æƒ³è¦è¯¢é—®çš„é—®é¢˜ã€‚æŒ‰ Shift+Enter å¯ä»¥å‘é€ã€‚",
      placement: "top",
      disableBeacon: true,
    },
    {
      target: '[data-tour="chat-send"]',
      content: "ç‚¹å‡»å‘é€æŒ‰é’®æˆ–æŒ‰ Enter é”®å‘é€æ¶ˆæ¯ã€‚",
      placement: "top",
    },
  ],

  // æ™ºèƒ½ä½“å¸‚åœºå¼•å¯¼
  "/agent/marketplace": [
    {
      target: '[data-tour="agent-categories"] .mantine-UnstyledButton-root',
      content: "æµè§ˆä¸åŒç±»åˆ«çš„æ™ºèƒ½ä½“ï¼Œæ‰¾åˆ°æœ€é€‚åˆæ‚¨éœ€æ±‚çš„AIåŠ©æ‰‹ã€‚",
      placement: "bottom",
      disableBeacon: true,
    },
    {
      target: '[data-tour="agent-card"] .mantine-UnstyledButton-root',
      content: "ç‚¹å‡»æ™ºèƒ½ä½“å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…æˆ–è´­ä¹°ä½¿ç”¨ã€‚",
      placement: "top",
    },
  ],

  // å·¥ä½œæµå¸‚åœºå¼•å¯¼
  "/workflow/marketplace": [
    {
      target: '[data-tour="agent-categories"] .mantine-UnstyledButton-root',
      content: "æµè§ˆä¸åŒç±»åˆ«çš„å·¥ä½œæµï¼Œæ‰¾åˆ°é€‚åˆæ‚¨ä¸šåŠ¡éœ€æ±‚çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚",
      placement: "bottom",
      disableBeacon: true,
    },
    {
      target: '[data-tour="agent-card"] .mantine-UnstyledButton-root',
      content: "ç‚¹å‡»å·¥ä½œæµå¡ç‰‡æŸ¥çœ‹è¯¦æƒ…ï¼Œäº†è§£è‡ªåŠ¨åŒ–æµç¨‹çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚",
      placement: "top",
    },
  ],

  // è¯¾ç¨‹å¸‚åœºå¼•å¯¼
  "/course/marketplace": [
    {
      target: '[data-tour="course-categories"]',
      content: "é€‰æ‹©æ‚¨æ„Ÿå…´è¶£çš„è¯¾ç¨‹ç±»åˆ«ï¼Œç³»ç»Ÿå­¦ä¹ ç›¸å…³çŸ¥è¯†ã€‚",
      placement: "bottom",
      disableBeacon: true,
    },
    {
      target: '[data-tour="course-card"]',
      content: "æŸ¥çœ‹è¯¾ç¨‹ä»‹ç»å’Œä»·æ ¼ä¿¡æ¯ï¼Œé€‰æ‹©é€‚åˆçš„è¯¾ç¨‹å¼€å§‹å­¦ä¹ ã€‚",
      placement: "top",
    },
  ],

  // çŸ¥è¯†åº“é¡µé¢å¼•å¯¼
  "/knowledge": [
    {
      target: '[data-tour="knowledge-upload"]',
      content: "ä¸Šä¼ æ‚¨çš„æ–‡æ¡£ã€èµ„æ–™ï¼Œæ„å»ºä¸ªäººä¸“å±çŸ¥è¯†åº“ã€‚",
      placement: "bottom",
      disableBeacon: true,
    },
    {
      target: '[data-tour="knowledge-list"]',
      content: "ç®¡ç†æ‚¨çš„çŸ¥è¯†åº“å†…å®¹ï¼Œæ”¯æŒæœç´¢ã€ç¼–è¾‘å’Œåˆ é™¤æ“ä½œã€‚",
      placement: "top",
    },
  ],

  // ä¸ªäººä¸­å¿ƒå¼•å¯¼
  "/ucenter": [
    {
      target: '[data-tour="ucenter-assets"]',
      content: "æŸ¥çœ‹æ‚¨è´­ä¹°çš„æ™ºèƒ½ä½“å’Œè¯¾ç¨‹ï¼Œç®¡ç†æ‚¨çš„æ•°å­—èµ„äº§ã€‚",
      placement: "right",
      disableBeacon: true,
    },
    {
      target: '[data-tour="ucenter-usage"]',
      content: "æŸ¥çœ‹æ‚¨çš„ä½¿ç”¨æƒ…å†µå’Œæ¶ˆè´¹è®°å½•ï¼Œäº†è§£æœåŠ¡ä½¿ç”¨è¯¦æƒ…ã€‚",
      placement: "right",
    },
    {
      target: '[data-tour="ucenter-account"]',
      content: "ç®¡ç†æ‚¨çš„è´¦å·ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸ªäººèµ„æ–™å’Œå®‰å…¨è®¾ç½®ã€‚",
      placement: "right",
    },
  ],
};
```

### 2.3 å®ç°å…ƒç´ éªŒè¯æœºåˆ¶

ä¸ºäº†ç¡®ä¿å¼•å¯¼åŠŸèƒ½çš„ç¨³å®šæ€§ï¼Œå®ç°å…ƒç´ éªŒè¯ï¼š

```typescript
/**
 * æ£€æŸ¥å…ƒç´ æ˜¯å¦æœ‰æ•ˆ
 */
export const isElementValid = (selector: string): boolean => {
  try {
    const element = document.querySelector(selector);
    if (!element) return false;

    const rect = element.getBoundingClientRect();
    return rect.width > 0 && rect.height > 0;
  } catch {
    return false;
  }
};
```

---

## ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºçŠ¶æ€ç®¡ç†

### 3.1 å®šä¹‰çŠ¶æ€æ¥å£

åœ¨ `useOnboardingStore.ts` ä¸­åˆ›å»º Zustand çŠ¶æ€ç®¡ç†ï¼š

```typescript
// useOnboardingStore.ts
import { create } from "zustand";
import { persist, createJSONStorage } from "zustand/middleware";

interface OnboardingState {
  // å·²å®Œæˆå¼•å¯¼çš„é¡µé¢
  completedPages: string[];
  // æ˜¯å¦æ­£åœ¨è¿è¡Œå¼•å¯¼
  isRunning: boolean;

  // Actions
  markPageCompleted: (page: string) => void;
  isPageCompleted: (page: string) => boolean;
  startTour: () => void;
  stopTour: () => void;
  resetPageCompleted: (page: string) => void;
  resetAllCompleted: () => void;
}
```

### 3.2 å®ç°çŠ¶æ€ç®¡ç†

```typescript
/**
 * æ–°æ‰‹å¼•å¯¼çŠ¶æ€ç®¡ç†
 */
export const useOnboardingStore = create<OnboardingState>()(
  persist(
    (set, get) => ({
      completedPages: [],
      isRunning: false,

      markPageCompleted: (page) => {
        const { completedPages } = get();
        if (!completedPages.includes(page)) {
          set({
            completedPages: [...completedPages, page],
          });
        }
      },

      isPageCompleted: (page) => {
        const { completedPages } = get();
        return completedPages.includes(page);
      },

      startTour: () => {
        set({ isRunning: true });
      },

      stopTour: () => {
        set({ isRunning: false });
      },

      resetPageCompleted: (page) => {
        const { completedPages } = get();
        set({
          completedPages: completedPages.filter((p) => p !== page),
        });
      },

      resetAllCompleted: () => {
        set({ completedPages: [] });
      },
    }),
    {
      name: "onboarding-storage",
      storage: createJSONStorage(() => localStorage),
    }
  )
);
```

---

## ç¬¬å››æ­¥ï¼šå®ç°å¼•å¯¼ç»„ä»¶

### 4.1 åˆ›å»ºä¸»å¼•å¯¼ç»„ä»¶

åœ¨ `OnboardingTour.tsx` ä¸­å®ç°æ ¸å¿ƒå¼•å¯¼é€»è¾‘ï¼š

```typescript
// OnboardingTour.tsx
import React, { useEffect, useState, useCallback, useRef } from 'react';
import Joyride, { CallBackProps, STATUS, Step } from 'react-joyride';
import { useLocation } from 'react-router-dom';
import { useOnboardingStore } from './useOnboardingStore';
import { getPageTypeFromPath, getValidSteps, waitForPageReady } from './tourSteps';

interface OnboardingTourProps {
  page?: string;
}

const OnboardingTour: React.FC<OnboardingTourProps> = ({ page }) => {
  const location = useLocation();
  const { isRunning, stopTour, markPageCompleted, isPageCompleted } = useOnboardingStore();
  const [steps, setSteps] = useState<Step[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const hasError = useRef(false);
  const isInitialized = useRef(false);
  const currentPageRef = useRef<string | null>(null);

  // ç¡®å®šå½“å‰é¡µé¢
  const currentPage = page || getPageTypeFromPath(location.pathname);

  // é‡ç½®çŠ¶æ€
  const resetState = useCallback(() => {
    setSteps([]);
    setIsLoading(false);
    hasError.current = false;
    isInitialized.current = false;
    currentPageRef.current = null;
  }, []);
```

### 4.2 å®ç°å¼•å¯¼é€»è¾‘

```typescript
// åˆå§‹åŒ–å¼•å¯¼æ­¥éª¤
const initializeTour = useCallback(async () => {
  if (!currentPage || !isRunning || isPageCompleted(currentPage)) {
    return;
  }

  setIsLoading(true);
  hasError.current = false;
  currentPageRef.current = currentPage;

  try {
    // ç­‰å¾…é¡µé¢å‡†å¤‡å°±ç»ª
    const pageReady = await waitForPageReady(currentPage);
    if (!pageReady) {
      resetState();
      return;
    }

    // è·å–æœ‰æ•ˆçš„å¼•å¯¼æ­¥éª¤
    const validSteps = getValidSteps(currentPage);
    if (validSteps.length === 0) {
      resetState();
      return;
    }

    setSteps(validSteps);
    isInitialized.current = true;
  } catch (error) {
    hasError.current = true;
    resetState();
  } finally {
    setIsLoading(false);
  }
}, [currentPage, isRunning, isPageCompleted, resetState]);

// å¤„ç†å¼•å¯¼å›è°ƒ
const handleJoyrideCallback = useCallback(
  (data: CallBackProps) => {
    const { status, type, step } = data;

    // å¤„ç†é”™è¯¯æƒ…å†µ
    if (type === "error" && step?.target) {
      hasError.current = true;
      if (!document.querySelector(step.target as string)) {
        stopTour();
        resetState();
        return;
      }
    }

    // å¤„ç†å®ŒæˆçŠ¶æ€
    if (
      !hasError.current &&
      (status === STATUS.FINISHED || status === STATUS.SKIPPED)
    ) {
      markPageCompleted(currentPage);
      stopTour();
      resetState();
    }
  },
  [currentPage, markPageCompleted, stopTour, resetState]
);
```

### 4.3 æ¸²æŸ“ Joyride ç»„ä»¶

```typescript
  // æ£€æŸ¥æ˜¯å¦éœ€è¦æ˜¾ç¤ºå¼•å¯¼
  const shouldShowTour = isRunning &&
                        steps.length > 0 &&
                        !isPageCompleted(currentPage) &&
                        !isLoading &&
                        !hasError.current &&
                        currentPage === currentPageRef.current &&
                        isInitialized.current;

  if (!shouldShowTour) return null;

  return (
    <Joyride
      steps={steps}
      run={true}
      continuous={true}
      showSkipButton={true}
      callback={handleJoyrideCallback}
      disableOverlayClose={false}
      disableScrolling={false}
      hideCloseButton={false}
      spotlightClicks={false}
      spotlightPadding={8}
      scrollToFirstStep={true}
      scrollOffset={100}
      floaterProps={{
        disableAnimation: true,
        options: {
          preventOverflow: { boundariesElement: 'viewport' },
        },
      }}
      styles={{
        options: {
          primaryColor: '#228be6',
        }
      }}
    />
  );
};

export default OnboardingTour;
```

### 4.4 åˆ›å»ºå…¨å±€å¼•å¯¼ç»„ä»¶

åœ¨ `GlobalOnboarding.tsx` ä¸­åˆ›å»ºè‡ªåŠ¨æ£€æµ‹é¡µé¢å˜åŒ–çš„ç»„ä»¶ï¼š

```typescript
// GlobalOnboarding.tsx
import React from "react";
import OnboardingTour from "./OnboardingTour";
import { useSimpleTour } from "./useSimpleTour";

/**
 * å…¨å±€å¼•å¯¼ç»„ä»¶
 * è‡ªåŠ¨æ£€æµ‹é¡µé¢å˜åŒ–å¹¶è§¦å‘ç›¸åº”å¼•å¯¼
 */
const GlobalOnboarding: React.FC = () => {
  const { currentPage } = useSimpleTour({
    delay: 1000,
  });

  return <OnboardingTour page={currentPage} />;
};

export default GlobalOnboarding;
```

---

## ç¬¬äº”æ­¥ï¼šé¡µé¢å…ƒç´ æ ‡è®°

### 5.1 åœ¨ç»„ä»¶ä¸­æ·»åŠ å¼•å¯¼æ ‡è¯†

ä¸ºéœ€è¦å¼•å¯¼çš„å…ƒç´ æ·»åŠ  `data-tour` å±æ€§ï¼š

```tsx
// èŠå¤©é¡µé¢ç¤ºä¾‹
const ChatBox = () => {
  return (
    <Box>
      {/* è¾“å…¥æ¡† */}
      <QuillTextArea data-tour="chat-input" />

      <Group>
        {/* å‘é€æŒ‰é’® */}
        <SendAction data-tour="chat-send" aria-label="Send Message" />
      </Group>
    </Box>
  );
};

// æ™ºèƒ½ä½“å¸‚åœºé¡µé¢ç¤ºä¾‹
const AgentMarketplace = () => {
  return (
    <Box>
      {/* åˆ†ç±»æ ‡ç­¾æ  */}
      <FilterTabs
        data-tour="agent-categories"
        categories={categories}
        selectedCategory={activeCategory}
        onCategoryChange={handleCategoryChange}
      />

      {/* æ™ºèƒ½ä½“å¡ç‰‡åˆ—è¡¨ */}
      <ModuleList>
        {agents.map((agent, index) => (
          <div
            key={agent.id}
            data-tour={index === 0 ? "agent-card" : undefined}
          >
            <ModuleCard
              id={agent.id}
              name={agent.name}
              description={agent.description}
              iconUrl={agent.icon}
              onClick={() => handleOpenModal(agent.id)}
            />
          </div>
        ))}
      </ModuleList>
    </Box>
  );
};
```

### 5.2 å…ƒç´ æ ‡è®°è§„èŒƒ

- **å‘½åè§„èŒƒ**: ä½¿ç”¨ `é¡µé¢-åŠŸèƒ½` æ ¼å¼ï¼Œå¦‚ `chat-input`ã€`agent-card`
- **å”¯ä¸€æ€§**: ç¡®ä¿æ¯ä¸ªé¡µé¢çš„ `data-tour` å€¼å”¯ä¸€
- **è¯­ä¹‰åŒ–**: ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤
- **ç¨³å®šæ€§**: é¿å…åœ¨åŠ¨æ€ç”Ÿæˆçš„å…ƒç´ ä¸Šä½¿ç”¨ï¼Œä¼˜å…ˆé€‰æ‹©ç¨³å®šçš„ DOM ç»“æ„

---

## ç¬¬å…­æ­¥ï¼šé›†æˆåˆ°åº”ç”¨

### 6.1 åœ¨ä¸»å¸ƒå±€ä¸­é›†æˆ

åœ¨ `Desktop.tsx` ä¸»å¸ƒå±€ç»„ä»¶ä¸­æ·»åŠ å…¨å±€å¼•å¯¼ç»„ä»¶ï¼š

```tsx
// Desktop.tsx
import GlobalOnboarding from "~/core/components/OnboardingTour/GlobalOnboarding";

const Desktop = () => {
  return (
    <>
      <AppShell>
        {/* å¯¼èˆªæ  */}
        <AppShell.Navbar>{/* å¯¼èˆªå†…å®¹ */}</AppShell.Navbar>

        {/* ä¸»å†…å®¹åŒºåŸŸ */}
        <AppShell.Main>
          <ErrorBoundary>
            <Outlet />
          </ErrorBoundary>
        </AppShell.Main>
      </AppShell>

      {/* å…¨å±€æ–°æ‰‹å¼•å¯¼ç»„ä»¶ */}
      <GlobalOnboarding />
    </>
  );
};

export default Desktop;
```

### 6.2 åˆ›å»ºå¼•å¯¼ Hook

åœ¨ `useSimpleTour.ts` ä¸­åˆ›å»ºä¾¿äºä½¿ç”¨çš„ Hookï¼š

```typescript
// useSimpleTour.ts
import { useEffect } from "react";
import { useLocation } from "react-router-dom";
import { useOnboardingStore } from "./useOnboardingStore";
import { getStepKeyFromPath } from "./tourSteps";

export const useSimpleTour = (options?: {
  pageType?: string;
  disabled?: boolean;
  delay?: number;
}) => {
  const location = useLocation();
  const {
    startTour,
    isPageCompleted,
    isRunning,
    stopTour,
    markPageCompleted,
    resetPageCompleted,
  } = useOnboardingStore();

  const {
    pageType: customPageType,
    disabled = false,
    delay = 1000,
  } = options || {};

  // ç¡®å®šå½“å‰é¡µé¢è·¯å¾„
  const currentPagePath =
    customPageType || getStepKeyFromPath(location.pathname);

  // è‡ªåŠ¨å¯åŠ¨å¼•å¯¼
  useEffect(() => {
    if (disabled || !currentPagePath || isPageCompleted(currentPagePath)) {
      return;
    }

    const timer = setTimeout(() => {
      if (!isRunning) {
        startTour();
      }
    }, delay);

    return () => clearTimeout(timer);
  }, [currentPagePath, disabled, delay, isPageCompleted, isRunning, startTour]);

  // æ‰‹åŠ¨æ§åˆ¶å‡½æ•°
  return {
    start: () => startTour(),
    stop: () => stopTour(),
    complete: () => markPageCompleted(currentPagePath),
    reset: () => resetPageCompleted(currentPagePath),
    isCompleted: () => isPageCompleted(currentPagePath),
    isRunning: () => isRunning,
    currentPage: currentPagePath,
  };
};
```

---

## ç¬¬ä¸ƒæ­¥ï¼šè°ƒè¯•å’Œä¼˜åŒ–

### 7.1 åˆ›å»ºè°ƒè¯•å·¥å…·

åœ¨ `debug.ts` ä¸­åˆ›å»ºè°ƒè¯•å·¥å…·ï¼š

```typescript
// debug.ts
import { useOnboardingStore } from "./useOnboardingStore";
import { getStepKeyFromPath, getValidSteps } from "./tourSteps";

const onboardingDebug = {
  getCurrentPagePath: () => {
    const pathname = window.location.pathname;
    const pagePath = getStepKeyFromPath(pathname);
    console.log(`å½“å‰è·¯å¾„: ${pathname}`);
    console.log(`åŒ¹é…çš„å¼•å¯¼è·¯å¾„: ${pagePath || "æœªè¯†åˆ«"}`);
    return pagePath;
  },

  getStepsForCurrentPage: () => {
    const pagePath = onboardingDebug.getCurrentPagePath();
    if (!pagePath) {
      console.log("âŒ æ— æ³•è·å–é¡µé¢è·¯å¾„");
      return [];
    }

    const steps = getValidSteps(pagePath);
    console.log(`ğŸ“‹ é¡µé¢ ${pagePath} çš„æœ‰æ•ˆæ­¥éª¤:`, steps);
    return steps;
  },

  startTour: () => {
    const { startTour } = useOnboardingStore.getState();
    console.log("ğŸš€ æ‰‹åŠ¨å¯åŠ¨å¼•å¯¼");
    startTour();
  },

  stopTour: () => {
    const { stopTour } = useOnboardingStore.getState();
    console.log("â¹ï¸ åœæ­¢å¼•å¯¼");
    stopTour();
  },

  resetAllCompleted: () => {
    const { resetAllCompleted } = useOnboardingStore.getState();
    console.log("ğŸ”„ é‡ç½®æ‰€æœ‰å·²å®Œæˆçš„é¡µé¢");
    resetAllCompleted();
  },

  checkElements: () => {
    const pageType = onboardingDebug.getCurrentPageType();
    if (!pageType) return;

    const elementsToCheck: { [key: string]: string[] } = {
      chat: ['[data-tour="chat-input"]', '[data-tour="chat-send"]'],
      agent: ['[data-tour="agent-categories"]', '[data-tour="agent-card"]'],
      // å…¶ä»–é¡µé¢...
    };

    const selectors = elementsToCheck[pageType] || [];

    selectors.forEach((selector) => {
      const element = document.querySelector(selector);
      if (element) {
        const rect = element.getBoundingClientRect();
        const isVisible = rect.width > 0 && rect.height > 0;
        console.log(
          `${isVisible ? "âœ…" : "âŒ"} ${selector}:`,
          isVisible ? "å¯è§" : "ä¸å¯è§"
        );
      } else {
        console.log(`âŒ ${selector}: å…ƒç´ ä¸å­˜åœ¨`);
      }
    });
  },
};

// æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡
if (typeof window !== "undefined") {
  window.onboardingDebug = onboardingDebug;
  console.log("ğŸ› ï¸ æ–°æ‰‹å¼•å¯¼è°ƒè¯•å·¥å…·å·²åŠ è½½ï¼Œä½¿ç”¨ window.onboardingDebug è®¿é—®");
}

export default onboardingDebug;
```

### 7.2 ä½¿ç”¨è°ƒè¯•å·¥å…·

åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ä½¿ç”¨è°ƒè¯•å·¥å…·ï¼š

```javascript
// è·å–å½“å‰é¡µé¢ç±»å‹
window.onboardingDebug.getCurrentPageType();

// è·å–å½“å‰é¡µé¢çš„å¼•å¯¼æ­¥éª¤
window.onboardingDebug.getStepsForCurrentPage();

// æ‰‹åŠ¨å¯åŠ¨å¼•å¯¼
window.onboardingDebug.startTour();

// åœæ­¢å¼•å¯¼
window.onboardingDebug.stopTour();

// é‡ç½®æ‰€æœ‰å·²å®Œæˆçš„é¡µé¢
window.onboardingDebug.resetAllCompleted();

// æ£€æŸ¥å¼•å¯¼å…ƒç´ 
window.onboardingDebug.checkElements();
```

### 7.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **åˆç†è®¾ç½®å»¶è¿Ÿæ—¶é—´**: ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½åå†å¯åŠ¨å¼•å¯¼
2. **ä½¿ç”¨å¤‡ç”¨é€‰æ‹©å™¨**: æé«˜å…ƒç´ å®šä½çš„ç¨³å®šæ€§
3. **é¿å…å¤æ‚æ“ä½œ**: å¼•å¯¼è¿‡ç¨‹ä¸­é¿å…è¿›è¡Œå¤æ‚çš„ DOM æ“ä½œ
4. **é”™è¯¯æ¢å¤æœºåˆ¶**: å®ç°å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤é€»è¾‘

---

## æ ¸å¿ƒæµç¨‹æ€»ç»“

### å®ç°æ­¥éª¤å›é¡¾

1. **ç¬¬ä¸€æ­¥ - å®‰è£…ä¾èµ–**: å®‰è£… `react-joyride` å’Œ `zustand`
2. **ç¬¬äºŒæ­¥ - å®šä¹‰é…ç½®**: åˆ›å»ºé¡µé¢æ˜ å°„ã€å¼•å¯¼æ­¥éª¤å’Œå¤‡ç”¨é€‰æ‹©å™¨
3. **ç¬¬ä¸‰æ­¥ - çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ Zustand ç®¡ç†å¼•å¯¼çŠ¶æ€å’ŒæŒä¹…åŒ–
4. **ç¬¬å››æ­¥ - å®ç°ç»„ä»¶**: åˆ›å»ºä¸»å¼•å¯¼ç»„ä»¶å’Œå…¨å±€ç»„ä»¶
5. **ç¬¬äº”æ­¥ - å…ƒç´ æ ‡è®°**: ä¸ºé¡µé¢å…ƒç´ æ·»åŠ  `data-tour` å±æ€§
6. **ç¬¬å…­æ­¥ - é›†æˆåº”ç”¨**: åœ¨ä¸»å¸ƒå±€ä¸­é›†æˆå¼•å¯¼ç»„ä»¶
7. **ç¬¬ä¸ƒæ­¥ - è°ƒè¯•ä¼˜åŒ–**: åˆ›å»ºè°ƒè¯•å·¥å…·å’Œæ€§èƒ½ä¼˜åŒ–

### å…³é”®ç‰¹æ€§

- **è‡ªåŠ¨æ£€æµ‹**: æ ¹æ®è·¯ç”±è‡ªåŠ¨è¯†åˆ«é¡µé¢ç±»å‹å¹¶è§¦å‘å¼•å¯¼
- **æ™ºèƒ½å®šä½**: å¤‡ç”¨é€‰æ‹©å™¨æœºåˆ¶ç¡®ä¿å…ƒç´ å®šä½çš„ç¨³å®šæ€§
- **çŠ¶æ€æŒä¹…åŒ–**: ä½¿ç”¨ localStorage è®°ä½ç”¨æˆ·çš„å¼•å¯¼è¿›åº¦
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ
- **è°ƒè¯•å‹å¥½**: ä¸°å¯Œçš„è°ƒè¯•å·¥å…·å’Œæ—¥å¿—ç³»ç»Ÿ

### æœ€ä½³å®è·µ

1. **å…ƒç´ æ ‡è¯†**: ä½¿ç”¨è¯­ä¹‰åŒ–çš„ `data-tour` å±æ€§ï¼Œéµå¾ªå‘½åè§„èŒƒ
2. **å†…å®¹ç¼–å†™**: å¼•å¯¼å†…å®¹ç®€æ´æ˜äº†ï¼Œçªå‡ºæ ¸å¿ƒåŠŸèƒ½
3. **æ€§èƒ½è€ƒè™‘**: åˆç†è®¾ç½®å»¶è¿Ÿï¼Œä½¿ç”¨å¤‡ç”¨é€‰æ‹©å™¨
4. **é”™è¯¯å¤„ç†**: å®ç°å…ƒç´ æœ‰æ•ˆæ€§æ£€æŸ¥å’Œé”™è¯¯æ¢å¤

è¿™ä¸ªå®ç°æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„æ–°æ‰‹å¼•å¯¼åŠŸèƒ½ï¼Œå…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œèƒ½å¤Ÿä¸ºç”¨æˆ·æä¾›æµç•…çš„å¼•å¯¼ä½“éªŒã€‚
