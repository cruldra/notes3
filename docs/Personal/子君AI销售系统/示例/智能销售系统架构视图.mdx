---
hide_table_of_contents: true
siderbar_position: 1
---


import SystemArchitecture from '@site/src/components/SystemArchitecture';

<SystemArchitecture />

---

```mermaid
graph TD

    %% --- å·¦ç¿¼ï¼šé”€å”®ä¾§ (Human-in-the-Loop) ---
    subgraph LeftWing [ğŸ¦… å·¦ç¿¼ï¼šé”€å”®å®æ“å·¥ä½œå°]
        direction TB
        SalesUI[ä¼å¾®ä¾§è¾¹æ /H5]
        Dashboard[å®æ—¶æ¼æ–—ä»ªè¡¨ç›˜]
        HumanIntervene[äººå·¥å¹²é¢„/æ”¹æ´¾]
        TaskCenter[å¾…åŠä»»åŠ¡ä¸­å¿ƒ]
    end
    class LeftWing,SalesUI,Dashboard,HumanIntervene,TaskCenter wings;

    %% --- å³ç¿¼ï¼šè¿è¥ä¾§ (Configuration) ---
    subgraph RightWing [ğŸ¦… å³ç¿¼ï¼šè¿è¥é…ç½®ä¸­å¿ƒ]
        direction TB
        StrategyConfig[ç­–ç•¥ç”»å¸ƒ/è§„åˆ™é…ç½®]
        KnowledgeBase[åŸå­äº‹å®ç®¡ç†<br>ä»·æ ¼æ—¥å†/æ”¿ç­–]
        CrowdMgr[åˆ†ç¾¤ä¸LTVé…ç½®]
        AuditLog[å®¡è®¡ä¸é£æ§æ—¥å¿—]
    end
    class RightWing,StrategyConfig,KnowledgeBase,CrowdMgr,AuditLog wings;

    %% --- ä¸­é—´æ ¸å¿ƒï¼šä¸‰å±‚æ¶æ„ ---
    
    %% ç¬¬ä¸€å±‚ï¼šæ„ŸçŸ¥å±‚
    subgraph Layer1 [1. æ„ŸçŸ¥å±‚: äº‹ä»¶é©±åŠ¨ä¿¡å·æ€»çº¿ Event Bus]
        direction LR
        SignalReceiver[å¤šæºä¿¡å·æ¥æ”¶é€‚é…å™¨]
        EventCleaner[äº‹ä»¶æ¸…æ´—ä¸æ ‡å‡†åŒ–]
        msg_queue{{Kafka / Coze Trigger}}
        
        LiveStream[ç›´æ’­é—´åŸ‹ç‚¹] --> SignalReceiver
        PaySystem[æ”¯ä»˜ç½‘å…³å›è°ƒ] --> SignalReceiver
        WeComHook[ä¼å¾®æ¶ˆæ¯å›è°ƒ] --> SignalReceiver
        SignalReceiver --> EventCleaner --> msg_queue
    end
    class Layer1 perception;
    class SignalReceiver,EventCleaner,msg_queue perception;

    %% ç¬¬äºŒå±‚ï¼šå†³ç­–å±‚
    subgraph Layer2 [2. å†³ç­–å±‚: FSMçŠ¶æ€æœº & è·¯ç”±å¼•æ“]
        direction TB
        
        %% æ ¸å¿ƒçŠ¶æ€æœº
        subgraph FSM_Core [åŠ¨æ€å®¢æˆ·çŠ¶æ€æœº FSM]
            CustomerState[å®¢æˆ·çŠ¶æ€å®¹å™¨<br>Stage / Intent / LTV]
            StateTransition[çŠ¶æ€æµè½¬é€»è¾‘]
        end
        
        %% ç­–ç•¥è·¯ç”±
        subgraph Routing_Engine [åˆ†å±‚ç­–ç•¥è·¯ç”±]
            ConflictResolver[å†²çªæ¶ˆè§£ & ä¼˜å…ˆçº§]
            StageRouter[é˜¶æ®µè·¯ç”±]
            EventRouter[äº‹ä»¶è·¯ç”±]
            ProfileRouter[ç”»åƒè·¯ç”±]
        end
        
        %% AI å¤§è„‘
        subgraph AI_Brain [AI Agent & RAG]
            LLM_Core[LLM æ¨ç†æ ¸å¿ƒ]
            PromptEngine[åŠ¨æ€ Prompt ç»„è£…]
            FactCheck[åŸå­äº‹å®æ ¡éªŒ<br>ä»·æ ¼/æ”¿ç­–]
        end

        %% æ•°æ®æµè½¬
        msg_queue --> StateTransition
        StateTransition -- çŠ¶æ€å˜æ›´äº‹ä»¶ --> ConflictResolver
        ConflictResolver --> StageRouter & EventRouter & ProfileRouter
        StageRouter & EventRouter & ProfileRouter --> PromptEngine
        PromptEngine -- è°ƒç”¨ --> LLM_Core
        LLM_Core -- æ£€ç´¢/æ ¡éªŒ --> FactCheck
    end
    class Layer2 decision;
    class FSM_Core,Routing_Engine,AI_Brain,CustomerState,StateTransition,ConflictResolver,StageRouter,EventRouter,ProfileRouter,LLM_Core,PromptEngine,FactCheck decision;

    %% ç¬¬ä¸‰å±‚ï¼šæ‰§è¡Œå±‚
    subgraph Layer3 [3. æ‰§è¡Œå±‚: é€šé“æŠ½è±¡ç½‘å…³ Channel Gateway]
        direction TB
        UnifiedSender[ç»Ÿä¸€å‘é€æŒ‡ä»¤æ¥å£]
        FreqControl[é«˜é¢‘é˜²æŠ¤ & ç†”æ–­]
        ChannelSwitch[é€šé“è‡ªåŠ¨åˆ‡æ¢/é™çº§]
        
        subgraph Adaptors [åè®®é€‚é…å™¨]
            WeComAPI[ä¼å¾® API]
            SMS_API[çŸ­ä¿¡ç½‘å…³]
            Voice_API[AI å¤–å‘¼]
        end
    end
    class Layer3 execution;
    class UnifiedSender,FreqControl,ChannelSwitch,Adaptors,WeComAPI,SMS_API,Voice_API execution;

    %% --- å­˜å‚¨å±‚ (æ”¯æ’‘) ---
    subgraph DataLayer [æŒä¹…åŒ–æ•°æ®å­˜å‚¨]
        DB_User[(å®¢æˆ·ç”»åƒåº“)]
        DB_Rules[(è§„åˆ™ç­–ç•¥åº“)]
        DB_Logs[(äº¤äº’æ—¥å¿—)]
    end
    class DataLayer,DB_User,DB_Rules,DB_Logs db;

    %% --- è·¨å±‚è¿æ¥ ---
    RightWing -- é…ç½®æ›´æ–° --> DB_Rules
    DB_Rules -.-> Routing_Engine & FactCheck
    
    LeftWing -- æŸ¥è¯¢/å¹²é¢„ --> FSM_Core
    FSM_Core -- è¯»å†™ --> DB_User
    
    FactCheck -.-> DB_Rules
    
    LLM_Core -- ç”Ÿæˆè¯æœ¯/åŠ¨ä½œ --> UnifiedSender
    UnifiedSender --> FreqControl --> ChannelSwitch --> Adaptors
    
    Adaptors -- è§¦è¾¾ç»“æœ --> SignalReceiver
```