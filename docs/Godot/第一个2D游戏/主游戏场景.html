<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Godot/第一个2D游戏/主游戏场景" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">主游戏场景 | Cruldra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/notes3/docs/Godot/第一个2D游戏/主游戏场景"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="主游戏场景 | Cruldra"><meta data-rh="true" name="description" content="现在是时候将我们所做的一切整合到一个可玩的游戏场景中了。"><meta data-rh="true" property="og:description" content="现在是时候将我们所做的一切整合到一个可玩的游戏场景中了。"><link data-rh="true" rel="icon" href="/notes3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/notes3/docs/Godot/第一个2D游戏/主游戏场景"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/Godot/第一个2D游戏/主游戏场景" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/Godot/第一个2D游戏/主游戏场景" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"主游戏场景","item":"https://your-docusaurus-site.example.com/notes3/docs/Godot/第一个2D游戏/主游戏场景"}]}</script><link rel="alternate" type="application/rss+xml" href="/notes3/blog/rss.xml" title="Cruldra RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes3/blog/atom.xml" title="Cruldra Atom Feed"><link rel="stylesheet" href="/notes3/assets/css/styles.48a6e6d2.css">
<script src="/notes3/assets/js/runtime~main.04368516.js" defer="defer"></script>
<script src="/notes3/assets/js/main.dcb0ce96.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme",window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme-choice","system"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/notes3/img/logo.svg"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_aA1M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes3/"><div class="navbar__logo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--light_DVqC"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--dark_B_L3"></div><b class="navbar__title text--truncate">Cruldra</b></a><a class="navbar__item navbar__link" href="/notes3/docs/category/设计模式">JVM</a><a class="navbar__item navbar__link" href="/notes3/docs/category/css">前端</a><a class="navbar__item navbar__link" href="/notes3/docs/category/astrbot">工具</a><a class="navbar__item navbar__link" href="/notes3/docs/category/ai电竞酒店">个人</a><a class="navbar__item navbar__link" href="/notes3/docs/AI/ACP/架构">AI</a><a class="navbar__item navbar__link" href="/notes3/docs/category/内置模块">Python</a><a class="navbar__item navbar__link" href="/notes3/docs/category/actix-web">Rust</a><a class="navbar__item navbar__link" href="/notes3/docs/category/数据库系统">软件工程</a><a class="navbar__item navbar__link" href="/notes3/docs/category/上古卷轴5">游戏</a><a class="navbar__item navbar__link" href="/notes3/docs/Go/Go-Python-Java三语言全方位对比">Go</a><a class="navbar__item navbar__link" href="/notes3/docs/Hardware/GPU工作原理">硬件</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes3/docs/Godot/功能列表">Godot</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_PufJ"><div class="navbar__search searchBarContainer_r6C1" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_G4_y" value=""><div class="loadingRing__Zfe searchBarLoadingRing_f0pn"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ctfR"><div class="docsWrapper_ByIB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KwvU" type="button"></button><div class="docRoot_hD6z"><aside class="theme-doc-sidebar-container docSidebarContainer_KuHC"><div class="sidebarViewport_LCjr"><div class="sidebar_L77d"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VYAF"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/功能列表"><span title="功能列表" class="linkLabel__RqX">功能列表</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/核心概念概览"><span title="核心概念概览" class="linkLabel__RqX">核心概念概览</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/初识编辑器界面"><span title="初识编辑器界面" class="linkLabel__RqX">初识编辑器界面</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/学习新特性"><span title="学习新特性" class="linkLabel__RqX">学习新特性</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/设计理念"><span title="设计理念" class="linkLabel__RqX">设计理念</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/节点与场景"><span title="节点与场景" class="linkLabel__RqX">节点与场景</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/创建场景实例"><span title="创建场景实例" class="linkLabel__RqX">创建场景实例</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/脚本语言"><span title="脚本语言" class="linkLabel__RqX">脚本语言</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/编写你的第一个脚本"><span title="编写你的第一个脚本" class="linkLabel__RqX">编写你的第一个脚本</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/监听玩家输入"><span title="监听玩家输入" class="linkLabel__RqX">监听玩家输入</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/使用信号"><span title="使用信号" class="linkLabel__RqX">使用信号</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/Godot/GodotScript/Lesson_1_What_Code_Is_Like"><span title="GodotScript" class="categoryLinkLabel_FHN4">GodotScript</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/Godot简介"><span title="Godot简介" class="linkLabel__RqX">Godot简介</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/Node、Sprint、Area这三个2d类的区别"><span title="Node、Sprint、Area这三个2d类的区别" class="linkLabel__RqX">Node、Sprint、Area这三个2d类的区别</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/介绍"><span title="介绍" class="linkLabel__RqX">介绍</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/使用GDScript学习编程"><span title="使用GDScript学习编程" class="linkLabel__RqX">使用GDScript学习编程</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/发布策略"><span title="发布策略" class="linkLabel__RqX">发布策略</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/常见问题"><span title="常见问题" class="linkLabel__RqX">常见问题</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/notes3/docs/Godot/第一个2D游戏/简介"><span title="第一个2D游戏" class="categoryLinkLabel_FHN4">第一个2D游戏</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/简介"><span title="简介" class="linkLabel__RqX">简介</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/设置项目"><span title="设置项目" class="linkLabel__RqX">设置项目</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/创建玩家场景"><span title="创建玩家场景" class="linkLabel__RqX">创建玩家场景</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/编写玩家代码"><span title="编写玩家代码" class="linkLabel__RqX">编写玩家代码</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/创建敌人"><span title="创建敌人" class="linkLabel__RqX">创建敌人</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/主游戏场景"><span title="主游戏场景" class="linkLabel__RqX">主游戏场景</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/图形用户界面"><span title="图形用户界面" class="linkLabel__RqX">图形用户界面</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Godot/第一个2D游戏/最后总结"><span title="最后总结" class="linkLabel__RqX">最后总结</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Godot/简介"><span title="简介" class="linkLabel__RqX">简介</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/Godot/遇到的问题/保存场景时遇到性能警告"><span title="遇到的问题" class="categoryLinkLabel_FHN4">遇到的问题</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_WxcZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Zd2x"><div class="docItemContainer_EEW4"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xL_w" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_zA1U"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">第一个2D游戏</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">主游戏场景</span></li></ul></nav><div class="tocCollapsible_aZGz theme-doc-toc-mobile tocMobile_ShCt"><button type="button" class="clean-btn tocCollapsibleButton_fxzH">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>主游戏场景</h1></header><p>现在是时候将我们所做的一切整合到一个可玩的游戏场景中了。</p>
<p>创建一个新场景并添加一个名为 <code>Main</code> 的 <a href="https://docs.godotengine.org/en/stable/classes/class_node.html" target="_blank" rel="noopener noreferrer" class="">Node</a>。（我们使用 <code>Node</code> 而不是 <code>Node2D</code> 的原因是这个节点将作为处理游戏逻辑的容器。它本身不需要 2D 功能。）</p>
<p>点击 <strong>实例化 (Instance)</strong> 按钮（由链条图标表示）并选择你保存的 <code>player.tscn</code>。</p>
<p><img decoding="async" loading="lazy" src="https://docs.godotengine.org/en/stable/_images/instance_scene.webp" alt="Instance Scene" class="img_kBI4"></p>
<p>现在，添加以下节点作为 <code>Main</code> 的子节点，并按如下所示命名：</p>
<ul>
<li class=""><a href="https://docs.godotengine.org/en/stable/classes/class_timer.html" target="_blank" rel="noopener noreferrer" class="">Timer</a> (命名为 <code>MobTimer</code>) —— 用于控制小怪生成的频率。</li>
<li class=""><a href="https://docs.godotengine.org/en/stable/classes/class_timer.html" target="_blank" rel="noopener noreferrer" class="">Timer</a> (命名为 <code>ScoreTimer</code>) —— 用于每秒增加分数。</li>
<li class=""><a href="https://docs.godotengine.org/en/stable/classes/class_timer.html" target="_blank" rel="noopener noreferrer" class="">Timer</a> (命名为 <code>StartTimer</code>) —— 用于在开始前提供延迟。</li>
<li class=""><a href="https://docs.godotengine.org/en/stable/classes/class_marker2d.html" target="_blank" rel="noopener noreferrer" class="">Marker2D</a> (命名为 <code>StartPosition</code>) —— 用于指示玩家的起始位置。</li>
</ul>
<p>按如下方式设置每个 <code>Timer</code> 节点的 <code>Wait Time</code> (等待时间) 属性（单位为秒）：</p>
<ul>
<li class=""><code>MobTimer</code>: <code>0.5</code></li>
<li class=""><code>ScoreTimer</code>: <code>1</code></li>
<li class=""><code>StartTimer</code>: <code>2</code></li>
</ul>
<p>此外，将 <code>StartTimer</code> 的 <code>One Shot</code> (单次) 属性设置为 “启用”，并将 <code>StartPosition</code> 节点的 <code>Position</code> 设置为 <code>(240, 450)</code>。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="生成小怪-spawning-mobs">生成小怪 (Spawning mobs)<a href="#生成小怪-spawning-mobs" class="hash-link" aria-label="Direct link to 生成小怪 (Spawning mobs)" title="Direct link to 生成小怪 (Spawning mobs)" translate="no">​</a></h2>
<p><code>Main</code> 节点将负责生成新的小怪，我们希望它们出现在屏幕边缘的随机位置。点击场景面板中的 <code>Main</code> 节点，然后添加一个名为 <code>MobPath</code> 的 <a href="https://docs.godotengine.org/en/stable/classes/class_path2d.html" target="_blank" rel="noopener noreferrer" class="">Path2D</a> 子节点。当你选中 <code>Path2D</code> 时，你会看到编辑器顶部出现了一些新按钮：</p>
<p><img decoding="async" loading="lazy" src="https://docs.godotengine.org/en/stable/_images/path2d_buttons.webp" alt="Path2D Buttons" class="img_kBI4"></p>
<p>选择中间那个（“添加点”），并通过点击在所示的角落添加点来绘制路径。为了让点对齐网格，请确保同时选中了 “使用网格捕捉 (Use Grid Snap)” 和 “使用智能捕捉 (Use Smart Snap)”。这些选项位于 “锁定” 按钮左侧，分别显示为磁铁旁边有小点和交叉线的图标。</p>
<p><img decoding="async" loading="lazy" src="https://docs.godotengine.org/en/stable/_images/grid_snap_button.webp" alt="Grid Snap Button" class="img_kBI4"></p>
<blockquote>
<p><strong>重要</strong></p>
<p>请按 <strong>顺时针</strong> 方向绘制路径，否则你的小怪会向 <strong>外</strong> 发射而不是向 <strong>内</strong> 发射！</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="https://docs.godotengine.org/en/stable/_images/draw_path2d.gif" alt="Draw Path2D" class="img_kBI4"></p>
<p>在图中放置第 <code>4</code> 个点后，点击 “闭合曲线 (Close Curve)” 按钮，你的曲线就完成了。</p>
<p>既然路径已经定义好了，添加一个 <a href="https://docs.godotengine.org/en/stable/classes/class_pathfollow2d.html" target="_blank" rel="noopener noreferrer" class="">PathFollow2D</a> 节点作为 <code>MobPath</code> 的子节点，并命名为 <code>MobSpawnLocation</code>。这个节点在移动时会自动旋转并跟随路径，因此我们可以用它来沿着路径选择随机的位置和方向。</p>
<p>你的场景现在应该是这样的：</p>
<p><img decoding="async" loading="lazy" src="https://docs.godotengine.org/en/stable/_images/main_scene_nodes.webp" alt="Main Scene Nodes" class="img_kBI4"></p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="主脚本-main-script">主脚本 (Main script)<a href="#主脚本-main-script" class="hash-link" aria-label="Direct link to 主脚本 (Main script)" title="Direct link to 主脚本 (Main script)" translate="no">​</a></h2>
<p>为 <code>Main</code> 添加一个脚本。在脚本顶部，我们使用 <code>@export var mob_scene: PackedScene</code> 来允许我们选择想要实例化的小怪场景。</p>
<div class="language-gdscript codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-gdscript codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">extends Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@export var mob_scene: PackedScene</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var score</span><br></span></code></pre></div></div>
<div class="language-csharp codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-csharp codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">using Godot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public partial class Main : Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 别忘了重新构建项目，以便编辑器知道新的导出变量。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Export]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PackedScene MobScene { get; set; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int _score;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>点击 <code>Main</code> 节点，你会看到检查器中 “Main.gd” 下出现了 <code>Mob Scene</code> 属性。</p>
<p>你可以通过两种方式为该属性赋值：</p>
<ul>
<li class="">从 “文件系统” 面板将 <code>mob.tscn</code> 拖放到 <strong>Mob Scene</strong> 属性中。</li>
<li class="">点击 “[空]” 旁边的下箭头并选择 “加载 (Load)”，然后选择 <code>mob.tscn</code>。</li>
</ul>
<p>接下来，在场景面板中选中 <code>Main</code> 节点下的 <code>Player</code> 场景实例，并打开侧边栏的 “节点” 面板。确保选中了 “信号” 选项卡。</p>
<p>你应该能看到 <code>Player</code> 节点的信号列表。在列表中找到并双击 <code>hit</code> 信号（或右键点击它并选择 “连接...”）。这将打开信号连接对话框。我们要创建一个名为 <code>game_over</code> 的新函数，它将处理游戏结束时需要发生的事情。在对话框底部的 “接收方法 (Receiver Method)” 框中输入 “game_over” 并点击 “连接”。你的目标是让 <code>Player</code> 发出 <code>hit</code> 信号并在 <code>Main</code> 脚本中处理它。在函数中添加以下代码，并添加一个 <code>new_game</code> 函数来为新游戏做好准备：</p>
<div class="language-gdscript codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-gdscript codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">func game_over():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$ScoreTimer.stop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$MobTimer.stop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func new_game():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	score = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$Player.start($StartPosition.position)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$StartTimer.start()</span><br></span></code></pre></div></div>
<div class="language-csharp codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-csharp codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">public void GameOver()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetNode&lt;Timer&gt;(&quot;MobTimer&quot;).Stop();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetNode&lt;Timer&gt;(&quot;ScoreTimer&quot;).Stop();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void NewGame()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _score = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var player = GetNode&lt;Player&gt;(&quot;Player&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var startPosition = GetNode&lt;Marker2D&gt;(&quot;StartPosition&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    player.Start(startPosition.Position);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetNode&lt;Timer&gt;(&quot;StartTimer&quot;).Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>现在我们将每个 Timer 节点（<code>StartTimer</code>、<code>ScoreTimer</code> 和 <code>MobTimer</code>）的 <code>timeout()</code> 信号连接到主脚本。对于这三个定时器，分别在场景面板中选中它们，打开 “节点” 面板的 “信号” 选项卡，然后双击列表中的 <code>timeout()</code> 信号。默认设置即可，点击 <strong>连接 (Connect)</strong> 创建新的信号连接。</p>
<p>完成这三个定时器的设置后，你应该能在它们各自的信号选项卡中看到每个定时器的 <code>timeout()</code> 信号都有一个绿色的连接：</p>
<ul>
<li class="">（对于 MobTimer）：<code>_on_mob_timer_timeout()</code></li>
<li class="">（对于 ScoreTimer）：<code>_on_score_timer_timeout()</code></li>
<li class="">（对于 StartTimer）：<code>_on_start_timer_timeout()</code></li>
</ul>
<p>现在我们通过添加下面的代码来定义这些定时器的运行方式。注意 <code>StartTimer</code> 将启动另外两个定时器，而 <code>ScoreTimer</code> 将使分数增加 1。</p>
<div class="language-gdscript codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-gdscript codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">func _on_score_timer_timeout():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	score += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">func _on_start_timer_timeout():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$MobTimer.start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	$ScoreTimer.start()</span><br></span></code></pre></div></div>
<div class="language-csharp codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-csharp codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">// 我们还在编辑器的连接窗口中以 PascalCase 指定了此函数名称。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void OnScoreTimerTimeout()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _score++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 我们还在编辑器的连接窗口中以 PascalCase 指定了此函数名称。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void OnStartTimerTimeout()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetNode&lt;Timer&gt;(&quot;MobTimer&quot;).Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetNode&lt;Timer&gt;(&quot;ScoreTimer&quot;).Start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>在 <code>_on_mob_timer_timeout()</code> 中，我们将创建一个小怪实例，沿着 <code>Path2D</code> 选择一个随机的起始位置，并让小怪开始移动。<code>PathFollow2D</code> 节点在跟随路径时会自动旋转，因此我们将利用这一点来选择小怪的方向和位置。生成小怪时，我们将为其移动速度选取一个 <code>150.0</code> 到 <code>250.0</code> 之间的随机值（如果速度都一样就太无聊了）。</p>
<p>注意，必须使用 <code>add_child()</code> 将新实例添加到场景中。</p>
<div class="language-gdscript codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-gdscript codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">func _on_mob_timer_timeout():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 创建小怪场景的新实例。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var mob = mob_scene.instantiate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 在 Path2D 上选择一个随机位置。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var mob_spawn_location = $MobPath/MobSpawnLocation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	mob_spawn_location.progress_ratio = randf()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 将小怪的位置设置为随机位置。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	mob.position = mob_spawn_location.position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 设置小怪的方向垂直于路径方向。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var direction = mob_spawn_location.rotation + PI / 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 为方向添加一些随机性。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	direction += randf_range(-PI / 4, PI / 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	mob.rotation = direction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 为小怪选择速度。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	var velocity = Vector2(randf_range(150.0, 250.0), 0.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	mob.linear_velocity = velocity.rotated(direction)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	# 通过将小怪添加到 Main 场景中来生成它。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	add_child(mob)</span><br></span></code></pre></div></div>
<div class="language-csharp codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-csharp codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">// 我们还在编辑器的连接窗口中以 PascalCase 指定了此函数名称。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private void OnMobTimerTimeout()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 创建小怪场景的新实例。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mob mob = MobScene.Instantiate&lt;Mob&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 在 Path2D 上选择一个随机位置。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var mobSpawnLocation = GetNode&lt;PathFollow2D&gt;(&quot;MobPath/MobSpawnLocation&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mobSpawnLocation.ProgressRatio = GD.Randf();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 设置小怪的方向垂直于路径方向。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float direction = mobSpawnLocation.Rotation + Mathf.Pi / 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 将小怪的位置设置为随机位置。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mob.Position = mobSpawnLocation.Position;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 为方向添加一些随机性。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    direction += (float)GD.RandRange(-Mathf.Pi / 4, Mathf.Pi / 4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mob.Rotation = direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 选择速度。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var velocity = new Vector2((float)GD.RandRange(150.0, 250.0), 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mob.LinearVelocity = velocity.Rotated(direction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 通过将小怪添加到 Main 场景中来生成它。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AddChild(mob);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<blockquote>
<p><strong>重要</strong></p>
<p>为什么用 <code>PI</code>？在需要角度的函数中，Godot 使用 <strong>弧度 (radians)</strong>，而不是角度。Pi 代表弧度制中的半圈，大约为 <code>3.1415</code>（还有 <code>TAU</code>，等于 <code>2 * PI</code>）。如果你更习惯使用角度，则需要使用 <code>deg_to_rad()</code> 和 <code>rad_to_deg()</code> 函数在两者之间进行转换。</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="测试场景-testing-the-scene">测试场景 (Testing the scene)<a href="#测试场景-testing-the-scene" class="hash-link" aria-label="Direct link to 测试场景 (Testing the scene)" title="Direct link to 测试场景 (Testing the scene)" translate="no">​</a></h2>
<p>让我们测试一下场景，确保一切正常。在 <code>_ready()</code> 中添加 <code>new_game</code> 调用：</p>
<div class="language-gdscript codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-gdscript codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">func _ready():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	new_game()</span><br></span></code></pre></div></div>
<div class="language-csharp codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-csharp codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">public override void _Ready()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NewGame();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>让我们还将 <code>Main</code> 分配为我们的 “主场景” —— 即游戏启动时自动运行的场景。按下 “运行项目” 按钮，并在提示时选择 <code>main.tscn</code>。</p>
<blockquote>
<p><strong>提示</strong></p>
<p>如果你已经设置了另一个场景作为 “主场景”，可以在 “文件系统” 面板中右键点击 <code>main.tscn</code> 并选择 <strong>设为主场景 (Set As Main Scene)</strong>。</p>
</blockquote>
<p>你应该能够移动玩家，看到小怪生成，并看到玩家在被小怪击中时消失。</p>
<p>当你确定一切正常后，从 <code>_ready()</code> 中删除对 <code>new_game()</code> 的调用，并用 <code>pass</code> 替换它。</p>
<p>我们的游戏还缺少什么？一些用户界面。在下一课中，我们将添加标题屏幕并显示玩家的分数。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_iDCr"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Godot/第一个2D游戏/主游戏场景.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_c0mv" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mxtt"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes3/docs/Godot/第一个2D游戏/创建敌人"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">创建敌人</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes3/docs/Godot/第一个2D游戏/图形用户界面"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">图形用户界面</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_r83r thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#生成小怪-spawning-mobs" class="table-of-contents__link toc-highlight">生成小怪 (Spawning mobs)</a></li><li><a href="#主脚本-main-script" class="table-of-contents__link toc-highlight">主脚本 (Main script)</a></li><li><a href="#测试场景-testing-the-scene" class="table-of-contents__link toc-highlight">测试场景 (Testing the scene)</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>