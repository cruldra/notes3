# 英雄联盟辅助工具架构方案

## 1. 项目概述

### 1.1 项目目标
开发一款基于 Python 的英雄联盟辅助工具,提供英雄技能分析、连招推荐、符文搭配、出装思路、阵容 B/P 分析、对线细节、野区规划等功能。

### 1.2 核心技术栈
- **开发语言**: Python 3.11+
- **UI 框架**: PySide6 (Qt for Python)
- **数据获取**: LCU API + Stagehand (网页数据抓取)
- **AI 能力**: Agno
- **向量数据库**: Qdrant (语义搜索)
- **依赖管理**: uv

## 2. 系统架构设计

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                      PySide6 UI Layer                        │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐  │
│  │英雄分析  │符文出装  │阵容分析  │对线助手  │野区规划  │  │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                    Application Layer                         │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              Service Layer (业务逻辑)                  │  │
│  │  • HeroService      • RuneService                     │  │
│  │  • ItemService      • MatchService                    │  │
│  │  • ComboService     • AnalysisService                 │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                      Data Layer                              │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐  │
│  │LCU Client│Stagehand │Qdrant DB │Local Cache│AI Engine │  │
│  │  (实时)  │ (静态)   │ (向量)   │  (SQLite) │  (Agno)  │  │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 模块划分

#### 2.2.1 数据层 (Data Layer)

**LCU Client Module**
```python
# lcu/client.py
- LCUConnector: 连接管理
- SummonerAPI: 召唤师信息
- MatchHistoryAPI: 历史战绩
- ChampSelectAPI: 英雄选择阶段
- GameFlowAPI: 游戏流程监控
```

**Stagehand Scraper Module**
```python
# scraper/
- champion_scraper.py: 英雄数据 (技能、属性、成长)
- rune_scraper.py: 符文数据
- item_scraper.py: 装备数据
- patch_scraper.py: 版本更新数据
- meta_scraper.py: 当前版本 Meta 数据
```

**Qdrant Vector DB Module**
```python
# vector_db/
- qdrant_client.py: 向量数据库客户端
- embeddings.py: 文本向量化
- collections.py: 集合管理 (英雄、符文、装备、连招)
- search.py: 语义搜索接口
```

**Local Cache Module**
```python
# cache/
- sqlite_cache.py: SQLite 本地缓存
- models.py: 数据模型 (Champion, Rune, Item, Match)
- cache_manager.py: 缓存策略管理
```

**AI Engine Module**
```python
# ai/
- agno_client.py: Agno 客户端封装
- prompt_templates.py: 提示词模板
- analyzers/
  - combo_analyzer.py: 连招分析
  - matchup_analyzer.py: 对线分析
  - draft_analyzer.py: 阵容分析
  - jungle_analyzer.py: 野区规划
```

#### 2.2.2 业务层 (Service Layer)

**Hero Service**
```python
# services/hero_service.py
- get_hero_info(champion_id): 获取英雄详细信息
- get_skill_details(champion_id): 获取技能详情
- analyze_combo(champion_id, context): AI 分析连招
- get_counter_picks(champion_id): 获取克制关系
```

**Rune Service**
```python
# services/rune_service.py
- get_recommended_runes(champion_id, role, enemy_champion): 推荐符文
- get_rune_stats(rune_id): 符文统计数据
- analyze_rune_synergy(champion_id, runes): 符文协同分析
```

**Item Service**
```python
# services/item_service.py
- get_build_path(champion_id, role, game_phase): 出装路线
- analyze_item_efficiency(champion_id, items, game_state): 装备效率分析
- get_situational_items(champion_id, enemy_comp): 针对性出装
```

**Match Service**
```python
# services/match_service.py
- get_match_history(summoner_id, count): 获取历史战绩
- analyze_performance(match_data): 表现分析
- get_champion_mastery(summoner_id): 英雄熟练度
```

**Analysis Service**
```python
# services/analysis_service.py
- analyze_draft(ally_picks, enemy_picks, bans): 阵容分析
- analyze_lane_matchup(ally_champ, enemy_champ, role): 对线分析
- analyze_jungle_pathing(champion_id, enemy_jungle): 野区规划
- suggest_combo_tricks(champion_id): 骚套路推荐
```

#### 2.2.3 UI 层 (Presentation Layer)

**主窗口**
```python
# ui/main_window.py
- MainWindow: 主窗口框架
- NavigationBar: 导航栏
- StatusBar: 状态栏
```

**功能模块界面**
```python
# ui/modules/
- hero_analysis_widget.py: 英雄技能分析界面
- rune_build_widget.py: 符文出装界面
- draft_analysis_widget.py: 阵容 B/P 分析界面
- lane_assistant_widget.py: 对线助手界面
- jungle_planning_widget.py: 野区规划界面
- match_history_widget.py: 战绩查询界面
- tricks_widget.py: 骚套路组合界面
```

**通用组件**
```python
# ui/components/
- champion_selector.py: 英雄选择器
- rune_editor.py: 符文编辑器
- item_builder.py: 出装构建器
- skill_viewer.py: 技能展示组件
- stats_chart.py: 数据图表组件
```

## 3. 数据流设计

### 3.1 数据获取流程

```
启动应用
    ↓
检测 LCU 连接
    ↓
加载本地缓存 (SQLite)
    ↓
后台更新静态数据 (Stagehand)
    ↓
构建向量索引 (Qdrant)
    ↓
监听游戏事件 (LCU WebSocket)
```

### 3.2 AI 分析流程

```
用户请求分析
    ↓
收集上下文数据 (英雄、对手、版本等)
    ↓
语义搜索相关知识 (Qdrant)
    ↓
构建提示词 (Prompt Templates)
    ↓
调用 Agno AI 分析
    ↓
解析结果并展示
    ↓
缓存分析结果
```

### 3.3 实时监控流程

```
LCU WebSocket 连接
    ↓
监听游戏阶段变化
    ↓
英雄选择阶段 → 触发阵容分析
    ↓
游戏开始 → 加载对线建议
    ↓
游戏进行中 → 实时数据更新
    ↓
游戏结束 → 保存战绩数据
```

## 4. 核心功能设计

### 4.1 英雄技能分析与连招

**数据来源**
- Stagehand 抓取技能描述、伤害数值、CD
- LCU API 获取技能等级、冷却时间
- 向量数据库存储技能组合知识

**AI 功能**
- 分析技能协同效果
- 推荐最优连招顺序
- 根据对手英雄调整连招策略
- 计算连招伤害

**实现要点**
```python
# 示例:连招分析
context = {
    "champion": "亚索",
    "enemy_champion": "劫",
    "game_phase": "对线期",
    "skill_levels": {"Q": 3, "W": 1, "E": 2, "R": 1}
}

combo_result = analysis_service.analyze_combo(context)
# 返回: 连招序列、伤害计算、注意事项
```

### 4.2 符文搭配

**数据来源**
- Stagehand 抓取符文树、符文效果
- LCU API 获取当前符文配置
- 统计网站数据 (胜率、使用率)

**推荐逻辑**
- 基于英雄定位推荐主系
- 根据对线对手调整副系
- 考虑阵容组成优化符文
- AI 分析符文协同效果

### 4.3 出装思路

**分阶段出装**
- 起始装备
- 前期核心装
- 中期过渡装
- 后期神装

**动态调整**
- 根据对手阵容调整
- 根据经济状况调整
- 根据游戏局势调整

**AI 分析**
- 装备性价比分析
- 装备协同效果
- 针对性出装建议

### 4.4 阵容 B/P 及分析

**Ban 位建议**
- 版本强势英雄
- 针对对手常用英雄
- 保护己方阵容体系

**Pick 建议**
- 阵容组成分析 (前排、输出、控制)
- 英雄协同效果
- Counter Pick 推荐

**阵容评分**
- 前期强度
- 后期强度
- 团战能力
- 分推能力
- 容错率

### 4.5 骚套路组合

**数据收集**
- 从视频网站抓取套路玩法
- 从论坛收集创意组合
- 用户自定义套路

**向量搜索**
- 根据英雄组合搜索套路
- 根据战术意图搜索套路
- 语义搜索相似套路

**AI 生成**
- 分析英雄技能组合可能性
- 生成创新套路建议
- 评估套路可行性

### 4.6 对线细节

**对线知识库**
- 英雄对线强弱势期
- 技能交换时机
- 兵线管理技巧
- 视野控制要点

**实时建议**
- 根据双方英雄给出对线建议
- 提醒关键技能 CD
- 提示 Gank 时机
- 推荐换血时机

### 4.7 野区规划

**刷野路线**
- 根据英雄特性推荐路线
- 考虑对方打野位置
- 优化刷野效率

**Gank 时机**
- 分析线上状态
- 计算伤害是否足够击杀
- 评估 Gank 成功率

**视野布置**
- 推荐眼位
- 反野路线
- 资源控制时机

## 5. 技术实现细节

### 5.1 LCU API 集成

**连接方式**
```python
# 读取 lockfile 获取端口和密钥
lockfile_path = "C:/Riot Games/League of Legends/lockfile"
# 格式: LeagueClient:PID:PORT:PASSWORD:PROTOCOL

# 建立 HTTPS 连接
base_url = f"https://127.0.0.1:{port}"
auth = ("riot", password)
```

**WebSocket 监听**
```python
# 订阅游戏事件
ws_url = f"wss://127.0.0.1:{port}"
# 监听: /lol-champ-select/v1/session
# 监听: /lol-gameflow/v1/gameflow-phase
```

### 5.2 Stagehand 数据抓取

**抓取目标**
- op.gg: Meta 数据、胜率统计
- u.gg: 符文出装推荐
- lolalytics.com: 详细数据分析
- 英雄联盟官网: 英雄技能描述

**抓取策略**
- 定时更新 (每日/每周)
- 版本更新时触发
- 增量更新机制
- 数据校验与清洗

### 5.3 Qdrant 向量数据库

**集合设计**
```python
collections = {
    "champions": {
        "vector_size": 768,
        "fields": ["name", "title", "skills", "lore", "tags"]
    },
    "combos": {
        "vector_size": 768,
        "fields": ["champion", "combo_sequence", "description", "difficulty"]
    },
    "matchups": {
        "vector_size": 768,
        "fields": ["champion_a", "champion_b", "tips", "win_rate"]
    },
    "tricks": {
        "vector_size": 768,
        "fields": ["title", "description", "champions", "video_url"]
    }
}
```

**语义搜索示例**
```python
# 搜索连招
query = "亚索如何快速清兵"
results = qdrant_client.search(
    collection_name="combos",
    query_vector=embeddings.encode(query),
    limit=5
)
```

### 5.4 Agno AI 集成

**可能的 AI 应用场景**

1. **智能问答助手**
   - 用户提问游戏相关问题
   - AI 基于知识库回答

2. **个性化建议**
   - 根据用户历史战绩
   - 推荐适合的英雄和玩法

3. **战局分析**
   - 分析当前对局形势
   - 给出战术建议

4. **学习路径规划**
   - 根据用户水平
   - 规划英雄学习顺序

5. **复盘分析**
   - 分析失败原因
   - 提出改进建议

**Prompt 设计示例**
```python
COMBO_ANALYSIS_PROMPT = """
你是一位英雄联盟专业教练。请分析以下情况下的最优连招:

英雄: {champion}
对手: {enemy_champion}
游戏阶段: {game_phase}
当前技能等级: {skill_levels}
装备: {items}

请提供:
1. 推荐连招序列
2. 伤害计算
3. 注意事项
4. 失误风险
"""
```

## 6. 项目结构

```
lol-assistant/
├── src/
│   ├── main.py                 # 应用入口
│   ├── config.py               # 配置管理
│   ├── lcu/                    # LCU API 模块
│   │   ├── __init__.py
│   │   ├── client.py
│   │   ├── connector.py
│   │   └── apis/
│   │       ├── summoner.py
│   │       ├── match.py
│   │       └── champ_select.py
│   ├── scraper/                # 数据抓取模块
│   │   ├── __init__.py
│   │   ├── base_scraper.py
│   │   ├── champion_scraper.py
│   │   ├── rune_scraper.py
│   │   └── item_scraper.py
│   ├── vector_db/              # 向量数据库模块
│   │   ├── __init__.py
│   │   ├── qdrant_client.py
│   │   ├── embeddings.py
│   │   └── collections.py
│   ├── cache/                  # 本地缓存模块
│   │   ├── __init__.py
│   │   ├── sqlite_cache.py
│   │   └── models.py
│   ├── ai/                     # AI 模块
│   │   ├── __init__.py
│   │   ├── agno_client.py
│   │   ├── prompt_templates.py
│   │   └── analyzers/
│   │       ├── combo_analyzer.py
│   │       ├── matchup_analyzer.py
│   │       └── draft_analyzer.py
│   ├── services/               # 业务服务层
│   │   ├── __init__.py
│   │   ├── hero_service.py
│   │   ├── rune_service.py
│   │   ├── item_service.py
│   │   ├── match_service.py
│   │   └── analysis_service.py
│   └── ui/                     # UI 层
│       ├── __init__.py
│       ├── main_window.py
│       ├── modules/
│       │   ├── hero_analysis_widget.py
│       │   ├── rune_build_widget.py
│       │   ├── draft_analysis_widget.py
│       │   ├── lane_assistant_widget.py
│       │   └── jungle_planning_widget.py
│       └── components/
│           ├── champion_selector.py
│           ├── rune_editor.py
│           └── item_builder.py
├── resources/                  # 资源文件
│   ├── images/
│   ├── icons/
│   └── qss/                    # Qt 样式表
├── data/                       # 数据目录
│   ├── cache.db                # SQLite 缓存
│   └── static/                 # 静态数据
├── pyproject.toml              # 项目配置
├── README.md
└── .env                        # 环境变量
```

## 7. 开发路线图

### Phase 1: 基础框架 (2-3 周)
- [ ] 搭建项目结构
- [ ] 实现 LCU API 连接
- [ ] 开发基础 UI 框架
- [ ] 实现本地缓存系统

### Phase 2: 数据层 (2-3 周)
- [ ] 实现 Stagehand 数据抓取
- [ ] 集成 Qdrant 向量数据库
- [ ] 建立数据更新机制
- [ ] 完善数据模型

### Phase 3: 核心功能 (4-6 周)
- [ ] 英雄技能分析
- [ ] 符文出装推荐
- [ ] 阵容 B/P 分析
- [ ] 对线助手
- [ ] 野区规划

### Phase 4: AI 增强 (2-3 周)
- [ ] 集成 Agno AI
- [ ] 实现智能问答
- [ ] 连招分析优化
- [ ] 个性化推荐

### Phase 5: 优化与发布 (2-3 周)
- [ ] 性能优化
- [ ] UI/UX 优化
- [ ] 打包发布
- [ ] 文档完善

## 8. 技术挑战与解决方案

### 8.1 LCU API 稳定性
**挑战**: LCU API 可能随版本更新变化
**解决方案**: 
- 版本兼容性检测
- API 变更监控
- 降级方案设计

### 8.2 数据实时性
**挑战**: 游戏数据更新频繁
**解决方案**:
- 增量更新机制
- 缓存失效策略
- 后台自动更新

### 8.3 AI 响应速度
**挑战**: AI 分析可能耗时较长
**解决方案**:
- 异步处理
- 结果缓存
- 流式输出

### 8.4 向量搜索性能
**挑战**: 大规模向量搜索性能
**解决方案**:
- 合理设计索引
- 分片存储
- 预加载常用数据

## 9. 依赖清单

```toml
[project]
name = "lol-assistant"
version = "0.1.0"
requires-python = ">=3.11"

dependencies = [
    "pyside6>=6.6.0",
    "requests>=2.31.0",
    "websockets>=12.0",
    "qdrant-client>=1.7.0",
    "stagehand>=0.1.0",
    "agno>=0.1.0",
    "sqlalchemy>=2.0.0",
    "pydantic>=2.5.0",
    "httpx>=0.25.0",
    "beautifulsoup4>=4.12.0",
    "lxml>=4.9.0",
    "pillow>=10.1.0",
    "numpy>=1.26.0",
    "pandas>=2.1.0",
]
```

## 10. 总结

本架构方案采用分层设计,将数据获取、业务逻辑和界面展示分离,便于维护和扩展。通过 LCU API 获取实时数据,Stagehand 抓取静态数据,Qdrant 实现语义搜索,Agno 提供 AI 能力,构建一个功能完善的英雄联盟辅助工具。

核心优势:
- **实时性**: 通过 LCU API 实时获取游戏数据
- **智能化**: AI 驱动的分析和推荐
- **可扩展**: 模块化设计,易于添加新功能
- **用户友好**: PySide6 提供现代化界面

后续可根据用户反馈持续优化功能,添加更多创新特性。

