---
sidebar_position: 11
---
在本节课中，你将编写你的第一个脚本，让 Godot 图标转圈。正如我们在 [简介](../introduction/introduction_to_godot.md) 中提到的，我们假设你已经具备编程基础。

本教程使用 GDScript 编写，为了方便起见，每个代码块的另一个选项卡中都包含等效的 C# 代码。

![Rotating Godot](https://docs.godotengine.org/en/stable/_images/scripting_first_script_rotating_godot.gif)

> **另见**
>
> 要了解有关 GDScript 及其关键字、语法的更多信息，请前往 [GDScript](https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/index.html) 部分。要了解有关 C# 的更多信息，请前往 [C#/.NET](https://docs.godotengine.org/en/stable/tutorials/scripting/c_sharp/index.html) 部分。

## 项目设置 (Project setup)

请 [创建一个新项目](https://docs.godotengine.org/en/stable/tutorials/editor/project_manager.html) 以从头开始。你的项目应该包含一张图片：Godot 图标，我们经常在社区中用它来制作原型。

![Godot Icon](https://docs.godotengine.org/en/stable/_images/scripting_first_script_icon.svg)

我们需要创建一个 `Sprite2D` 节点来在游戏中显示它。在 “场景” 面板中，点击 **其它节点 (Other Node)** 按钮。

![Click Other Node](https://docs.godotengine.org/en/stable/_images/scripting_first_script_click_other_node.webp)

在搜索栏中输入 “Sprite2D” 以过滤节点，然后双击 `Sprite2D` 以创建该节点。

![Add Sprite Node](https://docs.godotengine.org/en/stable/_images/scripting_first_script_add_sprite_node.webp)

现在你的场景选项卡中应该只有一个 `Sprite2D` 节点。

![Scene Tree](https://docs.godotengine.org/en/stable/_images/scripting_first_script_scene_tree.webp)

`Sprite2D` 节点需要一个纹理 (texture) 才能显示。在右侧的检查器中，你可以看到 `Texture` 属性显示为 `<空>`。要显示 Godot 图标，请点击并从 “文件系统 (FileSystem)” 面板中将 `icon.svg` 文件拖动到 `Texture` 插槽上。

![Setting Texture](https://docs.godotengine.org/en/stable/_images/scripting_first_script_setting_texture.webp)

> **注意**
>
> 你可以通过将图像拖放到视口中来自动创建 `Sprite2D` 节点。

然后，在视口中点击并拖动图标，将其放在游戏视图的中心。

![Centering Sprite](https://docs.godotengine.org/en/stable/_images/scripting_first_script_centering_sprite.webp)

## 创建新脚本 (Creating a new script)

要创建新脚本并将其附加到我们的节点，请在场景面板中右键点击 `Sprite2D` 并选择 **附加脚本 (Attach Script)**。

![Attach Script](https://docs.godotengine.org/en/stable/_images/scripting_first_script_attach_script.webp)

出现 “附加节点脚本” 窗口。它允许你选择脚本语言和文件路径，以及其他选项。

将 **模板 (Template)** 字段从 `Node: Default` 更改为 `Object: Empty`，以便从空文件开始。保持其他选项为默认值，然后点击 **创建 (Create)** 按钮来创建脚本。

![Attach Node Script](https://docs.godotengine.org/en/stable/_images/scripting_first_script_attach_node_script.webp)

> **注意**
>
> C# 脚本名称需要与其类名匹配。在这种情况下，你应该将文件命名为 `MySprite2D.cs`。

脚本工作区应该会出现，并打开了新的 `sprite_2d.gd` 文件，其中包含以下代码行：

```gdscript
extends Sprite2D
```

```csharp
using Godot;
using System;

public partial class MySprite2D : Sprite2D
{
}
```

每个 GDScript 文件隐式地都是一个类。`extends` 关键字定义了此脚本继承或扩展的类。在这种情况下，它是 `Sprite2D`，这意味着我们的脚本将能够访问 `Sprite2D` 节点的所有属性和函数，包括它所扩展的类，如 `Node2D`、`CanvasItem` 和 `Node`。

> **注意**
>
> 在 GDScript 中，如果你省略带有 `extends` 关键字的行，你的类将隐式扩展 [RefCounted](https://docs.godotengine.org/en/stable/classes/class_refcounted.html)，Godot 使用它来管理应用程序的内存。

继承的属性包括你在检查器面板中看到的那些，比如我们节点的 `texture`。

> **注意**
>
> 默认情况下，检查器以 “首字母大写 (Title Case)” 形式显示节点的属性，单词首字母大写并用空格分隔。在 GDScript 代码中，这些属性采用 “蛇形命名法 (snake_case)”，即小写单词用下划线分隔。

你可以将鼠标悬停在检查器中的任何属性名称上，以查看说明及其在代码中的标识符。

## 你好，世界！ (Hello, world!)

我们的脚本目前什么都不做。让我们先让它在底部的 “输出 (Output)” 面板中打印文本 “Hello, world!”。

将以下代码添加到你的脚本中：

```gdscript
func _init():
	print("Hello, world!")
```

```csharp
public MySprite2D()
{
    GD.Print("Hello, world!");
}
```

让我们分解一下。`func` 关键字定义了一个名为 `_init` 的新函数。这是我们类的构造函数的特殊名称。如果你定义了这个函数，引擎在内存中创建每个对象或节点时都会调用 `_init()`。

> **注意**
>
> GDScript 是一种基于缩进的语言。显示 `print()` 的行首的制表符 (tab) 是代码运行所必需的。如果你省略它或没有正确缩进行，编辑器会将其高亮显示为红色并显示以下错误信息：“需要缩进块 (Indented block expected)”。

如果尚未保存，请将场景保存为 `sprite_2d.tscn`，然后按 **F6** (macOS 为 **Cmd + R**) 运行它。查看展开的底部 “输出” 面板。它应该显示 “Hello, world!”。

![Print Hello World](https://docs.godotengine.org/en/stable/_images/scripting_first_script_print_hello_world.webp)

删除 `_init()` 函数，只保留 `extends Sprite2D` 行。

## 转圈圈 (Turning around)

是时候让我们的节点移动和旋转了。为此，我们要在脚本中添加两个成员变量：移动速度（以像素/秒为单位）和角速度（以弧度/秒为单位）。在 `extends Sprite2D` 行之后添加以下内容。

```gdscript
var speed = 400
var angular_speed = PI
```

```csharp
private int _speed = 400;
private float _angularSpeed = Mathf.Pi;
```

成员变量位于脚本顶部，在任何 “extends” 行之后，但在函数之前。每个附加了此脚本的节点实例都将拥有自己的 `speed` 和 `angular_speed` 属性副本。

> **注意**
>
> Godot 中的角度默认使用弧度，但如果你更喜欢用角度计算，也有内置的函数和属性可用。

为了移动我们的图标，我们需要在游戏循环中每帧更新其位置和旋转。我们可以使用 `Node` 类的 `_process()` 虚函数。如果你在任何扩展了 `Node` 类的类（如 `Sprite2D`）中定义了它，Godot 都会在每帧调用该函数，并传递一个名为 `delta` 的参数，即自上一帧以来经过的时间。

> **注意**
>
> 游戏通过每秒渲染许多图像（每个称为一帧）并在循环中执行来工作。我们以每秒帧数 (FPS) 来衡量游戏生成图像的速率。大多数游戏的目标是 60 FPS，尽管你可能会在较慢的移动设备上看到 30 FPS，或者在虚拟现实游戏中看到 90 到 240 FPS。
>
> 引擎和游戏开发者尽力以恒定的时间间隔更新游戏世界并渲染图像，但帧渲染时间总是存在微小波动。这就是为什么引擎为我们提供了这个 `delta` 时间值，使得我们的运动与帧率无关。

在脚本底部定义该函数：

```gdscript
func _process(delta):
	rotation += angular_speed * delta
```

```csharp
public override void _Process(double delta)
{
    Rotation += _angularSpeed * (float)delta;
}
```

`func` 关键字定义了一个新函数。在它之后，我们必须写出函数的名称以及它在括号中接受的参数。冒号结束定义，随后的缩进块是函数的内容或指令。

> **注意**
>
> 注意 `_process()` 和 `_init()` 一样，都是以下划线开头的。按照惯例，Godot 的虚函数（即你可以重写以与引擎通信的内置函数）都以下划线开头。

函数内部的行 `rotation += angular_speed * delta` 每帧都会增加我们精灵的旋转。这里，`rotation` 是继承自 `Node2D` 类（`Sprite2D` 扩展自该类）的一个属性。它控制我们节点的旋转并使用弧度。

> **提示**
>
> 在代码编辑器中，你可以按住 **Ctrl** 点击（macOS 为 **Cmd + 点击**）任何内置属性或函数（如 `position`、`rotation` 或 `_process`），即可在新的选项卡中打开相应的文档。

运行场景，看看 Godot 图标是如何原地旋转的。

![Godot Turning In Place](https://docs.godotengine.org/en/stable/_images/scripting_first_script_godot_turning_in_place.gif)

> **注意**
>
> 在 C# 中，注意 `_Process()` 接受的 `delta` 参数是 `double` 类型。因此，当我们将它应用于旋转时，需要将其转换为 `float`。

### 向前移动

现在让节点移动。在 `_process()` 函数内部添加以下两行，确保新行的缩进方式与之前的 `rotation += angular_speed * delta` 行相同。

```gdscript
var velocity = Vector2.UP.rotated(rotation) * speed

position += velocity * delta
```

```csharp
var velocity = Vector2.Up.Rotated(Rotation) * _speed;

Position += velocity * (float)delta;
```

正如我们已经看到的，`var` 关键字定义了一个新变量。如果你把它放在脚本顶部，它定义的是类的一个属性。在函数内部，它定义的是局部变量：它仅在函数作用域内存在。

我们定义了一个名为 `velocity` 的局部变量，它是一个代表方向和速度的 2D 向量。为了让节点向前移动，我们从 `Vector2` 类的常量 `Vector2.UP`（一个指向上的向量）开始，通过调用 `Vector2` 的 `rotated()` 方法来旋转它。这个表达式 `Vector2.UP.rotated(rotation)` 是一个相对于我们图标指向前方的向量。乘以我们的 `speed` 属性，它就给了我们一个可以用来向前移动节点的物理速度。

我们将 `velocity * delta` 加到节点的 `position` 上来移动它。位置本身是 [Vector2](https://docs.godotengine.org/en/stable/classes/class_vector2.html) 类型，这是 Godot 中表示 2D 向量的内置类型。

运行场景，看看 Godot 头像如何转圈跑。

![Rotating Godot](https://docs.godotengine.org/en/stable/_images/scripting_first_script_rotating_godot.gif)

> **注意**
>
> 这样移动节点不会考虑与墙壁或地板的碰撞。在 [你的第一个 2D 游戏](https://docs.godotengine.org/en/stable/getting_started/first_2d_game/index.html) 中，你将学习另一种在检测碰撞的同时移动物体的方法。

我们的节点目前是自动移动的。在下一部分 [监听玩家输入](../step_by_step/scripting_player_input.md) 中，我们将使用玩家输入来控制它。

## 完整脚本

这里提供完整的 `sprite_2d.gd` 文件供参考。

```gdscript
extends Sprite2D

var speed = 400
var angular_speed = PI

func _process(delta):
	rotation += angular_speed * delta

	var velocity = Vector2.UP.rotated(rotation) * speed

	position += velocity * delta
```

```csharp
using Godot;
using System;

public partial class MySprite2D : Sprite2D
{
    private int _speed = 400;
    private float _angularSpeed = Mathf.Pi;

    public override void _Process(double delta)
    {
        Rotation += _angularSpeed * (float)delta;
        var velocity = Vector2.Up.Rotated(Rotation) * _speed;

        Position += velocity * (float)delta;
    }
}
```
