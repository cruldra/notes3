<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Python/Libraries/Fastapi/BackgroundTasks" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">BackgroundTasks | Cruldra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="BackgroundTasks | Cruldra"><meta data-rh="true" name="description" content="FastAPI ä¸­çš„ BackgroundTasks ç±»æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨è¿”å›å“åº”ä¹‹åè¿è¡Œè€—æ—¶çš„ä»»åŠ¡ã€‚è¿™å¯¹äºæé«˜ API çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦è‡³å…³é‡è¦ï¼Œå› ä¸ºç”¨æˆ·ä¸éœ€è¦ç­‰å¾…è¿™äº›ä»»åŠ¡å®Œæˆå°±å¯ä»¥æ”¶åˆ° API çš„å›å¤ã€‚"><meta data-rh="true" property="og:description" content="FastAPI ä¸­çš„ BackgroundTasks ç±»æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨è¿”å›å“åº”ä¹‹åè¿è¡Œè€—æ—¶çš„ä»»åŠ¡ã€‚è¿™å¯¹äºæé«˜ API çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦è‡³å…³é‡è¦ï¼Œå› ä¸ºç”¨æˆ·ä¸éœ€è¦ç­‰å¾…è¿™äº›ä»»åŠ¡å®Œæˆå°±å¯ä»¥æ”¶åˆ° API çš„å›å¤ã€‚"><link data-rh="true" rel="icon" href="/notes3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"å¸¸ç”¨åº“","item":"https://your-docusaurus-site.example.com/notes3/docs/category/å¸¸ç”¨åº“-2"},{"@type":"ListItem","position":2,"name":"BackgroundTasks","item":"https://your-docusaurus-site.example.com/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks"}]}</script><link rel="alternate" type="application/rss+xml" href="/notes3/blog/rss.xml" title="Cruldra RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes3/blog/atom.xml" title="Cruldra Atom Feed"><link rel="stylesheet" href="/notes3/assets/css/styles.8c4657fb.css">
<script src="/notes3/assets/js/runtime~main.a0c4d8b3.js" defer="defer"></script>
<script src="/notes3/assets/js/main.20a6d5ca.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme",window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme-choice","system"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/notes3/img/logo.svg"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_aA1M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes3/"><div class="navbar__logo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--light_DVqC"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--dark_B_L3"></div><b class="navbar__title text--truncate">Cruldra</b></a><a class="navbar__item navbar__link" href="/notes3/docs/category/è®¾è®¡æ¨¡å¼">JVM</a><a class="navbar__item navbar__link" href="/notes3/docs/category/css">å‰ç«¯</a><a class="navbar__item navbar__link" href="/notes3/docs/category/astrbot">å·¥å…·</a><a class="navbar__item navbar__link" href="/notes3/docs/category/aiç”µç«é…’åº—">ä¸ªäºº</a><a class="navbar__item navbar__link" href="/notes3/docs/AI/ACP/æ¶æ„">AI</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes3/docs/category/å†…ç½®æ¨¡å—">Python</a><a class="navbar__item navbar__link" href="/notes3/docs/category/actix-web">Rust</a><a class="navbar__item navbar__link" href="/notes3/docs/category/æ•°æ®åº“ç³»ç»Ÿ">è½¯ä»¶å·¥ç¨‹</a><a class="navbar__item navbar__link" href="/notes3/docs/category/ä¸Šå¤å·è½´5">æ¸¸æˆ</a><a class="navbar__item navbar__link" href="/notes3/docs/Go/Go-Python-Javaä¸‰è¯­è¨€å…¨æ–¹ä½å¯¹æ¯”">Go</a><a class="navbar__item navbar__link" href="/notes3/docs/Hardware/intro">ç¡¬ä»¶</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_PufJ"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ctfR"><div class="docsWrapper_ByIB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KwvU" type="button"></button><div class="docRoot_hD6z"><aside class="theme-doc-sidebar-container docSidebarContainer_KuHC"><div class="sidebarViewport_LCjr"><div class="sidebar_L77d"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VYAF"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/category/å†…ç½®æ¨¡å—"><span title="å†…ç½®æ¨¡å—" class="categoryLinkLabel_FHN4">å†…ç½®æ¨¡å—</span></a><button aria-label="Expand sidebar category &#x27;å†…ç½®æ¨¡å—&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--active" href="/notes3/docs/category/å¸¸ç”¨åº“-2"><span title="å¸¸ç”¨åº“" class="categoryLinkLabel_FHN4">å¸¸ç”¨åº“</span></a><button aria-label="Collapse sidebar category &#x27;å¸¸ç”¨åº“&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" tabindex="0" href="/notes3/docs/category/å®‰å…¨ç®¡ç†"><span title="å®‰å…¨ç®¡ç†" class="categoryLinkLabel_FHN4">å®‰å…¨ç®¡ç†</span></a><button aria-label="Expand sidebar category &#x27;å®‰å…¨ç®¡ç†&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" tabindex="0" href="/notes3/docs/category/æ•°æ®åº“-1"><span title="æ•°æ®åº“" class="categoryLinkLabel_FHN4">æ•°æ®åº“</span></a><button aria-label="Expand sidebar category &#x27;æ•°æ®åº“&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" tabindex="0" href="/notes3/docs/category/æ–‡æ¡£ç®¡ç†"><span title="æ–‡æ¡£ç®¡ç†" class="categoryLinkLabel_FHN4">æ–‡æ¡£ç®¡ç†</span></a><button aria-label="Expand sidebar category &#x27;æ–‡æ¡£ç®¡ç†&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" tabindex="0" href="/notes3/docs/category/è‡ªåŠ¨åŒ–"><span title="è‡ªåŠ¨åŒ–" class="categoryLinkLabel_FHN4">è‡ªåŠ¨åŒ–</span></a><button aria-label="Expand sidebar category &#x27;è‡ªåŠ¨åŒ–&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" tabindex="0" href="/notes3/docs/category/é˜¿é‡Œäº‘"><span title="é˜¿é‡Œäº‘" class="categoryLinkLabel_FHN4">é˜¿é‡Œäº‘</span></a><button aria-label="Expand sidebar category &#x27;é˜¿é‡Œäº‘&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" tabindex="0" href="/notes3/docs/category/asgiæœåŠ¡å™¨"><span title="ASGIæœåŠ¡å™¨" class="categoryLinkLabel_FHN4">ASGIæœåŠ¡å™¨</span></a><button aria-label="Expand sidebar category &#x27;ASGIæœåŠ¡å™¨&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks"><span title="Fastapi" class="categoryLinkLabel_FHN4">Fastapi</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes3/docs/Python/Libraries/Fastapi/BackgroundTasks"><span title="BackgroundTasks" class="linkLabel__RqX">BackgroundTasks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/Libraries/Fastapi/ç®€ä»‹"><span title="ç®€ä»‹" class="linkLabel__RqX">ç®€ä»‹</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/notes3/docs/Python/Libraries/Gui/PySide6ä¸PyQtå¯¹æ¯”"><span title="Gui" class="categoryLinkLabel_FHN4">Gui</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/notes3/docs/Python/Libraries/Plumbum/ç®€ä»‹"><span title="Plumbum" class="categoryLinkLabel_FHN4">Plumbum</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/Libraries/PydanticSettings"><span title="PydanticSettings" class="linkLabel__RqX">PydanticSettings</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/Libraries/Pyperclip"><span title="Pyperclip" class="linkLabel__RqX">Pyperclip</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/Libraries/Tenacity"><span title="Tenacity" class="linkLabel__RqX">Tenacity</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/Libraries/Typer"><span title="Typer" class="linkLabel__RqX">Typer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/Libraries/ä»»åŠ¡è°ƒåº¦"><span title="ä»»åŠ¡è°ƒåº¦" class="linkLabel__RqX">ä»»åŠ¡è°ƒåº¦</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/category/å¼‚æ­¥"><span title="å¼‚æ­¥" class="categoryLinkLabel_FHN4">å¼‚æ­¥</span></a><button aria-label="Expand sidebar category &#x27;å¼‚æ­¥&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/OCRæ–¹æ¡ˆ"><span title="Python OCRæ–¹æ¡ˆ" class="linkLabel__RqX">Python OCRæ–¹æ¡ˆ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/SSE"><span title="SSE" class="linkLabel__RqX">SSE</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/stagehand_comprehensive_guide"><span title="ğŸ­ Stagehand å®Œå…¨æŒ‡å—" class="linkLabel__RqX">ğŸ­ Stagehand å®Œå…¨æŒ‡å—</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/å¾®ä¿¡å®¢æœ"><span title="å¾®ä¿¡å®¢æœ" class="linkLabel__RqX">å¾®ä¿¡å®¢æœ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/å¾®ä¿¡æ”¯ä»˜"><span title="å¾®ä¿¡æ”¯ä»˜" class="linkLabel__RqX">å¾®ä¿¡æ”¯ä»˜</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/æšä¸¾"><span title="æšä¸¾" class="linkLabel__RqX">æšä¸¾</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/æ¨¡å—åŒ–"><span title="æ¨¡å—åŒ–" class="linkLabel__RqX">æ¨¡å—åŒ–</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/æµå¼UTF-8è§£ç æœ€ä½³å®è·µ"><span title="æµå¼UTF-8è§£ç æœ€ä½³å®è·µ" class="linkLabel__RqX">æµå¼UTF-8è§£ç æœ€ä½³å®è·µ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/æºç ä¿æŠ¤"><span title="æºç ä¿æŠ¤" class="linkLabel__RqX">æºç ä¿æŠ¤</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/è½»é‡çº§webåº”ç”¨æŠ€æœ¯æ ˆ"><span title="è½»é‡çº§webåº”ç”¨æŠ€æœ¯æ ˆ" class="linkLabel__RqX">è½»é‡çº§webåº”ç”¨æŠ€æœ¯æ ˆ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/é­”æœ¯æ–¹æ³•"><span title="é­”æœ¯æ–¹æ³•" class="linkLabel__RqX">é­”æœ¯æ–¹æ³•</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_WxcZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Zd2x"><div class="docItemContainer_EEW4"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xL_w" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_zA1U"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/notes3/docs/category/å¸¸ç”¨åº“-2"><span>å¸¸ç”¨åº“</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Fastapi</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">BackgroundTasks</span></li></ul></nav><div class="tocCollapsible_aZGz theme-doc-toc-mobile tocMobile_ShCt"><button type="button" class="clean-btn tocCollapsibleButton_fxzH">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>BackgroundTasks</h1></header><p>FastAPI ä¸­çš„ <code>BackgroundTasks</code> ç±»æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå…è®¸ä½ åœ¨<strong>è¿”å›å“åº”ä¹‹å</strong>è¿è¡Œè€—æ—¶çš„ä»»åŠ¡ã€‚è¿™å¯¹äºæé«˜ API çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦è‡³å…³é‡è¦ï¼Œå› ä¸ºç”¨æˆ·ä¸éœ€è¦ç­‰å¾…è¿™äº›ä»»åŠ¡å®Œæˆå°±å¯ä»¥æ”¶åˆ° API çš„å›å¤ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å…³äº <code>BackgroundTasks</code> çš„è¯¦ç»†è§£é‡Šï¼š</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="1-æ ¸å¿ƒæ¦‚å¿µ">1. æ ¸å¿ƒæ¦‚å¿µ<a href="#1-æ ¸å¿ƒæ¦‚å¿µ" class="hash-link" aria-label="Direct link to 1. æ ¸å¿ƒæ¦‚å¿µ" title="Direct link to 1. æ ¸å¿ƒæ¦‚å¿µ" translate="no">â€‹</a></h3>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ä½ è¯·æ±‚ä¸€ä¸ª API æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå¤„ç†è¯·æ±‚ï¼Œç„¶åè¿”å›å“åº”ã€‚å¦‚æœå¤„ç†è¿‡ç¨‹ï¼ˆä¾‹å¦‚å‘é€é‚®ä»¶ã€å¤„ç†å›¾åƒã€ç”ŸæˆæŠ¥å‘Šï¼‰éå¸¸æ…¢ï¼Œç”¨æˆ·å°±å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚</p>
<p><code>BackgroundTasks</code> è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li class="">å®¢æˆ·ç«¯å‘é€è¯·æ±‚ã€‚</li>
<li class="">FastAPI å®šä¹‰è¯¥ä»»åŠ¡ï¼ˆä¾‹å¦‚â€œå‘é€é‚®ä»¶â€ï¼‰ï¼Œä½†<strong>ä¸ç«‹å³æ‰§è¡Œ</strong>ã€‚</li>
<li class="">FastAPI <strong>ç«‹å³</strong>å‘å®¢æˆ·ç«¯è¿”å›å“åº”ï¼ˆä¾‹å¦‚ <code>HTTP 202 Accepted</code> æˆ– JSON æ¶ˆæ¯ï¼‰ã€‚</li>
<li class="">åœ¨å“åº”å‘é€å®Œæ¯•åï¼ŒFastAPI åœ¨åå°è‡ªåŠ¨æ‰§è¡Œä¹‹å‰å®šä¹‰çš„ä»»åŠ¡ã€‚</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="2-ä½•æ—¶ä½¿ç”¨">2. ä½•æ—¶ä½¿ç”¨<a href="#2-ä½•æ—¶ä½¿ç”¨" class="hash-link" aria-label="Direct link to 2. ä½•æ—¶ä½¿ç”¨" title="Direct link to 2. ä½•æ—¶ä½¿ç”¨" translate="no">â€‹</a></h3>
<p>é€šè¿‡ä½¿ç”¨åå°ä»»åŠ¡ï¼Œä½ å¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ul>
<li class=""><strong>å‘é€ç”µå­é‚®ä»¶é€šçŸ¥</strong>ï¼šç”¨æˆ·æ³¨å†Œåï¼Œç«‹å³è¿”å›â€œæ³¨å†ŒæˆåŠŸâ€ï¼Œåå°æ…¢æ…¢å‘ç¡®è®¤é‚®ä»¶ã€‚</li>
<li class=""><strong>æ•°æ®å¤„ç†</strong>ï¼šä¸Šä¼ æ–‡ä»¶åï¼Œç«‹å³è¿”å›â€œä¸Šä¼ æˆåŠŸâ€ï¼Œåå°æ…¢æ…¢å‹ç¼©å›¾ç‰‡æˆ–è§£æ CSVã€‚</li>
<li class=""><strong>è®°å½•æ—¥å¿—æˆ–ç»Ÿè®¡</strong>ï¼šè®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œä¸å½±å“å“åº”é€Ÿåº¦ã€‚</li>
<li class=""><strong>è§¦å‘å¤–éƒ¨ API</strong>ï¼šå¼‚æ­¥é€šçŸ¥ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="3-å¦‚ä½•ä½¿ç”¨">3. å¦‚ä½•ä½¿ç”¨<a href="#3-å¦‚ä½•ä½¿ç”¨" class="hash-link" aria-label="Direct link to 3. å¦‚ä½•ä½¿ç”¨" title="Direct link to 3. å¦‚ä½•ä½¿ç”¨" translate="no">â€‹</a></h3>
<p>ä½¿ç”¨ <code>BackgroundTasks</code> éå¸¸ç®€å•ï¼Œåªéœ€å°†å…¶ä½œä¸ºè·¯å¾„æ“ä½œå‡½æ•°çš„å‚æ•°å£°æ˜å³å¯ã€‚</p>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="åŸºç¡€ç¤ºä¾‹å‘é€é‚®ä»¶">åŸºç¡€ç¤ºä¾‹ï¼šå‘é€é‚®ä»¶<a href="#åŸºç¡€ç¤ºä¾‹å‘é€é‚®ä»¶" class="hash-link" aria-label="Direct link to åŸºç¡€ç¤ºä¾‹ï¼šå‘é€é‚®ä»¶" title="Direct link to åŸºç¡€ç¤ºä¾‹ï¼šå‘é€é‚®ä»¶" translate="no">â€‹</a></h4>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BackgroundTasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># å®šä¹‰ä¸€ä¸ªæ™®é€šçš„ Python å‡½æ•°ä½œä¸ºä»»åŠ¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">write_notification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;log.txt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;notification for </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">email</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">message</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/send-notification/{email}&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_notification</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> background_tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BackgroundTasks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># å°†ä»»åŠ¡æ·»åŠ åˆ°åå°ä»»åŠ¡é˜Ÿåˆ—ä¸­</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># add_task(å‡½æ•°å, å‚æ•°1, å‚æ•°2, ...)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    background_tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">write_notification</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;some notification&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ç«‹å³è¿”å›å“åº”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Notification sent in the background&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="4-backgroundtasks-çš„å·¥ä½œåŸç†">4. <code>BackgroundTasks</code> çš„å·¥ä½œåŸç†<a href="#4-backgroundtasks-çš„å·¥ä½œåŸç†" class="hash-link" aria-label="Direct link to 4-backgroundtasks-çš„å·¥ä½œåŸç†" title="Direct link to 4-backgroundtasks-çš„å·¥ä½œåŸç†" translate="no">â€‹</a></h3>
<ul>
<li class=""><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šFastAPI é€šè¿‡ä¾èµ–æ³¨å…¥ç³»ç»Ÿæä¾› <code>BackgroundTasks</code> å®ä¾‹ã€‚</li>
<li class=""><strong><code>add_task</code> æ–¹æ³•</strong>ï¼šè¿™æ˜¯æœ€æ ¸å¿ƒçš„æ–¹æ³•ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ï¼‰ä»¥åŠè¯¥å‡½æ•°æ‰€éœ€çš„å‚æ•°ã€‚<!-- -->
<ul>
<li class="">è¯­æ³•ï¼š<code>background_tasks.add_task(func, *args, **kwargs)</code></li>
</ul>
</li>
<li class=""><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šå½“è·¯ç”±å‡½æ•°è¿”å›å“åº”ï¼ˆreturnï¼‰ä¹‹åï¼ŒStarletteï¼ˆFastAPI çš„åº•å±‚æ¡†æ¶ï¼‰ä¼šæ¥ç®¡å¹¶æ‰§è¡Œæ·»åŠ åˆ° <code>background_tasks</code> ä¸­çš„æ‰€æœ‰ä»»åŠ¡ã€‚</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="5-é«˜çº§ç”¨æ³•">5. é«˜çº§ç”¨æ³•<a href="#5-é«˜çº§ç”¨æ³•" class="hash-link" aria-label="Direct link to 5. é«˜çº§ç”¨æ³•" title="Direct link to 5. é«˜çº§ç”¨æ³•" translate="no">â€‹</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="åœ¨ä¾èµ–é¡¹ä¸­ä½¿ç”¨-backgroundtasks">åœ¨ä¾èµ–é¡¹ä¸­ä½¿ç”¨ BackgroundTasks<a href="#åœ¨ä¾èµ–é¡¹ä¸­ä½¿ç”¨-backgroundtasks" class="hash-link" aria-label="Direct link to åœ¨ä¾èµ–é¡¹ä¸­ä½¿ç”¨ BackgroundTasks" title="Direct link to åœ¨ä¾èµ–é¡¹ä¸­ä½¿ç”¨ BackgroundTasks" translate="no">â€‹</a></h4>
<p>ä½ ä¹Ÿå¯ä»¥åœ¨ FastAPI çš„ä¾èµ–é¡¹ï¼ˆDependencyï¼‰ä¸­ä½¿ç”¨ <code>BackgroundTasks</code>ã€‚è¿™æœ‰åŠ©äºä»£ç å¤ç”¨ã€‚</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> fastapi </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BackgroundTasks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Depends</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FastAPI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">write_log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;log.txt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">message</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">background_tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BackgroundTasks</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> q</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Found query: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">q</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        background_tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">write_log</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/audit/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">audit_logging</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">q</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Depends</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">get_query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Log request received&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="ä¸-async-def-ä¸€èµ·ä½¿ç”¨">ä¸ <code>async def</code> ä¸€èµ·ä½¿ç”¨<a href="#ä¸-async-def-ä¸€èµ·ä½¿ç”¨" class="hash-link" aria-label="Direct link to ä¸-async-def-ä¸€èµ·ä½¿ç”¨" title="Direct link to ä¸-async-def-ä¸€èµ·ä½¿ç”¨" translate="no">â€‹</a></h4>
<p>åå°ä»»åŠ¡å‡½æ•°æ—¢å¯ä»¥æ˜¯æ™®é€šçš„ <code>def</code> å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ <code>async def</code> å‡½æ•°ã€‚å¦‚æœä»»åŠ¡æ¶‰åŠ I/O æ“ä½œï¼ˆå¦‚æ•°æ®åº“è°ƒç”¨ã€HTTP è¯·æ±‚ï¼‰ï¼Œä½¿ç”¨ <code>async def</code> å¹¶åœ¨å†…éƒ¨ä½¿ç”¨ <code>await</code> ä¼šæ›´é«˜æ•ˆã€‚</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">async_heavy_task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> asyncio</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-interpolation string" style="color:#e3116c">f&quot;Processed: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">data</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/process/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">background_tasks</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BackgroundTasks</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    background_tasks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_task</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">async_heavy_task</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;id&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;status&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Processing initiated&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="6-æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§">6. æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§<a href="#6-æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§" class="hash-link" aria-label="Direct link to 6. æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§" title="Direct link to 6. æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§" translate="no">â€‹</a></h3>
<p>è™½ç„¶ <code>BackgroundTasks</code> å¾ˆæ–¹ä¾¿ï¼Œä½†å®ƒ<strong>ä¸é€‚åˆ</strong>ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li class=""><strong>æåº¦ç¹é‡çš„è®¡ç®—ä»»åŠ¡</strong>ï¼šç”±äºåå°ä»»åŠ¡ä»åœ¨åŒä¸€ä¸ª Python è¿›ç¨‹ï¼ˆæˆ– Workerï¼‰ä¸­è¿è¡Œï¼Œå¦‚æœä½ è¿›è¡Œéå¸¸ç¹é‡çš„ CPU å¯†é›†å‹è®¡ç®—ï¼ˆå¦‚å¤æ‚çš„æ•°å­¦å»ºæ¨¡ã€è§†é¢‘è½¬ç ï¼‰ï¼Œå®ƒä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œä»è€Œå¯¼è‡´è¯¥ Worker æ— æ³•å¤„ç†æ–°çš„ API è¯·æ±‚ã€‚</li>
<li class=""><strong>å¿…é¡»ä¿è¯æ‰§è¡Œçš„ä»»åŠ¡ï¼ˆæŒä¹…åŒ–ï¼‰</strong>ï¼š<code>BackgroundTasks</code> å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å¦‚æœæœåŠ¡å™¨åœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å´©æºƒæˆ–é‡å¯ï¼Œä»»åŠ¡å°†ä¼š<strong>ä¸¢å¤±</strong>ã€‚</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼ˆCelery / Redis Queueï¼‰</strong>ï¼š
å¯¹äºä¸Šè¿°ä¸¤ç§æƒ…å†µï¼Œç‰¹åˆ«æ˜¯å¿…é¡»è¦ä¿è¯ä»»åŠ¡ä¸ä¸¢å¤±çš„åœºæ™¯ï¼Œä½ åº”è¯¥ä½¿ç”¨æ›´ä¸“ä¸šçš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼Œå¦‚ <strong>Celery</strong>ã€<strong>RabbitMQ</strong> æˆ– <strong>Redis Queue (RQ)</strong>ã€‚</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="æ€»ç»“">æ€»ç»“<a href="#æ€»ç»“" class="hash-link" aria-label="Direct link to æ€»ç»“" title="Direct link to æ€»ç»“" translate="no">â€‹</a></h3>
<ul>
<li class=""><strong>ç±»å</strong>ï¼š<code>fastapi.BackgroundTasks</code></li>
<li class=""><strong>ç”¨é€”</strong>ï¼šåœ¨ API å‘é€å“åº”åæ‰§è¡Œä»£ç ã€‚</li>
<li class=""><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•æ˜“ç”¨ï¼Œä¸éœ€è¦é¢å¤–çš„ç»„ä»¶ï¼ˆå¦‚ Redisï¼‰ï¼Œéé˜»å¡ç”¨æˆ·ç­‰å¾…ã€‚</li>
<li class=""><strong>å±€é™</strong>ï¼šä»»åŠ¡ä¸ä»…ä¹…åŒ–ï¼ŒæœåŠ¡å™¨é‡å¯ä¼šä¸¢å¤±ï¼›ä¸é€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡ã€‚</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_iDCr"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Python/Libraries/Fastapi/BackgroundTasks.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_c0mv" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mxtt"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes3/docs/Python/Libraries/ASGI/Uvicorn"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Uvicorn</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes3/docs/Python/Libraries/Fastapi/ç®€ä»‹"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ç®€ä»‹</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_r83r thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-æ ¸å¿ƒæ¦‚å¿µ" class="table-of-contents__link toc-highlight">1. æ ¸å¿ƒæ¦‚å¿µ</a></li><li><a href="#2-ä½•æ—¶ä½¿ç”¨" class="table-of-contents__link toc-highlight">2. ä½•æ—¶ä½¿ç”¨</a></li><li><a href="#3-å¦‚ä½•ä½¿ç”¨" class="table-of-contents__link toc-highlight">3. å¦‚ä½•ä½¿ç”¨</a></li><li><a href="#4-backgroundtasks-çš„å·¥ä½œåŸç†" class="table-of-contents__link toc-highlight">4. <code>BackgroundTasks</code> çš„å·¥ä½œåŸç†</a></li><li><a href="#5-é«˜çº§ç”¨æ³•" class="table-of-contents__link toc-highlight">5. é«˜çº§ç”¨æ³•</a></li><li><a href="#6-æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§" class="table-of-contents__link toc-highlight">6. æ³¨æ„äº‹é¡¹ä¸å±€é™æ€§</a></li><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes3/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>