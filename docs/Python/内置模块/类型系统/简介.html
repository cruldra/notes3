<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Python/内置模块/类型系统/简介" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">简介 | Cruldra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/notes3/docs/Python/内置模块/类型系统/简介"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="简介 | Cruldra"><meta data-rh="true" name="description" content="1. 概述 (Introduction)"><meta data-rh="true" property="og:description" content="1. 概述 (Introduction)"><link data-rh="true" rel="icon" href="/notes3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/notes3/docs/Python/内置模块/类型系统/简介"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/Python/内置模块/类型系统/简介" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/Python/内置模块/类型系统/简介" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"内置模块","item":"https://your-docusaurus-site.example.com/notes3/docs/category/内置模块"},{"@type":"ListItem","position":2,"name":"简介","item":"https://your-docusaurus-site.example.com/notes3/docs/Python/内置模块/类型系统/简介"}]}</script><link rel="alternate" type="application/rss+xml" href="/notes3/blog/rss.xml" title="Cruldra RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes3/blog/atom.xml" title="Cruldra Atom Feed"><link rel="stylesheet" href="/notes3/assets/css/styles.8c4657fb.css">
<script src="/notes3/assets/js/runtime~main.d7acfa00.js" defer="defer"></script>
<script src="/notes3/assets/js/main.b254c009.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme",window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme-choice","system"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/notes3/img/logo.svg"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_aA1M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes3/"><div class="navbar__logo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--light_DVqC"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--dark_B_L3"></div><b class="navbar__title text--truncate">Cruldra</b></a><a class="navbar__item navbar__link" href="/notes3/docs/category/设计模式">JVM</a><a class="navbar__item navbar__link" href="/notes3/docs/category/css">前端</a><a class="navbar__item navbar__link" href="/notes3/docs/category/astrbot">工具</a><a class="navbar__item navbar__link" href="/notes3/docs/category/ai电竞酒店">个人</a><a class="navbar__item navbar__link" href="/notes3/docs/AI/ACP/架构">AI</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes3/docs/category/内置模块">Python</a><a class="navbar__item navbar__link" href="/notes3/docs/category/actix-web">Rust</a><a class="navbar__item navbar__link" href="/notes3/docs/category/数据库系统">软件工程</a><a class="navbar__item navbar__link" href="/notes3/docs/category/上古卷轴5">游戏</a><a class="navbar__item navbar__link" href="/notes3/docs/Go/Go-Python-Java三语言全方位对比">Go</a><a class="navbar__item navbar__link" href="/notes3/docs/Hardware/intro">硬件</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_PufJ"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ctfR"><div class="docsWrapper_ByIB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KwvU" type="button"></button><div class="docRoot_hD6z"><aside class="theme-doc-sidebar-container docSidebarContainer_KuHC"><div class="sidebarViewport_LCjr"><div class="sidebar_L77d"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VYAF"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--active" href="/notes3/docs/category/内置模块"><span title="内置模块" class="categoryLinkLabel_FHN4">内置模块</span></a><button aria-label="Collapse sidebar category &#x27;内置模块&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/内置模块/asyncio"><span title="asyncio" class="linkLabel__RqX">asyncio</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/内置模块/configparser"><span title="configparser" class="linkLabel__RqX">configparser</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/内置模块/contextlib"><span title="contextlib" class="linkLabel__RqX">contextlib</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/内置模块/subprocess"><span title="subprocess" class="linkLabel__RqX">subprocess</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/notes3/docs/Python/内置模块/类型系统/简介"><span title="类型系统" class="categoryLinkLabel_FHN4">类型系统</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes3/docs/Python/内置模块/类型系统/简介"><span title="简介" class="linkLabel__RqX">简介</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/Python/内置模块/类型系统/tuple"><span title="tuple" class="linkLabel__RqX">tuple</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/category/异步"><span title="异步" class="categoryLinkLabel_FHN4">异步</span></a><button aria-label="Expand sidebar category &#x27;异步&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/category/常用库-2"><span title="常用库" class="categoryLinkLabel_FHN4">常用库</span></a><button aria-label="Expand sidebar category &#x27;常用库&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/OCR方案"><span title="Python OCR方案" class="linkLabel__RqX">Python OCR方案</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/SSE"><span title="SSE" class="linkLabel__RqX">SSE</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/微信客服"><span title="微信客服" class="linkLabel__RqX">微信客服</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/微信支付"><span title="微信支付" class="linkLabel__RqX">微信支付</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/枚举"><span title="枚举" class="linkLabel__RqX">枚举</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/模块化"><span title="模块化" class="linkLabel__RqX">模块化</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/流式UTF-8解码最佳实践"><span title="流式UTF-8解码最佳实践" class="linkLabel__RqX">流式UTF-8解码最佳实践</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/源码保护"><span title="源码保护" class="linkLabel__RqX">源码保护</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/矩阵运算符"><span title="矩阵运算符" class="linkLabel__RqX">矩阵运算符</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/Python/轻量级web应用技术栈"><span title="轻量级web应用技术栈" class="linkLabel__RqX">轻量级web应用技术栈</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/Python/魔术方法/call"><span title="魔术方法" class="categoryLinkLabel_FHN4">魔术方法</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_WxcZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Zd2x"><div class="docItemContainer_EEW4"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xL_w" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_zA1U"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/notes3/docs/category/内置模块"><span>内置模块</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">类型系统</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">简介</span></li></ul></nav><div class="tocCollapsible_aZGz theme-doc-toc-mobile tocMobile_ShCt"><button type="button" class="clean-btn tocCollapsibleButton_fxzH">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>简介</h1></header><h2 class="anchor anchorTargetStickyNavbar_aDle" id="1-概述-introduction">1. 概述 (Introduction)<a href="#1-概述-introduction" class="hash-link" aria-label="Direct link to 1. 概述 (Introduction)" title="Direct link to 1. 概述 (Introduction)" translate="no">​</a></h2>
<p>Python 的类型系统是<strong>渐进式 (Gradual Typing)</strong> 的。这意味着 Python 允许程序中部分代码是动态类型的（默认行为），而部分代码是静态类型的（通过类型提示）。<code>typing</code> 模块是这一体系的核心，提供了构建复杂类型签名的词汇表。</p>
<p>与 Java 或 C++ 等静态语言不同，Python 的类型注解<strong>不会影响运行时行为</strong>（除了极少数例外，如 <code>dataclasses</code> 或 <code>singledispatch</code>）。它们主要用于：</p>
<ol>
<li class=""><strong>静态分析</strong>：供 <code>mypy</code>、<code>pyright</code> 等工具在代码运行前捕获错误。</li>
<li class=""><strong>IDE 支持</strong>：提供更精准的代码补全和重构建议。</li>
<li class=""><strong>文档化</strong>：作为机器可读的文档。</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="2-类型系统架构-type-system-architecture">2. 类型系统架构 (Type System Architecture)<a href="#2-类型系统架构-type-system-architecture" class="hash-link" aria-label="Direct link to 2. 类型系统架构 (Type System Architecture)" title="Direct link to 2. 类型系统架构 (Type System Architecture)" translate="no">​</a></h2>
<p>Python 的类型层级结构具有独特的“双顶端”特性。</p>
<!-- -->
<ul>
<li class=""><strong><code>Any</code></strong>: 既是所有类型的子类型（Subtype），也是所有类型的父类型（Supertype）。它是静态类型检查的“逃生舱”，任何对象都可以赋值给 <code>Any</code>，<code>Any</code> 也可以赋值给任何对象。</li>
<li class=""><strong><code>object</code></strong>: 真正的类层级顶端。所有类型都是 <code>object</code> 的子类。但 <code>object</code> 不能赋值给具体的类型（如 <code>int</code>）。</li>
<li class=""><strong><code>Never</code> (或 <code>NoReturn</code>)</strong>: 底类型（Bottom Type）。没有任何值属于此类型，通常用于表示不可达代码或死循环函数的返回值。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="3-泛型与变变性-generics--variance">3. 泛型与变变性 (Generics &amp; Variance)<a href="#3-泛型与变变性-generics--variance" class="hash-link" aria-label="Direct link to 3. 泛型与变变性 (Generics &amp; Variance)" title="Direct link to 3. 泛型与变变性 (Generics &amp; Variance)" translate="no">​</a></h2>
<p>泛型允许定义关于类型参数的类或函数。理解泛型的核心在于理解<strong>变变性 (Variance)</strong>，即复合类型的子类型关系如何随其组件类型的子类型关系变化。</p>
<p>假设 <code>Cat</code> 是 <code>Animal</code> 的子类 (<code>Cat &lt;: Animal</code>)：</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="31-变变性分类">3.1 变变性分类<a href="#31-变变性分类" class="hash-link" aria-label="Direct link to 3.1 变变性分类" title="Direct link to 3.1 变变性分类" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">类型</th><th style="text-align:left">描述</th><th style="text-align:left">数学符号</th><th style="text-align:left">示例</th></tr></thead><tbody><tr><td style="text-align:left"><strong>协变 (Covariant)</strong></td><td style="text-align:left">保持子类型关系</td><td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&lt;</mo><mo>:</mo><mi>U</mi><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>C</mi><mo stretchy="false">[</mo><mi>T</mi><mo stretchy="false">]</mo><mo>&lt;</mo><mo>:</mo><mi>C</mi><mo stretchy="false">[</mo><mi>U</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">T &lt;: U \implies C[T] &lt;: C[U]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em"></span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7073em;vertical-align:-0.024em"></span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mclose">]</span></span></span></span></td><td style="text-align:left"><code>Sequence[Cat] &lt;: Sequence[Animal]</code> (只读容器通常是协变的)</td></tr><tr><td style="text-align:left"><strong>逆变 (Contravariant)</strong></td><td style="text-align:left">翻转子类型关系</td><td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&lt;</mo><mo>:</mo><mi>U</mi><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext><mi>C</mi><mo stretchy="false">[</mo><mi>U</mi><mo stretchy="false">]</mo><mo>&lt;</mo><mo>:</mo><mi>C</mi><mo stretchy="false">[</mo><mi>T</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">T &lt;: U \implies C[U] &lt;: C[T]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em"></span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.7073em;vertical-align:-0.024em"></span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mclose">]</span></span></span></span></td><td style="text-align:left"><code>Callable[[Animal], None] &lt;: Callable[[Cat], None]</code> (函数参数通常是逆变的)</td></tr><tr><td style="text-align:left"><strong>不变 (Invariant)</strong></td><td style="text-align:left">无子类型关系</td><td style="text-align:left"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&lt;</mo><mo>:</mo><mi>U</mi><mo>⇏</mo><mi>C</mi><mo stretchy="false">[</mo><mi>T</mi><mo stretchy="false">]</mo><mo>∼</mo><mi>C</mi><mo stretchy="false">[</mo><mi>U</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">T &lt;: U \nRightarrow C[T] \sim C[U]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em"></span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">&lt;:</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6833em"></span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel amsrm">⇏</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.07153em">C</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em">U</span><span class="mclose">]</span></span></span></span></td><td style="text-align:left"><code>List[Cat]</code> 与 <code>List[Animal]</code> 互不兼容 (可变容器必须是不变的)</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="32-定义泛型-python-312-syntax">3.2 定义泛型 (Python 3.12+ Syntax)<a href="#32-定义泛型-python-312-syntax" class="hash-link" aria-label="Direct link to 3.2 定义泛型 (Python 3.12+ Syntax)" title="Direct link to 3.2 定义泛型 (Python 3.12+ Syntax)" translate="no">​</a></h3>
<p>Python 3.12 引入了 <strong>PEP 695</strong>，大大简化了泛型语法。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 旧语法 (Pre-3.12)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Generic</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Sequence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;T&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 默认为 Invariant</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Stack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Generic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 新语法 (Python 3.12+)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Stack</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 自动推断 variance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> T</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 定义协变泛型 (只读)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReadOnlyBox</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 如果仅作为返回值，T 会被自动推断为协变</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> T</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="33-显式控制-variance-旧语法">3.3 显式控制 Variance (旧语法)<a href="#33-显式控制-variance-旧语法" class="hash-link" aria-label="Direct link to 3.3 显式控制 Variance (旧语法)" title="Direct link to 3.3 显式控制 Variance (旧语法)" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TypeVar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T_co </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;T_co&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> covariant</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 协变</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T_contra </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;T_contra&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> contravariant</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 逆变</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Producer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Generic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T_co</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 只出不进</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Consumer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Generic</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">T_contra</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 只进不出</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="4-结构化子类型-structural-subtyping--protocols">4. 结构化子类型 (Structural Subtyping / Protocols)<a href="#4-结构化子类型-structural-subtyping--protocols" class="hash-link" aria-label="Direct link to 4. 结构化子类型 (Structural Subtyping / Protocols)" title="Direct link to 4. 结构化子类型 (Structural Subtyping / Protocols)" translate="no">​</a></h2>
<p>Python 传统上使用“鸭子类型” (Duck Typing)。<code>typing.Protocol</code> 将这种动态概念引入了静态类型系统，称为<strong>结构化子类型 (Structural Subtyping)</strong>。</p>
<p>与名义子类型 (Nominal Subtyping, 如继承) 不同，结构化子类型只关心“它有什么方法/属性”，而不关心“它继承自谁”。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Protocol</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> runtime_checkable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@runtime_checkable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Renderable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Protocol</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;定义一个协议：任何具有 render 方法并返回 str 的类都满足此协议&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Report</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 不需要继承 Renderable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Report Content&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Renderable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">render</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Report</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ✅ 通过静态检查</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong><code>@runtime_checkable</code></strong>: 允许在运行时使用 <code>isinstance(obj, Renderable)</code>。默认情况下，Protocol 仅用于静态分析。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="5-高级类型构造-advanced-type-constructors">5. 高级类型构造 (Advanced Type Constructors)<a href="#5-高级类型构造-advanced-type-constructors" class="hash-link" aria-label="Direct link to 5. 高级类型构造 (Advanced Type Constructors)" title="Direct link to 5. 高级类型构造 (Advanced Type Constructors)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="51-annotated">5.1 <code>Annotated</code><a href="#51-annotated" class="hash-link" aria-label="Direct link to 51-annotated" title="Direct link to 51-annotated" translate="no">​</a></h3>
<p>用于附加元数据，这些元数据会被类型检查器忽略，但可供运行时框架（如 FastAPI, Pydantic）使用。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Annotated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># &quot;Metadata&quot; 对类型检查器不可见，但库可以读取它进行验证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Age </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Annotated</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;必须大于0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;小于120&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="52-typevartuple-variadic-generics">5.2 <code>TypeVarTuple</code> (Variadic Generics)<a href="#52-typevartuple-variadic-generics" class="hash-link" aria-label="Direct link to 52-typevartuple-variadic-generics" title="Direct link to 52-typevartuple-variadic-generics" translate="no">​</a></h3>
<p>用于处理不定数量的类型参数，常见于张量库（如 PyTorch, TensorFlow）或类似 <code>zip</code> 的函数。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TypeVarTuple</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Unpack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TypeVarTuple</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Ts&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">move_first_to_last</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">tuple</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Unpack</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Ts</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">tuple</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Unpack</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Ts</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">tup</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tup</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="53-paramspec">5.3 <code>ParamSpec</code><a href="#53-paramspec" class="hash-link" aria-label="Direct link to 53-paramspec" title="Direct link to 53-paramspec" translate="no">​</a></h3>
<p>用于精确保留被装饰函数的参数签名。这是编写装饰器时的最佳实践。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ParamSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ParamSpec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;P&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;R&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">logging_decorator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">func</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">P</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">P</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wrapper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> P</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> R</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Calling...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> wrapper</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="6-类型字典与字面量-typeddict--literal">6. 类型字典与字面量 (TypedDict &amp; Literal)<a href="#6-类型字典与字面量-typeddict--literal" class="hash-link" aria-label="Direct link to 6. 类型字典与字面量 (TypedDict &amp; Literal)" title="Direct link to 6. 类型字典与字面量 (TypedDict &amp; Literal)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="61-typeddict">6.1 <code>TypedDict</code><a href="#61-typeddict" class="hash-link" aria-label="Direct link to 61-typeddict" title="Direct link to 61-typeddict" translate="no">​</a></h3>
<p>用于为字典提供结构化类型提示，适用于处理 JSON 数据。支持 <code>total=False</code> (所有键可选) 或使用 <code>Required</code>/<code>NotRequired</code> (Python 3.11+)。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> TypedDict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NotRequired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Movie</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    year</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rating</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NotRequired</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 该键可以不存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Movie </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;title&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Matrix&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;year&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1999</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ✅ OK</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="62-literal">6.2 <code>Literal</code><a href="#62-literal" class="hash-link" aria-label="Direct link to 62-literal" title="Direct link to 62-literal" translate="no">​</a></h3>
<p>限制变量只能是特定的字面值。</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Literal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">open_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Literal</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;r&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;w&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;rb&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;wb&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;r&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ✅ OK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">open_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;rw&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># ❌ Type Error</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="7-最佳实践-best-practices">7. 最佳实践 (Best Practices)<a href="#7-最佳实践-best-practices" class="hash-link" aria-label="Direct link to 7. 最佳实践 (Best Practices)" title="Direct link to 7. 最佳实践 (Best Practices)" translate="no">​</a></h2>
<ol>
<li class=""><strong>优先使用内置集合类型</strong> (Python 3.9+): 使用 <code>list[int]</code> 而非 <code>List[int]</code>，使用 <code>dict[str, int]</code> 而非 <code>Dict</code>。</li>
<li class=""><strong>新语法优先</strong>: 在 Python 3.10+ 中使用 <code>X | Y</code> 代替 <code>Union[X, Y]</code>。</li>
<li class=""><strong>配置严格模式</strong>: <code>mypy</code> 默认较为宽松。建议开启 <code>--strict</code> 或至少 <code>--disallow-untyped-defs</code> 以获得真正的类型安全收益。</li>
<li class=""><strong>避免过度使用 <code>Any</code></strong>: 每当你使用 <code>Any</code>，你就关闭了那一部分代码的类型检查。如果不知道类型，考虑使用 <code>object</code> (只读) 或泛型。</li>
<li class=""><strong>使用 <code>Self</code></strong>: 在返回自身实例的方法（如构建器模式）中使用 <code>Self</code> 类型 (Python 3.11+)，这比使用 TypeVar 绑定更简洁。</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="参考资料">参考资料<a href="#参考资料" class="hash-link" aria-label="Direct link to 参考资料" title="Direct link to 参考资料" translate="no">​</a></h2>
<ol>
<li class=""><a href="https://docs.python.org/3/library/typing.html" target="_blank" rel="noopener noreferrer" class="">Python 3.14.2 Documentation - typing</a></li>
<li class=""><a href="https://typing.python.org/en/latest/reference/generics.html" target="_blank" rel="noopener noreferrer" class="">Typing Documentation - Generics</a></li>
<li class=""><a href="https://typing.python.org/en/latest/spec/protocol.html" target="_blank" rel="noopener noreferrer" class="">Typing Documentation - Protocols</a></li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_iDCr"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Python/内置模块/类型系统/简介.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_c0mv" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mxtt"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes3/docs/Python/内置模块/subprocess"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">subprocess</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes3/docs/Python/内置模块/类型系统/tuple"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">tuple</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_r83r thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-概述-introduction" class="table-of-contents__link toc-highlight">1. 概述 (Introduction)</a></li><li><a href="#2-类型系统架构-type-system-architecture" class="table-of-contents__link toc-highlight">2. 类型系统架构 (Type System Architecture)</a></li><li><a href="#3-泛型与变变性-generics--variance" class="table-of-contents__link toc-highlight">3. 泛型与变变性 (Generics &amp; Variance)</a><ul><li><a href="#31-变变性分类" class="table-of-contents__link toc-highlight">3.1 变变性分类</a></li><li><a href="#32-定义泛型-python-312-syntax" class="table-of-contents__link toc-highlight">3.2 定义泛型 (Python 3.12+ Syntax)</a></li><li><a href="#33-显式控制-variance-旧语法" class="table-of-contents__link toc-highlight">3.3 显式控制 Variance (旧语法)</a></li></ul></li><li><a href="#4-结构化子类型-structural-subtyping--protocols" class="table-of-contents__link toc-highlight">4. 结构化子类型 (Structural Subtyping / Protocols)</a></li><li><a href="#5-高级类型构造-advanced-type-constructors" class="table-of-contents__link toc-highlight">5. 高级类型构造 (Advanced Type Constructors)</a><ul><li><a href="#51-annotated" class="table-of-contents__link toc-highlight">5.1 <code>Annotated</code></a></li><li><a href="#52-typevartuple-variadic-generics" class="table-of-contents__link toc-highlight">5.2 <code>TypeVarTuple</code> (Variadic Generics)</a></li><li><a href="#53-paramspec" class="table-of-contents__link toc-highlight">5.3 <code>ParamSpec</code></a></li></ul></li><li><a href="#6-类型字典与字面量-typeddict--literal" class="table-of-contents__link toc-highlight">6. 类型字典与字面量 (TypedDict &amp; Literal)</a><ul><li><a href="#61-typeddict" class="table-of-contents__link toc-highlight">6.1 <code>TypedDict</code></a></li><li><a href="#62-literal" class="table-of-contents__link toc-highlight">6.2 <code>Literal</code></a></li></ul></li><li><a href="#7-最佳实践-best-practices" class="table-of-contents__link toc-highlight">7. 最佳实践 (Best Practices)</a></li><li><a href="#参考资料" class="table-of-contents__link toc-highlight">参考资料</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes3/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>