`UnityEngine.AdaptivePerformance` 是 Unity 推出的一个高级性能优化包（package），其核心目标是让**移动设备**上的游戏能够更智能地管理硬件资源（CPU、GPU、散热），从而在保持流畅帧率的同时，延长电池寿命并防止设备过热。

这个包是 Unity 与 **Samsung**（最初）以及后来的 **Google (Android)** 深度合作的结果，旨在让开发者能够访问到底层硬件的运行状态数据。

以下是对 `UnityEngine.AdaptivePerformance` 的详细介绍、工作原理及应用场景。

### 1. 核心解决的问题

在移动游戏开发中，通常面临一个**“性能-散热-电池”**的三角制约：
*   如果游戏一直全速运行（最高画质、最高帧率），手机会迅速发热，导致系统强制降频（Thermal Throttling），帧率突然大幅下降，体验极差，且电量消耗极快。
*   如果游戏为了省电限制性能，画面可能不够流畅或精美。

`AdaptivePerformance` 的作用就是在二者之间寻找动态平衡。

### 2. 核心功能与机制

这个包主要提供以下几个关键能力：

#### A. 散热状态监控 (Thermal Status Monitoring)
它可以实时告诉你的游戏当前设备的温度状态。
*   **Thermal Warning Level (散热警告等级):** 告知你当前设备是否正在发热，以及发热的严重程度（例如：无警告、轻微发热、严重过热）。
*   **Thermal Trend (散热趋势):** 预测温度是在上升还是下降。

#### B. 性能瓶颈检测 (Performance Bottleneck Detection)
它可以告诉你当前是什么在拖累游戏性能。
*   **CPU Bind / GPU Bound:** 判断当前是由 CPU 还是 GPU 导致帧率上不去。

#### C. 主动性能控制 (Active Performance Control)
这是最强大的功能。开发者不仅是被动读取数据，还可以主动请求系统调整硬件状态：
*   **CPU/GPU Level Control:** 你可以请求系统降低 CPU 或 GPU 的频率（Level）。如果你知道此时是一个简单的 UI 界面，不需要全速渲染，你可以降低 GPU 频率来省电和降温。
*   **Boost Mode:** 在加载场景或瞬间需要高计算量时，请求短期提升硬件频率。

#### D. 自动性能模式 (Indexer & Scalers)
如果你不想手动写代码控制，它提供了一个自动化系统：
*   **Indexer:** 不断评估当前的性能压力。
*   **Scalers:** 根据 Indexer 的评估，自动调整画质设置（如降低分辨率、减少阴影距离、降低 LOD）。

### 3. 主要类与 API

#### `IAdaptivePerformance`
这是访问该系统的主接口，通常通过 `Holder.Instance` 访问。

```csharp
using UnityEngine.AdaptivePerformance;

void CheckThermalState()
{
    var ap = Holder.Instance;
    if (ap == null || !ap.Active) return;

    // 获取当前散热警告级别
    var thermalLevel = ap.ThermalStatus.ThermalMetrics.WarningLevel;
    
    if (thermalLevel == UnityEngine.AdaptivePerformance.Provider.WarningLevel.Critical)
    {
        Debug.LogWarning("设备过热！正在降低画质...");
        // 执行降质逻辑，例如降低分辨率或帧率限制
    }
}
```

#### `AdaptivePerformanceIndexer`
用于自动缩放系统。可以订阅这套系统来自动调整 Shadow quality, View distance 等。

### 4. 典型应用场景

1.  **防止过热掉帧 (Anti-Throttling):**
    当检测到 `WarningLevel` 升高时，主动降低目标帧率（从 60 降到 30）或降低分辨率因子，让手机自行降温，避免系统强行“断崖式”降频卡顿。

2.  **省电模式:**
    在不需要高强度的场景（如背包界面、对话界面），主动调低 CPU/GPU Level，显著延长续航。

3.  **平滑帧率:**
    当检测到 GPU 负载过高时，动态降低渲染分辨率（Dynamic Resolution），保持帧率稳定。

### 5. 支持的平台 (Provider)

这一点非常重要：**Adaptive Performance 并不是所有手机都能用的。**

它依赖于底层硬件厂商提供的驱动接口。目前主要支持：
*   **Samsung (三星):** 支持最好的设备，最初就是为 Galaxy 系列开发的（GameSDK）。
*   **Android (Google):** 通过 Android 性能提示 API (Android Performance Tuner / ADPF) 支持部分 Pixel 和其他 Android 10+ 设备。
*   **模拟器:** Unity 编辑器内提供了模拟器，方便在不打包的情况下测试逻辑。

*注：iOS 目前没有开放此类底层硬件调频接口给 Adaptive Performance（iOS 有自己的 ThermalState API，但不在这个包的直接控制范围内）。*

### 6. 安装与使用

1.  在 **Package Manager** 中搜索 `Adaptive Performance` 并安装。
2.  还需要安装对应的 **Provider**（例如 `Adaptive Performance Samsung Android`）。
3.  在 **Project Settings** -> **Adaptive Performance** 中启用对应的 Provider。
4.  在场景中添加 `AdaptivePerformanceScaler` 组件（如果你想用自动缩放功能）或编写脚本（如果你想手动控制）。

### 总结

`UnityEngine.AdaptivePerformance` 是一个**“硬件感知”**的优化工具。

*   **它的价值：** 让游戏不再盲目地“跑满”硬件，而是根据设备的温度和负载，“聪明”地调节自身的画质和硬件频率。
*   **适用对象：** 对性能要求极高、希望在安卓旗舰机（尤其是三星）上获得极致稳定体验和更长续航的大型手游项目。