`UnityEngine.SceneManagement.SceneManager` 是 Unity 中用于**运行时场景管理**的核心静态类。

在 Unity 5.3 之前，场景加载主要依赖 `Application.LoadLevel`，但现在这些方法已被废弃，**`SceneManager` 是目前加载、卸载和管理场景的标准方式**。

要想使用它，你必须在脚本头部引入命名空间：
```csharp
using UnityEngine.SceneManagement;
```

以下是 `SceneManager` 的核心功能详解：

### 1. 加载场景 (Loading Scenes)

这是最常用的功能。你可以通过场景的**名称 (String)** 或在 Build Settings 中的**索引 (Int)** 来加载。

#### 同步加载
此时游戏画面会暂停，直到新场景加载完成（适用于小型场景）。

```csharp
// 通过名称加载
SceneManager.LoadScene("GameLevel1");

// 通过索引加载 (需在 Build Settings 中查看)
SceneManager.LoadScene(1);
```

#### 加载模式 (LoadSceneMode)
`LoadScene` 的重载版本允许你指定加载模式：

*   **`LoadSceneMode.Single`** (默认)：关闭当前所有场景，加载新场景。用于切换关卡。
*   **`LoadSceneMode.Additive`**：保留当前场景，将新场景“叠加”进去。常用于无缝大地图加载或加载独立的 UI 场景。

```csharp
// 叠加加载 HUD 场景，当前游戏场景不会被销毁
SceneManager.LoadScene("HUD", LoadSceneMode.Additive);
```

### 2. 异步加载 (Asynchronous Loading)

对于大型游戏，同步加载会导致画面卡死。`SceneManager.LoadSceneAsync` 允许在后台加载场景，同时游戏继续运行（常用于制作带有进度条的 Loading 界面）。

它返回一个 `AsyncOperation` 对象，用于监控进度。

**关键属性：**
*   `AsyncOperation.progress`：加载进度，范围是 $0.0 \to 1.0$。
    *   **注意**：当 `allowSceneActivation` 为 `true` 时，进度达到 $0.9$ 就会自动切换场景。
*   `AsyncOperation.allowSceneActivation`：设为 `false` 可以让场景加载完后不立即显示，等待玩家按键后再进入。

### 3. 获取场景信息

你可以获取当前活动的场景或通过名称/索引获取特定场景的 `Scene` 结构体。

*   **`SceneManager.GetActiveScene()`**: 获取当前主场景。
*   **`SceneManager.sceneCount`**: 获取当前加载了几个场景（Additive 模式下可能大于 1）。

```csharp
Scene currentScene = SceneManager.GetActiveScene();
Debug.Log("Current Scene Name: " + currentScene.name);
Debug.Log("Current Scene Index: " + currentScene.buildIndex);
```

### 4. 场景事件 (Events)

`SceneManager` 提供了委托（Delegate）事件，允许你在场景加载或卸载时触发特定逻辑。

*   **`sceneLoaded`**: 当一个场景加载完成时触发。
*   **`sceneUnloaded`**: 当一个场景被卸载时触发。
*   **`activeSceneChanged`**: 当活动场景发生变化时触发。

```csharp
void OnEnable()
{
    // 订阅事件
    SceneManager.sceneLoaded += OnSceneLoaded;
}

void OnDisable()
{
    // 取消订阅 (防止内存泄漏)
    SceneManager.sceneLoaded -= OnSceneLoaded;
}

void OnSceneLoaded(Scene scene, LoadSceneMode mode)
{
    Debug.Log($"场景 {scene.name} 已加载！");
}
```

### 5. 常见陷阱：Build Settings

无论你想加载哪个场景，**必须**先将它们添加到 Unity 编辑器的 Build Settings 中。

1.  点击菜单栏 `File` -> `Build Settings`。
2.  将 Project 窗口中的场景文件拖入 `Scenes In Build` 列表中。
3.  列表右侧的数字就是场景的 `buildIndex`。

如果场景不在列表中，调用 `LoadScene` 会报错。

---

### 综合代码示例：LoadingManager

下面是一个包含**同步加载**和**带有伪进度条的异步加载**的管理器示例：

```csharp
using UnityEngine;
using UnityEngine.SceneManagement; 
using System.Collections;

public class MyLevelLoader : MonoBehaviour
{
    // 1. 普通切换关卡
    public void LoadNextLevel()
    {
        // 获取当前场景索引并 + 1
        int nextIndex = SceneManager.GetActiveScene().buildIndex + 1;
        
        // 检查索引是否越界 (即是否还有下一关)
        if (nextIndex < SceneManager.sceneCountInBuildSettings)
        {
            SceneManager.LoadScene(nextIndex);
        }
        else
        {
            Debug.Log("已经是最后一关了");
        }
    }

    // 2. 异步加载（带进度条逻辑）
    public void LoadLevelAsync(string levelName)
    {
        StartCoroutine(LoadAsyncSequence(levelName));
    }

    IEnumerator LoadAsyncSequence(string levelName)
    {
        // 开始后台加载
        AsyncOperation operation = SceneManager.LoadSceneAsync(levelName);

        // 阻止场景加载完自动跳转，方便我们演示进度条
        operation.allowSceneActivation = false;

        while (!operation.isDone)
        {
            // Unity 的加载过程在 0.9 时停止
            // 所以我们需要把 0 ~ 0.9 映射到 0 ~ 1.0
            float progress = Mathf.Clamp01(operation.progress / 0.9f);
            
            Debug.Log($"Loading Progress: {progress * 100}%");

            // 当加载非常接近完成时
            if (operation.progress >= 0.9f)
            {
                Debug.Log("按任意键继续...");
                
                if (Input.anyKeyDown)
                {
                    // 允许跳转
                    operation.allowSceneActivation = true;
                }
            }

            yield return null; // 等待下一帧
        }
    }
}
```

### 总结

*   **`SceneManager.LoadScene`**: 简单粗暴的切关。
*   **`SceneManager.LoadSceneAsync`**: 适合做 Loading 页面。
*   **`SceneManager.GetActiveScene`**: 知道自己在哪里。
*   **命名空间**: 永远别忘了 `using UnityEngine.SceneManagement;`。