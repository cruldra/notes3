# 使用自托管Gitea作为Docker容器注册表教程

## 概述

Gitea不仅是一个优秀的Git代码托管平台，还内置了Docker容器注册表功能。本教程将指导你如何配置和使用Gitea作为私有Docker镜像仓库。

## 前提条件

- 已部署的Gitea实例（本教程以 `gitea.ailoveworld.cn` 为例）
- Docker已安装并运行
- 拥有Gitea账户和相应权限

 

## 第一步：登录到Gitea容器注册表

使用Docker命令登录到你的Gitea实例：

```bash
docker login gitea.ailoveworld.cn
```

输入你的Gitea用户名和密码：
```
Username: your-username
Password: your-password
Login Succeeded
```

## 第二步：准备和推送Docker镜像

### 3.1 构建本地镜像

首先构建你的Docker镜像：

```bash
docker build -t your-image-name .
```

### 3.2 为镜像打标签

**重要**：必须为镜像打上包含完整仓库地址的标签：

```bash
docker tag your-image-name gitea.ailoveworld.cn/username/repository-name:tag
```

例如：
```bash
docker tag frp:latest gitea.ailoveworld.cn/cruldra/frp:latest
```

### 3.3 推送镜像

```bash
docker push gitea.ailoveworld.cn/username/repository-name:tag
```

例如：
```bash
docker push gitea.ailoveworld.cn/cruldra/frp:latest
```

成功推送后会看到类似输出：
```
The push refers to repository [gitea.ailoveworld.cn/cruldra/frp]
2ed3fe95e616: Pushed 
c11626d9a96d: Pushed 
396c31837116: Pushed 
latest: digest: sha256:bd8130742455fddce1c50b56c5972bbd26e2104453e4161a389c24abd6cbd4ec size: 855
```

## 第三步：拉取镜像

从Gitea容器注册表拉取镜像：

```bash
docker pull gitea.ailoveworld.cn/username/repository-name:tag
```

## 常见问题和解决方案

### 问题1：tag does not exist 错误

**错误信息**：
```
tag does not exist: gitea.ailoveworld.cn/cruldra/frp:latest
```

**原因**：本地镜像标签与目标仓库地址不匹配

**解决方案**：
```bash
# 先给镜像打正确的标签
docker tag local-image:tag gitea.ailoveworld.cn/username/repo:tag
# 然后推送
docker push gitea.ailoveworld.cn/username/repo:tag
```

### 问题2：push access denied

**错误信息**：
```
push access denied, repository does not exist or may require authorization
```

**可能原因**：
1. 未登录或登录失效
2. 用户没有推送权限
3. 仓库不存在

**解决方案**：
1. 重新登录：`docker login gitea.ailoveworld.cn`
2. 检查用户权限
3. 确保仓库名称正确



## 最佳实践

### 1. 镜像命名规范

```bash
gitea.ailoveworld.cn/[用户名或组织]/[项目名]:[标签]
```

### 2. 使用多个标签

```bash
# 同时推送latest和版本号标签
docker tag myapp:latest gitea.ailoveworld.cn/myuser/myapp:latest
docker tag myapp:latest gitea.ailoveworld.cn/myuser/myapp:v1.0.0

docker push gitea.ailoveworld.cn/myuser/myapp:latest
docker push gitea.ailoveworld.cn/myuser/myapp:v1.0.0
```

### 3. 自动化脚本示例

```bash
#!/bin/bash
IMAGE_NAME="myapp"
VERSION="1.0.0"
REGISTRY="gitea.ailoveworld.cn"
USERNAME="myuser"

# 构建镜像
docker build -t ${IMAGE_NAME}:${VERSION} .

# 打标签
docker tag ${IMAGE_NAME}:${VERSION} ${REGISTRY}/${USERNAME}/${IMAGE_NAME}:${VERSION}
docker tag ${IMAGE_NAME}:${VERSION} ${REGISTRY}/${USERNAME}/${IMAGE_NAME}:latest

# 推送镜像
docker push ${REGISTRY}/${USERNAME}/${IMAGE_NAME}:${VERSION}
docker push ${REGISTRY}/${USERNAME}/${IMAGE_NAME}:latest
```

## 总结

通过以上步骤，你已经成功配置了Gitea作为Docker容器注册表。关键点包括：

1. 启用Gitea的容器注册表功能
2. 正确登录到注册表
3. 为镜像打上包含完整仓库地址的标签
4. 推送和拉取镜像

这样你就拥有了一个完全自主控制的私有Docker镜像仓库，既安全又便于管理。
