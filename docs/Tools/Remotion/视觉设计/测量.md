---
sidebar_position: 6
---

## 测量 DOM 节点

如果你想测量一个 DOM 节点，可以为其分配一个 [React Ref](https://react.dev/learn/manipulating-the-dom-with-refs)，然后使用 [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect?retiredLocale=de) 浏览器 API 来获取该节点的位置和大小。

在 Remotion 中，这并不像往常那样简单，因为渲染视频的 `<div>` 元素应用了 `scale()` 变换，这会影响你从 `getBoundingClientRect()` 获取的值。

### 使用 `useCurrentScale()` 钩子进行测量

从 v4.0.111 版本开始，你可以使用 [`useCurrentScale()`](https://www.remotion.dev/docs/use-current-scale) 钩子来校正元素的尺寸。

**MyComponent.tsx**

```tsx
import { useCallback, useEffect, useState, useRef } from "react";
import { useCurrentScale } from "remotion";

export const MyComponent = () => {
  const ref = useRef<HTMLDivElement>(null);
  const [dimensions, setDimensions] = useState<{
    correctedHeight: number;
    correctedWidth: number;
  } | null>(null);

  const scale = useCurrentScale();

  useEffect(() => {
    if (!ref.current) {
      return;
    }

    const rect = ref.current.getBoundingClientRect();
    setDimensions({
      // 使用当前缩放比例进行校正
      correctedHeight: rect.height / scale,
      correctedWidth: rect.width / scale,
    });
  }, [scale]);

  return (
    <div>
      <div ref={ref}>Hello World!</div>
    </div>
  );
};
```

### v4.0.110 之前的版本

为了获得准确的测量结果，你可以渲染一个具有固定宽度（例如 `10px`）的额外元素并同时测量它。然后，你可以将该元素的宽度除以 `10` 来获得缩放因子。

**MyComponent.tsx**

```tsx
import { useCallback, useEffect, useState, useRef } from "react";

const MEASURER_SIZE = 10;

export const MyComponent = () => {
  const ref = useRef<HTMLDivElement>(null);
  const measurer = useRef<HTMLDivElement>(null);
  const [dimensions, setDimensions] = useState<{
    correctedHeight: number;
    correctedWidth: number;
  } | null>(null);

  useEffect(() => {
    if (!ref.current || !measurer.current) {
      return;
    }

    const rect = ref.current.getBoundingClientRect();
    const measurerRect = measurer.current.getBoundingClientRect();
    
    // 通过测量已知大小的元素来计算缩放比例
    const scale = measurerRect.width / MEASURER_SIZE;

    setDimensions({
      correctedHeight: rect.height * scale,
      correctedWidth: rect.width * scale,
    });
  }, []);

  return (
    <div>
      <div ref={ref}>Hello World!</div>
      <div
        ref={measurer}
        style={{
          width: MEASURER_SIZE,
          position: "fixed",
          top: -99999,
        }}
      />
    </div>
  );
};
```

#### 示例项目

*   [源代码](https://github.com/remotion-dev/measure-item)
*   [预览](https://measure-item.vercel.app/)

### v4.0.103 之前的版本

在 Remotion 的早期版本中，由于组件虽已挂载但尚未显示，`getBoundingClientRect()` 在第一个 `useEffect()` 中可能会返回所有值均为 `0` 的尺寸。

在后续版本中，你可以放心这些尺寸将是非零值。

### 另请参阅

*   [react-use-measure](https://github.com/pmndrs/react-use-measure)
     - 在滚动容器内正确测量元素
