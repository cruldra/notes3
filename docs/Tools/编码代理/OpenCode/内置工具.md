管理 LLM 可使用的工具

工具允许 LLM 在您的代码库中执行操作。OpenCode 自带了一套内置工具，但您也可以通过自定义工具或 MCP 服务器来扩展它。

默认情况下，所有工具都是**启用**的，并且不需要运行权限。您可以通过权限控制工具的行为。

---

## [配置](#configure)

使用 `permission` 字段来控制工具行为。您可以允许、拒绝或要求批准每个工具。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "edit": "deny",
    "bash": "ask",
    "webfetch": "allow"
  }
}
```

您还可以使用通配符一次控制多个工具。例如，要求批准来自 MCP 服务器的所有工具：

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "mymcp_*": "ask"
  }
}
```

了解更多关于配置权限的信息。

---

## [内置工具](#built-in)

以下是 OpenCode 中可用的所有内置工具。

---

### [bash](#bash)

在您的项目环境中执行 shell 命令。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "bash": "allow"
  }
}
```

此工具允许 LLM 运行终端命令，如 `npm install`、`git status` 或任何其他 shell 命令。

---

### [edit](#edit)

使用精确字符串替换修改现有文件。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "edit": "allow"
  }
}
```

此工具通过替换精确的文本匹配来对文件进行精确编辑。这是 LLM 修改代码的主要方式。

---

### [write](#write)

创建新文件或覆盖现有文件。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "edit": "allow"
  }
}
```

使用此工具允许 LLM 创建新文件。如果文件已存在，它将覆盖现有文件。

注意

`write` 工具由 `edit` 权限控制，该权限涵盖所有文件修改（`edit`、`write`、`patch`、`multiedit`）。

---

### [read](#read)

从您的代码库读取文件内容。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "read": "allow"
  }
}
```

此工具读取文件并返回其内容。它支持读取大文件的特定行范围。

---

### [grep](#grep)

使用正则表达式搜索文件内容。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "grep": "allow"
  }
}
```

在您的代码库中进行快速内容搜索。支持完整的正则表达式语法和文件模式过滤。

---

### [glob](#glob)

通过模式匹配查找文件。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "glob": "allow"
  }
}
```

使用 glob 模式（如 `**/*.js` 或 `src/**/*.ts`）搜索文件。返回按修改时间排序的匹配文件路径。

---

### [list](#list)

列出给定路径中的文件和目录。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "list": "allow"
  }
}
```

此工具列出目录内容。它接受 glob 模式来过滤结果。

---

### [lsp (实验性)](#lsp-experimental)

与您配置的 LSP 服务器交互，以获取代码智能特性，如定义、引用、悬停信息和调用层次结构。

注意

此工具仅在 `OPENCODE_EXPERIMENTAL_LSP_TOOL=true`（或 `OPENCODE_EXPERIMENTAL=true`）时可用。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "lsp": "allow"
  }
}
```

支持的操作包括 `goToDefinition`、`findReferences`、`hover`、`documentSymbol`、`workspaceSymbol`、`goToImplementation`、`prepareCallHierarchy`、`incomingCalls` 和 `outgoingCalls`。

要配置项目中可用的 LSP 服务器，请参阅 LSP 服务器。

---

### [patch](#patch)

对文件应用补丁。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "edit": "allow"
  }
}
```

此工具将补丁文件应用到您的代码库。用于应用来自各种来源的差异（diffs）和补丁。

注意

`patch` 工具由 `edit` 权限控制，该权限涵盖所有文件修改（`edit`、`write`、`patch`、`multiedit`）。

---

### [skill](#skill)

加载一个技能（一个 `SKILL.md` 文件）并在对话中返回其内容。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "skill": "allow"
  }
}
```

---

### [todowrite](#todowrite)

在编码会话期间管理待办事项列表。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "todowrite": "allow"
  }
}
```

创建和更新任务列表以跟踪复杂操作期间的进度。LLM 使用它来组织多步骤任务。

注意

此工具默认对子智能体（subagents）禁用，但您可以手动启用它。

---

### [todoread](#todoread)

读取现有的待办事项列表。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "todoread": "allow"
  }
}
```

读取当前的待办事项列表状态。由 LLM 用于跟踪哪些任务挂起或已完成。

注意

此工具默认对子智能体（subagents）禁用，但您可以手动启用它。

---

### [webfetch](#webfetch)

获取 Web 内容。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "webfetch": "allow"
  }
}
```

允许 LLM 获取和读取网页。用于查找文档或在线研究资源。

---

### [question](#question)

在执行期间向用户提问。

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "question": "allow"
  }
}
```

此工具允许 LLM 在任务期间向用户提问。它适用于：

*   收集用户偏好或需求
*   澄清模棱两可的指令
*   获取关于实现选择的决策
*   提供关于采取何种方向的选择

每个问题包括一个标题、问题文本和一个选项列表。用户可以从提供的选项中选择或输入自定义答案。当有多个问题时，用户可以在提交所有答案之前在它们之间导航。

---

## [自定义工具](#custom-tools)

自定义工具允许您定义 LLM 可以调用的自己的函数。这些在您的配置文件中定义，并且可以执行任意代码。

了解更多关于创建自定义工具的信息。

---

## [MCP 服务器](#mcp-servers)

MCP（模型上下文协议）服务器允许您集成外部工具和服务。这包括数据库访问、API 集成和第三方服务。

了解更多关于配置 MCP 服务器的信息。

---

## [内部机制](#internals)

在内部，像 `grep`、`glob` 和 `list` 这样的工具底层使用 [ripgrep](https://github.com/BurntSushi/ripgrep)。默认情况下，ripgrep 遵守 `.gitignore` 模式，这意味着您的 `.gitignore` 中列出的文件和目录将从搜索和列表中排除。

---

### [忽略模式](#ignore-patterns)

要包含通常会被忽略的文件，请在您的项目根目录中创建一个 `.ignore` 文件。此文件可以显式允许某些路径。

.ignore

```text
!node_modules/
!dist/
!build/
```

例如，这个 `.ignore` 文件允许 ripgrep 在 `node_modules/`、`dist/` 和 `build/` 目录中搜索，即使它们列在 `.gitignore` 中。
