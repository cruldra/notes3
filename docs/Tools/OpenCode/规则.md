为 opencode 设置自定义指令

您可以通过创建 `AGENTS.md` 文件为 opencode 提供自定义指令。这类似于 `CLAUDE.md` 或 Cursor 的规则。它包含将包含在 LLM 上下文中的指令，以便为您的特定项目自定义其行为。

---

## [初始化](#initialize)

要创建一个新的 `AGENTS.md` 文件，您可以在 opencode 中运行 `/init` 命令。

提示

您应该将项目的 `AGENTS.md` 文件提交到 Git。

这将扫描您的项目及其所有内容，以了解项目的内容并据此生成 `AGENTS.md` 文件。这有助于 opencode 更好地浏览项目。

如果您有一个现有的 `AGENTS.md` 文件，它将尝试添加到其中。

---

## [示例](#example)

您也可以手动创建此文件。以下是您可以放入 `AGENTS.md` 文件中的一些内容示例。

AGENTS.md

```markdown
# SST v3 单体仓库项目

这是一个使用 TypeScript 的 SST v3 单体仓库。该项目使用 bun workspaces 进行包管理。

## 项目结构

- `packages/` - 包含所有工作区包（functions, core, web 等）
- `infra/` - 按服务拆分的基础设施定义（storage.ts, api.ts, web.ts）
- `sst.config.ts` - 带有动态导入的主 SST 配置

## 代码标准

- 使用启用了严格模式的 TypeScript
- 共享代码位于 `packages/core/` 中，并带有适当的导出配置
- 函数位于 `packages/functions/` 中
- 基础设施应拆分为 `infra/` 中的逻辑文件

## 单体仓库约定

- 使用工作区名称导入共享模块：`@my-app/core/example`
```

我们在这里添加了特定于项目的指令，这将在您的团队中共享。

---

## [类型](#types)

opencode 还支持从多个位置读取 `AGENTS.md` 文件。这服务于不同的目的。

### [项目级](#project)

我们在上面看到的，将 `AGENTS.md` 放置在项目根目录下的，是特定于项目的规则。这些规则仅在您在此目录或其子目录中工作时适用。

### [全局级](#global)

您也可以在 `~/.config/opencode/AGENTS.md` 文件中拥有全局规则。这适用于所有 opencode 会话。

由于这不会提交到 Git 或与您的团队共享，我们建议使用它来指定 LLM 应该遵循的任何个人规则。

---

## [优先级](#precedence)

因此，当 opencode 启动时，它会查找：

1.  **本地文件**：从当前目录向上遍历
2.  **全局文件**：检查 `~/.config/opencode/AGENTS.md`

如果您同时拥有全局和特定于项目的规则，opencode 将把它们组合在一起。

---

## [自定义指令](#custom-instructions)

您可以在 `opencode.json` 或全局 `~/.config/opencode/opencode.json` 中指定自定义指令文件。这允许您和您的团队重用现有规则，而不必将它们复制到 AGENTS.md。

示例：

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "instructions": ["CONTRIBUTING.md", "docs/guidelines.md", ".cursor/rules/*.md"]
}
```

所有指令文件都会与您的 `AGENTS.md` 文件组合。

---

## [引用外部文件](#referencing-external-files)

虽然 opencode 不会自动解析 `AGENTS.md` 中的文件引用，但您可以通过两种方式实现类似的功能：

### [使用 opencode.json](#using-opencodejson)

推荐的方法是在 `opencode.json` 中使用 `instructions` 字段：

opencode.json

```json
{
  "$schema": "https://opencode.ai/config.json",
  "instructions": ["docs/development-standards.md", "test/testing-guidelines.md", "packages/*/AGENTS.md"]
}
```

### [AGENTS.md 中的手动指令](#manual-instructions-in-agentsmd)

您可以通过在 `AGENTS.md` 中提供明确的指令来教 opencode 读取外部文件。这是一个实际示例：

AGENTS.md

```markdown
# TypeScript 项目规则

## 外部文件加载

关键：当您遇到文件引用（例如 @rules/general.md）时，根据需要使用您的 Read 工具加载它。它们与手头的特定任务相关。

指令：
- 不要抢先加载所有引用 - 根据实际需要使用延迟加载
- 加载后，将内容视为覆盖默认值的强制性指令
- 需要时递归跟踪引用

## 开发指南

关于 TypeScript 代码风格和最佳实践：@docs/typescript-guidelines.md
关于 React 组件架构和 Hooks 模式：@docs/react-patterns.md
关于 REST API 设计和错误处理：@docs/api-standards.md
关于测试策略和覆盖率要求：@test/testing-guidelines.md

## 通用指南

立即阅读以下文件，因为它与所有工作流相关：@rules/general-guidelines.md。
```

这种方法允许您：

*   创建模块化、可重用的规则文件
*   通过符号链接或 git 子模块跨项目共享规则
*   在引用详细指南的同时保持 AGENTS.md 简洁
*   确保 opencode 仅在特定任务需要时加载文件

提示

对于单体仓库或具有共享标准的项目，使用带有 glob 模式（如 `packages/*/AGENTS.md`）的 `opencode.json` 比手动指令更易于维护。
