为重复性任务创建自定义命令

自定义命令允许您指定要在 TUI 中执行该命令时运行的提示词（prompt）。

```bash
/my-command
```

自定义命令是对内置命令（如 `/init`、`/undo`、`/redo`、`/share`、`/help`）的补充。[了解更多](/docs/tui#commands)。

---

## [创建命令文件](#create-command-files)

在 `command/` 目录中创建 markdown 文件以定义自定义命令。

创建 `.opencode/command/test.md`:

.opencode/command/test.md

```markdown
---
description: Run tests with coverage
agent: build
model: anthropic/claude-3-5-sonnet-20241022
---

Run the full test suite with coverage report and show any failures.
Focus on the failing tests and suggest fixes.
```

Frontmatter 定义了命令属性。内容将作为模板。

通过输入 `/` 后跟命令名称来使用该命令。

```bash
"/test"
```

---

## [配置](#configure)

您可以通过 OpenCode 配置添加自定义命令，或者在 `command/` 目录中创建 markdown 文件。

---

### [JSON](#json)

使用 OpenCode [配置](/docs/config)中的 `command` 选项：

opencode.jsonc

```json
{
  "$schema": "https://opencode.ai/config.json",
  "command": {
    // 这将成为命令的名称
    "test": {
      // 这是将发送给 LLM 的提示词
      "template": "Run the full test suite with coverage report and show any failures.\nFocus on the failing tests and suggest fixes.",
      // 这在 TUI 中显示为描述
      "description": "Run tests with coverage",
      "agent": "build",
      "model": "anthropic/claude-3-5-sonnet-20241022"
    }
  }
}
```

现在您可以在 TUI 中运行此命令：

```bash
/test
```

---

### [Markdown](#markdown)

您也可以使用 markdown 文件定义命令。将它们放置在：

*   全局：`~/.config/opencode/command/`
*   每个项目：`.opencode/command/`

~/.config/opencode/command/test.md

```markdown
---
description: Run tests with coverage
agent: build
model: anthropic/claude-3-5-sonnet-20241022
---

Run the full test suite with coverage report and show any failures.
Focus on the failing tests and suggest fixes.
```

Markdown 文件名将成为命令名称。例如，`test.md` 让您可以运行：

```bash
/test
```

---

## [提示词配置](#prompt-config)

自定义命令的提示词支持几种特殊的占位符和语法。

---

### [参数](#arguments)

使用 `$ARGUMENTS` 占位符将参数传递给命令。

.opencode/command/component.md

```markdown
---
description: Create a new component
---

Create a new React component named $ARGUMENTS with TypeScript support.
Include proper typing and basic structure.
```

运行带参数的命令：

```bash
/component Button
```

`$ARGUMENTS` 将被替换为 `Button`。

您还可以使用位置参数访问单个参数：

*   `$1` - 第一个参数
*   `$2` - 第二个参数
*   `$3` - 第三个参数
*   依此类推...

例如：

.opencode/command/create-file.md

```markdown
---
description: Create a new file with content
---

Create a file named $1 in the directory $2
with the following content: $3
```

运行命令：

```bash
/create-file config.json src "{ \"key\": \"value\" }"
```

这将替换：

*   `$1` 为 `config.json`
*   `$2` 为 `src`
*   `$3` 为 `{ "key": "value" }`

---

### [Shell 输出](#shell-output)

使用 *!`command`* 将 [bash 命令](/docs/tui#bash-commands)的输出注入到您的提示词中。

例如，要创建一个分析测试覆盖率的自定义命令：

.opencode/command/analyze-coverage.md

```markdown
---
description: Analyze test coverage
---

Here are the current test results:

!`npm test`

Based on these results, suggest improvements to increase coverage.
```

或者审查最近的更改：

.opencode/command/review-changes.md

```markdown
---
description: Review recent changes
---

Recent git commits:

!`git log --oneline -10`

Review these changes and suggest any improvements.
```

命令在您的项目根目录中运行，其输出成为提示词的一部分。

---

### [文件引用](#file-references)

使用 `@` 后跟文件名在命令中包含文件。

.opencode/command/review-component.md

```markdown
---
description: Review component
---

Review the component in @src/components/Button.tsx.
Check for performance issues and suggest improvements.
```

文件内容会自动包含在提示词中。

---

## [选项](#options)

让我们详细了解配置选项。

---

### [Template (模板)](#template)

`template` 选项定义了执行命令时将发送给 LLM 的提示词。

opencode.json

```json
{
  "command": {
    "test": {
      "template": "Run the full test suite with coverage report and show any failures.\nFocus on the failing tests and suggest fixes."
    }
  }
}
```

这是一个**必填**的配置选项。

---

### [Description (描述)](#description)

使用 `description` 选项提供命令功能的简要描述。

opencode.json

```json
{
  "command": {
    "test": {
      "description": "Run tests with coverage"
    }
  }
}
```

当您输入命令时，这会在 TUI 中显示为描述。

---

### [Agent (智能体)](#agent)

使用 `agent` 配置可选择指定哪个 [智能体](/docs/agents) 应执行此命令。
如果这是一个 [子智能体](/docs/agents/#subagents)，该命令默认将触发子智能体调用。
要禁用此行为，请将 `subtask` 设置为 `false`。

opencode.json

```json
{
  "command": {
    "review": {
      "agent": "plan"
    }
  }
}
```

这是一个**可选**的配置选项。如果未指定，默认为您当前的智能体。

---

### [Subtask (子任务)](#subtask)

使用 `subtask` 布尔值强制命令触发 [子智能体](/docs/agents/#subagents) 调用。
如果您希望命令不污染您的主要上下文，这将非常有用，并且将**强制**智能体作为子智能体运行，
即使在 [智能体](/docs/agents) 配置中 `mode` 设置为 `primary`。

opencode.json

```json
{
  "command": {
    "analyze": {
      "subtask": true
    }
  }
}
```

这是一个**可选**的配置选项。

---

### [Model (模型)](#model)

使用 `model` 配置覆盖此命令的默认模型。

opencode.json

```json
{
  "command": {
    "analyze": {
      "model": "anthropic/claude-3-5-sonnet-20241022"
    }
  }
}
```

这是一个**可选**的配置选项。

---

## [内置命令](#built-in)

opencode 包含几个内置命令，如 `/init`、`/undo`、`/redo`、`/share`、`/help`；[了解更多](/docs/tui#commands)。

注意

自定义命令可以覆盖内置命令。

如果您定义了一个具有相同名称的自定义命令，它将覆盖内置命令。
