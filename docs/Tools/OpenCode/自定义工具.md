在 opencode 中创建 LLM 可调用的工具

自定义工具是你创建的函数，LLM 可以在对话过程中调用它们。它们与 opencode 的内置工具（如 `read`、`write` 和 `bash`）协同工作。

---

## [创建工具](#creating-a-tool)

工具定义为 **TypeScript** 或 **JavaScript** 文件。但是，工具定义可以调用用**任何语言**编写的脚本——TypeScript 或 JavaScript 仅用于工具定义本身。

---

### [位置](#location)

它们可以定义在：

*   本地：通过将它们放置在项目的 `.opencode/tool/` 目录中。
*   全局：通过将它们放置在 `~/.config/opencode/tool/` 中。

---

### [结构](#structure)

创建工具最简单的方法是使用 `tool()` 辅助函数，它提供类型安全和验证。

.opencode/tool/database.ts

```typescript
import { tool } from "@opencode-ai/plugin"

export default tool({
  description: "Query the project database",
  args: {
    query: tool.schema.string().describe("SQL query to execute"),
  },
  async execute(args) {
    // Your database logic here
    return `Executed query: ${args.query}`
  },
})
```

**文件名**即为**工具名**。上面的代码创建了一个 `database` 工具。

---

#### [单个文件中的多个工具](#multiple-tools-per-file)

你也可以从单个文件中导出多个工具。每个导出都会成为**一个独立的工具**，名称为 **`<文件名>_<导出名>`**：

.opencode/tool/math.ts

```typescript
import { tool } from "@opencode-ai/plugin"

export const add = tool({
  description: "Add two numbers",
  args: {
    a: tool.schema.number().describe("First number"),
    b: tool.schema.number().describe("Second number"),
  },
  async execute(args) {
    return args.a + args.b
  },
})

export const multiply = tool({
  description: "Multiply two numbers",
  args: {
    a: tool.schema.number().describe("First number"),
    b: tool.schema.number().describe("Second number"),
  },
  async execute(args) {
    return args.a * args.b
  },
})
```

这将创建两个工具：`math_add` 和 `math_multiply`。

---

### [参数](#arguments)

你可以使用 `tool.schema`（即 [Zod](https://zod.dev)）来定义参数类型。

```typescript
args: {
  query: tool.schema.string().describe("SQL query to execute")
}
```

你也可以直接导入 [Zod](https://zod.dev) 并返回一个普通对象：

```typescript
import { z } from "zod"

export default {
  description: "Tool description",
  args: {
    param: z.string().describe("Parameter description"),
  },
  async execute(args, context) {
    // Tool implementation
    return "result"
  },
}
```

---

### [上下文](#context)

工具接收关于当前会话的上下文：

.opencode/tool/project.ts

```typescript
import { tool } from "@opencode-ai/plugin"

export default tool({
  description: "Get project information",
  args: {},
  async execute(args, context) {
    // Access context information
    const { agent, sessionID, messageID } = context
    return `Agent: ${agent}, Session: ${sessionID}, Message: ${messageID}`
  },
})
```

---

## [示例](#examples)

### [用 Python 编写工具](#write-a-tool-in-python)

你可以用任何你想要的语言编写工具。这是一个使用 Python 相加两个数字的示例。

首先，将工具创建为 Python 脚本：

.opencode/tool/add.py

```python
import sys

a = int(sys.argv[1])
b = int(sys.argv[2])

print(a + b)
```

然后创建调用它的工具定义：

.opencode/tool/python-add.ts

```typescript
import { tool } from "@opencode-ai/plugin"

export default tool({
  description: "Add two numbers using Python",
  args: {
    a: tool.schema.number().describe("First number"),
    b: tool.schema.number().describe("Second number"),
  },
  async execute(args) {
    const result = await Bun.$`python3 .opencode/tool/add.py ${args.a} ${args.b}`.text()
    return result.trim()
  },
})
```

这里我们使用 [`Bun.$`](https://bun.com/docs/runtime/shell) 工具来运行 Python 脚本。
