通过 SKILL.md 定义可重用行为

代理技能 (Agent skills) 让 OpenCode 能够从你的仓库或主目录中发现可重用的指令。
技能通过原生 `skill` 工具按需加载——代理可以看到可用的技能，并在需要时加载完整内容。

---

## [放置文件](#place-files)

为每个技能创建一个文件夹，并在其中放入 `SKILL.md` 文件。
OpenCode 会搜索以下位置：

* 项目配置: `.opencode/skill/<name>/SKILL.md`
* 全局配置: `~/.config/opencode/skill/<name>/SKILL.md`
* 项目 Claude 兼容路径: `.claude/skills/<name>/SKILL.md`
* 全局 Claude 兼容路径: `~/.claude/skills/<name>/SKILL.md`

---

## [理解发现机制](#understand-discovery)

对于项目本地路径，OpenCode 会从当前工作目录向上查找，直到到达 git 工作树根目录。
沿途会加载 `.opencode/` 中任何匹配 `skill/*/SKILL.md` 的文件，以及任何匹配 `.claude/skills/*/SKILL.md` 的文件。

全局定义也会从 `~/.config/opencode/skill/*/SKILL.md` 和 `~/.claude/skills/*/SKILL.md` 加载。

---

## [编写 Frontmatter](#write-frontmatter)

每个 `SKILL.md` 必须以 YAML frontmatter (前置元数据) 开头。
仅识别以下字段：

* `name` (必填)
* `description` (必填)
* `license` (可选)
* `compatibility` (可选)
* `metadata` (可选，字符串到字符串的映射)

未知的 frontmatter 字段将被忽略。

---

## [验证名称](#validate-names)

`name` 必须满足：

* 长度为 1-64 个字符
* 由小写字母和数字组成，使用单个连字符分隔
* 不能以 `-` 开头或结尾
* 不能包含连续的 `--`
* 必须与包含 `SKILL.md` 的目录名称匹配

等效的正则表达式：

```
^[a-z0-9]+(-[a-z0-9]+)*$
```

---

## [遵循长度规则](#follow-length-rules)

`description` 必须在 1-1024 个字符之间。
描述应足够具体，以便代理能够正确选择。

---

## [使用示例](#use-an-example)

创建一个 `.opencode/skill/git-release/SKILL.md` 文件，内容如下：

```
---
name: git-release
description: Create consistent releases and changelogs
license: MIT
compatibility: opencode
metadata:
  audience: maintainers
  workflow: github
---

## What I do
- Draft release notes from merged PRs
- Propose a version bump
- Provide a copy-pasteable `gh release create` command

## When to use me
Use this when you are preparing a tagged release.
Ask clarifying questions if the target versioning scheme is unclear.
```

---

## [识别工具描述](#recognize-tool-description)

OpenCode 在 `skill` 工具描述中列出可用的技能。
每个条目包含技能名称和描述：

```
<available_skills>
  <skill>
    <name>git-release</name>
    <description>Create consistent releases and changelogs</description>
  </skill>
</available_skills>
```

代理通过调用工具来加载技能：

```
skill({ name: "git-release" })
```

---

## [配置权限](#configure-permissions)

在 `opencode.json` 中使用基于模式的权限控制代理可以访问哪些技能：

```
{
  "permission": {
    "skill": {
      "pr-review": "allow",
      "internal-*": "deny",
      "experimental-*": "ask",
      "*": "allow"
    }
  }
}
```

| 权限 | 行为 |
| --- | --- |
| `allow` | 技能立即加载 |
| `deny` | 技能对代理隐藏，访问被拒绝 |
| `ask` | 加载前提示用户批准 |

模式支持通配符：`internal-*` 匹配 `internal-docs`、`internal-tools` 等。

---

## [按代理覆盖](#override-per-agent)

为特定代理赋予不同于全局默认设置的权限。

**对于自定义代理** (在代理 frontmatter 中)：

```
---
permission:
  skill:
    "documents-*": "allow"
---
```

**对于内置代理** (在 `opencode.json` 中)：

```
{
  "agent": {
    "plan": {
      "permission": {
        "skill": {
          "internal-*": "allow"
        }
      }
    }
  }
}
```

---

## [禁用技能工具](#disable-the-skill-tool)

完全禁用不应使用技能的代理的技能功能：

**对于自定义代理**：

```
---
tools:
  skill: false
---
```

**对于内置代理**：

```
{
  "agent": {
    "plan": {
      "tools": {
        "skill": false
      }
    }
  }
}
```

禁用时，`<available_skills>` 部分将被完全省略。

---

## [加载故障排除](#troubleshoot-loading)

如果技能未显示：

1. 验证 `SKILL.md` 是否全大写拼写
2. 检查 frontmatter 是否包含 `name` 和 `description`
3. 确保技能名称在所有位置都是唯一的
4. 检查权限——设置为 `deny` 的技能对代理隐藏
