# ComfyUI 端口配置指南

本文档介绍如何在启动ComfyUI时配置端口号和相关网络设置。

## 目录
- [基本端口配置](#基本端口配置)
- [网络监听配置](#网络监听配置)
- [HTTPS配置](#https配置)
- [其他网络选项](#其他网络选项)
- [使用示例](#使用示例)
- [故障排除](#故障排除)

## 基本端口配置

### 默认端口
ComfyUI默认使用端口 **8188**。如果不指定任何参数，启动后可通过以下地址访问：
```
http://127.0.0.1:8188
```

### 自定义端口
使用 `--port` 参数指定自定义端口：

```bash
python main.py --port 端口号
```

**示例：**
```bash
# 使用端口8080
python main.py --port 8080

# 使用端口9999
python main.py --port 9999
```

## 网络监听配置

### 监听地址
使用 `--listen` 参数配置监听的IP地址：

```bash
python main.py --listen IP地址
```

**常用配置：**
- `127.0.0.1` - 仅本地访问（默认）
- `0.0.0.0` - 允许所有IP访问
- `192.168.1.100` - 指定特定IP

**示例：**
```bash
# 允许所有IP访问
python main.py --listen 0.0.0.0

# 指定特定IP和端口
python main.py --listen 192.168.1.100 --port 8080
```

### 多IP监听
可以通过逗号分隔指定多个IP地址：

```bash
python main.py --listen "127.0.0.1,192.168.1.100"
```

## HTTPS配置

### 启用HTTPS
使用TLS/SSL证书启用HTTPS访问：

```bash
python main.py --tls-keyfile 私钥文件路径 --tls-certfile 证书文件路径
```

**示例：**
```bash
python main.py --port 8443 --tls-keyfile key.pem --tls-certfile cert.pem
```

### 生成自签名证书
对于开发环境，可以生成自签名证书：

```bash
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -sha256 -days 3650 -nodes -subj "/C=XX/ST=StateName/L=CityName/O=CompanyName/OU=CompanySectionName/CN=CommonNameOrHostname"
```

## 其他网络选项

### CORS配置
启用跨域资源共享：

```bash
# 允许所有来源
python main.py --enable-cors-header

# 指定特定来源
python main.py --enable-cors-header "https://example.com"
```

### 上传大小限制
设置最大上传文件大小（单位：MB）：

```bash
python main.py --max-upload-size 200
```

### 响应压缩
启用响应体压缩以提高传输效率：

```bash
python main.py --enable-compress-response-body
```

## 使用示例

### 基础使用
```bash
# 默认配置启动
python main.py

# 自定义端口
python main.py --port 8080
```

### 局域网访问
```bash
# 允许局域网访问
python main.py --listen 0.0.0.0 --port 8080
```

### 生产环境配置
```bash
# HTTPS + 自定义端口 + CORS + 压缩
python main.py \
  --port 8443 \
  --listen 0.0.0.0 \
  --tls-keyfile /path/to/key.pem \
  --tls-certfile /path/to/cert.pem \
  --enable-cors-header \
  --enable-compress-response-body \
  --max-upload-size 500
```

### 开发环境配置
```bash
# 开发环境：自动启动浏览器
python main.py --port 8080 --auto-launch
```

## 故障排除

### 端口被占用
如果遇到端口被占用的错误：

1. **检查端口占用：**
   ```bash
   # Windows
   netstat -ano | findstr :8188
   
   # Linux/macOS
   lsof -i :8188
   ```

2. **更换端口：**
   ```bash
   python main.py --port 8189
   ```

### 无法访问
如果无法通过网络访问：

1. **检查防火墙设置**
2. **确认监听地址配置：**
   ```bash
   # 确保使用0.0.0.0而不是127.0.0.1
   python main.py --listen 0.0.0.0
   ```

### HTTPS证书问题
如果HTTPS证书有问题：

1. **检查证书文件路径**
2. **验证证书格式**
3. **确保私钥和证书匹配**

### 权限问题
在Linux/macOS上使用低端口号（&lt;1024）需要管理员权限：

```bash
# 使用sudo运行
sudo python main.py --port 80

# 或使用高端口号
python main.py --port 8080
```

## 配置文件参数总结

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `--port` | int | 8188 | 设置监听端口 |
| `--listen` | str | 127.0.0.1 | 设置监听IP地址 |
| `--tls-keyfile` | str | None | TLS私钥文件路径 |
| `--tls-certfile` | str | None | TLS证书文件路径 |
| `--enable-cors-header` | str | None | 启用CORS，可指定来源 |
| `--max-upload-size` | float | 100 | 最大上传大小(MB) |
| `--enable-compress-response-body` | flag | False | 启用响应压缩 |
| `--auto-launch` | flag | False | 自动启动浏览器 |

## 注意事项

1. **安全性：** 在生产环境中使用`--listen 0.0.0.0`时要注意安全性，建议配合防火墙使用
2. **性能：** 启用响应压缩可以提高传输效率，但会增加CPU使用率
3. **证书：** 自签名证书会在浏览器中显示安全警告，生产环境建议使用正式证书
4. **端口选择：** 避免使用系统保留端口，建议使用8000-9999范围内的端口

---

更多信息请参考 [ComfyUI官方文档](https://github.com/comfyanonymous/ComfyUI)
