> Agent Client Protocol 架构概述

Agent Client Protocol 定义了 AI 代理与客户端应用程序之间通信的标准接口。该架构旨在灵活、可扩展且与平台无关。

## 设计理念

协议架构遵循几个关键原则：

1. **MCP 友好**：协议建立在 JSON-RPC 之上，并尽可能重用 MCP 类型，因此集成者无需为常见数据类型构建另一种表示形式。
2. **UX 优先**：它旨在解决与 AI 代理交互的 UX 挑战；确保有足够的灵活性来清晰地呈现代理意图，但又不会过度抽象。
3. **受信任**：当您使用代码编辑器与您信任的模型进行对话时，ACP 就会发挥作用。您仍然可以控制代理的工具调用，但代码编辑器赋予代理访问本地文件和 MCP 服务器的权限。

## 设置

当用户尝试连接到代理时，编辑器会按需启动代理子进程，所有通信都通过 stdin/stdout 进行。

每个连接可以支持多个并发会话，因此您可以同时进行多个思路流。

<img src="https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=90242ce890be80f96c4c1a6166e3c057" alt="Server Client setup" data-og-width="579" width="579" data-og-height="455" height="455" data-path="images/server-client.svg" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?w=280&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=bd917ddb677e6b23cdc2a19346390822 280w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?w=560&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=1d05c343199c6051ca57040276d3cd60 560w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?w=840&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=d60766a694ef1485b14044538777260d 840w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?w=1100&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=60a044b75725dd10573c2a5a9d10b103 1100w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?w=1650&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=c8755a1d971c8c0c374077a622ce2873 1650w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/server-client.svg?w=2500&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=53540d5df78b7c0e400a33632b95ef8e 2500w" />

ACP 大量使用 JSON-RPC 通知，允许代理实时向 UI 传输更新。它还使用 JSON-RPC 的双向请求，允许代理向代码编辑器发出请求：例如请求工具调用的权限。

## MCP

通常代码编辑器会有用户配置的 MCP 服务器。当转发用户的提示时，它会将这些配置传递给代理。这允许代理直接连接到 MCP 服务器。

<img src="https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=4208d22ec64bdf11af53b1778df72c8c" alt="MCP Server connection" data-og-width="689" width="689" data-og-height="440" height="440" data-path="images/mcp.svg" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?w=280&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=9442d9a54ca427398580ae7a483cf4ad 280w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?w=560&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=44ab3b84da5c6b81bbf67d9228c7316b 560w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?w=840&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=fefa396575e4ad81ba6123284c394d5d 840w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?w=1100&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=80fddbbee7c96dcb961204e3fbb24507 1100w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?w=1650&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=28bc64ceb8091ec50d58903e8132bd6f 1650w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp.svg?w=2500&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=049676f3e8a20c01fd0e169032041fc8 2500w" />

代码编辑器本身也可能希望导出基于 MCP 的工具。代码编辑器无需尝试在同一个套接字上运行 MCP 和 ACP，而是可以提供自己的 MCP 服务器作为配置。由于代理可能仅支持基于 stdio 的 MCP，代码编辑器可以提供一个小代理，将请求隧道回自身：

<img src="https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=ce25c0e525d70d48044da2d9841d6f83" alt="MCP connection to self" data-og-width="632" width="632" data-og-height="440" height="440" data-path="images/mcp-proxy.svg" data-optimize="true" data-opv="3" srcset="https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?w=280&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=4fdf7e888ab64e9a77cda096c3115354 280w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?w=560&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=22e6dec61324e2a4f4ee82d9c0624563 560w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?w=840&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=0d7a261ba0002c913174de587490728f 840w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?w=1100&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=6dd1a0f7deb4d4da801ce6613dd4c180 1100w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?w=1650&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=a9927bfa96f59759d50525163732b511 1650w, https://mintcdn.com/zed-685ed6d6/FgcZrIi8cEeJJGHC/images/mcp-proxy.svg?w=2500&fit=max&auto=format&n=FgcZrIi8cEeJJGHC&q=85&s=711e54a4c2195fd9183baf3e021f719c 2500w" />


---

> 要查找本文档中的导航和其他页面，请获取 llms.txt 文件：https://agentclientprotocol.com/llms.txt
