<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-AI/提示词工程/DSPy/API/优化器/GEPA" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">GEPA | Cruldra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/notes3/docs/AI/提示词工程/DSPy/API/优化器/GEPA"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GEPA | Cruldra"><meta data-rh="true" name="description" content="GEPA (Genetic-Pareto) 是在 &quot;GEPA2507.19457) 中提出的一种反射式优化器，它自适应地进化任意系统的文本组件（例如提示词）。除了指标返回的标量分数外，用户还可以向 GEPA 提供文本反馈以指导优化过程。这种文本反馈使 GEPA 更清楚地了解系统为何获得该分数，然后 GEPA 可以进行内省以确定如何提高分数。这使得 GEPA 能够在极少的轮次中提出高性能的提示词。"><meta data-rh="true" property="og:description" content="GEPA (Genetic-Pareto) 是在 &quot;GEPA2507.19457) 中提出的一种反射式优化器，它自适应地进化任意系统的文本组件（例如提示词）。除了指标返回的标量分数外，用户还可以向 GEPA 提供文本反馈以指导优化过程。这种文本反馈使 GEPA 更清楚地了解系统为何获得该分数，然后 GEPA 可以进行内省以确定如何提高分数。这使得 GEPA 能够在极少的轮次中提出高性能的提示词。"><link data-rh="true" rel="icon" href="/notes3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/notes3/docs/AI/提示词工程/DSPy/API/优化器/GEPA"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/AI/提示词工程/DSPy/API/优化器/GEPA" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/AI/提示词工程/DSPy/API/优化器/GEPA" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"GEPA","item":"https://your-docusaurus-site.example.com/notes3/docs/AI/提示词工程/DSPy/API/优化器/GEPA"}]}</script><link rel="alternate" type="application/rss+xml" href="/notes3/blog/rss.xml" title="Cruldra RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes3/blog/atom.xml" title="Cruldra Atom Feed"><link rel="stylesheet" href="/notes3/assets/css/styles.8c4657fb.css">
<script src="/notes3/assets/js/runtime~main.983b7776.js" defer="defer"></script>
<script src="/notes3/assets/js/main.424b1ecb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme",window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme-choice","system"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/notes3/img/logo.svg"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_aA1M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes3/"><div class="navbar__logo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--light_DVqC"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--dark_B_L3"></div><b class="navbar__title text--truncate">Cruldra</b></a><a class="navbar__item navbar__link" href="/notes3/docs/category/设计模式">JVM</a><a class="navbar__item navbar__link" href="/notes3/docs/category/css">前端</a><a class="navbar__item navbar__link" href="/notes3/docs/category/astrbot">工具</a><a class="navbar__item navbar__link" href="/notes3/docs/category/ai电竞酒店">个人</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes3/docs/AI/Agno/介绍">AI</a><a class="navbar__item navbar__link" href="/notes3/docs/category/内置模块">Python</a><a class="navbar__item navbar__link" href="/notes3/docs/category/actix-web">Rust</a><a class="navbar__item navbar__link" href="/notes3/docs/category/数据库系统">软件工程</a><a class="navbar__item navbar__link" href="/notes3/docs/category/上古卷轴5">游戏</a><a class="navbar__item navbar__link" href="/notes3/docs/Go/Go-Python-Java三语言全方位对比">Go</a><a class="navbar__item navbar__link" href="/notes3/docs/Hardware/intro">硬件</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_PufJ"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ctfR"><div class="docsWrapper_ByIB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KwvU" type="button"></button><div class="docRoot_hD6z"><aside class="theme-doc-sidebar-container docSidebarContainer_KuHC"><div class="sidebarViewport_LCjr"><div class="sidebar_L77d"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VYAF"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/Agno/介绍"><span title="Agno" class="categoryLinkLabel_FHN4">Agno</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/CrewAI/CLI"><span title="CrewAI" class="categoryLinkLabel_FHN4">CrewAI</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/DALLE成本计算"><span title="DALL-E 画图成本计算" class="linkLabel__RqX">DALL-E 画图成本计算</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/MCP/MCP-Python-SDK"><span title="MCP" class="categoryLinkLabel_FHN4">MCP</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/Transformer"><span title="Transformer" class="linkLabel__RqX">Transformer</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/AI/vllm"><span title="vLLM 学习资料" class="categoryLinkLabel_FHN4">vLLM 学习资料</span></a><button aria-label="Expand sidebar category &#x27;vLLM 学习资料&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念1"><span title="一些概念1" class="linkLabel__RqX">一些概念1</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念2"><span title="一些概念2" class="linkLabel__RqX">一些概念2</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念3"><span title="一些概念3" class="linkLabel__RqX">一些概念3</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念4"><span title="一些概念4" class="linkLabel__RqX">一些概念4</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念5"><span title="一些概念5" class="linkLabel__RqX">一些概念5</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/候选模型"><span title="候选模型" class="linkLabel__RqX">候选模型</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/变分自编码器详解"><span title="变分自编码器（VAE）详解" class="linkLabel__RqX">变分自编码器（VAE）详解</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/大模型核心概念通俗解释"><span title="大模型核心概念通俗解释" class="linkLabel__RqX">大模型核心概念通俗解释</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/大模型训练中的随机种子：为什么需要它？"><span title="大模型训练中的随机种子：为什么需要它？" class="linkLabel__RqX">大模型训练中的随机种子：为什么需要它？</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/嵌入和向量/Chroma与PGVector对比"><span title="嵌入和向量" class="categoryLinkLabel_FHN4">嵌入和向量</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/感知机"><span title="感知机" class="linkLabel__RqX">感知机</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BetterTogether"><span title="提示词工程" class="categoryLinkLabel_FHN4">提示词工程</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BetterTogether"><span title="DSPy" class="categoryLinkLabel_FHN4">DSPy</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BetterTogether"><span title="API" class="categoryLinkLabel_FHN4">API</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BetterTogether"><span title="优化器" class="categoryLinkLabel_FHN4">优化器</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BetterTogether"><span title="BetterTogether" class="linkLabel__RqX">BetterTogether</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BootstrapFewShot"><span title="BootstrapFewShot" class="linkLabel__RqX">BootstrapFewShot</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BootstrapFinetune"><span title="BootstrapFinetune" class="linkLabel__RqX">BootstrapFinetune</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/GEPA"><span title="GEPA" class="linkLabel__RqX">GEPA</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/各个优化器之间的区别及适用场景"><span title="各个优化器之间的区别及适用场景" class="linkLabel__RqX">各个优化器之间的区别及适用场景</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/参考/1"><span title="参考" class="categoryLinkLabel_FHN4">参考</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/和智能体框架集成"><span title="如何将 DSPy 训练模型集成到 CrewAI/Agno 智能体框架" class="linkLabel__RqX">如何将 DSPy 训练模型集成到 CrewAI/Agno 智能体框架</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/学习/概览"><span title="学习" class="categoryLinkLabel_FHN4">学习</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/示例/ai_text_game"><span title="示例" class="categoryLinkLabel_FHN4">示例</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/提示词工程/DSPy/简介"><span title="简介" class="linkLabel__RqX">简介</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/智能体"><span title="智能体(Agent)" class="linkLabel__RqX">智能体(Agent)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/深度学习/入门"><span title="深度学习" class="categoryLinkLabel_FHN4">深度学习</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/理解大模型：从函数视角看AI的本质"><span title="理解大模型：从函数视角看AI的本质" class="linkLabel__RqX">理解大模型：从函数视角看AI的本质</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/知识蒸馏"><span title="知识蒸馏" class="linkLabel__RqX">知识蒸馏</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/联邦学习概念"><span title="联邦学习概念" class="linkLabel__RqX">联邦学习概念</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/通义千问/阿里云百炼"><span title="通义千问" class="categoryLinkLabel_FHN4">通义千问</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/金丝雀发布和AB测试"><span title="金丝雀发布和AB测试" class="linkLabel__RqX">金丝雀发布和AB测试</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_WxcZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Zd2x"><div class="docItemContainer_EEW4"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xL_w" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_zA1U"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">提示词工程</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">DSPy</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">API</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">优化器</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">GEPA</span></li></ul></nav><div class="tocCollapsible_aZGz theme-doc-toc-mobile tocMobile_ShCt"><button type="button" class="clean-btn tocCollapsibleButton_fxzH">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GEPA</h1></header><p><strong>GEPA</strong> (Genetic-Pareto) 是在 &quot;GEPA: Reflective Prompt Evolution Can Outperform Reinforcement Learning&quot; (Agrawal et al., 2025, <a href="https://arxiv.org/abs/2507.19457" target="_blank" rel="noopener noreferrer" class="">arxiv:2507.19457</a>) 中提出的一种反射式优化器，它自适应地进化任意系统的<em>文本组件</em>（例如提示词）。除了指标返回的标量分数外，用户还可以向 GEPA 提供文本反馈以指导优化过程。这种文本反馈使 GEPA 更清楚地了解系统为何获得该分数，然后 GEPA 可以进行内省以确定如何提高分数。这使得 GEPA 能够在极少的轮次中提出高性能的提示词。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="dspygepametric-gepafeedbackmetric--auto-literallight-medium-heavy--none--none-max_full_evals-int--none--none-max_metric_calls-int--none--none-reflection_minibatch_size-int--3-candidate_selection_strategy-literalpareto-current_best--pareto-reflection_lm-lm--none--none-skip_perfect_score-bool--true-add_format_failure_as_feedback-bool--false-instruction_proposer-proposalfn--none--none-component_selector-reflectioncomponentselector--str--round_robin-use_merge-bool--true-max_merge_invocations-int--none--5-num_threads-int--none--none-failure_score-float--00-perfect_score-float--10-log_dir-str--none--none-track_stats-bool--false-use_wandb-bool--false-wandb_api_key-str--none--none-wandb_init_kwargs-dictstr-any--none--none-track_best_outputs-bool--false-warn_on_score_mismatch-bool--true-enable_tool_optimization-bool--false-use_mlflow-bool--false-seed-int--none--0-gepa_kwargs-dict--none--none-"><code>dspy.GEPA(metric: GEPAFeedbackMetric, *, auto: Literal[&#x27;light&#x27;, &#x27;medium&#x27;, &#x27;heavy&#x27;] | None = None, max_full_evals: int | None = None, max_metric_calls: int | None = None, reflection_minibatch_size: int = 3, candidate_selection_strategy: Literal[&#x27;pareto&#x27;, &#x27;current_best&#x27;] = &#x27;pareto&#x27;, reflection_lm: LM | None = None, skip_perfect_score: bool = True, add_format_failure_as_feedback: bool = False, instruction_proposer: ProposalFn | None = None, component_selector: ReflectionComponentSelector | str = &#x27;round_robin&#x27;, use_merge: bool = True, max_merge_invocations: int | None = 5, num_threads: int | None = None, failure_score: float = 0.0, perfect_score: float = 1.0, log_dir: str | None = None, track_stats: bool = False, use_wandb: bool = False, wandb_api_key: str | None = None, wandb_init_kwargs: dict[str, Any] | None = None, track_best_outputs: bool = False, warn_on_score_mismatch: bool = True, enable_tool_optimization: bool = False, use_mlflow: bool = False, seed: int | None = 0, gepa_kwargs: dict | None = None)</code> <a href="#dspy.GEPA" title="永久链接" class="">¶</a><a href="#dspygepametric-gepafeedbackmetric--auto-literallight-medium-heavy--none--none-max_full_evals-int--none--none-max_metric_calls-int--none--none-reflection_minibatch_size-int--3-candidate_selection_strategy-literalpareto-current_best--pareto-reflection_lm-lm--none--none-skip_perfect_score-bool--true-add_format_failure_as_feedback-bool--false-instruction_proposer-proposalfn--none--none-component_selector-reflectioncomponentselector--str--round_robin-use_merge-bool--true-max_merge_invocations-int--none--5-num_threads-int--none--none-failure_score-float--00-perfect_score-float--10-log_dir-str--none--none-track_stats-bool--false-use_wandb-bool--false-wandb_api_key-str--none--none-wandb_init_kwargs-dictstr-any--none--none-track_best_outputs-bool--false-warn_on_score_mismatch-bool--true-enable_tool_optimization-bool--false-use_mlflow-bool--false-seed-int--none--0-gepa_kwargs-dict--none--none-" class="hash-link" aria-label="Direct link to dspygepametric-gepafeedbackmetric--auto-literallight-medium-heavy--none--none-max_full_evals-int--none--none-max_metric_calls-int--none--none-reflection_minibatch_size-int--3-candidate_selection_strategy-literalpareto-current_best--pareto-reflection_lm-lm--none--none-skip_perfect_score-bool--true-add_format_failure_as_feedback-bool--false-instruction_proposer-proposalfn--none--none-component_selector-reflectioncomponentselector--str--round_robin-use_merge-bool--true-max_merge_invocations-int--none--5-num_threads-int--none--none-failure_score-float--00-perfect_score-float--10-log_dir-str--none--none-track_stats-bool--false-use_wandb-bool--false-wandb_api_key-str--none--none-wandb_init_kwargs-dictstr-any--none--none-track_best_outputs-bool--false-warn_on_score_mismatch-bool--true-enable_tool_optimization-bool--false-use_mlflow-bool--false-seed-int--none--0-gepa_kwargs-dict--none--none-" title="Direct link to dspygepametric-gepafeedbackmetric--auto-literallight-medium-heavy--none--none-max_full_evals-int--none--none-max_metric_calls-int--none--none-reflection_minibatch_size-int--3-candidate_selection_strategy-literalpareto-current_best--pareto-reflection_lm-lm--none--none-skip_perfect_score-bool--true-add_format_failure_as_feedback-bool--false-instruction_proposer-proposalfn--none--none-component_selector-reflectioncomponentselector--str--round_robin-use_merge-bool--true-max_merge_invocations-int--none--5-num_threads-int--none--none-failure_score-float--00-perfect_score-float--10-log_dir-str--none--none-track_stats-bool--false-use_wandb-bool--false-wandb_api_key-str--none--none-wandb_init_kwargs-dictstr-any--none--none-track_best_outputs-bool--false-warn_on_score_mismatch-bool--true-enable_tool_optimization-bool--false-use_mlflow-bool--false-seed-int--none--0-gepa_kwargs-dict--none--none-" translate="no">​</a></h2>
<p>基类: <code>Teleprompter</code></p>
<p>GEPA 是一个进化优化器，它使用反射来进化复杂系统的文本组件。GEPA 在论文 <a href="https://arxiv.org/abs/2507.19457" target="_blank" rel="noopener noreferrer" class="">GEPA: Reflective Prompt Evolution Can Outperform Reinforcement Learning</a> 中提出。
GEPA 优化引擎由 <code>gepa</code> 包提供，可从 <code>https://github.com/gepa-ai/gepa</code> 获取。</p>
<p>GEPA 捕获 DSPy 模块执行的完整轨迹，识别与特定预测器对应的轨迹部分，并反思预测器的行为以为预测器提出新的指令。GEPA 允许用户向优化器提供文本反馈，用于指导预测器的进化。文本反馈可以在单个预测器的粒度上提供，也可以在整个系统的执行级别上提供。</p>
<p>要向 GEPA 优化器提供反馈，请按如下方式实现一个指标：</p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">def metric(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gold: Example,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pred: Prediction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace: Optional[DSPyTrace] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pred_name: Optional[str] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pred_trace: Optional[DSPyTrace] = None,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; float | ScoreWithFeedback:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    此函数使用以下参数调用：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - gold: 黄金示例（标准答案）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - pred: 预测输出。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - trace: 可选。程序执行的轨迹。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - pred_name: 可选。GEPA 当前正在优化的目标预测器的名称，正在为其请求反馈。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - pred_trace: 可选。GEPA 正在寻求反馈的目标预测器的执行轨迹。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    注意 `pred_name` 和 `pred_trace` 参数。在优化过程中，GEPA 将调用指标以获取正在优化的单个预测器的反馈。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GEPA 在 `pred_name` 中提供预测器的名称，在 `pred_trace` 中提供对应于预测器的子轨迹（轨迹的一部分）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如果在预测器级别可用，指标应返回对应于预测器的 `{&#x27;score&#x27;: float, &#x27;feedback&#x27;: str}`。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如果在预测器级别不可用，指标也可以在程序级别返回文本反馈（仅使用 gold, pred 和 trace）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如果未返回反馈，GEPA 将使用仅包含分数的简单文本反馈：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `f&quot;This trajectory got a score of {score}.&quot;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>GEPA 还可以用作批量推理时搜索策略，方法是传递 <code>valset=trainset, track_stats=True, track_best_outputs=True</code>，并使用优化后的程序（由 <code>compile</code> 返回）的 <code>detailed_results</code> 属性来获取批次的 Pareto 前沿。<code>optimized_program.detailed_results.best_outputs_valset</code> 将包含批次中每个任务的最佳输出。</p>
<p>示例:</p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">gepa = GEPA(metric=metric, track_stats=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_of_tasks = [dspy.Example(...) for task in tasks]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new_prog = gepa.compile(student, trainset=trainset, valset=batch_of_tasks)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pareto_frontier = new_prog.detailed_results.val_aggregate_scores</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># pareto_frontier 是一个分数列表，批次中的每个任务对应一个分数。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>参数:</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><code>metric</code></td><td><code>[GEPAFeedbackMetric](#dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric &quot;            dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric&quot;)</code></td><td>用于反馈和评估的指标函数。</td><td><em>必填</em></td></tr><tr><td><code>auto</code></td><td>`Literal[&#x27;light&#x27;, &#x27;medium&#x27;, &#x27;heavy&#x27;]</td><td>None`</td><td>运行使用的自动预算。选项: &quot;light&quot;, &quot;medium&quot;, &quot;heavy&quot;。</td></tr><tr><td><code>max_full_evals</code></td><td>`int</td><td>None`</td><td>要执行的最大完整评估次数。</td></tr><tr><td><code>max_metric_calls</code></td><td>`int</td><td>None`</td><td>要执行的最大指标调用次数。</td></tr><tr><td><code>reflection_minibatch_size</code></td><td><code>int</code></td><td>单个 GEPA 步骤中用于反射的示例数量。默认为 3。</td><td><code>3</code></td></tr><tr><td><code>candidate_selection_strategy</code></td><td><code>Literal[&#x27;pareto&#x27;, &#x27;current_best&#x27;]</code></td><td>候选选择策略。默认为 &quot;pareto&quot;，它从所有验证分数的 Pareto 前沿随机选择候选者。选项: &quot;pareto&quot;, &quot;current_best&quot;。</td><td><code>&#x27;pareto&#x27;</code></td></tr><tr><td><code>reflection_lm</code></td><td>`[LM](../../../models/LM/#dspy.LM &quot;              dspy.LM(model: str, model_type: Literal[&#x27;chat&#x27;, &#x27;text&#x27;, &#x27;responses&#x27;] = &#x27;chat&#x27;, temperature: float</td><td>None = None, max_tokens: int</td><td>None = None, cache: bool = True, callbacks: list[BaseCallback]</td></tr><tr><td><code>skip_perfect_score</code></td><td><code>bool</code></td><td>是否在反射期间跳过具有完美分数的示例。默认为 True。</td><td><code>True</code></td></tr><tr><td><code>instruction_proposer</code></td><td>`ProposalFn</td><td>None`</td><td>可选的自定义指令提议者，实现 GEPA 的 ProposalFn 协议。<strong>默认: None（推荐大多数用户使用）</strong> - 使用来自 <a href="https://github.com/gepa-ai/gepa" target="_blank" rel="noopener noreferrer" class="">GEPA 库</a> 的经过验证的 GEPA 指令提议者，该提议者实现了 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/core/adapter.py" target="_blank" rel="noopener noreferrer" class=""><code>ProposalFn</code></a>。此默认提议者能力很强，并在 GEPA 论文和教程中报告的各种实验中得到了验证。在此处查看有关自定义指令提议者的文档 <a href="https://dspy.ai/api/optimizers/GEPA/GEPA_Advanced/#custom-instruction-proposers" target="_blank" rel="noopener noreferrer" class="">这里</a>。<strong>高级功能</strong>: 仅在特定场景下需要：- <strong>多模态处理</strong>: 处理 dspy.Image 输入以及文本信息 - <strong>对约束的细微控制</strong>: 对指令长度、格式和结构要求进行细粒度控制，超出标准反馈机制 - <strong>特定领域知识注入</strong>: 无法仅通过 feedback_func 提供的专业术语或上下文 - <strong>特定提供商提示</strong>: 针对特定 LLM 提供商（OpenAI, Anthropic）及其独特格式偏好的优化 - <strong>耦合组件更新</strong>: 协调多个组件的更新，而不是独立优化 - <strong>外部知识集成</strong>: 运行时访问数据库、API 或知识库。默认提议者有效地处理绝大多数用例。对于视觉内容，使用 <code>dspy.teleprompt.gepa.instruction_proposal</code> 中的 <code>MultiModalInstructionProposer()</code>，或者为高度专业化的需求实现自定义 <code>ProposalFn</code>。注意：当同时设置了 <code>instruction_proposer</code> 和 <code>reflection_lm</code> 时，<code>instruction_proposer</code> 在 <code>reflection_lm</code> 上下文中调用。但是，使用自定义 <code>instruction_proposer</code> 时，<code>reflection_lm</code> 是可选的。如果需要，自定义指令提议者可以调用自己的 LLM。</td></tr><tr><td><code>component_selector</code></td><td>`ReflectionComponentSelector</td><td>str`</td><td>实现 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/proposer/reflective_mutation/base.py" target="_blank" rel="noopener noreferrer" class="">ReflectionComponentSelector</a> 协议的自定义组件选择器，或指定内置选择器策略的字符串。控制每次迭代中选择哪些组件（预测器）进行优化。默认为 &#x27;round_robin&#x27; 策略，该策略一次循环一个组件。可用的字符串选项：&#x27;round_robin&#x27;（按顺序循环组件），&#x27;all&#x27;（选择所有组件进行同时优化）。自定义选择器可以实现基于优化状态和轨迹的 LLM 驱动的选择逻辑。请参阅 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/strategies/component_selector.py" target="_blank" rel="noopener noreferrer" class="">gepa 组件选择器</a> 以获取可用的内置选择器，以及 ReflectionComponentSelector 协议以实现自定义选择器。</td></tr><tr><td><code>add_format_failure_as_feedback</code></td><td><code>bool</code></td><td>是否将格式失败添加为反馈。默认为 False。</td><td><code>False</code></td></tr><tr><td><code>use_merge</code></td><td><code>bool</code></td><td>是否使用基于合并的优化。默认为 True。</td><td><code>True</code></td></tr><tr><td><code>max_merge_invocations</code></td><td>`int</td><td>None`</td><td>要执行的最大合并调用次数。默认为 5。</td></tr><tr><td><code>num_threads</code></td><td>`int</td><td>None`</td><td>使用 <code>Evaluate</code> 进行评估时使用的线程数。可选。</td></tr><tr><td><code>failure_score</code></td><td><code>float</code></td><td>分配给失败示例的分数。默认为 0.0。</td><td><code>0.0</code></td></tr><tr><td><code>perfect_score</code></td><td><code>float</code></td><td>指标可达到的最高分数。默认为 1.0。GEPA 使用它来确定小批量中的所有示例是否都是完美的。</td><td><code>1.0</code></td></tr><tr><td><code>log_dir</code></td><td>`str</td><td>None`</td><td>保存日志的目录。GEPA 在此目录中保存详细的日志以及所有候选程序。使用相同的 <code>log_dir</code> 运行 GEPA 将从上一个检查点恢复运行。</td></tr><tr><td><code>track_stats</code></td><td><code>bool</code></td><td>是否在优化后程序的 <code>detailed_results</code> 属性中返回详细结果和所有提议的程序。默认为 False。</td><td><code>False</code></td></tr><tr><td><code>use_wandb</code></td><td><code>bool</code></td><td>是否使用 wandb 进行记录。默认为 False。</td><td><code>False</code></td></tr><tr><td><code>wandb_api_key</code></td><td>`str</td><td>None`</td><td>用于 wandb 的 API 密钥。如果未提供，wandb 将使用环境变量 <code>WANDB_API_KEY</code> 中的 API 密钥。</td></tr><tr><td><code>wandb_init_kwargs</code></td><td>`dict[str, Any]</td><td>None`</td><td>传递给 <code>wandb.init</code> 的其他关键字参数。</td></tr><tr><td><code>track_best_outputs</code></td><td><code>bool</code></td><td>是否在验证集上跟踪最佳输出。如果 <code>track_best_outputs</code> 为 True，则 <code>track_stats</code> 必须为 True。优化后程序的 <code>detailed_results.best_outputs_valset</code> 将包含验证集中每个任务的最佳输出。</td><td><code>False</code></td></tr><tr><td><code>warn_on_score_mismatch</code></td><td><code>bool</code></td><td>GEPA（当前）期望在带有和不带有 <code>pred_name</code> 的情况下调用时，指标返回相同的模块级分数。此标志（默认为 True）确定如果检测到模块级和预测器级分数不匹配，是否引发警告。</td><td><code>True</code></td></tr><tr><td><code>enable_tool_optimization</code></td><td><code>bool</code></td><td>是否启用 dspy.ReAct 模块的联合优化。启用后，GEPA 将联合优化 dspy.ReAct 模块的预测器指令和工具描述。有关何时使用此功能及其工作原理的详细信息，请参阅 <a href="https://dspy.ai/api/optimizers/GEPA/GEPA_Advanced/#tool-optimization" target="_blank" rel="noopener noreferrer" class="">工具优化指南</a>。默认为 False。</td><td><code>False</code></td></tr><tr><td><code>seed</code></td><td>`int</td><td>None`</td><td>用于可重复性的随机种子。默认为 0。</td></tr><tr><td><code>gepa_kwargs</code></td><td>`dict</td><td>None`</td><td>(可选) 直接传递给 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/api.py" target="_blank" rel="noopener noreferrer" class="">gepa.optimize</a> 的其他关键字参数。用于访问未通过 DSPy 的 GEPA 接口直接公开的高级 GEPA 功能。可用参数：- batch_sampler: 选择训练示例的策略。可以是 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/strategies/batch_sampler.py" target="_blank" rel="noopener noreferrer" class="">BatchSampler</a> 实例或字符串 (&#x27;epoch_shuffled&#x27;)。默认为 &#x27;epoch_shuffled&#x27;。仅在 reflection_minibatch_size 为 None 时有效。 - merge_val_overlap_floor: 在尝试合并子采样之前，父代之间所需的共享验证 ID 的最小数量。仅在使用 &#x27;full_eval&#x27; 以外的 <code>val_evaluation_policy</code> 时相关。默认为 5。 - stop_callbacks: 可选的停止器，当优化应停止时返回 True。可以是单个 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/utils/stop_condition.py" target="_blank" rel="noopener noreferrer" class="">StopperProtocol</a> 或 StopperProtocol 实例列表。示例: <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/utils/stop_condition.py" target="_blank" rel="noopener noreferrer" class="">FileStopper</a>, <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/utils/stop_condition.py" target="_blank" rel="noopener noreferrer" class="">TimeoutStopCondition</a>, <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/utils/stop_condition.py" target="_blank" rel="noopener noreferrer" class="">SignalStopper</a>, <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/utils/stop_condition.py" target="_blank" rel="noopener noreferrer" class="">NoImprovementStopper</a>, 或自定义停止逻辑。注意：这会覆盖默认的 max_metric_calls 停止条件。 - use_cloudpickle: 使用 cloudpickle 而不是 pickle 进行序列化。当序列化状态包含动态生成的 DSPy 签名时很有用。默认为 False。 - val_evaluation_policy: 控制每次迭代评分哪些验证 ID 的策略。可以是 &#x27;full_eval&#x27;（每次评估每个 ID）或 <a href="https://github.com/gepa-ai/gepa/blob/main/src/gepa/strategies/eval_policy.py" target="_blank" rel="noopener noreferrer" class="">EvaluationPolicy</a> 实例。默认为 &#x27;full_eval&#x27;。 - use_mlf... [截断]</td></tr></tbody></table>
<p>注意</p>
<p>预算配置：必须提供 <code>auto</code>, <code>max_full_evals</code>, 或 <code>max_metric_calls</code> 中的一个且仅一个。
<code>auto</code> 参数提供预设配置：&quot;light&quot; 用于快速实验，&quot;medium&quot; 用于平衡优化，&quot;heavy&quot; 用于彻底优化。</p>
<p>反射配置：<code>reflection_lm</code> 参数是必需的，并且应该是一个强大的语言模型。
GEPA 在使用像 <code>dspy.LM(model=&#x27;gpt-5&#x27;, temperature=1.0, max_tokens=32000)</code> 这样的模型时表现最佳。
反射过程分析失败的示例以生成用于程序改进的反馈。</p>
<p>合并配置：GEPA 可以使用 <code>use_merge=True</code> 合并成功的程序变体。
<code>max_merge_invocations</code> 参数控制优化期间进行的合并尝试次数。</p>
<p>评估配置：使用 <code>num_threads</code> 并行化评估。<code>failure_score</code> 和 <code>perfect_score</code> 参数帮助 GEPA 理解你的指标范围并据此进行优化。</p>
<p>日志配置：设置 <code>log_dir</code> 以保存详细日志并启用检查点恢复。
使用 <code>track_stats=True</code> 通过 <code>detailed_results</code> 属性访问详细的优化结果。
启用 <code>use_wandb=True</code> 进行实验跟踪和可视化。</p>
<p>可重复性：设置 <code>seed</code> 以确保具有相同配置的运行结果一致。</p>
<p>源代码位于 <code>dspy/teleprompt/gepa/gepa.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444</code></td><td>``` def <strong>init</strong>(     self,     metric: GEPAFeedbackMetric,     *,     # Budget configuration     auto: Literal[&quot;light&quot;, &quot;medium&quot;, &quot;heavy&quot;]</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="方法">方法<a href="#dspy.GEPA-functions" title="永久链接" class="">¶</a><a href="#方法" class="hash-link" aria-label="Direct link to 方法" title="Direct link to 方法" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="auto_budgetnum_preds-num_candidates-valset_size-int-minibatch_size-int--35-full_eval_steps-int--5---int-"><code>auto_budget(num_preds, num_candidates, valset_size: int, minibatch_size: int = 35, full_eval_steps: int = 5) -&gt; int</code> <a href="#dspy.GEPA.auto_budget" title="永久链接" class="">¶</a><a href="#auto_budgetnum_preds-num_candidates-valset_size-int-minibatch_size-int--35-full_eval_steps-int--5---int-" class="hash-link" aria-label="Direct link to auto_budgetnum_preds-num_candidates-valset_size-int-minibatch_size-int--35-full_eval_steps-int--5---int-" title="Direct link to auto_budgetnum_preds-num_candidates-valset_size-int-minibatch_size-int--35-full_eval_steps-int--5---int-" translate="no">​</a></h4>
<p>源代码位于 <code>dspy/teleprompt/gepa/gepa.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>520 521 522 523 524 525 526 527 528 529 530 531 532 533 534 535 536 537 538 539 540 541 542 543 544 545 546 547 548 549 550 551 552</code></td><td><code>def auto_budget(     self, num_preds, num_candidates, valset_size: int, minibatch_size: int = 35, full_eval_steps: int = 5 ) -&gt; int:     import numpy as np      num_trials = int(max(2 * (num_preds * 2) * np.log2(num_candidates), 1.5 * num_candidates))     if num_trials &lt; 0 or valset_size &lt; 0 or minibatch_size &lt; 0:         raise ValueError(&quot;num_trials, valset_size, and minibatch_size must be &gt;= 0.&quot;)     if full_eval_steps &lt; 1:         raise ValueError(&quot;full_eval_steps must be &gt;= 1.&quot;)      V = valset_size     N = num_trials     M = minibatch_size     m = full_eval_steps      # Initial full evaluation on the default program     total = V      # Assume upto 5 trials for bootstrapping each candidate     total += num_candidates * 5      # N minibatch evaluations     total += N * M     if N == 0:         return total  # no periodic/full evals inside the loop     # Periodic full evals occur when trial_num % (m+1) == 0, where trial_num runs 2..N+1     periodic_fulls = (N + 1) // (m) + 1     # If 1 &lt;= N &lt; m, the code triggers one final full eval at the end     extra_final = 1 if N &lt; m else 0      total += (periodic_fulls + extra_final) * V     return total </code></td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="compilestudent-module--trainset-listexample-teacher-module--none--none-valset-listexample--none--none---module-"><code>compile(student: Module, *, trainset: list[Example], teacher: Module | None = None, valset: list[Example] | None = None) -&gt; Module</code> <a href="#dspy.GEPA.compile" title="永久链接" class="">¶</a><a href="#compilestudent-module--trainset-listexample-teacher-module--none--none-valset-listexample--none--none---module-" class="hash-link" aria-label="Direct link to compilestudent-module--trainset-listexample-teacher-module--none--none-valset-listexample--none--none---module-" title="Direct link to compilestudent-module--trainset-listexample-teacher-module--none--none-valset-listexample--none--none---module-" translate="no">​</a></h4>
<p>GEPA 使用 trainset 来执行提示词的反射性更新，但使用 valset 来跟踪 Pareto 分数。
如果未提供 valset，GEPA 将对两者都使用 trainset。</p>
<p>参数:</p>
<ul>
<li class="">student: 要优化的学生模块。</li>
<li class="">trainset: 用于反射性更新的训练集。</li>
<li class="">valset: 用于跟踪 Pareto 分数的验证集。如果未提供，GEPA 将对两者都使用 trainset。</li>
</ul>
<p>源代码位于 <code>dspy/teleprompt/gepa/gepa.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>554 555 556 557 558 559 560 561 562 563 564 565 566 567 568 569 570 571 572 573 574 575 576 577 578 579 580 581 582 583 584 585 586 587 588 589 590 591 592 593 594 595 596 597 598 599 600 601 602 603 604 605 606 607 608 609 610 611 612 613 614 615 616 617 618 619 620 621 622 623 624 625 626 627 628 629 630 631 632 633 634 635 636 637 638 639 640 641 642 643 644 645 646 647 648 649 650 651 652 653 654 655 656 657 658 659 660 661 662 663 664 665 666 667 668 669 670 671 672 673 674 675 676 677 678 679 680 681 682 683 684 685 686 687 688</code></td><td>``` def compile(     self,     student: Module,     *,     trainset: list[Example],     teacher: Module</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="get_params---dictstr-any-"><code>get_params() -&gt; dict[str, Any]</code> <a href="#dspy.GEPA.get_params" title="永久链接" class="">¶</a><a href="#get_params---dictstr-any-" class="hash-link" aria-label="Direct link to get_params---dictstr-any-" title="Direct link to get_params---dictstr-any-" translate="no">​</a></h4>
<p>获取 Teleprompter 的参数。</p>
<p>返回:</p>
<table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><code>dict[str, Any]</code></td><td>Teleprompter 的参数。</td></tr></tbody></table>
<p>源代码位于 <code>dspy/teleprompt/teleprompt.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>25 26 27 28 29 30 31 32</code></td><td><code>def get_params(self) -&gt; dict[str, Any]:     &quot;&quot;&quot;     Get the parameters of the teleprompter.      Returns:         The parameters of the teleprompter.     &quot;&quot;&quot;     return self.__dict__ </code></td></tr></tbody></table>
<p>:::</p>
<p>GEPA 背后的一个关键见解是它能够利用特定领域的文本反馈。用户应提供一个反馈函数作为 GEPA 指标，其调用签名如下：</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="dspytelepromptgepagepagepafeedbackmetric-"><code>dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric</code> <a href="#dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric" title="永久链接" class="">¶</a><a href="#dspytelepromptgepagepagepafeedbackmetric-" class="hash-link" aria-label="Direct link to dspytelepromptgepagepagepafeedbackmetric-" title="Direct link to dspytelepromptgepagepagepafeedbackmetric-" translate="no">​</a></h2>
<p>基类: <code>Protocol</code></p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="方法-1">方法<a href="#dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric-functions" title="永久链接" class="">¶</a><a href="#方法-1" class="hash-link" aria-label="Direct link to 方法-1" title="Direct link to 方法-1" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="__call__gold-example-pred-prediction-trace-optionaldspytrace-pred_name-str--none-pred_trace-optionaldspytrace---unionfloat-scorewithfeedback-"><code>__call__(gold: Example, pred: Prediction, trace: Optional[DSPyTrace], pred_name: str | None, pred_trace: Optional[DSPyTrace]) -&gt; Union[float, ScoreWithFeedback]</code> <a href="#dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric.__call__" title="永久链接" class="">¶</a><a href="#__call__gold-example-pred-prediction-trace-optionaldspytrace-pred_name-str--none-pred_trace-optionaldspytrace---unionfloat-scorewithfeedback-" class="hash-link" aria-label="Direct link to __call__gold-example-pred-prediction-trace-optionaldspytrace-pred_name-str--none-pred_trace-optionaldspytrace---unionfloat-scorewithfeedback-" title="Direct link to __call__gold-example-pred-prediction-trace-optionaldspytrace-pred_name-str--none-pred_trace-optionaldspytrace---unionfloat-scorewithfeedback-" translate="no">​</a></h4>
<p>此函数使用以下参数调用：</p>
<ul>
<li class="">gold: 黄金示例。</li>
<li class="">pred: 预测输出。</li>
<li class="">trace: 可选。程序执行的轨迹。</li>
<li class="">pred_name: 可选。GEPA 当前正在优化的目标预测器的名称，正在为其请求反馈。</li>
<li class="">pred_trace: 可选。GEPA 正在寻求反馈的目标预测器的执行轨迹。</li>
</ul>
<p>注意 <code>pred_name</code> 和 <code>pred_trace</code> 参数。在优化过程中，GEPA 将调用指标以获取正在优化的单个预测器的反馈。
GEPA 在 <code>pred_name</code> 中提供预测器的名称，在 <code>pred_trace</code> 中提供对应于预测器的子轨迹（轨迹的一部分）。
如果在预测器级别可用，指标应返回对应于预测器的 dspy.Prediction(score: float, feedback: str)。
如果在预测器级别不可用，指标也可以在程序级别返回文本反馈（仅使用 gold, pred 和 trace）。
如果未返回反馈，GEPA 将使用仅包含分数的简单文本反馈：
<code>f&quot;This trajectory got a score of {score}.&quot;</code></p>
<p>源代码位于 <code>dspy/teleprompt/gepa/gepa.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63</code></td><td>``` def <strong>call</strong>(     self,     gold: Example,     pred: Prediction,     trace: Optional[&quot;DSPyTrace&quot;],     pred_name: str</td></tr></tbody></table>
<p>:::</p>
<p>当 <code>track_stats=True</code> 时，GEPA 返回有关所有提议候选者和优化运行元数据的详细结果。结果可在 GEPA 返回的优化后程序的 <code>detailed_results</code> 属性中获得，类型如下：</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="dspytelepromptgepagepadspygeparesultcandidates-listmodule-parents-listlistint--none-val_aggregate_scores-listfloat-val_subscores-listlistfloat-per_val_instance_best_candidates-listsetint-discovery_eval_counts-listint-best_outputs_valset-listlisttupleint-listprediction--none--none-total_metric_calls-int--none--none-num_full_val_evals-int--none--none-log_dir-str--none--none-seed-int--none--none-dataclass-"><code>dspy.teleprompt.gepa.gepa.DspyGEPAResult(candidates: list[Module], parents: list[list[int | None]], val_aggregate_scores: list[float], val_subscores: list[list[float]], per_val_instance_best_candidates: list[set[int]], discovery_eval_counts: list[int], best_outputs_valset: list[list[tuple[int, list[Prediction]]]] | None = None, total_metric_calls: int | None = None, num_full_val_evals: int | None = None, log_dir: str | None = None, seed: int | None = None)</code> <code>dataclass</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult" title="永久链接" class="">¶</a><a href="#dspytelepromptgepagepadspygeparesultcandidates-listmodule-parents-listlistint--none-val_aggregate_scores-listfloat-val_subscores-listlistfloat-per_val_instance_best_candidates-listsetint-discovery_eval_counts-listint-best_outputs_valset-listlisttupleint-listprediction--none--none-total_metric_calls-int--none--none-num_full_val_evals-int--none--none-log_dir-str--none--none-seed-int--none--none-dataclass-" class="hash-link" aria-label="Direct link to dspytelepromptgepagepadspygeparesultcandidates-listmodule-parents-listlistint--none-val_aggregate_scores-listfloat-val_subscores-listlistfloat-per_val_instance_best_candidates-listsetint-discovery_eval_counts-listint-best_outputs_valset-listlisttupleint-listprediction--none--none-total_metric_calls-int--none--none-num_full_val_evals-int--none--none-log_dir-str--none--none-seed-int--none--none-dataclass-" title="Direct link to dspytelepromptgepagepadspygeparesultcandidates-listmodule-parents-listlistint--none-val_aggregate_scores-listfloat-val_subscores-listlistfloat-per_val_instance_best_candidates-listsetint-discovery_eval_counts-listint-best_outputs_valset-listlisttupleint-listprediction--none--none-total_metric_calls-int--none--none-num_full_val_evals-int--none--none-log_dir-str--none--none-seed-int--none--none-dataclass-" translate="no">​</a></h2>
<p>与 GEPA 运行相关的其他数据。</p>
<p>字段:</p>
<ul>
<li class="">candidates: 提议的候选者列表 (component_name -&gt; component_text)</li>
<li class="">parents: 谱系信息；对于每个候选者 i，parents[i] 是父索引列表或 None</li>
<li class="">val_aggregate_scores: 每个候选者在验证集上的综合得分（越高越好）</li>
<li class="">val_subscores: 每个候选者在验证集上的每实例得分 (长度 == num_val_instances)</li>
<li class="">per_val_instance_best_candidates: 对于每个验证实例 t，在 t 上获得最佳分数的候选者索引集合</li>
<li class="">discovery_eval_counts: 在发现每个候选者之前消耗的预算（指标调用次数 / 轮次）</li>
</ul>
<ul>
<li class="">total_metric_calls: 整个运行过程中进行的指标调用总数</li>
<li class="">num_full_val_evals: 执行的完整验证评估次数</li>
<li class="">log_dir: 写入工件的位置（如果有）</li>
<li class="">seed: 用于可重复性的 RNG 种子（如果已知）</li>
<li class="">best_idx: 具有最高 val_aggregate_scores 的候选者索引</li>
<li class="">best_candidate: best_idx 的程序文本映射</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="属性">属性<a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult-attributes" title="永久链接" class="">¶</a><a href="#属性" class="hash-link" aria-label="Direct link to 属性" title="Direct link to 属性" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="candidates-listmodule-instance-attribute-"><code>candidates: list[Module]</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.candidates" title="永久链接" class="">¶</a><a href="#candidates-listmodule-instance-attribute-" class="hash-link" aria-label="Direct link to candidates-listmodule-instance-attribute-" title="Direct link to candidates-listmodule-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="parents-listlistint--none-instance-attribute-"><code>parents: list[list[int | None]]</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.parents" title="永久链接" class="">¶</a><a href="#parents-listlistint--none-instance-attribute-" class="hash-link" aria-label="Direct link to parents-listlistint--none-instance-attribute-" title="Direct link to parents-listlistint--none-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="val_aggregate_scores-listfloat-instance-attribute-"><code>val_aggregate_scores: list[float]</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.val_aggregate_scores" title="永久链接" class="">¶</a><a href="#val_aggregate_scores-listfloat-instance-attribute-" class="hash-link" aria-label="Direct link to val_aggregate_scores-listfloat-instance-attribute-" title="Direct link to val_aggregate_scores-listfloat-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="val_subscores-listlistfloat-instance-attribute-"><code>val_subscores: list[list[float]]</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.val_subscores" title="永久链接" class="">¶</a><a href="#val_subscores-listlistfloat-instance-attribute-" class="hash-link" aria-label="Direct link to val_subscores-listlistfloat-instance-attribute-" title="Direct link to val_subscores-listlistfloat-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="per_val_instance_best_candidates-listsetint-instance-attribute-"><code>per_val_instance_best_candidates: list[set[int]]</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.per_val_instance_best_candidates" title="永久链接" class="">¶</a><a href="#per_val_instance_best_candidates-listsetint-instance-attribute-" class="hash-link" aria-label="Direct link to per_val_instance_best_candidates-listsetint-instance-attribute-" title="Direct link to per_val_instance_best_candidates-listsetint-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="discovery_eval_counts-listint-instance-attribute-"><code>discovery_eval_counts: list[int]</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.discovery_eval_counts" title="永久链接" class="">¶</a><a href="#discovery_eval_counts-listint-instance-attribute-" class="hash-link" aria-label="Direct link to discovery_eval_counts-listint-instance-attribute-" title="Direct link to discovery_eval_counts-listint-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="best_outputs_valset-listlisttupleint-listprediction--none--none-class-attribute-instance-attribute-"><code>best_outputs_valset: list[list[tuple[int, list[Prediction]]]] | None = None</code> <code>class-attribute</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.best_outputs_valset" title="永久链接" class="">¶</a><a href="#best_outputs_valset-listlisttupleint-listprediction--none--none-class-attribute-instance-attribute-" class="hash-link" aria-label="Direct link to best_outputs_valset-listlisttupleint-listprediction--none--none-class-attribute-instance-attribute-" title="Direct link to best_outputs_valset-listlisttupleint-listprediction--none--none-class-attribute-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="total_metric_calls-int--none--none-class-attribute-instance-attribute-"><code>total_metric_calls: int | None = None</code> <code>class-attribute</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.total_metric_calls" title="永久链接" class="">¶</a><a href="#total_metric_calls-int--none--none-class-attribute-instance-attribute-" class="hash-link" aria-label="Direct link to total_metric_calls-int--none--none-class-attribute-instance-attribute-" title="Direct link to total_metric_calls-int--none--none-class-attribute-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="num_full_val_evals-int--none--none-class-attribute-instance-attribute-"><code>num_full_val_evals: int | None = None</code> <code>class-attribute</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.num_full_val_evals" title="永久链接" class="">¶</a><a href="#num_full_val_evals-int--none--none-class-attribute-instance-attribute-" class="hash-link" aria-label="Direct link to num_full_val_evals-int--none--none-class-attribute-instance-attribute-" title="Direct link to num_full_val_evals-int--none--none-class-attribute-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="log_dir-str--none--none-class-attribute-instance-attribute-"><code>log_dir: str | None = None</code> <code>class-attribute</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.log_dir" title="永久链接" class="">¶</a><a href="#log_dir-str--none--none-class-attribute-instance-attribute-" class="hash-link" aria-label="Direct link to log_dir-str--none--none-class-attribute-instance-attribute-" title="Direct link to log_dir-str--none--none-class-attribute-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="seed-int--none--none-class-attribute-instance-attribute-"><code>seed: int | None = None</code> <code>class-attribute</code> <code>instance-attribute</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.seed" title="永久链接" class="">¶</a><a href="#seed-int--none--none-class-attribute-instance-attribute-" class="hash-link" aria-label="Direct link to seed-int--none--none-class-attribute-instance-attribute-" title="Direct link to seed-int--none--none-class-attribute-instance-attribute-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="best_idx-int-property-"><code>best_idx: int</code> <code>property</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.best_idx" title="永久链接" class="">¶</a><a href="#best_idx-int-property-" class="hash-link" aria-label="Direct link to best_idx-int-property-" title="Direct link to best_idx-int-property-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="best_candidate-dictstr-str-property-"><code>best_candidate: dict[str, str]</code> <code>property</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.best_candidate" title="永久链接" class="">¶</a><a href="#best_candidate-dictstr-str-property-" class="hash-link" aria-label="Direct link to best_candidate-dictstr-str-property-" title="Direct link to best_candidate-dictstr-str-property-" translate="no">​</a></h4>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="highest_score_achieved_per_val_task-listfloat-property-"><code>highest_score_achieved_per_val_task: list[float]</code> <code>property</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.highest_score_achieved_per_val_task" title="永久链接" class="">¶</a><a href="#highest_score_achieved_per_val_task-listfloat-property-" class="hash-link" aria-label="Direct link to highest_score_achieved_per_val_task-listfloat-property-" title="Direct link to highest_score_achieved_per_val_task-listfloat-property-" translate="no">​</a></h4>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="方法-2">方法<a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult-functions" title="永久链接" class="">¶</a><a href="#方法-2" class="hash-link" aria-label="Direct link to 方法-2" title="Direct link to 方法-2" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="to_dict---dictstr-any-"><code>to_dict() -&gt; dict[str, Any]</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.to_dict" title="永久链接" class="">¶</a><a href="#to_dict---dictstr-any-" class="hash-link" aria-label="Direct link to to_dict---dictstr-any-" title="Direct link to to_dict---dictstr-any-" translate="no">​</a></h4>
<p>源代码位于 <code>dspy/teleprompt/gepa/gepa.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138</code></td><td><code>def to_dict(self) -&gt; dict[str, Any]:     cands = [{k: v for k, v in cand.items()} for cand in self.candidates]      return dict(         candidates=cands,         parents=self.parents,         val_aggregate_scores=self.val_aggregate_scores,         best_outputs_valset=self.best_outputs_valset,         val_subscores=self.val_subscores,         per_val_instance_best_candidates=[list(s) for s in self.per_val_instance_best_candidates],         discovery_eval_counts=self.discovery_eval_counts,         total_metric_calls=self.total_metric_calls,         num_full_val_evals=self.num_full_val_evals,         log_dir=self.log_dir,         seed=self.seed,         best_idx=self.best_idx,     ) </code></td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="from_gepa_resultgepa_result-geparesult-adapter-dspyadapter---dspygeparesult-staticmethod-"><code>from_gepa_result(gepa_result: GEPAResult, adapter: DspyAdapter) -&gt; DspyGEPAResult</code> <code>staticmethod</code> <a href="#dspy.teleprompt.gepa.gepa.DspyGEPAResult.from_gepa_result" title="永久链接" class="">¶</a><a href="#from_gepa_resultgepa_result-geparesult-adapter-dspyadapter---dspygeparesult-staticmethod-" class="hash-link" aria-label="Direct link to from_gepa_resultgepa_result-geparesult-adapter-dspyadapter---dspygeparesult-staticmethod-" title="Direct link to from_gepa_resultgepa_result-geparesult-adapter-dspyadapter---dspygeparesult-staticmethod-" translate="no">​</a></h4>
<p>源代码位于 <code>dspy/teleprompt/gepa/gepa.py</code></p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><code>140 141 142 143 144 145 146 147 148 149 150 151 152 153 154</code></td><td><code>@staticmethod def from_gepa_result(gepa_result: &quot;GEPAResult&quot;, adapter: &quot;DspyAdapter&quot;) -&gt; &quot;DspyGEPAResult&quot;:     return DspyGEPAResult(         candidates=[adapter.build_program(c) for c in gepa_result.candidates],         parents=gepa_result.parents,         val_aggregate_scores=gepa_result.val_aggregate_scores,         best_outputs_valset=gepa_result.best_outputs_valset,         val_subscores=gepa_result.val_subscores,         per_val_instance_best_candidates=gepa_result.per_val_instance_best_candidates,         discovery_eval_counts=gepa_result.discovery_eval_counts,         total_metric_calls=gepa_result.total_metric_calls,         num_full_val_evals=gepa_result.num_full_val_evals,         log_dir=gepa_result.run_dir,         seed=gepa_result.seed,     ) </code></td></tr></tbody></table>
<p>:::</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="使用示例">使用示例<a href="#usage-examples" title="永久链接" class="">¶</a><a href="#使用示例" class="hash-link" aria-label="Direct link to 使用示例" title="Direct link to 使用示例" translate="no">​</a></h2>
<p>查看 GEPA 教程了解使用方法。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="推理时搜索">推理时搜索<a href="#inference-time-search" title="永久链接" class="">¶</a><a href="#推理时搜索" class="hash-link" aria-label="Direct link to 推理时搜索" title="Direct link to 推理时搜索" translate="no">​</a></h3>
<p>GEPA 可以充当测试时/推理搜索机制。通过将 <code>valset</code> 设置为你的<em>评估批次</em>并使用 <code>track_best_outputs=True</code>，GEPA 为每个批次元素生成在进化搜索期间找到的得分最高的输出。</p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">gepa = dspy.GEPA(metric=metric, track_stats=True, ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new_prog = gepa.compile(student, trainset=my_tasks, valset=my_tasks)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">highest_score_achieved_per_task = new_prog.detailed_results.highest_score_achieved_per_val_task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">best_outputs = new_prog.detailed_results.best_outputs_valset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="gepa-如何工作">GEPA 如何工作？<a href="#how-does-gepa-work" title="永久链接" class="">¶</a><a href="#gepa-如何工作" class="hash-link" aria-label="Direct link to gepa-如何工作" title="Direct link to gepa-如何工作" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="1-反射性提示词变异">1. <strong>反射性提示词变异</strong><a href="#1-reflective-prompt-mutation" title="永久链接" class="">¶</a><a href="#1-反射性提示词变异" class="hash-link" aria-label="Direct link to 1-反射性提示词变异" title="Direct link to 1-反射性提示词变异" translate="no">​</a></h3>
<p>GEPA 使用 LLM <em>反思</em>结构化执行轨迹（输入、输出、失败、反馈），针对选定的模块，并使用反射元提示和收集到的反馈为目标模块提出新的指令/程序文本。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="2-丰富的文本反馈作为优化信号">2. <strong>丰富的文本反馈作为优化信号</strong><a href="#2-rich-textual-feedback-as-optimization-signal" title="永久链接" class="">¶</a><a href="#2-丰富的文本反馈作为优化信号" class="hash-link" aria-label="Direct link to 2-丰富的文本反馈作为优化信号" title="Direct link to 2-丰富的文本反馈作为优化信号" translate="no">​</a></h3>
<p>GEPA 可以利用<em>任何</em>可用的文本反馈——不仅仅是标量奖励。这包括评估日志、代码轨迹、失败的解析、约束违反、错误消息字符串，甚至隔离的子模块特定反馈。这允许可操作的、领域感知的优化。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="3-基于-pareto-的候选者选择">3. <strong>基于 Pareto 的候选者选择</strong><a href="#3-pareto-based-candidate-selection" title="永久链接" class="">¶</a><a href="#3-基于-pareto-的候选者选择" class="hash-link" aria-label="Direct link to 3-基于-pareto-的候选者选择" title="Direct link to 3-基于-pareto-的候选者选择" translate="no">​</a></h3>
<p>GEPA 不是仅仅进化<em>最佳</em>全局候选者（这会导致局部最优或停滞），而是维护一个 Pareto 前沿：在至少一个评估实例上获得最高分数的候选者集合。在每次迭代中，从该前沿采样（概率与覆盖率成正比）下一个要变异的候选者，保证探索和稳健地保留互补策略。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="算法摘要">算法摘要<a href="#algorithm-summary" title="永久链接" class="">¶</a><a href="#算法摘要" class="hash-link" aria-label="Direct link to 算法摘要" title="Direct link to 算法摘要" translate="no">​</a></h3>
<ol>
<li class=""><strong>初始化</strong> 候选池为未优化的程序。</li>
<li class=""><strong>迭代</strong>:</li>
<li class=""><strong>采样一个候选者</strong>（从 Pareto 前沿）。</li>
<li class=""><strong>采样一个小批次</strong>（从训练集中）。</li>
<li class=""><strong>收集执行轨迹 + 反馈</strong> 用于小批次上的模块轮次。</li>
<li class=""><strong>选择一个模块</strong> 进行有针对性的改进。</li>
<li class=""><strong>LLM 反射:</strong> 使用反射元提示和收集到的反馈为目标模块提出新的指令/提示词。</li>
<li class=""><strong>在小批次上推出新候选者</strong>；<strong>如果改进，则在 Pareto 验证集上进行评估</strong>。</li>
<li class=""><strong>更新候选池/Pareto 前沿。</strong></li>
<li class=""><strong>[可选] 系统感知合并/交叉</strong>: 组合来自不同谱系的表现最佳的模块。</li>
<li class=""><strong>继续</strong> 直到轮次或指标预算耗尽。</li>
<li class=""><strong>返回</strong> 在验证集上具有最佳综合性能的候选者。</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="实现反馈指标">实现反馈指标<a href="#implementing-feedback-metrics" title="永久链接" class="">¶</a><a href="#实现反馈指标" class="hash-link" aria-label="Direct link to 实现反馈指标" title="Direct link to 实现反馈指标" translate="no">​</a></h2>
<p>设计良好的指标是 GEPA 样本效率和学习信号丰富性的核心。GEPA 期望指标返回 <code>dspy.Prediction(score=..., feedback=...)</code>。GEPA 利用基于 LLM 的工作流中的自然语言轨迹进行优化，保留纯文本形式的中间轨迹和错误，而不是将其简化为数值奖励。这反映了人类诊断过程，能够更清晰地识别系统行为和瓶颈。</p>
<p>GEPA 友好反馈的实用秘诀：</p>
<ul>
<li class=""><strong>利用现有工件</strong>: 使用日志、单元测试、评估脚本和分析器输出；展示这些通常就足够了。</li>
<li class=""><strong>分解结果</strong>: 将分数分解为每个目标的组件（例如，正确性、延迟、成本、安全性）并将错误归因于步骤。</li>
<li class=""><strong>暴露轨迹</strong>: 标记管道阶段，报告通过/失败以及显著错误（例如，在代码生成管道中）。</li>
<li class=""><strong>基于检查</strong>: 对不可验证的任务（如在 PUPA 中）使用自动验证器（单元测试、模式、模拟器）或 LLM-as-a-judge。</li>
<li class=""><strong>优先考虑清晰度</strong>: 关注错误覆盖和决策点，而不是技术复杂性。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="示例">示例<a href="#examples" title="永久链接" class="">¶</a><a href="#示例" class="hash-link" aria-label="Direct link to 示例" title="Direct link to 示例" translate="no">​</a></h3>
<ul>
<li class=""><strong>文档检索</strong>（例如，HotpotQA）：列出正确检索、不正确或遗漏的文档，而不仅仅是 Recall/F1 分数。</li>
<li class=""><strong>多目标任务</strong>（例如，PUPA）：分解总分以揭示每个目标的贡献，突出权衡（例如，质量与隐私）。</li>
<li class=""><strong>堆叠管道</strong>（例如，代码生成：解析 → 编译 → 运行 → 分析 → 评估）：暴露特定阶段的失败；自然语言轨迹通常足以进行 LLM 自我修正。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="使用-gepa-进行工具优化">使用 GEPA 进行工具优化<a href="#tool-optimization-with-gepa" title="永久链接" class="">¶</a><a href="#使用-gepa-进行工具优化" class="hash-link" aria-label="Direct link to 使用-gepa-进行工具优化" title="Direct link to 使用-gepa-进行工具优化" translate="no">​</a></h2>
<p>当 <code>enable_tool_optimization=True</code> 时，GEPA 将 <code>dspy.ReAct</code> 模块与工具联合优化——GEPA 根据执行轨迹和反馈一起更新预测器指令和工具描述/参数描述，而不是保持工具行为固定。</p>
<p>有关详细信息、示例和底层设计（工具发现、命名要求以及与自定义指令提议者的交互），请参阅工具优化文档。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="自定义指令提议">自定义指令提议<a href="#custom-instruction-proposal" title="永久链接" class="">¶</a><a href="#自定义指令提议" class="hash-link" aria-label="Direct link to 自定义指令提议" title="Direct link to 自定义指令提议" translate="no">​</a></h2>
<p>有关 GEPA 指令提议机制的高级自定义，包括自定义指令提议者和组件选择器，请参阅高级功能文档。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="延伸阅读">延伸阅读<a href="#further-reading" title="永久链接" class="">¶</a><a href="#延伸阅读" class="hash-link" aria-label="Direct link to 延伸阅读" title="Direct link to 延伸阅读" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://arxiv.org/abs/2507.19457" target="_blank" rel="noopener noreferrer" class="">GEPA 论文: arxiv:2507.19457</a></li>
<li class=""><a href="https://github.com/gepa-ai/gepa" target="_blank" rel="noopener noreferrer" class="">GEPA Github</a> - 此存储库提供了 <code>dspy.GEPA</code> 优化器使用的核心 GEPA 进化管道。</li>
<li class="">DSPy 教程 - 查看相关教程了解更多</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_iDCr"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/提示词工程/DSPy/API/优化器/GEPA.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_c0mv" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mxtt"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/BootstrapFinetune"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">BootstrapFinetune</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes3/docs/AI/提示词工程/DSPy/API/优化器/各个优化器之间的区别及适用场景"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">各个优化器之间的区别及适用场景</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_r83r thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dspygepametric-gepafeedbackmetric--auto-literallight-medium-heavy--none--none-max_full_evals-int--none--none-max_metric_calls-int--none--none-reflection_minibatch_size-int--3-candidate_selection_strategy-literalpareto-current_best--pareto-reflection_lm-lm--none--none-skip_perfect_score-bool--true-add_format_failure_as_feedback-bool--false-instruction_proposer-proposalfn--none--none-component_selector-reflectioncomponentselector--str--round_robin-use_merge-bool--true-max_merge_invocations-int--none--5-num_threads-int--none--none-failure_score-float--00-perfect_score-float--10-log_dir-str--none--none-track_stats-bool--false-use_wandb-bool--false-wandb_api_key-str--none--none-wandb_init_kwargs-dictstr-any--none--none-track_best_outputs-bool--false-warn_on_score_mismatch-bool--true-enable_tool_optimization-bool--false-use_mlflow-bool--false-seed-int--none--0-gepa_kwargs-dict--none--none-" class="table-of-contents__link toc-highlight"><code>dspy.GEPA(metric: GEPAFeedbackMetric, *, auto: Literal[&#39;light&#39;, &#39;medium&#39;, &#39;heavy&#39;] | None = None, max_full_evals: int | None = None, max_metric_calls: int | None = None, reflection_minibatch_size: int = 3, candidate_selection_strategy: Literal[&#39;pareto&#39;, &#39;current_best&#39;] = &#39;pareto&#39;, reflection_lm: LM | None = None, skip_perfect_score: bool = True, add_format_failure_as_feedback: bool = False, instruction_proposer: ProposalFn | None = None, component_selector: ReflectionComponentSelector | str = &#39;round_robin&#39;, use_merge: bool = True, max_merge_invocations: int | None = 5, num_threads: int | None = None, failure_score: float = 0.0, perfect_score: float = 1.0, log_dir: str | None = None, track_stats: bool = False, use_wandb: bool = False, wandb_api_key: str | None = None, wandb_init_kwargs: dict[str, Any] | None = None, track_best_outputs: bool = False, warn_on_score_mismatch: bool = True, enable_tool_optimization: bool = False, use_mlflow: bool = False, seed: int | None = 0, gepa_kwargs: dict | None = None)</code> ¶</a><ul><li><a href="#方法" class="table-of-contents__link toc-highlight">方法¶</a></li></ul></li><li><a href="#dspytelepromptgepagepagepafeedbackmetric-" class="table-of-contents__link toc-highlight"><code>dspy.teleprompt.gepa.gepa.GEPAFeedbackMetric</code> ¶</a><ul><li><a href="#方法-1" class="table-of-contents__link toc-highlight">方法¶</a></li></ul></li><li><a href="#dspytelepromptgepagepadspygeparesultcandidates-listmodule-parents-listlistint--none-val_aggregate_scores-listfloat-val_subscores-listlistfloat-per_val_instance_best_candidates-listsetint-discovery_eval_counts-listint-best_outputs_valset-listlisttupleint-listprediction--none--none-total_metric_calls-int--none--none-num_full_val_evals-int--none--none-log_dir-str--none--none-seed-int--none--none-dataclass-" class="table-of-contents__link toc-highlight"><code>dspy.teleprompt.gepa.gepa.DspyGEPAResult(candidates: list[Module], parents: list[list[int | None]], val_aggregate_scores: list[float], val_subscores: list[list[float]], per_val_instance_best_candidates: list[set[int]], discovery_eval_counts: list[int], best_outputs_valset: list[list[tuple[int, list[Prediction]]]] | None = None, total_metric_calls: int | None = None, num_full_val_evals: int | None = None, log_dir: str | None = None, seed: int | None = None)</code> <code>dataclass</code> ¶</a><ul><li><a href="#属性" class="table-of-contents__link toc-highlight">属性¶</a></li><li><a href="#方法-2" class="table-of-contents__link toc-highlight">方法¶</a></li></ul></li><li><a href="#使用示例" class="table-of-contents__link toc-highlight">使用示例¶</a><ul><li><a href="#推理时搜索" class="table-of-contents__link toc-highlight">推理时搜索¶</a></li></ul></li><li><a href="#gepa-如何工作" class="table-of-contents__link toc-highlight">GEPA 如何工作？¶</a><ul><li><a href="#1-反射性提示词变异" class="table-of-contents__link toc-highlight">1. <strong>反射性提示词变异</strong>¶</a></li><li><a href="#2-丰富的文本反馈作为优化信号" class="table-of-contents__link toc-highlight">2. <strong>丰富的文本反馈作为优化信号</strong>¶</a></li><li><a href="#3-基于-pareto-的候选者选择" class="table-of-contents__link toc-highlight">3. <strong>基于 Pareto 的候选者选择</strong>¶</a></li><li><a href="#算法摘要" class="table-of-contents__link toc-highlight">算法摘要¶</a></li></ul></li><li><a href="#实现反馈指标" class="table-of-contents__link toc-highlight">实现反馈指标¶</a><ul><li><a href="#示例" class="table-of-contents__link toc-highlight">示例¶</a></li></ul></li><li><a href="#使用-gepa-进行工具优化" class="table-of-contents__link toc-highlight">使用 GEPA 进行工具优化¶</a></li><li><a href="#自定义指令提议" class="table-of-contents__link toc-highlight">自定义指令提议¶</a></li><li><a href="#延伸阅读" class="table-of-contents__link toc-highlight">延伸阅读¶</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes3/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>