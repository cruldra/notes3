<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-AI/vllm/vLLM实战部署指南" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">vLLM 实战部署指南 | Cruldra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/notes3/docs/AI/vllm/vLLM实战部署指南"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="vLLM 实战部署指南 | Cruldra"><meta data-rh="true" name="description" content="环境准备"><meta data-rh="true" property="og:description" content="环境准备"><link data-rh="true" rel="icon" href="/notes3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/notes3/docs/AI/vllm/vLLM实战部署指南"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/AI/vllm/vLLM实战部署指南" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/AI/vllm/vLLM实战部署指南" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"vLLM 学习资料","item":"https://your-docusaurus-site.example.com/notes3/docs/AI/vllm/"},{"@type":"ListItem","position":2,"name":"vLLM 实战部署指南","item":"https://your-docusaurus-site.example.com/notes3/docs/AI/vllm/vLLM实战部署指南"}]}</script><link rel="alternate" type="application/rss+xml" href="/notes3/blog/rss.xml" title="Cruldra RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes3/blog/atom.xml" title="Cruldra Atom Feed"><link rel="stylesheet" href="/notes3/assets/css/styles.da241bce.css">
<script src="/notes3/assets/js/runtime~main.983dbf1a.js" defer="defer"></script>
<script src="/notes3/assets/js/main.50610574.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme",window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme-choice","system"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/notes3/img/logo.svg"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_HuOE" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes3/"><div class="navbar__logo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E0TY themedComponent--light_oQTo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E0TY themedComponent--dark_xnBK"></div><b class="navbar__title text--truncate">Cruldra</b></a><a class="navbar__item navbar__link" href="/notes3/docs/category/设计模式">JVM</a><a class="navbar__item navbar__link" href="/notes3/docs/category/css">前端</a><a class="navbar__item navbar__link" href="/notes3/docs/category/astrbot">工具</a><a class="navbar__item navbar__link" href="/notes3/docs/category/ai电竞酒店">个人</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes3/docs/AI/Agno/介绍">AI</a><a class="navbar__item navbar__link" href="/notes3/docs/category/内置模块">Python</a><a class="navbar__item navbar__link" href="/notes3/docs/category/actix-web">Rust</a><a class="navbar__item navbar__link" href="/notes3/docs/category/数据库系统">软件工程</a><a class="navbar__item navbar__link" href="/notes3/docs/category/上古卷轴5">游戏</a><a class="navbar__item navbar__link" href="/notes3/docs/Go/Go语言常用语法">Go</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_lmNG"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ec9K"><div class="docsWrapper_T_Kj"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_U0vv" type="button"></button><div class="docRoot_n2jZ"><aside class="theme-doc-sidebar-container docSidebarContainer_BcoR"><div class="sidebarViewport_Cc21"><div class="sidebar_OHx_"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_n4En"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_smok menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/Agno/介绍"><span title="Agno" class="categoryLinkLabel_X2zX">Agno</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/DALLE成本计算"><span title="DALL-E 画图成本计算" class="linkLabel_j3lx">DALL-E 画图成本计算</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_smok menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/MCP/MCP-Python-SDK"><span title="MCP" class="categoryLinkLabel_X2zX">MCP</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/Transformer"><span title="Transformer" class="linkLabel_j3lx">Transformer</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_smok menu__link menu__link--sublist menu__link--active" href="/notes3/docs/AI/vllm/"><span title="vLLM 学习资料" class="categoryLinkLabel_X2zX">vLLM 学习资料</span></a><button aria-label="Collapse sidebar category &#x27;vLLM 学习资料&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/vllm/PagedAttention技术详解"><span title="PagedAttention 技术详解" class="linkLabel_j3lx">PagedAttention 技术详解</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/vllm/vLLM完整指南"><span title="vLLM 完整指南" class="linkLabel_j3lx">vLLM 完整指南</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes3/docs/AI/vllm/vLLM实战部署指南"><span title="vLLM 实战部署指南" class="linkLabel_j3lx">vLLM 实战部署指南</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/vllm/vLLM性能调优指南"><span title="vLLM 性能调优指南" class="linkLabel_j3lx">vLLM 性能调优指南</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/vllm/vllm-fast-inference-and-cuda-graph"><span title="vLLM 快速推理与 CUDA Graph 详解" class="linkLabel_j3lx">vLLM 快速推理与 CUDA Graph 详解</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes3/docs/AI/vllm/安装常见错误及解决方案"><span title="安装常见错误及解决方案" class="linkLabel_j3lx">安装常见错误及解决方案</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念1"><span title="一些概念1" class="linkLabel_j3lx">一些概念1</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念2"><span title="一些概念2" class="linkLabel_j3lx">一些概念2</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念3"><span title="一些概念3" class="linkLabel_j3lx">一些概念3</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念4"><span title="一些概念4" class="linkLabel_j3lx">一些概念4</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/一些概念5"><span title="一些概念5" class="linkLabel_j3lx">一些概念5</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/候选模型"><span title="候选模型" class="linkLabel_j3lx">候选模型</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/变分自编码器详解"><span title="变分自编码器（VAE）详解" class="linkLabel_j3lx">变分自编码器（VAE）详解</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/大模型核心概念通俗解释"><span title="大模型核心概念通俗解释" class="linkLabel_j3lx">大模型核心概念通俗解释</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/大模型训练中的随机种子：为什么需要它？"><span title="大模型训练中的随机种子：为什么需要它？" class="linkLabel_j3lx">大模型训练中的随机种子：为什么需要它？</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_smok menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/嵌入和向量/Chroma与PGVector对比"><span title="嵌入和向量" class="categoryLinkLabel_X2zX">嵌入和向量</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/感知机"><span title="感知机" class="linkLabel_j3lx">感知机</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/智能体"><span title="智能体(Agent)" class="linkLabel_j3lx">智能体(Agent)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_smok menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/深度学习/入门"><span title="深度学习" class="categoryLinkLabel_X2zX">深度学习</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/理解大模型：从函数视角看AI的本质"><span title="理解大模型：从函数视角看AI的本质" class="linkLabel_j3lx">理解大模型：从函数视角看AI的本质</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/知识蒸馏"><span title="知识蒸馏" class="linkLabel_j3lx">知识蒸馏</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/联邦学习概念"><span title="联邦学习概念" class="linkLabel_j3lx">联邦学习概念</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_smok menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/AI/通义千问/阿里云百炼"><span title="通义千问" class="categoryLinkLabel_X2zX">通义千问</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/AI/金丝雀发布和AB测试"><span title="金丝雀发布和AB测试" class="linkLabel_j3lx">金丝雀发布和AB测试</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_vrpX"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_WIWH"><div class="docItemContainer_zhTd"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_kL0w" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_y6sH"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/notes3/docs/AI/vllm/"><span>vLLM 学习资料</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">vLLM 实战部署指南</span></li></ul></nav><div class="tocCollapsible_sNig theme-doc-toc-mobile tocMobile_AD9K"><button type="button" class="clean-btn tocCollapsibleButton_dkdr">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>vLLM 实战部署指南</h1></header>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="环境准备">环境准备<a href="#环境准备" class="hash-link" aria-label="Direct link to 环境准备" title="Direct link to 环境准备" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="硬件要求">硬件要求<a href="#硬件要求" class="hash-link" aria-label="Direct link to 硬件要求" title="Direct link to 硬件要求" translate="no">​</a></h3>
<ul>
<li><strong>GPU</strong>：NVIDIA GPU with Compute Capability 7.0+ (V100, A100, H100, RTX 3090/4090 等)</li>
<li><strong>显存</strong>：根据模型大小确定<!-- -->
<ul>
<li>7B 模型：≥16GB</li>
<li>13B 模型：≥24GB</li>
<li>32B 模型：≥64GB</li>
<li>70B 模型：≥140GB (多卡)</li>
</ul>
</li>
<li><strong>内存</strong>：建议 ≥32GB</li>
<li><strong>存储</strong>：SSD，根据模型大小预留空间</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="软件要求">软件要求<a href="#软件要求" class="hash-link" aria-label="Direct link to 软件要求" title="Direct link to 软件要求" translate="no">​</a></h3>
<ul>
<li><strong>操作系统</strong>：Linux (Ubuntu 20.04/22.04 推荐)</li>
<li><strong>Python</strong>：3.8-3.11</li>
<li><strong>CUDA</strong>：11.8 或 12.1+</li>
<li><strong>Docker</strong>：20.10+ (可选)</li>
<li><strong>NVIDIA Driver</strong>：≥525.60.13</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="检查环境">检查环境<a href="#检查环境" class="hash-link" aria-label="Direct link to 检查环境" title="Direct link to 检查环境" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 GPU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvidia-smi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 CUDA 版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvcc --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 Python 版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 Docker 版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker --version</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="方式一使用-pip-安装">方式一：使用 pip 安装<a href="#方式一使用-pip-安装" class="hash-link" aria-label="Direct link to 方式一：使用 pip 安装" title="Direct link to 方式一：使用 pip 安装" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="1-创建虚拟环境">1. 创建虚拟环境<a href="#1-创建虚拟环境" class="hash-link" aria-label="Direct link to 1. 创建虚拟环境" title="Direct link to 1. 创建虚拟环境" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 conda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda create -n vllm python=3.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda activate vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或使用 venv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -m venv vllm-env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source vllm-env/bin/activate</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="2-安装-vllm">2. 安装 vLLM<a href="#2-安装-vllm" class="hash-link" aria-label="Direct link to 2. 安装 vLLM" title="Direct link to 2. 安装 vLLM" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装稳定版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或安装最新开发版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install git+https://github.com/vllm-project/vllm.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 验证安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -c &quot;import vllm; print(vllm.__version__)&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="3-下载模型">3. 下载模型<a href="#3-下载模型" class="hash-link" aria-label="Direct link to 3. 下载模型" title="Direct link to 3. 下载模型" translate="no">​</a></h3>
<p>使用 ModelScope 下载模型（国内推荐）：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 ModelScope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install modelscope</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -c &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from modelscope import snapshot_download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_dir = snapshot_download(&#x27;Qwen/Qwen2.5-7B-Instruct&#x27;, cache_dir=&#x27;/data/models&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print(f&#x27;Model downloaded to: {model_dir}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<p>或使用 HuggingFace：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 huggingface-cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install huggingface-hub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">huggingface-cli download Qwen/Qwen2.5-7B-Instruct --local-dir /data/models/Qwen2.5-7B-Instruct</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="4-启动服务">4. 启动服务<a href="#4-启动服务" class="hash-link" aria-label="Direct link to 4. 启动服务" title="Direct link to 4. 启动服务" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 启动 OpenAI 兼容服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --host 0.0.0.0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --port 8000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpu-memory-utilization 0.9 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max-model-len 4096 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --api-key your-secret-key</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="5-测试服务">5. 测试服务<a href="#5-测试服务" class="hash-link" aria-label="Direct link to 5. 测试服务" title="Direct link to 5. 测试服务" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 测试健康检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8000/health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试补全接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8000/v1/completions \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Authorization: Bearer your-secret-key&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;model&quot;: &quot;/data/models/Qwen2.5-7B-Instruct&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;prompt&quot;: &quot;你好，请介绍一下北京&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;max_tokens&quot;: 100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;temperature&quot;: 0.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="方式二使用-docker-部署">方式二：使用 Docker 部署<a href="#方式二使用-docker-部署" class="hash-link" aria-label="Direct link to 方式二：使用 Docker 部署" title="Direct link to 方式二：使用 Docker 部署" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="1-安装-docker-和-nvidia-container-toolkit">1. 安装 Docker 和 NVIDIA Container Toolkit<a href="#1-安装-docker-和-nvidia-container-toolkit" class="hash-link" aria-label="Direct link to 1. 安装 Docker 和 NVIDIA Container Toolkit" title="Direct link to 1. 安装 Docker 和 NVIDIA Container Toolkit" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 Docker（如果未安装）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://get.docker.com | bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 NVIDIA Container Toolkit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">distribution=$(. /etc/os-release;echo $ID$VERSION_ID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo tee /etc/apt/sources.list.d/nvidia-docker.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install -y nvidia-container-toolkit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置 Docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo nvidia-ctk runtime configure --runtime=docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试 GPU 访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --rm --gpus all nvidia/cuda:12.1.0-base-ubuntu22.04 nvidia-smi</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="2-拉取-vllm-镜像">2. 拉取 vLLM 镜像<a href="#2-拉取-vllm-镜像" class="hash-link" aria-label="Direct link to 2. 拉取 vLLM 镜像" title="Direct link to 2. 拉取 vLLM 镜像" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 拉取官方镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull vllm/vllm-openai:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker images | grep vllm</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="3-准备模型">3. 准备模型<a href="#3-准备模型" class="hash-link" aria-label="Direct link to 3. 准备模型" title="Direct link to 3. 准备模型" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建模型目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /data/models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载模型（使用 ModelScope）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run --rm -v /data/models:/models \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python:3.10 bash -c &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pip install modelscope &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python -c \&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from modelscope import snapshot_download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">snapshot_download(&#x27;Qwen/Qwen2.5-7B-Instruct&#x27;, cache_dir=&#x27;/models&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  \&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="4-启动容器">4. 启动容器<a href="#4-启动容器" class="hash-link" aria-label="Direct link to 4. 启动容器" title="Direct link to 4. 启动容器" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name vllm-service \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --restart=always \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpus all \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ipc=host \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v /data/models:/models \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 8000:8000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vllm/vllm-openai:latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --model /models/Qwen/Qwen2___5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --host 0.0.0.0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --port 8000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpu-memory-utilization 0.9 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max-model-len 4096 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --api-key your-secret-key</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="5-管理容器">5. 管理容器<a href="#5-管理容器" class="hash-link" aria-label="Direct link to 5. 管理容器" title="Direct link to 5. 管理容器" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker logs -f vllm-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看容器状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker ps | grep vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 停止容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker stop vllm-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker start vllm-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker restart vllm-service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 进入容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -it vllm-service bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rm -f vllm-service</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="方式三多卡部署">方式三：多卡部署<a href="#方式三多卡部署" class="hash-link" aria-label="Direct link to 方式三：多卡部署" title="Direct link to 方式三：多卡部署" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="1-张量并行tensor-parallelism">1. 张量并行（Tensor Parallelism）<a href="#1-张量并行tensor-parallelism" class="hash-link" aria-label="Direct link to 1. 张量并行（Tensor Parallelism）" title="Direct link to 1. 张量并行（Tensor Parallelism）" translate="no">​</a></h3>
<p>适用于单个模型太大，需要分布到多张 GPU 上：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 4 张 GPU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-70B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tensor-parallel-size 4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpu-memory-utilization 0.9</span><br></span></code></pre></div></div>
<p>Docker 方式：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --name vllm-multi-gpu \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --restart=always \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpus all \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --ipc=host \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v /data/models:/models \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 8000:8000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vllm/vllm-openai:latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --model /models/Qwen2.5-70B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tensor-parallel-size 4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpu-memory-utilization 0.9</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="2-流水线并行pipeline-parallelism">2. 流水线并行（Pipeline Parallelism）<a href="#2-流水线并行pipeline-parallelism" class="hash-link" aria-label="Direct link to 2. 流水线并行（Pipeline Parallelism）" title="Direct link to 2. 流水线并行（Pipeline Parallelism）" translate="no">​</a></h3>
<p>适用于超大模型：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/DeepSeek-R1-671B \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tensor-parallel-size 8 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --pipeline-parallel-size 4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="高级配置">高级配置<a href="#高级配置" class="hash-link" aria-label="Direct link to 高级配置" title="Direct link to 高级配置" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="1-性能优化参数">1. 性能优化参数<a href="#1-性能优化参数" class="hash-link" aria-label="Direct link to 1. 性能优化参数" title="Direct link to 1. 性能优化参数" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpu-memory-utilization 0.9 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max-model-len 8192 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max-num-batched-tokens 8192 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max-num-seqs 256 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-chunked-prefill \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --disable-log-requests</span><br></span></code></pre></div></div>
<p>参数说明：</p>
<ul>
<li><code>--max-num-batched-tokens</code>：批处理的最大 token 数</li>
<li><code>--max-num-seqs</code>：最大并发序列数</li>
<li><code>--enable-chunked-prefill</code>：启用分块预填充</li>
<li><code>--disable-log-requests</code>：禁用请求日志（提升性能）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="2-长文本支持">2. 长文本支持<a href="#2-长文本支持" class="hash-link" aria-label="Direct link to 2. 长文本支持" title="Direct link to 2. 长文本支持" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 YaRN 扩展上下文长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --max-model-len 32768 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --rope-scaling &#x27;{&quot;type&quot;: &quot;yarn&quot;, &quot;factor&quot;: 4.0}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="3-量化支持">3. 量化支持<a href="#3-量化支持" class="hash-link" aria-label="Direct link to 3. 量化支持" title="Direct link to 3. 量化支持" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 AWQ 量化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct-AWQ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --quantization awq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 GPTQ 量化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct-GPTQ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --quantization gptq</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="4-监控配置">4. 监控配置<a href="#4-监控配置" class="hash-link" aria-label="Direct link to 4. 监控配置" title="Direct link to 4. 监控配置" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 启用 Prometheus 监控</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --disable-log-stats \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-metrics</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="使用示例">使用示例<a href="#使用示例" class="hash-link" aria-label="Direct link to 使用示例" title="Direct link to 使用示例" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="python-客户端">Python 客户端<a href="#python-客户端" class="hash-link" aria-label="Direct link to Python 客户端" title="Direct link to Python 客户端" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-python codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> openai </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> OpenAI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 初始化客户端</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OpenAI</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    base_url</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;http://localhost:8000/v1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api_key</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;your-secret-key&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 聊天补全</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/data/models/Qwen2.5-7B-Instruct&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    messages</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;你是一个有帮助的助手。&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;介绍一下北京的著名景点&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temperature</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_tokens</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 流式输出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">chat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">completions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;/data/models/Qwen2.5-7B-Instruct&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    messages</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;role&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;content&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;写一首关于春天的诗&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">choices</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="curl-示例">curl 示例<a href="#curl-示例" class="hash-link" aria-label="Direct link to curl 示例" title="Direct link to curl 示例" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 聊天补全</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8000/v1/chat/completions \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Authorization: Bearer your-secret-key&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;model&quot;: &quot;/data/models/Qwen2.5-7B-Instruct&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;messages&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;你是一个有帮助的助手。&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;介绍一下北京的著名景点&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;temperature&quot;: 0.7,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;max_tokens&quot;: 500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 流式输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://localhost:8000/v1/chat/completions \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &quot;Authorization: Bearer your-secret-key&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;model&quot;: &quot;/data/models/Qwen2.5-7B-Instruct&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;messages&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;写一首关于春天的诗&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;stream&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="生产环境部署建议">生产环境部署建议<a href="#生产环境部署建议" class="hash-link" aria-label="Direct link to 生产环境部署建议" title="Direct link to 生产环境部署建议" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="1-使用-systemd-管理服务">1. 使用 systemd 管理服务<a href="#1-使用-systemd-管理服务" class="hash-link" aria-label="Direct link to 1. 使用 systemd 管理服务" title="Direct link to 1. 使用 systemd 管理服务" translate="no">​</a></h3>
<p>创建 <code>/etc/systemd/system/vllm.service</code>：</p>
<div class="language-ini codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-ini codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=vLLM Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=network.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User=vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WorkingDirectory=/opt/vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/opt/vllm/venv/bin/vllm serve /data/models/Qwen2.5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --host 0.0.0.0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --port 8000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --dtype bfloat16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --gpu-memory-utilization 0.9 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --api-key your-secret-key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RestartSec=10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span></code></pre></div></div>
<p>启动服务：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start vllm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status vllm</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="2-使用-nginx-反向代理">2. 使用 Nginx 反向代理<a href="#2-使用-nginx-反向代理" class="hash-link" aria-label="Direct link to 2. 使用 Nginx 反向代理" title="Direct link to 2. 使用 Nginx 反向代理" translate="no">​</a></h3>
<div class="language-nginx codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-nginx codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain">upstream vllm_backend {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server localhost:8000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name your-domain.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://vllm_backend;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 流式输出支持</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_buffering off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_cache off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="3-监控和日志">3. 监控和日志<a href="#3-监控和日志" class="hash-link" aria-label="Direct link to 3. 监控和日志" title="Direct link to 3. 监控和日志" translate="no">​</a></h3>
<p>使用 Prometheus + Grafana 监控：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 启动 vLLM 并启用监控</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-metrics \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --metrics-port 9090</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="常见问题排查">常见问题排查<a href="#常见问题排查" class="hash-link" aria-label="Direct link to 常见问题排查" title="Direct link to 常见问题排查" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="1-cuda-out-of-memory">1. CUDA Out of Memory<a href="#1-cuda-out-of-memory" class="hash-link" aria-label="Direct link to 1. CUDA Out of Memory" title="Direct link to 1. CUDA Out of Memory" translate="no">​</a></h3>
<p><strong>解决方案</strong>：</p>
<ul>
<li>降低 <code>--gpu-memory-utilization</code>（如 0.8）</li>
<li>减小 <code>--max-model-len</code></li>
<li>减小 <code>--max-num-seqs</code></li>
<li>使用量化模型</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="2-推理速度慢">2. 推理速度慢<a href="#2-推理速度慢" class="hash-link" aria-label="Direct link to 2. 推理速度慢" title="Direct link to 2. 推理速度慢" translate="no">​</a></h3>
<p><strong>解决方案</strong>：</p>
<ul>
<li>增加 <code>--gpu-memory-utilization</code></li>
<li>启用 <code>--enable-chunked-prefill</code></li>
<li>调整 <code>--max-num-batched-tokens</code></li>
<li>使用多卡并行</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_qHQm" id="3-服务启动失败">3. 服务启动失败<a href="#3-服务启动失败" class="hash-link" aria-label="Direct link to 3. 服务启动失败" title="Direct link to 3. 服务启动失败" translate="no">​</a></h3>
<p><strong>检查步骤</strong>：</p>
<div class="language-bash codeBlockContainer_El0U theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_AwBu"><pre tabindex="0" class="prism-code language-bash codeBlock_D9uD thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_hMzE"><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 GPU 可用性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvidia-smi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 CUDA 版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvcc --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查 vLLM 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -c &quot;import vllm; print(vllm.__version__)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看详细日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vllm serve /data/models/Qwen2.5-7B-Instruct --log-level debug</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_qHQm" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结" translate="no">​</a></h2>
<p>本指南涵盖了 vLLM 的三种主要部署方式：</p>
<ol>
<li><strong>pip 安装</strong>：适合开发和测试</li>
<li><strong>Docker 部署</strong>：适合生产环境，易于管理</li>
<li><strong>多卡部署</strong>：适合大模型和高性能需求</li>
</ol>
<p>选择合适的部署方式，根据实际需求调整参数，即可快速搭建高性能的大语言模型推理服务。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/vllm/vLLM实战部署指南.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_HnUL" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_DcQK"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes3/docs/AI/vllm/vLLM完整指南"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">vLLM 完整指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes3/docs/AI/vllm/vLLM性能调优指南"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">vLLM 性能调优指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_AvJD thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#环境准备" class="table-of-contents__link toc-highlight">环境准备</a><ul><li><a href="#硬件要求" class="table-of-contents__link toc-highlight">硬件要求</a></li><li><a href="#软件要求" class="table-of-contents__link toc-highlight">软件要求</a></li><li><a href="#检查环境" class="table-of-contents__link toc-highlight">检查环境</a></li></ul></li><li><a href="#方式一使用-pip-安装" class="table-of-contents__link toc-highlight">方式一：使用 pip 安装</a><ul><li><a href="#1-创建虚拟环境" class="table-of-contents__link toc-highlight">1. 创建虚拟环境</a></li><li><a href="#2-安装-vllm" class="table-of-contents__link toc-highlight">2. 安装 vLLM</a></li><li><a href="#3-下载模型" class="table-of-contents__link toc-highlight">3. 下载模型</a></li><li><a href="#4-启动服务" class="table-of-contents__link toc-highlight">4. 启动服务</a></li><li><a href="#5-测试服务" class="table-of-contents__link toc-highlight">5. 测试服务</a></li></ul></li><li><a href="#方式二使用-docker-部署" class="table-of-contents__link toc-highlight">方式二：使用 Docker 部署</a><ul><li><a href="#1-安装-docker-和-nvidia-container-toolkit" class="table-of-contents__link toc-highlight">1. 安装 Docker 和 NVIDIA Container Toolkit</a></li><li><a href="#2-拉取-vllm-镜像" class="table-of-contents__link toc-highlight">2. 拉取 vLLM 镜像</a></li><li><a href="#3-准备模型" class="table-of-contents__link toc-highlight">3. 准备模型</a></li><li><a href="#4-启动容器" class="table-of-contents__link toc-highlight">4. 启动容器</a></li><li><a href="#5-管理容器" class="table-of-contents__link toc-highlight">5. 管理容器</a></li></ul></li><li><a href="#方式三多卡部署" class="table-of-contents__link toc-highlight">方式三：多卡部署</a><ul><li><a href="#1-张量并行tensor-parallelism" class="table-of-contents__link toc-highlight">1. 张量并行（Tensor Parallelism）</a></li><li><a href="#2-流水线并行pipeline-parallelism" class="table-of-contents__link toc-highlight">2. 流水线并行（Pipeline Parallelism）</a></li></ul></li><li><a href="#高级配置" class="table-of-contents__link toc-highlight">高级配置</a><ul><li><a href="#1-性能优化参数" class="table-of-contents__link toc-highlight">1. 性能优化参数</a></li><li><a href="#2-长文本支持" class="table-of-contents__link toc-highlight">2. 长文本支持</a></li><li><a href="#3-量化支持" class="table-of-contents__link toc-highlight">3. 量化支持</a></li><li><a href="#4-监控配置" class="table-of-contents__link toc-highlight">4. 监控配置</a></li></ul></li><li><a href="#使用示例" class="table-of-contents__link toc-highlight">使用示例</a><ul><li><a href="#python-客户端" class="table-of-contents__link toc-highlight">Python 客户端</a></li><li><a href="#curl-示例" class="table-of-contents__link toc-highlight">curl 示例</a></li></ul></li><li><a href="#生产环境部署建议" class="table-of-contents__link toc-highlight">生产环境部署建议</a><ul><li><a href="#1-使用-systemd-管理服务" class="table-of-contents__link toc-highlight">1. 使用 systemd 管理服务</a></li><li><a href="#2-使用-nginx-反向代理" class="table-of-contents__link toc-highlight">2. 使用 Nginx 反向代理</a></li><li><a href="#3-监控和日志" class="table-of-contents__link toc-highlight">3. 监控和日志</a></li></ul></li><li><a href="#常见问题排查" class="table-of-contents__link toc-highlight">常见问题排查</a><ul><li><a href="#1-cuda-out-of-memory" class="table-of-contents__link toc-highlight">1. CUDA Out of Memory</a></li><li><a href="#2-推理速度慢" class="table-of-contents__link toc-highlight">2. 推理速度慢</a></li><li><a href="#3-服务启动失败" class="table-of-contents__link toc-highlight">3. 服务启动失败</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_YFPC"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_YFPC"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_YFPC"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes3/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_YFPC"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>