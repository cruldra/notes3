è¿™æ˜¯ CrewAI å®˜æ–¹æ–‡æ¡£ä¸­å…³äºâ€œKnowledgeï¼ˆçŸ¥è¯†ï¼‰â€éƒ¨åˆ†çš„ä¸­æ–‡ç¿»è¯‘ã€‚

---

# æ ¸å¿ƒæ¦‚å¿µ - çŸ¥è¯† (Knowledge)

CrewAI ä¸­çš„çŸ¥è¯†æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚

## æ¦‚è§ˆ (Overview)

CrewAI ä¸­çš„çŸ¥è¯†æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç³»ç»Ÿï¼Œå…è®¸ AI ä»£ç†ï¼ˆAgentsï¼‰åœ¨ä»–æ‰§è¡Œä»»åŠ¡æœŸé—´è®¿é—®å’Œåˆ©ç”¨å¤–éƒ¨ä¿¡æ¯æºã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆç»™ä½ çš„ä»£ç†æä¾›äº†ä¸€ä¸ªå‚è€ƒå›¾ä¹¦é¦†ï¼Œä¾›å…¶åœ¨å·¥ä½œæ—¶æŸ¥é˜…ã€‚

ä½¿ç”¨çŸ¥è¯†ç³»ç»Ÿçš„ä¸»è¦å¥½å¤„ï¼š

*   ä½¿ç”¨ç‰¹å®šé¢†åŸŸçš„ä¿¡æ¯å¢å¼ºä»£ç†çš„èƒ½åŠ›ã€‚
*   ç”¨çœŸå®ä¸–ç•Œçš„æ•°æ®æ”¯æŒå†³ç­–ã€‚
*   åœ¨æ•´ä¸ªå¯¹è¯è¿‡ç¨‹ä¸­ä¿æŒä¸Šä¸‹æ–‡ã€‚
*   ä½¿å›å¤åŸºäºäº‹å®ä¿¡æ¯ã€‚

## å¿«é€Ÿå…¥é—¨ç¤ºä¾‹ (Quickstart Examples)

å¯¹äºåŸºäºæ–‡ä»¶çš„çŸ¥è¯†æºï¼Œè¯·ç¡®ä¿å°†æ–‡ä»¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `knowledge` ç›®å½•ä¸­ã€‚æ­¤å¤–ï¼Œåœ¨åˆ›å»ºæºæ—¶ï¼Œè¯·ä½¿ç”¨ç›¸å¯¹äº `knowledge` ç›®å½•çš„è·¯å¾„ã€‚

### å‘é‡å­˜å‚¨ (RAG) å®¢æˆ·ç«¯é…ç½®

CrewAI ä¸ºå‘é‡å­˜å‚¨æä¾›äº†ä¸€ä¸ªä¸æä¾›å•†æ— å…³çš„ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰å®¢æˆ·ç«¯æŠ½è±¡ã€‚é»˜è®¤æä¾›å•†æ˜¯ ChromaDBï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ Qdrantã€‚ä½ å¯ä»¥ä½¿ç”¨é…ç½®å·¥å…·åˆ‡æ¢æä¾›å•†ã€‚ç›®å‰æ”¯æŒï¼š

*   ChromaDB (é»˜è®¤)
*   Qdrant

```python
from crewai.rag.config.utils import set_rag_config, get_rag_client, clear_rag_config

# ChromaDB (é»˜è®¤)
from crewai.rag.chromadb.config import ChromaDBConfig
set_rag_config(ChromaDBConfig())
chromadb_client = get_rag_client()

# Qdrant
from crewai.rag.qdrant.config import QdrantConfig
set_rag_config(QdrantConfig())
qdrant_client = get_rag_client()

# æ“ä½œç¤ºä¾‹ (å¯¹äºä»»ä½•æä¾›å•† API éƒ½æ˜¯ç›¸åŒçš„)
client = qdrant_client  # æˆ–è€… chromadb_client
client.create_collection(collection_name="docs")
client.add_documents(
    collection_name="docs",
    documents=[{"id": "1", "content": "CrewAI enables collaborative AI agents."}],
)
results = client.search(collection_name="docs", query="collaborative agents", limit=3)

clear_rag_config()  # å¯é€‰çš„é‡ç½®æ“ä½œ
```

è¿™ä¸ª RAG å®¢æˆ·ç«¯ä¸ Knowledge å†…ç½®çš„å­˜å‚¨æ˜¯åˆ†å¼€çš„ã€‚å½“ä½ éœ€è¦ç›´æ¥æ§åˆ¶å‘é‡å­˜å‚¨æˆ–è‡ªå®šä¹‰æ£€ç´¢ç®¡é“æ—¶ï¼Œè¯·ä½¿ç”¨å®ƒã€‚

### åŸºç¡€å­—ç¬¦ä¸²çŸ¥è¯†ç¤ºä¾‹

```python
from crewai import Agent, Task, Crew, Process, LLM
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

# åˆ›å»ºä¸€ä¸ªçŸ¥è¯†æº
content = "Users name is John. He is 30 years old and lives in San Francisco."
string_source = StringKnowledgeSource(content=content)

# åˆ›å»ºä¸€ä¸ª temperature ä¸º 0 çš„ LLM ä»¥ç¡®ä¿ç¡®å®šæ€§è¾“å‡º
llm = LLM(model="gpt-4o-mini", temperature=0)

# åˆ›å»ºä¸€ä¸ªå¸¦æœ‰çŸ¥è¯†åº“çš„ä»£ç†
agent = Agent(
    role="About User",
    goal="You know everything about the user.",
    backstory="You are a master at understanding people and their preferences.",
    verbose=True,
    allow_delegation=False,
    llm=llm,
)

task = Task(
    description="Answer the following questions about the user: {question}",
    expected_output="An answer to the question.",
    agent=agent,
)

crew = Crew(
    agents=[agent],
    tasks=[task],
    verbose=True,
    process=Process.sequential,
    knowledge_sources=[string_source], # åœ¨æ­¤å¤„æ·»åŠ æºä»¥å¯ç”¨çŸ¥è¯†
)

result = crew.kickoff(inputs={"question": "What city does John live in and how old is he?"})
```

### Web å†…å®¹çŸ¥è¯†ç¤ºä¾‹

ä½ éœ€è¦å®‰è£… `docling` æ‰èƒ½è¿è¡Œä»¥ä¸‹ç¤ºä¾‹ï¼š`uv add docling`

```python
from crewai import LLM, Agent, Crew, Process, Task
from crewai.knowledge.source.crew_docling_source import CrewDoclingSource

# ä»ç½‘é¡µå†…å®¹åˆ›å»ºçŸ¥è¯†æº
content_source = CrewDoclingSource(
    file_paths=[
        "https://lilianweng.github.io/posts/2024-11-28-reward-hacking",
        "https://lilianweng.github.io/posts/2024-07-07-hallucination",
    ],
)

# åˆ›å»ºä¸€ä¸ª temperature ä¸º 0 çš„ LLM ä»¥ç¡®ä¿ç¡®å®šæ€§è¾“å‡º
llm = LLM(model="gpt-4o-mini", temperature=0)

# åˆ›å»ºä¸€ä¸ªå¸¦æœ‰çŸ¥è¯†åº“çš„ä»£ç†
agent = Agent(
    role="About papers",
    goal="You know everything about the papers.",
    backstory="You are a master at understanding papers and their content.",
    verbose=True,
    allow_delegation=False,
    llm=llm,
)

task = Task(
    description="Answer the following questions about the papers: {question}",
    expected_output="An answer to the question.",
    agent=agent,
)

crew = Crew(
    agents=[agent],
    tasks=[task],
    verbose=True,
    process=Process.sequential,
    knowledge_sources=[content_source],
)

result = crew.kickoff(
    inputs={"question": "What is the reward hacking paper about? Be sure to provide sources."}
)
```

## æ”¯æŒçš„çŸ¥è¯†æº (Supported Knowledge Sources)

CrewAI å¼€ç®±å³ç”¨åœ°æ”¯æŒå¤šç§ç±»å‹çš„çŸ¥è¯†æºï¼š

**æ–‡æœ¬æº (Text Sources)**

*   åŸå§‹å­—ç¬¦ä¸² (Raw strings)
*   æ–‡æœ¬æ–‡ä»¶ (.txt)
*   PDF æ–‡æ¡£

**ç»“æ„åŒ–æ•°æ® (Structured Data)**

*   CSV æ–‡ä»¶
*   Excel ç”µå­è¡¨æ ¼
*   JSON æ–‡æ¡£

### æ–‡æœ¬æ–‡ä»¶çŸ¥è¯†æº

```python
from crewai.knowledge.source.text_file_knowledge_source import TextFileKnowledgeSource

text_source = TextFileKnowledgeSource(
    file_paths=["document.txt", "another.txt"]
)
```

### PDF çŸ¥è¯†æº

```python
from crewai.knowledge.source.pdf_knowledge_source import PDFKnowledgeSource

pdf_source = PDFKnowledgeSource(
    file_paths=["document.pdf", "another.pdf"]
)
```

### CSV çŸ¥è¯†æº

```python
from crewai.knowledge.source.csv_knowledge_source import CSVKnowledgeSource

csv_source = CSVKnowledgeSource(
    file_paths=["data.csv"]
)
```

### Excel çŸ¥è¯†æº

```python
from crewai.knowledge.source.excel_knowledge_source import ExcelKnowledgeSource

excel_source = ExcelKnowledgeSource(
    file_paths=["spreadsheet.xlsx"]
)
```

### JSON çŸ¥è¯†æº

```python
from crewai.knowledge.source.json_knowledge_source import JSONKnowledgeSource

json_source = JSONKnowledgeSource(
    file_paths=["data.json"]
)
```

è¯·ç¡®ä¿ä½ å·²åˆ›å»º `./knowledge` æ–‡ä»¶å¤¹ã€‚æ‰€æœ‰æºæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼š.txt, .pdf, .xlsx, .jsonï¼‰éƒ½åº”æ”¾åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ä»¥ä¾¿é›†ä¸­ç®¡ç†ã€‚

## ä»£ç† vs Crew çŸ¥è¯†ï¼šå®Œæ•´æŒ‡å— (Agent vs Crew Knowledge: Complete Guide)

**ç†è§£çŸ¥è¯†å±‚çº§**ï¼šCrewAI æ”¯æŒä»£ç†ï¼ˆAgentï¼‰çº§åˆ«å’Œå›¢é˜Ÿï¼ˆCrewï¼‰çº§åˆ«çš„çŸ¥è¯†ã€‚æœ¬èŠ‚é˜è¿°äº†å®ƒä»¬å„è‡ªçš„å·¥ä½œæ–¹å¼ã€åˆå§‹åŒ–çš„æ—¶é—´ï¼Œå¹¶è§£å†³äº†æœ‰å…³ä¾èµ–å…³ç³»çš„å¸¸è§è¯¯è§£ã€‚

### çŸ¥è¯†åˆå§‹åŒ–å®é™…æ˜¯å¦‚ä½•å·¥ä½œçš„

å½“ä½ ä½¿ç”¨çŸ¥è¯†æ—¶ï¼Œå®é™…å‘ç”Ÿäº†ä»¥ä¸‹æƒ…å†µï¼š

#### ä»£ç†çº§çŸ¥è¯† (ç‹¬ç«‹)

```python
from crewai import Agent, Task, Crew
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

# å…·æœ‰è‡ªå·±çŸ¥è¯†çš„ä»£ç† - ä¸éœ€è¦ Crew çŸ¥è¯†
specialist_knowledge = StringKnowledgeSource(
    content="Specialized technical information for this agent only"
)

specialist_agent = Agent(
    role="Technical Specialist",
    goal="Provide technical expertise",
    backstory="Expert in specialized technical domains",
    knowledge_sources=[specialist_knowledge]  # ä»£ç†ç‰¹å®šçš„çŸ¥è¯†
)

task = Task(
    description="Answer technical questions",
    agent=specialist_agent,
    expected_output="Technical answer"
)

# ä¸éœ€è¦ crew çº§åˆ«çš„çŸ¥è¯†
crew = Crew(
    agents=[specialist_agent],
    tasks=[task]
)

result = crew.kickoff()  # ä»£ç†çŸ¥è¯†ç‹¬ç«‹å·¥ä½œ
```

#### åœ¨ `crew.kickoff()` æœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆ

å½“ä½ è°ƒç”¨ `crew.kickoff()` æ—¶ï¼Œç¡®åˆ‡çš„é¡ºåºå¦‚ä¸‹ï¼š

```python
# During kickoff
for agent in self.agents:
    agent.crew = self  # ä»£ç†è·å¾— crew çš„å¼•ç”¨
    agent.set_knowledge(crew_embedder=self.embedder)  # ä»£ç†çŸ¥è¯†è¢«åˆå§‹åŒ–
    agent.create_agent_executor()
```

#### å­˜å‚¨çš„ç‹¬ç«‹æ€§

æ¯ä¸ªçŸ¥è¯†å±‚çº§ä½¿ç”¨ç‹¬ç«‹çš„å­˜å‚¨é›†åˆï¼š

```python
# ä»£ç†çŸ¥è¯†å­˜å‚¨
agent_collection_name = agent.role  # ä¾‹å¦‚ï¼š"Technical Specialist"

# Crew çŸ¥è¯†å­˜å‚¨  
crew_collection_name = "crew"

# ä¸¤è€…éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ª ChromaDB å®ä¾‹ä¸­ï¼Œä½†åœ¨ä¸åŒçš„é›†åˆé‡Œ
# è·¯å¾„: ~/.local/share/CrewAI/{project}/knowledge/
#   â”œâ”€â”€ crew/                    # Crew çŸ¥è¯†é›†åˆ
#   â”œâ”€â”€ Technical Specialist/    # ä»£ç†çŸ¥è¯†é›†åˆ
#   â””â”€â”€ Another Agent Role/      # å¦ä¸€ä¸ªä»£ç†çš„é›†åˆ
```

### å®Œæ•´çš„å·¥ä½œç¤ºä¾‹

#### ç¤ºä¾‹ 1ï¼šä»…ä»£ç†çŸ¥è¯†

```python
from crewai import Agent, Task, Crew
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

# ä»£ç†ç‰¹å®šçš„çŸ¥è¯†
agent_knowledge = StringKnowledgeSource(
    content="Agent-specific information that only this agent needs"
)

agent = Agent(
    role="Specialist",
    goal="Use specialized knowledge",
    backstory="Expert with specific knowledge",
    knowledge_sources=[agent_knowledge],
    embedder={  # ä»£ç†å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ embedderï¼ˆåµŒå…¥å™¨ï¼‰
        "provider": "openai",
        "config": {"model": "text-embedding-3-small"}
    }
)

task = Task(
    description="Answer using your specialized knowledge",
    agent=agent,
    expected_output="Answer based on agent knowledge"
)

# ä¸éœ€è¦ crew çŸ¥è¯†
crew = Crew(agents=[agent], tasks=[task])
result = crew.kickoff()  # å®Œç¾è¿è¡Œ
```

#### ç¤ºä¾‹ 2ï¼šä»£ç†å’Œ Crew çŸ¥è¯†å¹¶å­˜

```python
# Crew èŒƒå›´çš„çŸ¥è¯† (æ‰€æœ‰ä»£ç†å…±äº«)
crew_knowledge = StringKnowledgeSource(
    content="Company policies and general information for all agents"
)

# ä»£ç†ç‰¹å®šçš„çŸ¥è¯†
specialist_knowledge = StringKnowledgeSource(
    content="Technical specifications only the specialist needs"
)

specialist = Agent(
    role="Technical Specialist",
    goal="Provide technical expertise",
    backstory="Technical expert",
    knowledge_sources=[specialist_knowledge]  # ä»£ç†ç‰¹å®š
)

generalist = Agent(
    role="General Assistant", 
    goal="Provide general assistance",
    backstory="General helper"
    # æ²¡æœ‰ä»£ç†ç‰¹å®šçš„çŸ¥è¯†
)

crew = Crew(
    agents=[specialist, generalist],
    tasks=[...],
    knowledge_sources=[crew_knowledge]  # Crew èŒƒå›´çš„çŸ¥è¯†
)

# ç»“æœ:
# - specialist è·å¾—: crew_knowledge + specialist_knowledge
# - generalist è·å¾—: ä»… crew_knowledge
```

#### ç¤ºä¾‹ 3ï¼šå¤šä¸ªä»£ç†æ‹¥æœ‰ä¸åŒçš„çŸ¥è¯†

```python
# é’ˆå¯¹ä¸åŒä»£ç†çš„ä¸åŒçŸ¥è¯†
sales_knowledge = StringKnowledgeSource(content="Sales procedures and pricing")
tech_knowledge = StringKnowledgeSource(content="Technical documentation")
support_knowledge = StringKnowledgeSource(content="Support procedures")

sales_agent = Agent(
    role="Sales Representative",
    knowledge_sources=[sales_knowledge],
    embedder={"provider": "openai", "config": {"model": "text-embedding-3-small"}}
)

tech_agent = Agent(
    role="Technical Expert", 
    knowledge_sources=[tech_knowledge],
    embedder={"provider": "ollama", "config": {"model": "mxbai-embed-large"}}
)

support_agent = Agent(
    role="Support Specialist",
    knowledge_sources=[support_knowledge]
    # å°†ä½¿ç”¨ crew embedder ä½œä¸ºåå¤‡
)

crew = Crew(
    agents=[sales_agent, tech_agent, support_agent],
    tasks=[...],
    embedder={  # ä¸ºæ²¡æœ‰è‡ªå·± embedder çš„ä»£ç†æä¾›åå¤‡ embedder
        "provider": "google-generativeai",
        "config": {"model_name": "gemini-embedding-001"}
    }
)

# æ¯ä¸ªä»£ç†åªè·å¾—ä»–ä»¬ç‰¹å®šçš„çŸ¥è¯†
# æ¯ä¸ªäººå¯ä»¥ä½¿ç”¨ä¸åŒçš„åµŒå…¥æä¾›å•†
```

ä¸ä½¿ç”¨å·¥å…·ä»å‘é‡æ•°æ®åº“ä¸­æ£€ç´¢ä¸åŒï¼Œé¢„åŠ è½½çŸ¥è¯†çš„ä»£ç†ä¸éœ€è¦æ£€ç´¢è§’è‰²ï¼ˆpersonaï¼‰æˆ–ä»»åŠ¡ã€‚åªéœ€ä¸ºæ‚¨éœ€è¦è¿è¡Œçš„ä»£ç†æˆ– Crew æ·»åŠ ç›¸å…³çš„çŸ¥è¯†æºå³å¯ã€‚çŸ¥è¯†æºå¯ä»¥åœ¨ä»£ç†çº§åˆ«æˆ– Crew çº§åˆ«æ·»åŠ ã€‚Crew çº§åˆ«çš„çŸ¥è¯†æºå°†è¢« Crew ä¸­çš„**æ‰€æœ‰ä»£ç†**ä½¿ç”¨ã€‚ä»£ç†çº§åˆ«çš„çŸ¥è¯†æºå°†ä»…ç”±é¢„åŠ è½½äº†è¯¥çŸ¥è¯†çš„**ç‰¹å®šä»£ç†**ä½¿ç”¨ã€‚

## çŸ¥è¯†é…ç½® (Knowledge Configuration)

ä½ å¯ä»¥é…ç½® Crew æˆ– Agent çš„çŸ¥è¯†è®¾ç½®ã€‚

```python
from crewai.knowledge.knowledge_config import KnowledgeConfig

knowledge_config = KnowledgeConfig(results_limit=10, score_threshold=0.5)

agent = Agent(
    ...
    knowledge_config=knowledge_config
)
```

`results_limit`ï¼šè¿”å›çš„ç›¸å…³æ–‡æ¡£æ•°é‡ã€‚é»˜è®¤ä¸º 3ã€‚
`score_threshold`ï¼šæ–‡æ¡£è¢«è§†ä¸ºç›¸å…³æ‰€éœ€çš„æœ€ä½åˆ†æ•°ã€‚é»˜è®¤ä¸º 0.35ã€‚

## æ”¯æŒçš„çŸ¥è¯†å‚æ•° (Supported Knowledge Parameters)

| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
| :--- | :--- | :--- | :--- |
| `sources` | `List[BaseKnowledgeSource]` | æ˜¯ | æä¾›è¦å­˜å‚¨å’ŒæŸ¥è¯¢çš„å†…å®¹çš„çŸ¥è¯†æºåˆ—è¡¨ã€‚å¯ä»¥åŒ…æ‹¬ PDFã€CSVã€Excelã€JSONã€æ–‡æœ¬æ–‡ä»¶æˆ–å­—ç¬¦ä¸²å†…å®¹ã€‚ |
| `collection_name` | `str` | å¦ | å­˜å‚¨çŸ¥è¯†çš„é›†åˆåç§°ã€‚ç”¨äºè¯†åˆ«ä¸åŒçš„çŸ¥è¯†é›†ã€‚å¦‚æœæœªæä¾›ï¼Œé»˜è®¤ä¸º "knowledge"ã€‚ |
| `storage` | `Optional[KnowledgeStorage]` | å¦ | ç”¨äºç®¡ç†çŸ¥è¯†å­˜å‚¨å’Œæ£€ç´¢æ–¹å¼çš„è‡ªå®šä¹‰å­˜å‚¨é…ç½®ã€‚å¦‚æœæœªæä¾›ï¼Œå°†åˆ›å»ºé»˜è®¤å­˜å‚¨ã€‚ |

## çŸ¥è¯†å­˜å‚¨é€æ˜åº¦ (Knowledge Storage Transparency)

**äº†è§£çŸ¥è¯†å­˜å‚¨**ï¼šCrewAI è‡ªåŠ¨å°†çŸ¥è¯†æºå­˜å‚¨åœ¨ç‰¹å®šå¹³å°çš„ç›®å½•ä¸­ï¼Œä½¿ç”¨ ChromaDB è¿›è¡Œå‘é‡å­˜å‚¨ã€‚äº†è§£è¿™äº›ä½ç½®å’Œé»˜è®¤è®¾ç½®æœ‰åŠ©äºç”Ÿäº§éƒ¨ç½²ã€è°ƒè¯•å’Œå­˜å‚¨ç®¡ç†ã€‚

### CrewAI åœ¨å“ªé‡Œå­˜å‚¨çŸ¥è¯†æ–‡ä»¶

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCrewAI ä½¿ç”¨ä¸ Memory ç›¸åŒçš„å­˜å‚¨ç³»ç»Ÿï¼Œå°†çŸ¥è¯†å­˜å‚¨åœ¨ç‰¹å®šå¹³å°çš„ç›®å½•ä¸­ï¼š

#### ä¸åŒå¹³å°çš„é»˜è®¤å­˜å‚¨ä½ç½®

**macOS:**

```
~/Library/Application Support/CrewAI/{project_name}/
â””â”€â”€ knowledge/                    # Knowledge ChromaDB æ–‡ä»¶
    â”œâ”€â”€ chroma.sqlite3           # ChromaDB å…ƒæ•°æ®
    â”œâ”€â”€ {collection_id}/         # å‘é‡åµŒå…¥
    â””â”€â”€ knowledge_{collection}/  # å‘½åçš„é›†åˆ
```

**Linux:**

```
~/.local/share/CrewAI/{project_name}/
â””â”€â”€ knowledge/
    â”œâ”€â”€ chroma.sqlite3
    â”œâ”€â”€ {collection_id}/
    â””â”€â”€ knowledge_{collection}/
```

**Windows:**

```
C:\Users\{username}\AppData\Local\CrewAI\{project_name}\
â””â”€â”€ knowledge\
    â”œâ”€â”€ chroma.sqlite3
    â”œâ”€â”€ {collection_id}\
    â””â”€â”€ knowledge_{collection}\
```

### æŸ¥æ‰¾ä½ çš„çŸ¥è¯†å­˜å‚¨ä½ç½®

è¦ç¡®åˆ‡æŸ¥çœ‹ CrewAI å­˜å‚¨çŸ¥è¯†æ–‡ä»¶çš„ä½ç½®ï¼š

```python
from crewai.utilities.paths import db_storage_path
import os

# è·å–çŸ¥è¯†å­˜å‚¨è·¯å¾„
knowledge_path = os.path.join(db_storage_path(), "knowledge")
print(f"Knowledge storage location: {knowledge_path}")

# åˆ—å‡ºçŸ¥è¯†é›†åˆå’Œæ–‡ä»¶
if os.path.exists(knowledge_path):
    print("\nKnowledge storage contents:")
    for item in os.listdir(knowledge_path):
        item_path = os.path.join(knowledge_path, item)
        if os.path.isdir(item_path):
            print(f"ğŸ“ Collection: {item}/")
            # æ˜¾ç¤ºé›†åˆå†…å®¹
            try:
                for subitem in os.listdir(item_path):
                    print(f"   â””â”€â”€ {subitem}")
            except PermissionError:
                print(f"   â””â”€â”€ (permission denied)")
        else:
            print(f"ğŸ“„ {item}")
else:
    print("No knowledge storage found yet.")
```

### æ§åˆ¶çŸ¥è¯†å­˜å‚¨ä½ç½®

#### é€‰é¡¹ 1ï¼šç¯å¢ƒå˜é‡ (æ¨è)

```python
import os
from crewai import Crew

# è®¾ç½®æ‰€æœ‰ CrewAI æ•°æ®çš„è‡ªå®šä¹‰å­˜å‚¨ä½ç½®
os.environ["CREWAI_STORAGE_DIR"] = "./my_project_storage"

# æ‰€æœ‰çŸ¥è¯†ç°åœ¨å°†å­˜å‚¨åœ¨ ./my_project_storage/knowledge/
crew = Crew(
    agents=[...],
    tasks=[...],
    knowledge_sources=[...]
)
```

#### é€‰é¡¹ 2ï¼šè‡ªå®šä¹‰çŸ¥è¯†å­˜å‚¨ (Custom Knowledge Storage)

```python
from crewai.knowledge.storage.knowledge_storage import KnowledgeStorage
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

# ä½¿ç”¨ç‰¹å®šçš„ embedder åˆ›å»ºè‡ªå®šä¹‰å­˜å‚¨
custom_storage = KnowledgeStorage(
    embedder={
        "provider": "ollama",
        "config": {"model": "mxbai-embed-large"}
    },
    collection_name="my_custom_knowledge"
)

# ä¸çŸ¥è¯†æºä¸€èµ·ä½¿ç”¨
knowledge_source = StringKnowledgeSource(
    content="Your knowledge content here"
)
knowledge_source.storage = custom_storage
```

#### é€‰é¡¹ 3ï¼šç‰¹å®šäºé¡¹ç›®çš„çŸ¥è¯†å­˜å‚¨

```python
import os
from pathlib import Path

# å°†çŸ¥è¯†å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•ä¸­
project_root = Path(__file__).parent
knowledge_dir = project_root / "knowledge_storage"

os.environ["CREWAI_STORAGE_DIR"] = str(knowledge_dir)

# ç°åœ¨æ‰€æœ‰çŸ¥è¯†å°†å­˜å‚¨åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­
```

### é»˜è®¤åµŒå…¥æä¾›å•†è¡Œä¸º (Default Embedding Provider Behavior)

**é»˜è®¤åµŒå…¥æä¾›å•†**ï¼šCrewAI é»˜è®¤ä½¿ç”¨ OpenAI Embeddings (`text-embedding-3-small`) è¿›è¡ŒçŸ¥è¯†å­˜å‚¨ï¼Œå³ä½¿ç”¨æˆ·ä½¿ç”¨çš„æ˜¯ä¸åŒçš„ LLM æä¾›å•†ã€‚ä½ å¯ä»¥è½»æ¾è‡ªå®šä¹‰ä»¥åŒ¹é…ä½ çš„è®¾ç½®ã€‚

#### äº†è§£é»˜è®¤è¡Œä¸º

```python
from crewai import Agent, Crew, LLM
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

# å½“ä½¿ç”¨ Claude ä½œä¸ºä½ çš„ LLM æ—¶...
agent = Agent(
    role="Researcher",
    goal="Research topics",
    backstory="Expert researcher",
    llm=LLM(provider="anthropic", model="claude-3-sonnet")  # ä½¿ç”¨ Claude
)

# CrewAI é»˜è®¤ä»å°†ä½¿ç”¨ OpenAI embeddings å­˜å‚¨çŸ¥è¯†
# è¿™ç¡®ä¿äº†ä¸€è‡´æ€§ï¼Œä½†å¯èƒ½ä¸ç¬¦åˆä½ çš„ LLM æä¾›å•†åå¥½
knowledge_source = StringKnowledgeSource(content="Research data...")

crew = Crew(
    agents=[agent],
    tasks=[...],
    knowledge_sources=[knowledge_source]
    # é»˜è®¤: å³ä½¿ä½¿ç”¨ Claude LLMï¼Œä¹Ÿä¼šä½¿ç”¨ OpenAI embeddings
)
```

#### è‡ªå®šä¹‰çŸ¥è¯†åµŒå…¥æä¾›å•†

```python
# é€‰é¡¹ 1: ä½¿ç”¨ Voyage AI (Anthropic æ¨èç»™ Claude ç”¨æˆ·)
crew = Crew(
    agents=[agent],
    tasks=[...],
    knowledge_sources=[knowledge_source],
    embedder={
        "provider": "voyageai",  # æ¨èç»™ Claude ç”¨æˆ·
        "config": {
            "api_key": "your-voyage-api-key",
            "model": "voyage-3"  # æˆ– "voyage-3-large" ä»¥è·å¾—æœ€ä½³è´¨é‡
        }
    }
)

# é€‰é¡¹ 2: ä½¿ç”¨æœ¬åœ° embeddings (æ— å¤–éƒ¨ API è°ƒç”¨)
crew = Crew(
    agents=[agent],
    tasks=[...],
    knowledge_sources=[knowledge_source],
    embedder={
        "provider": "ollama",
        "config": {
            "model": "mxbai-embed-large",
            "url": "http://localhost:11434/api/embeddings"
        }
    }
)

# é€‰é¡¹ 3: ä»£ç†çº§ embedding è‡ªå®šä¹‰
agent = Agent(
    role="Researcher",
    goal="Research topics",
    backstory="Expert researcher",
    knowledge_sources=[knowledge_source],
    embedder={
        "provider": "google-generativeai",
        "config": {
            "model_name": "gemini-embedding-001",
            "api_key": "your-google-key"
        }
    }
)
```

#### é…ç½® Azure OpenAI Embeddings

å½“ä½¿ç”¨ Azure OpenAI embeddings æ—¶ï¼š

1.  ç¡®ä¿é¦–å…ˆåœ¨ Azure å¹³å°ä¸­éƒ¨ç½²äº† embedding æ¨¡å‹ã€‚
2.  ç„¶åä½ éœ€è¦ä½¿ç”¨ä»¥ä¸‹é…ç½®ï¼š

```python
agent = Agent(
    role="Researcher",
    goal="Research topics",
    backstory="Expert researcher",
    knowledge_sources=[knowledge_source],
    embedder={
        "provider": "azure",
        "config": {
            "api_key": "your-azure-api-key",
            "model": "text-embedding-ada-002", # æ›´æ”¹ä¸ºä½ æ­£åœ¨ä½¿ç”¨ä¸”å·²åœ¨ Azure ä¸­éƒ¨ç½²çš„æ¨¡å‹
            "api_base": "https://your-azure-endpoint.openai.azure.com/",
            "api_version": "2024-02-01"
        }
    }
)
```

## é«˜çº§åŠŸèƒ½ (Advanced Features)

### æŸ¥è¯¢é‡å†™ (Query Rewriting)

CrewAI å®ç°äº†ä¸€ç§æ™ºèƒ½æŸ¥è¯¢é‡å†™æœºåˆ¶æ¥ä¼˜åŒ–çŸ¥è¯†æ£€ç´¢ã€‚å½“ä»£ç†éœ€è¦æœç´¢çŸ¥è¯†æºæ—¶ï¼ŒåŸå§‹ä»»åŠ¡æç¤ºï¼ˆpromptï¼‰ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæ›´æœ‰æ•ˆçš„æœç´¢æŸ¥è¯¢ã€‚

#### æŸ¥è¯¢é‡å†™æ˜¯å¦‚ä½•å·¥ä½œçš„

1.  å½“ä»£ç†æ‰§è¡Œå¸¦æœ‰å¯ç”¨çŸ¥è¯†æºçš„ä»»åŠ¡æ—¶ï¼Œä¼šè§¦å‘ `_get_knowledge_search_query` æ–¹æ³•ã€‚
2.  ä½¿ç”¨ä»£ç†çš„ LLM å°†åŸå§‹ä»»åŠ¡æç¤ºè½¬æ¢ä¸ºä¼˜åŒ–çš„æœç´¢æŸ¥è¯¢ã€‚
3.  ç„¶åä½¿ç”¨æ­¤ä¼˜åŒ–çš„æŸ¥è¯¢ä»çŸ¥è¯†æºä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ã€‚

#### æŸ¥è¯¢é‡å†™çš„å¥½å¤„

**æé«˜æ£€ç´¢å‡†ç¡®æ€§**
é€šè¿‡å…³æ³¨å…³é”®æ¦‚å¿µå¹¶ç§»é™¤æ— å…³å†…å®¹ï¼ŒæŸ¥è¯¢é‡å†™æœ‰åŠ©äºæ£€ç´¢æ›´ç›¸å…³çš„ä¿¡æ¯ã€‚

**ä¸Šä¸‹æ–‡æ„ŸçŸ¥**
é‡å†™çš„æŸ¥è¯¢æ—¨åœ¨é’ˆå¯¹å‘é‡æ•°æ®åº“æ£€ç´¢æ›´åŠ å…·ä½“ä¸”å…·æœ‰ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›ã€‚

#### ç¤ºä¾‹

```python
# åŸå§‹ä»»åŠ¡æç¤º
task_prompt = "Answer the following questions about the user's favorite movies: What movie did John watch last week? Format your answer in JSON."

# åœ¨å¹•åï¼Œè¿™å¯èƒ½ä¼šè¢«é‡å†™ä¸ºï¼š
rewritten_query = "What movies did John watch last week?"
```

é‡å†™çš„æŸ¥è¯¢æ›´å…³æ³¨æ ¸å¿ƒä¿¡æ¯éœ€æ±‚ï¼Œå¹¶ç§»é™¤äº†å…³äºè¾“å‡ºæ ¼å¼çš„æ— å…³æŒ‡ä»¤ã€‚

è¯¥æœºåˆ¶å®Œå…¨è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€ç”¨æˆ·é…ç½®ã€‚ä»£ç†çš„ LLM ç”¨äºæ‰§è¡ŒæŸ¥è¯¢é‡å†™ï¼Œå› æ­¤ä½¿ç”¨èƒ½åŠ›æ›´å¼ºçš„ LLM å¯ä»¥æé«˜é‡å†™æŸ¥è¯¢çš„è´¨é‡ã€‚

### çŸ¥è¯†äº‹ä»¶ (Knowledge Events)

CrewAI åœ¨çŸ¥è¯†æ£€ç´¢è¿‡ç¨‹ä¸­å‘å‡ºäº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿç›‘å¬è¿™äº›äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶å…è®¸ä½ ç›‘æ§ã€è°ƒè¯•å’Œåˆ†æä½ çš„ä»£ç†å¦‚ä½•æ£€ç´¢å’Œä½¿ç”¨çŸ¥è¯†ã€‚

#### å¯ç”¨çš„çŸ¥è¯†äº‹ä»¶

*   **KnowledgeRetrievalStartedEvent**: å½“ä»£ç†å¼€å§‹ä»æºæ£€ç´¢çŸ¥è¯†æ—¶å‘å‡ºã€‚
*   **KnowledgeRetrievalCompletedEvent**: å½“çŸ¥è¯†æ£€ç´¢å®Œæˆæ—¶å‘å‡ºï¼ŒåŒ…å«æ‰€ä½¿ç”¨çš„æŸ¥è¯¢å’Œæ£€ç´¢åˆ°çš„å†…å®¹ã€‚
*   **KnowledgeQueryStartedEvent**: å½“å¯¹çŸ¥è¯†æºçš„æŸ¥è¯¢å¼€å§‹æ—¶å‘å‡ºã€‚
*   **KnowledgeQueryCompletedEvent**: å½“æŸ¥è¯¢æˆåŠŸå®Œæˆæ—¶å‘å‡ºã€‚
*   **KnowledgeQueryFailedEvent**: å½“å¯¹çŸ¥è¯†æºçš„æŸ¥è¯¢å¤±è´¥æ—¶å‘å‡ºã€‚
*   **KnowledgeSearchQueryFailedEvent**: å½“æœç´¢æŸ¥è¯¢å¤±è´¥æ—¶å‘å‡ºã€‚

#### ç¤ºä¾‹ï¼šç›‘æ§çŸ¥è¯†æ£€ç´¢

```python
from crewai.events import (
    KnowledgeRetrievalStartedEvent,
    KnowledgeRetrievalCompletedEvent,
    BaseEventListener,
)

class KnowledgeMonitorListener(BaseEventListener):
    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(KnowledgeRetrievalStartedEvent)
        def on_knowledge_retrieval_started(source, event):
            print(f"Agent '{event.agent.role}' started retrieving knowledge")
            
        @crewai_event_bus.on(KnowledgeRetrievalCompletedEvent)
        def on_knowledge_retrieval_completed(source, event):
            print(f"Agent '{event.agent.role}' completed knowledge retrieval")
            print(f"Query: {event.query}")
            print(f"Retrieved {len(event.retrieved_knowledge)} knowledge chunks")

# åˆ›å»ºç›‘å¬å™¨å®ä¾‹
knowledge_monitor = KnowledgeMonitorListener()
```

æœ‰å…³ä½¿ç”¨äº‹ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [Event Listeners (äº‹ä»¶ç›‘å¬å™¨)](/en/concepts/event-listener) æ–‡æ¡£ã€‚

### è‡ªå®šä¹‰çŸ¥è¯†æº (Custom Knowledge Sources)

CrewAI å…è®¸ä½ é€šè¿‡æ‰©å±• `BaseKnowledgeSource` ç±»ä¸ºä»»ä½•ç±»å‹çš„æ•°æ®åˆ›å»ºè‡ªå®šä¹‰çŸ¥è¯†æºã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè·å–å¹¶å¤„ç†å¤ªç©ºæ–°é—»æ–‡ç« çš„å®é™…ç¤ºä¾‹ã€‚

#### å¤ªç©ºæ–°é—»çŸ¥è¯†æºç¤ºä¾‹

```python
from crewai import Agent, Task, Crew, Process, LLM
from crewai.knowledge.source.base_knowledge_source import BaseKnowledgeSource
import requests
from datetime import datetime
from typing import Dict, Any
from pydantic import BaseModel, Field

class SpaceNewsKnowledgeSource(BaseKnowledgeSource):
    """ä» Space News API è·å–æ•°æ®çš„çŸ¥è¯†æºã€‚"""

    api_endpoint: str = Field(description="API endpoint URL")
    limit: int = Field(default=10, description="Number of articles to fetch")

    def load_content(self) -> Dict[Any, str]:
        """è·å–å¹¶æ ¼å¼åŒ–å¤ªç©ºæ–°é—»æ–‡ç« ã€‚"""
        try:
            response = requests.get(
                f"{self.api_endpoint}?limit={self.limit}"
            )
            response.raise_for_status()

            data = response.json()
            articles = data.get('results', [])

            formatted_data = self.validate_content(articles)
            return {self.api_endpoint: formatted_data}
        except Exception as e:
            raise ValueError(f"Failed to fetch space news: {str(e)}")

    def validate_content(self, articles: list) -> str:
        """å°†æ–‡ç« æ ¼å¼åŒ–ä¸ºå¯è¯»æ–‡æœ¬ã€‚"""
        formatted = "Space News Articles:\n\n"
        for article in articles:
            formatted += f"""
                Title: {article['title']}
                Published: {article['published_at']}
                Summary: {article['summary']}
                News Site: {article['news_site']}
                URL: {article['url']}
                -------------------"""
        return formatted

    def add(self) -> None:
        """å¤„ç†å¹¶å­˜å‚¨æ–‡ç« ã€‚"""
        content = self.load_content()
        for _, text in content.items():
            chunks = self._chunk_text(text)
            self.chunks.extend(chunks)

        self._save_documents()

# åˆ›å»ºçŸ¥è¯†æº
recent_news = SpaceNewsKnowledgeSource(
    api_endpoint="https://api.spaceflightnewsapi.net/v4/articles",
    limit=10,
)

# åˆ›å»ºä¸“é—¨çš„ä»£ç†
space_analyst = Agent(
    role="Space News Analyst",
    goal="Answer questions about space news accurately and comprehensively",
    backstory="""You are a space industry analyst with expertise in space exploration,
    satellite technology, and space industry trends. You excel at answering questions
    about space news and providing detailed, accurate information.""",
    knowledge_sources=[recent_news],
    llm=LLM(model="gpt-4", temperature=0.0)
)

# åˆ›å»ºå¤„ç†ç”¨æˆ·é—®é¢˜çš„ä»»åŠ¡
analysis_task = Task(
    description="Answer this question about space news: {user_question}",
    expected_output="A detailed answer based on the recent space news articles",
    agent=space_analyst
)

# åˆ›å»ºå¹¶è¿è¡Œ crew
crew = Crew(
    agents=[space_analyst],
    tasks=[analysis_task],
    verbose=True,
    process=Process.sequential
)

# ä½¿ç”¨ç¤ºä¾‹
result = crew.kickoff(
    inputs={"user_question": "What are the latest developments in space exploration?"}
)
```

## è°ƒè¯•å’Œæ•…éšœæ’é™¤ (Debugging and Troubleshooting)

### è°ƒè¯•çŸ¥è¯†é—®é¢˜

#### æ£€æŸ¥ä»£ç†çŸ¥è¯†åˆå§‹åŒ–

```python
from crewai import Agent, Crew, Task
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

knowledge_source = StringKnowledgeSource(content="Test knowledge")

agent = Agent(
    role="Test Agent",
    goal="Test knowledge",
    backstory="Testing",
    knowledge_sources=[knowledge_source]
)

crew = Crew(agents=[agent], tasks=[Task(...)])

# Kickoff å‰ - çŸ¥è¯†æœªåˆå§‹åŒ–
print(f"Before kickoff - Agent knowledge: {getattr(agent, 'knowledge', None)}")

crew.kickoff()

# Kickoff å - çŸ¥è¯†å·²åˆå§‹åŒ–
print(f"After kickoff - Agent knowledge: {agent.knowledge}")
print(f"Agent knowledge collection: {agent.knowledge.storage.collection_name}")
print(f"Number of sources: {len(agent.knowledge.sources)}")
```

#### éªŒè¯çŸ¥è¯†å­˜å‚¨ä½ç½®

```python
import os
from crewai.utilities.paths import db_storage_path

# æ£€æŸ¥å­˜å‚¨ç»“æ„
storage_path = db_storage_path()
knowledge_path = os.path.join(storage_path, "knowledge")

if os.path.exists(knowledge_path):
    print("Knowledge collections found:")
    for collection in os.listdir(knowledge_path):
        collection_path = os.path.join(knowledge_path, collection)
        if os.path.isdir(collection_path):
            print(f"  - {collection}/")
            # æ˜¾ç¤ºé›†åˆå†…å®¹
            for item in os.listdir(collection_path):
                print(f"    â””â”€â”€ {item}")
```

#### æµ‹è¯•çŸ¥è¯†æ£€ç´¢

```python
# æµ‹è¯•ä»£ç†çŸ¥è¯†æ£€ç´¢
if hasattr(agent, 'knowledge') and agent.knowledge:
    test_query = ["test query"]
    results = agent.knowledge.query(test_query)
    print(f"Agent knowledge results: {len(results)} documents found")
    
    # æµ‹è¯• crew çŸ¥è¯†æ£€ç´¢ (å¦‚æœå­˜åœ¨)
    if hasattr(crew, 'knowledge') and crew.knowledge:
        crew_results = crew.query_knowledge(test_query)
        print(f"Crew knowledge results: {len(crew_results)} documents found")
```

#### æ£€æŸ¥çŸ¥è¯†é›†åˆ

```python
import chromadb
from crewai.utilities.paths import db_storage_path
import os

# è¿æ¥åˆ° CrewAI çš„çŸ¥è¯† ChromaDB
knowledge_path = os.path.join(db_storage_path(), "knowledge")

if os.path.exists(knowledge_path):
    client = chromadb.PersistentClient(path=knowledge_path)
    collections = client.list_collections()
    
    print("Knowledge Collections:")
    for collection in collections:
        print(f"  - {collection.name}: {collection.count()} documents")
        
        # é‡‡æ ·å°‘é‡æ–‡æ¡£ä»¥éªŒè¯å†…å®¹
        if collection.count() > 0:
            sample = collection.peek(limit=2)
            print(f"    Sample content: {sample['documents'][0][:100]}...")
else:
    print("No knowledge storage found")
```

#### æ£€æŸ¥çŸ¥è¯†å¤„ç†

```python
from crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource

# åˆ›å»ºæµ‹è¯•çŸ¥è¯†æº
test_source = StringKnowledgeSource(
    content="Test knowledge content for debugging",
    chunk_size=100,  # å°å—ç”¨äºæµ‹è¯•
    chunk_overlap=20
)

# æ£€æŸ¥åˆ†å—è¡Œä¸º
print(f"Original content length: {len(test_source.content)}")
print(f"Chunk size: {test_source.chunk_size}")
print(f"Chunk overlap: {test_source.chunk_overlap}")

# å¤„ç†å¹¶æ£€æŸ¥åˆ†å—
test_source.add()
print(f"Number of chunks created: {len(test_source.chunks)}")
for i, chunk in enumerate(test_source.chunks[:3]):  # æ˜¾ç¤ºå‰3ä¸ªå—
    print(f"Chunk {i+1}: {chunk[:50]}...")
```

### å¸¸è§çŸ¥è¯†å­˜å‚¨é—®é¢˜

**â€œFile not foundâ€ (æ‰¾ä¸åˆ°æ–‡ä»¶) é”™è¯¯ï¼š**

```python
# ç¡®ä¿æ–‡ä»¶åœ¨æ­£ç¡®çš„ä½ç½®
from crewai.utilities.constants import KNOWLEDGE_DIRECTORY
import os

knowledge_dir = KNOWLEDGE_DIRECTORY  # é€šå¸¸æ˜¯ "knowledge"
file_path = os.path.join(knowledge_dir, "your_file.pdf")

if not os.path.exists(file_path):
    print(f"File not found: {file_path}")
    print(f"Current working directory: {os.getcwd()}")
    print(f"Expected knowledge directory: {os.path.abspath(knowledge_dir)}")
```

**â€œEmbedding dimension mismatchâ€ (åµŒå…¥ç»´åº¦ä¸åŒ¹é…) é”™è¯¯ï¼š**

```python
# è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨åˆ‡æ¢ embedding æä¾›å•†æ—¶
# é‡ç½®çŸ¥è¯†å­˜å‚¨ä»¥æ¸…é™¤æ—§çš„ embedding
crew.reset_memories(command_type='knowledge')

# æˆ–è€…ä½¿ç”¨ä¸€è‡´çš„ embedding æä¾›å•†
crew = Crew(
    agents=[...],
    tasks=[...],
    knowledge_sources=[...],
    embedder={"provider": "openai", "config": {"model": "text-embedding-3-small"}}
)
```

**â€œChromaDB permission deniedâ€ (ChromaDB æƒé™è¢«æ‹’ç») é”™è¯¯ï¼š**

```bash
# ä¿®å¤å­˜å‚¨æƒé™
chmod -R 755 ~/.local/share/CrewAI/
```

**çŸ¥è¯†åœ¨è¿è¡Œä¹‹é—´ä¸æŒä¹…åŒ–ï¼š**

```python
# éªŒè¯å­˜å‚¨ä½ç½®çš„ä¸€è‡´æ€§
import os
from crewai.utilities.paths import db_storage_path

print("CREWAI_STORAGE_DIR:", os.getenv("CREWAI_STORAGE_DIR"))
print("Computed storage path:", db_storage_path())
print("Knowledge path:", os.path.join(db_storage_path(), "knowledge"))
```

### çŸ¥è¯†é‡ç½®å‘½ä»¤

```python
# ä»…é‡ç½®ä»£ç†ç‰¹å®šçš„çŸ¥è¯†
crew.reset_memories(command_type='agent_knowledge')

# é‡ç½® Crew å’Œä»£ç†çš„çŸ¥è¯†  
crew.reset_memories(command_type='knowledge')

# CLI å‘½ä»¤
# crewai reset-memories --agent-knowledge  # ä»…ä»£ç†çŸ¥è¯†
# crewai reset-memories --knowledge        # æ‰€æœ‰çŸ¥è¯†
```

### æ¸…é™¤çŸ¥è¯† (Clearing Knowledge)

å¦‚æœä½ éœ€è¦æ¸…é™¤ CrewAI ä¸­å­˜å‚¨çš„çŸ¥è¯†ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ `--knowledge` é€‰é¡¹çš„ `crewai reset-memories` å‘½ä»¤ã€‚

å‘½ä»¤ï¼š

```bash
crewai reset-memories --knowledge
```

å½“ä½ æ›´æ–°äº†çŸ¥è¯†æºå¹¶å¸Œæœ›ç¡®ä¿ä»£ç†ä½¿ç”¨æœ€æ–°ä¿¡æ¯æ—¶ï¼Œæ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚

## æœ€ä½³å®è·µ (Best Practices)

**å†…å®¹ç»„ç»‡**

*   æ ¹æ®ä½ çš„å†…å®¹ç±»å‹é€‰æ‹©é€‚å½“çš„å—å¤§å°ï¼ˆchunk sizesï¼‰ã€‚
*   è€ƒè™‘å†…å®¹é‡å ï¼ˆoverlapï¼‰ä»¥ä¿æŒä¸Šä¸‹æ–‡ã€‚
*   å°†ç›¸å…³ä¿¡æ¯ç»„ç»‡åˆ°å•ç‹¬çš„çŸ¥è¯†æºä¸­ã€‚

**æ€§èƒ½æç¤º**

*   æ ¹æ®å†…å®¹å¤æ‚åº¦è°ƒæ•´å—å¤§å°ã€‚
*   é…ç½®é€‚å½“çš„ embedding æ¨¡å‹ã€‚
*   è€ƒè™‘ä½¿ç”¨æœ¬åœ° embedding æä¾›å•†ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ã€‚

**ä¸€æ¬¡æ€§çŸ¥è¯†**

*   ä½¿ç”¨ CrewAI æä¾›çš„å…¸å‹æ–‡ä»¶ç»“æ„ï¼Œæ¯æ¬¡è§¦å‘ kickoff æ—¶éƒ½ä¼šåµŒå…¥çŸ¥è¯†æºã€‚
*   å¦‚æœçŸ¥è¯†æºå¾ˆå¤§ï¼Œè¿™ä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹å’Œå»¶è¿Ÿå¢åŠ ï¼Œå› ä¸ºæ¯æ¬¡éƒ½ä¼šåµŒå…¥ç›¸åŒçš„æ•°æ®ã€‚
*   è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·ç›´æ¥åˆå§‹åŒ– `knowledge` å‚æ•°ï¼Œè€Œä¸æ˜¯ `knowledge_sources` å‚æ•°ã€‚
*   é“¾æ¥åˆ°è¯¥é—®é¢˜ä»¥è·å¾—å®Œæ•´æ€è·¯ [Github Issue](https://github.com/crewAIInc/crewAI/issues/2755)

**ç®¡ç†çŸ¥è¯†**

*   ä½¿ç”¨ä»£ç†çº§çŸ¥è¯†æ¥è·å–ç‰¹å®šè§’è‰²çš„ä¿¡æ¯ã€‚
*   ä½¿ç”¨ Crew çº§çŸ¥è¯†æ¥è·å–æ‰€æœ‰ä»£ç†éœ€è¦çš„å…±äº«ä¿¡æ¯ã€‚
*   å¦‚æœä½ éœ€è¦ä¸åŒçš„åµŒå…¥ç­–ç•¥ï¼Œè¯·åœ¨ä»£ç†çº§åˆ«è®¾ç½® embeddersã€‚
*   ä½¿ç”¨æè¿°æ€§çš„ä»£ç†è§’è‰²æ¥ä¿æŒé›†åˆåç§°çš„ä¸€è‡´æ€§ã€‚
*   é€šè¿‡åœ¨ kickoff åæ£€æŸ¥ `agent.knowledge` æ¥æµ‹è¯•çŸ¥è¯†åˆå§‹åŒ–ã€‚
*   ç›‘æ§å­˜å‚¨ä½ç½®ä»¥äº†è§£çŸ¥è¯†å­˜å‚¨åœ¨å“ªé‡Œã€‚
*   ä½¿ç”¨æ­£ç¡®çš„å‘½ä»¤ç±»å‹é€‚å½“åœ°é‡ç½®çŸ¥è¯†ã€‚

**ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ**

*   åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å°† `CREWAI_STORAGE_DIR` è®¾ç½®ä¸ºå·²çŸ¥ä½ç½®ã€‚
*   é€‰æ‹©æ˜ç¡®çš„ embedding æä¾›å•†ä»¥åŒ¹é…ä½ çš„ LLM è®¾ç½®å¹¶é¿å… API å¯†é’¥å†²çªã€‚
*   éšç€æ–‡æ¡£çš„æ·»åŠ ï¼Œç›‘æ§çŸ¥è¯†å­˜å‚¨çš„å¤§å°å¢é•¿ã€‚
*   ä½¿ç”¨é›†åˆåç§°æŒ‰åŸŸæˆ–ç”¨é€”ç»„ç»‡çŸ¥è¯†æºã€‚
*   å°†çŸ¥è¯†ç›®å½•åŒ…å«åœ¨å¤‡ä»½å’Œéƒ¨ç½²ç­–ç•¥ä¸­ã€‚
*   ä¸ºçŸ¥è¯†æ–‡ä»¶å’Œå­˜å‚¨ç›®å½•è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™ã€‚
*   ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å­˜å‚¨ API å¯†é’¥å’Œæ•æ„Ÿé…ç½®ã€‚