è¿™æ˜¯ CrewAI å®˜æ–¹æ–‡æ¡£ä¸­å…³äºâ€œMemoryï¼ˆè®°å¿†ï¼‰â€éƒ¨åˆ†çš„ä¸­æ–‡ç¿»è¯‘ã€‚

---

# æ ¸å¿ƒæ¦‚å¿µ - è®°å¿† (Memory)

åˆ©ç”¨ CrewAI æ¡†æ¶ä¸­çš„è®°å¿†ç³»ç»Ÿæ¥å¢å¼ºä»£ç†ï¼ˆAgentï¼‰çš„èƒ½åŠ›ã€‚

## æ¦‚è§ˆ (Overview)

CrewAI æ¡†æ¶æä¾›äº†ä¸€ä¸ªå¤æ‚çš„è®°å¿†ç³»ç»Ÿï¼Œæ—¨åœ¨æ˜¾è‘—å¢å¼º AI ä»£ç†çš„èƒ½åŠ›ã€‚CrewAI æä¾›äº†**ä¸¤ç§æˆªç„¶ä¸åŒçš„è®°å¿†æ–¹æ³•**ï¼Œä»¥æœåŠ¡äºä¸åŒçš„ç”¨ä¾‹ï¼š

1.  **åŸºç¡€è®°å¿†ç³»ç»Ÿ (Basic Memory System)** - å†…ç½®çš„çŸ­æœŸã€é•¿æœŸå’Œå®ä½“è®°å¿†ã€‚
2.  **å¤–éƒ¨è®°å¿† (External Memory)** - ç‹¬ç«‹çš„å¤–éƒ¨è®°å¿†æä¾›å•†ã€‚

## è®°å¿†ç³»ç»Ÿç»„ä»¶ (Memory System Components)

| ç»„ä»¶ | æè¿° |
| :--- | :--- |
| **çŸ­æœŸè®°å¿† (Short-Term Memory)** | ä½¿ç”¨ `RAG` ä¸´æ—¶å­˜å‚¨æœ€è¿‘çš„äº¤äº’å’Œç»“æœï¼Œä½¿ä»£ç†èƒ½å¤Ÿåœ¨å½“å‰æ‰§è¡ŒæœŸé—´å›å¿†å¹¶åˆ©ç”¨ä¸å½“å‰ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯ã€‚ |
| **é•¿æœŸè®°å¿† (Long-Term Memory)** | ä¿å­˜è¿‡å»æ‰§è¡Œä¸­çš„å®è´µè§è§£å’Œç»éªŒï¼Œå…è®¸ä»£ç†éšç€æ—¶é—´çš„æ¨ç§»æ„å»ºå’Œå®Œå–„å…¶çŸ¥è¯†ã€‚ |
| **å®ä½“è®°å¿† (Entity Memory)** | æ•è·å¹¶ç»„ç»‡åœ¨ä»»åŠ¡æœŸé—´é‡åˆ°çš„å®ä½“ï¼ˆäººã€åœ°ç‚¹ã€æ¦‚å¿µï¼‰ä¿¡æ¯ï¼Œä¿ƒè¿›æ›´æ·±å±‚çš„ç†è§£å’Œå…³ç³»æ˜ å°„ã€‚ä½¿ç”¨ `RAG` å­˜å‚¨å®ä½“ä¿¡æ¯ã€‚ |
| **ä¸Šä¸‹æ–‡è®°å¿† (Contextual Memory)** | é€šè¿‡ç»“åˆ `ShortTermMemory`ï¼ˆçŸ­æœŸè®°å¿†ï¼‰ã€`LongTermMemory`ï¼ˆé•¿æœŸè®°å¿†ï¼‰ã€`ExternalMemory`ï¼ˆå¤–éƒ¨è®°å¿†ï¼‰å’Œ `EntityMemory`ï¼ˆå®ä½“è®°å¿†ï¼‰æ¥ç»´æŠ¤äº¤äº’çš„ä¸Šä¸‹æ–‡ï¼Œæœ‰åŠ©äºä»£ç†åœ¨ä¸€ç³»åˆ—ä»»åŠ¡æˆ–å¯¹è¯ä¸­ä¿æŒå›å¤çš„è¿è´¯æ€§å’Œç›¸å…³æ€§ã€‚ |

## 1. åŸºç¡€è®°å¿†ç³»ç»Ÿ (æ¨è)

è¿™æ˜¯æœ€ç®€å•ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚åªéœ€ä¸€ä¸ªå‚æ•°å³å¯ä¸ºä½ çš„ Crew å¯ç”¨è®°å¿†ï¼š

### å¿«é€Ÿå¼€å§‹ (Quick Start)

```python
from crewai import Crew, Agent, Task, Process

# å¯ç”¨åŸºç¡€è®°å¿†ç³»ç»Ÿ
crew = Crew(
    agents=[...],
    tasks=[...],
    process=Process.sequential,
    memory=True,  # å¯ç”¨çŸ­æœŸã€é•¿æœŸå’Œå®ä½“è®°å¿†
    verbose=True
)
```

### å·¥ä½œåŸç† (How It Works)

*   **çŸ­æœŸè®°å¿†**ï¼šä½¿ç”¨å¸¦æœ‰ RAG çš„ ChromaDB æ¥å¤„ç†å½“å‰ä¸Šä¸‹æ–‡ã€‚
*   **é•¿æœŸè®°å¿†**ï¼šä½¿ç”¨ SQLite3 è·¨ä¼šè¯å­˜å‚¨ä»»åŠ¡ç»“æœã€‚
*   **å®ä½“è®°å¿†**ï¼šä½¿ç”¨ RAG è¿½è¸ªå®ä½“ï¼ˆäººã€åœ°ç‚¹ã€æ¦‚å¿µï¼‰ã€‚
*   **å­˜å‚¨ä½ç½®**ï¼šé€šè¿‡ `appdirs` åŒ…ç¡®å®šçš„ç‰¹å®šäºå¹³å°çš„ä½ç½®ã€‚
*   **è‡ªå®šä¹‰å­˜å‚¨ç›®å½•**ï¼šè®¾ç½® `CREWAI_STORAGE_DIR` ç¯å¢ƒå˜é‡ã€‚

## å­˜å‚¨ä½ç½®é€æ˜åº¦ (Storage Location Transparency)

**äº†è§£å­˜å‚¨ä½ç½®**ï¼šCrewAI ä½¿ç”¨ç‰¹å®šäºå¹³å°çš„ç›®å½•æ¥å­˜å‚¨è®°å¿†å’ŒçŸ¥è¯†æ–‡ä»¶ï¼Œéµå¾ªæ“ä½œç³»ç»Ÿæƒ¯ä¾‹ã€‚äº†è§£è¿™äº›ä½ç½®æœ‰åŠ©äºç”Ÿäº§éƒ¨ç½²ã€å¤‡ä»½å’Œè°ƒè¯•ã€‚

### CrewAI åœ¨å“ªé‡Œå­˜å‚¨æ–‡ä»¶

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCrewAI ä½¿ç”¨ `appdirs` åº“æŒ‰ç…§å¹³å°æƒ¯ä¾‹ç¡®å®šå­˜å‚¨ä½ç½®ã€‚ä»¥ä¸‹æ˜¯æ–‡ä»¶å­˜å‚¨çš„ç¡®åˆ‡ä½ç½®ï¼š

#### ä¸åŒå¹³å°çš„é»˜è®¤å­˜å‚¨ä½ç½®

**macOS:**

```
~/Library/Application Support/CrewAI/{project_name}/
â”œâ”€â”€ knowledge/           # çŸ¥è¯†åº“ ChromaDB æ–‡ä»¶
â”œâ”€â”€ short_term_memory/   # çŸ­æœŸè®°å¿† ChromaDB æ–‡ä»¶
â”œâ”€â”€ long_term_memory/    # é•¿æœŸè®°å¿† ChromaDB æ–‡ä»¶
â”œâ”€â”€ entities/            # å®ä½“è®°å¿† ChromaDB æ–‡ä»¶
â””â”€â”€ long_term_memory_storage.db  # SQLite æ•°æ®åº“
```

**Linux:**

```
~/.local/share/CrewAI/{project_name}/
â”œâ”€â”€ knowledge/
â”œâ”€â”€ short_term_memory/
â”œâ”€â”€ long_term_memory/
â”œâ”€â”€ entities/
â””â”€â”€ long_term_memory_storage.db
```

**Windows:**

```
C:\Users\{username}\AppData\Local\CrewAI\{project_name}\
â”œâ”€â”€ knowledge\
â”œâ”€â”€ short_term_memory\
â”œâ”€â”€ long_term_memory\
â”œâ”€â”€ entities\
â””â”€â”€ long_term_memory_storage.db
```

### æŸ¥æ‰¾ä½ çš„å­˜å‚¨ä½ç½®

è¦æŸ¥çœ‹ CrewAI ç¡®åˆ‡åœ¨ä½ çš„ç³»ç»Ÿä¸­ä½•å¤„å­˜å‚¨æ–‡ä»¶ï¼š

```python
from crewai.utilities.paths import db_storage_path
import os

# è·å–åŸºç¡€å­˜å‚¨è·¯å¾„
storage_path = db_storage_path()
print(f"CrewAI storage location: {storage_path}")

# åˆ—å‡ºæ‰€æœ‰ CrewAI å­˜å‚¨ç›®å½•
if os.path.exists(storage_path):
    print("\nStored files and directories:")
    for item in os.listdir(storage_path):
        item_path = os.path.join(storage_path, item)
        if os.path.isdir(item_path):
            print(f"ğŸ“ {item}/")
            # æ˜¾ç¤º ChromaDB é›†åˆ
            if os.path.exists(item_path):
                for subitem in os.listdir(item_path):
                    print(f"   â””â”€â”€ {subitem}")
        else:
            print(f"ğŸ“„ {item}")
else:
    print("No CrewAI storage directory found yet.")
```

### æ§åˆ¶å­˜å‚¨ä½ç½®

#### é€‰é¡¹ 1ï¼šç¯å¢ƒå˜é‡ (æ¨è)

```python
import os
from crewai import Crew

# è®¾ç½®è‡ªå®šä¹‰å­˜å‚¨ä½ç½®
os.environ["CREWAI_STORAGE_DIR"] = "./my_project_storage"

# æ‰€æœ‰è®°å¿†å’ŒçŸ¥è¯†ç°åœ¨éƒ½å°†å­˜å‚¨åœ¨ ./my_project_storage/ ä¸­
crew = Crew(
    agents=[...],
    tasks=[...],
    memory=True
)
```

#### é€‰é¡¹ 2ï¼šè‡ªå®šä¹‰å­˜å‚¨è·¯å¾„

```python
import os
from crewai import Crew
from crewai.memory import LongTermMemory
from crewai.memory.storage.ltm_sqlite_storage import LTMSQLiteStorage

# é…ç½®è‡ªå®šä¹‰å­˜å‚¨ä½ç½®
custom_storage_path = "./storage"
os.makedirs(custom_storage_path, exist_ok=True)

crew = Crew(
    memory=True,
    long_term_memory=LongTermMemory(
        storage=LTMSQLiteStorage(
            db_path=f"{custom_storage_path}/memory.db"
        )
    )
)
```

#### é€‰é¡¹ 3ï¼šé¡¹ç›®ç‰¹å®šå­˜å‚¨

```python
import os
from pathlib import Path

# å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•ä¸­
project_root = Path(__file__).parent
storage_dir = project_root / "crewai_storage"

os.environ["CREWAI_STORAGE_DIR"] = str(storage_dir)

# ç°åœ¨æ‰€æœ‰å­˜å‚¨éƒ½å°†åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­
```

### åµŒå…¥æä¾›å•†é»˜è®¤å€¼ (Embedding Provider Defaults)

**é»˜è®¤åµŒå…¥æä¾›å•†**ï¼šCrewAI é»˜è®¤ä½¿ç”¨ OpenAI Embeddings ä»¥ç¡®ä¿ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚ä½ å¯ä»¥è½»æ¾è‡ªå®šä¹‰å®ƒä»¥åŒ¹é…ä½ çš„ LLM æä¾›å•†æˆ–ä½¿ç”¨æœ¬åœ°åµŒå…¥ã€‚

#### ç†è§£é»˜è®¤è¡Œä¸º

```python
# å½“ä½¿ç”¨ Claude ä½œä¸ºä½ çš„ LLM æ—¶...
from crewai import Agent, LLM

agent = Agent(
    role="Analyst",
    goal="Analyze data",
    backstory="Expert analyst",
    llm=LLM(provider="anthropic", model="claude-3-sonnet")  # ä½¿ç”¨ Claude
)

# ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼ŒCrewAI é»˜è®¤ä»å°†ä½¿ç”¨ OpenAI embeddings
# ä½ å¯ä»¥è½»æ¾è‡ªå®šä¹‰ä»¥åŒ¹é…ä½ åå¥½çš„æä¾›å•†
```

#### è‡ªå®šä¹‰åµŒå…¥æä¾›å•†

```python
from crewai import Crew

# é€‰é¡¹ 1: åŒ¹é…ä½ çš„ LLM æä¾›å•†
crew = Crew(
    agents=[agent],
    tasks=[task],
    memory=True,
    embedder={
        "provider": "anthropic", # åŒ¹é…ä½ çš„ LLM æä¾›å•†
        "config": {
            "api_key": "your-anthropic-key",
            "model": "text-embedding-3-small"
        }
    }
)

# é€‰é¡¹ 2: ä½¿ç”¨æœ¬åœ° embeddings (æ— å¤–éƒ¨ API è°ƒç”¨)
crew = Crew(
    agents=[agent],
    tasks=[task],
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {"model": "mxbai-embed-large"}
    }
)
```

### è°ƒè¯•å­˜å‚¨é—®é¢˜

#### æ£€æŸ¥å­˜å‚¨æƒé™

```python
import os
from crewai.utilities.paths import db_storage_path

storage_path = db_storage_path()
print(f"Storage path: {storage_path}")
print(f"Path exists: {os.path.exists(storage_path)}")
print(f"Is writable: {os.access(storage_path, os.W_OK) if os.path.exists(storage_path) else 'Path does not exist'}")

# åˆ›å»ºå…·æœ‰é€‚å½“æƒé™çš„ç›®å½•
if not os.path.exists(storage_path):
    os.makedirs(storage_path, mode=0o755, exist_ok=True)
    print(f"Created storage directory: {storage_path}")
```

#### æ£€æŸ¥ ChromaDB é›†åˆ

```python
import chromadb
from crewai.utilities.paths import db_storage_path

# è¿æ¥åˆ° CrewAI çš„ ChromaDB
storage_path = db_storage_path()
chroma_path = os.path.join(storage_path, "knowledge")

if os.path.exists(chroma_path):
    client = chromadb.PersistentClient(path=chroma_path)
    collections = client.list_collections()

    print("ChromaDB Collections:")
    for collection in collections:
        print(f"  - {collection.name}: {collection.count()} documents")
else:
    print("No ChromaDB storage found")
```

#### é‡ç½®å­˜å‚¨ (è°ƒè¯•ç”¨)

```python
from crewai import Crew

# é‡ç½®æ‰€æœ‰è®°å¿†å­˜å‚¨
crew = Crew(agents=[...], tasks=[...], memory=True)

# é‡ç½®ç‰¹å®šè®°å¿†ç±»å‹
crew.reset_memories(command_type='short')     # çŸ­æœŸè®°å¿†
crew.reset_memories(command_type='long')      # é•¿æœŸè®°å¿†
crew.reset_memories(command_type='entity')    # å®ä½“è®°å¿†
crew.reset_memories(command_type='knowledge') # çŸ¥è¯†å­˜å‚¨
```

### ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

1.  **è®¾ç½® `CREWAI_STORAGE_DIR`** åˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„å·²çŸ¥ä½ç½®ä»¥ä¾¿æ›´å¥½åœ°æ§åˆ¶ã€‚
2.  **é€‰æ‹©æ˜ç¡®çš„åµŒå…¥æä¾›å•†** ä»¥åŒ¹é…ä½ çš„ LLM è®¾ç½®ã€‚
3.  å¯¹äºå¤§è§„æ¨¡éƒ¨ç½²ï¼Œ**ç›‘æ§å­˜å‚¨ç›®å½•å¤§å°**ã€‚
4.  å°† **å­˜å‚¨ç›®å½•åŒ…å«åœ¨ä½ çš„å¤‡ä»½ç­–ç•¥ä¸­**ã€‚
5.  **è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™**ï¼ˆç›®å½•ä¸º 0o755ï¼Œæ–‡ä»¶ä¸º 0o644ï¼‰ã€‚
6.  å¯¹äºå®¹å™¨åŒ–éƒ¨ç½²ï¼Œ**ä½¿ç”¨é¡¹ç›®ç›¸å¯¹è·¯å¾„**ã€‚

### å¸¸è§å­˜å‚¨é—®é¢˜

**â€œChromaDB permission deniedâ€ï¼ˆæƒé™è¢«æ‹’ç»ï¼‰é”™è¯¯ï¼š**

```bash
# ä¿®å¤æƒé™
chmod -R 755 ~/.local/share/CrewAI/
```

**â€œDatabase is lockedâ€ï¼ˆæ•°æ®åº“è¢«é”å®šï¼‰é”™è¯¯ï¼š**

```python
# ç¡®ä¿åªæœ‰ä¸€ä¸ª CrewAI å®ä¾‹è®¿é—®å­˜å‚¨
import fcntl
import os

storage_path = db_storage_path()
lock_file = os.path.join(storage_path, ".crewai.lock")

with open(lock_file, 'w') as f:
    fcntl.flock(f.fileno(), fcntl.LOCK_EX | fcntl.LOCK_NB)
    # ä½ çš„ CrewAI ä»£ç åœ¨è¿™é‡Œ
```

**è¿è¡Œä¹‹é—´è®°å¿†æœªæŒä¹…åŒ–ï¼š**

```python
# éªŒè¯å­˜å‚¨ä½ç½®æ˜¯å¦ä¸€è‡´
import os
print("CREWAI_STORAGE_DIR:", os.getenv("CREWAI_STORAGE_DIR"))
print("Current working directory:", os.getcwd())
print("Computed storage path:", db_storage_path())
```

## è‡ªå®šä¹‰åµŒå…¥å™¨é…ç½® (Custom Embedder Configuration)

CrewAI æ”¯æŒå¤šç§åµŒå…¥æä¾›å•†ï¼Œè®©ä½ èƒ½å¤Ÿçµæ´»é€‰æ‹©æœ€é€‚åˆä½ ç”¨ä¾‹çš„é€‰é¡¹ã€‚ä»¥ä¸‹æ˜¯ä¸ºä½ çš„è®°å¿†ç³»ç»Ÿé…ç½®ä¸åŒåµŒå…¥æä¾›å•†çš„ç»¼åˆæŒ‡å—ã€‚

### ä¸ºä»€ä¹ˆè¦é€‰æ‹©ä¸åŒçš„åµŒå…¥æä¾›å•†ï¼Ÿ

*   **æˆæœ¬ä¼˜åŒ–**ï¼šæœ¬åœ°åµŒå…¥ï¼ˆOllamaï¼‰åœ¨åˆå§‹è®¾ç½®åæ˜¯å…è´¹çš„ã€‚
*   **éšç§**ï¼šä½¿ç”¨ Ollama å°†æ•°æ®ä¿ç•™åœ¨æœ¬åœ°ï¼Œæˆ–ä½¿ç”¨ä½ åå¥½çš„äº‘æä¾›å•†ã€‚
*   **æ€§èƒ½**ï¼šæŸäº›æ¨¡å‹åœ¨ç‰¹å®šé¢†åŸŸæˆ–è¯­è¨€ä¸Šè¡¨ç°æ›´å¥½ã€‚
*   **ä¸€è‡´æ€§**ï¼šä½¿ä½ çš„åµŒå…¥æä¾›å•†ä¸ä½ çš„ LLM æä¾›å•†ç›¸åŒ¹é…ã€‚
*   **åˆè§„æ€§**ï¼šæ»¡è¶³ç‰¹å®šçš„ç›‘ç®¡æˆ–ç»„ç»‡è¦æ±‚ã€‚

### OpenAI Embeddings (é»˜è®¤)

OpenAI æä¾›å¯é ã€é«˜è´¨é‡çš„åµŒå…¥ï¼Œé€‚ç”¨äºå¤§å¤šæ•°ç”¨ä¾‹ã€‚

```python
from crewai import Crew

# åŸºç¡€ OpenAI é…ç½® (ä½¿ç”¨ç¯å¢ƒå˜é‡ OPENAI_API_KEY)
crew = Crew(
    agents=[...],
    tasks=[...],
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "model_name": "text-embedding-3-small"  # æˆ– "text-embedding-3-large"
        }
    }
)

# é«˜çº§ OpenAI é…ç½®
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "api_key": "your-openai-api-key",  # å¯é€‰: è¦†ç›–ç¯å¢ƒå˜é‡
            "model_name": "text-embedding-3-large",
            "dimensions": 1536,  # å¯é€‰: ç”¨äºè¾ƒå°å­˜å‚¨çš„é™ç»´
            "organization_id": "your-org-id"  # å¯é€‰: é€‚ç”¨äºç»„ç»‡è´¦æˆ·
        }
    }
)
```

### Azure OpenAI Embeddings

é€‚ç”¨äºæ‹¥æœ‰ Azure OpenAI éƒ¨ç½²çš„ä¼ä¸šç”¨æˆ·ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",  # Azure ä½¿ç”¨ openai æä¾›å•†
        "config": {
            "api_key": "your-azure-api-key",
            "api_base": "https://your-resource.openai.azure.com/",
            "api_type": "azure",
            "api_version": "2023-05-15",
            "model_name": "text-embedding-3-small",
            "deployment_id": "your-deployment-name"  # Azure éƒ¨ç½²åç§°
        }
    }
)
```

### Google AI Embeddings

ä½¿ç”¨ Google çš„æ–‡æœ¬åµŒå…¥æ¨¡å‹ä¸ Google Cloud æœåŠ¡é›†æˆã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "google-generativeai",
        "config": {
            "api_key": "your-google-api-key",
            "model_name": "gemini-embedding-001"  # æˆ– "text-embedding-005", "text-multilingual-embedding-002"
        }
    }
)
```

### Vertex AI Embeddings

é€‚ç”¨äºæ‹¥æœ‰ Vertex AI è®¿é—®æƒé™çš„ Google Cloud ç”¨æˆ·ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "vertexai",
        "config": {
            "project_id": "your-gcp-project-id",
            "region": "us-central1",  # æˆ–ä½ åå¥½çš„åŒºåŸŸ
            "api_key": "your-service-account-key",
            "model_name": "textembedding-gecko"
        }
    }
)
```

### Ollama Embeddings (æœ¬åœ°)

åœ¨æœ¬åœ°è¿è¡ŒåµŒå…¥ä»¥ä¿æŠ¤éšç§å¹¶èŠ‚çœæˆæœ¬ã€‚

```python
# é¦–å…ˆï¼Œåœ¨æœ¬åœ°å®‰è£…å¹¶è¿è¡Œ Ollamaï¼Œç„¶åæ‹‰å–ä¸€ä¸ªåµŒå…¥æ¨¡å‹ï¼š
# ollama pull mxbai-embed-large

crew = Crew(
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {
            "model": "mxbai-embed-large",  # æˆ– "nomic-embed-text"
            "url": "http://localhost:11434/api/embeddings"  # é»˜è®¤ Ollama URL
        }
    }
)

# é’ˆå¯¹è‡ªå®šä¹‰ Ollama å®‰è£…
crew = Crew(
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {
            "model": "mxbai-embed-large",
            "url": "http://your-ollama-server:11434/api/embeddings"
        }
    }
)
```

### Cohere Embeddings

ä½¿ç”¨ Cohere çš„åµŒå…¥æ¨¡å‹ä»¥è·å¾—å¤šè¯­è¨€æ”¯æŒã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "cohere",
        "config": {
            "api_key": "your-cohere-api-key",
            "model_name": "embed-english-v3.0"  # æˆ– "embed-multilingual-v3.0"
        }
    }
)
```

### VoyageAI Embeddings

é’ˆå¯¹æ£€ç´¢ä»»åŠ¡ä¼˜åŒ–çš„é«˜æ€§èƒ½åµŒå…¥ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "voyageai",
        "config": {
            "api_key": "your-voyage-api-key",
            "model": "voyage-3",  # æˆ– "voyage-3-lite", "voyage-code-3"
            "input_type": "document"  # æˆ– "query"
        }
    }
)
```

### AWS Bedrock Embeddings

é€‚ç”¨äºæ‹¥æœ‰ Bedrock è®¿é—®æƒé™çš„ AWS ç”¨æˆ·ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "bedrock",
        "config": {
            "aws_access_key_id": "your-access-key",
            "aws_secret_access_key": "your-secret-key",
            "region_name": "us-east-1",
            "model": "amazon.titan-embed-text-v1"
        }
    }
)
```

### Hugging Face Embeddings

ä½¿ç”¨ Hugging Face çš„å¼€æºæ¨¡å‹ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "huggingface",
        "config": {
            "api_key": "your-hf-token",  # å¯¹äºå…¬å…±æ¨¡å‹å¯é€‰
            "model": "sentence-transformers/all-MiniLM-L6-v2"
        }
    }
)
```

### IBM Watson Embeddings

é€‚ç”¨äº IBM Cloud ç”¨æˆ·ã€‚

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "watson",
        "config": {
            "api_key": "your-watson-api-key",
            "url": "your-watson-instance-url",
            "model": "ibm/slate-125m-english-rtrvr"
        }
    }
)
```

### Mem0 æä¾›å•†

çŸ­æœŸè®°å¿†å’Œå®ä½“è®°å¿†éƒ½æ”¯æŒä¸ä½œä¸ºæä¾›å•†çš„ Mem0 OSS å’Œ Mem0 Client ç´§å¯†é›†æˆã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Mem0 ä½œä¸ºæä¾›å•†ã€‚

```python
from crewai.memory.short_term.short_term_memory import ShortTermMemory
from crewai.memory.entity_entity_memory import EntityMemory

mem0_oss_embedder_config = {
        "provider": "mem0",
        "config": {
            "user_id": "john",
            "local_mem0_config": {
                "vector_store": {"provider": "qdrant","config": {"host": "localhost", "port": 6333}},
                "llm": {"provider": "openai","config": {"api_key": "your-api-key", "model": "gpt-4"}},
                "embedder": {"provider": "openai","config": {"api_key": "your-api-key", "model": "text-embedding-3-small"}}
            },
            "infer": True # å¯é€‰ï¼Œé»˜è®¤ä¸º True
        },
    }

mem0_client_embedder_config = {
        "provider": "mem0",
        "config": {
            "user_id": "john",
            "org_id": "my_org_id",        # å¯é€‰
            "project_id": "my_project_id", # å¯é€‰
            "api_key": "custom-api-key"    # å¯é€‰ - è¦†ç›–ç¯å¢ƒå˜é‡
            "run_id": "my_run_id",        # å¯é€‰ - ç”¨äºçŸ­æœŸè®°å¿†
            "includes": "include1",       # å¯é€‰
            "excludes": "exclude1",       # å¯é€‰
            "infer": True                 # å¯é€‰ï¼Œé»˜è®¤ä¸º True
            "custom_categories": new_categories  # å¯é€‰ - ç”¨äºç”¨æˆ·è®°å¿†çš„è‡ªå®šä¹‰åˆ†ç±»
        },
    }

short_term_memory_mem0_oss = ShortTermMemory(embedder_config=mem0_oss_embedder_config) # åŸºäº Mem0 OSS çš„çŸ­æœŸè®°å¿†
short_term_memory_mem0_client = ShortTermMemory(embedder_config=mem0_client_embedder_config) # åŸºäº Mem0 Client çš„çŸ­æœŸè®°å¿†
entity_memory_mem0_oss = EntityMemory(embedder_config=mem0_oss_embedder_config) # åŸºäº Mem0 OSS çš„å®ä½“è®°å¿†
entity_memory_mem0_client = EntityMemory(embedder_config=mem0_client_embedder_config) # åŸºäº Mem0 Client çš„å®ä½“è®°å¿†

crew = Crew(
    memory=True,
    short_term_memory=short_term_memory_mem0_oss, # æˆ– short_term_memory_mem0_client
    entity_memory=entity_memory_mem0_oss # æˆ– entity_memory_mem0_client
)
```

### é€‰æ‹©åˆé€‚çš„åµŒå…¥æä¾›å•†

åœ¨é€‰æ‹©åµŒå…¥æä¾›å•†æ—¶ï¼Œè¯·è€ƒè™‘æ€§èƒ½ã€éšç§ã€æˆæœ¬å’Œé›†æˆéœ€æ±‚ç­‰å› ç´ ã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒè¡¨ï¼Œå¸®åŠ©ä½ åšå‡ºå†³å®šï¼š

| æä¾›å•† | æœ€é€‚åˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
| :--- | :--- | :--- | :--- |
| **OpenAI** | é€šç”¨ç”¨é€”ï¼Œé«˜å¯é æ€§ | é«˜è´¨é‡ï¼Œå¹¿æ³›æµ‹è¯• | ä»˜è´¹æœåŠ¡ï¼Œéœ€è¦ API å¯†é’¥ |
| **Ollama** | å…³æ³¨éšç§ï¼ŒèŠ‚çœæˆæœ¬ | å…è´¹ï¼Œæœ¬åœ°è¿è¡Œï¼Œå®Œå…¨ç§å¯† | éœ€è¦æœ¬åœ°å®‰è£…/è®¾ç½® |
| **Google AI** | Google ç”Ÿæ€ç³»ç»Ÿé›†æˆ | æ€§èƒ½å¼ºåŠ²ï¼Œæ”¯æŒè‰¯å¥½ | éœ€è¦ Google è´¦æˆ· |
| **Azure OpenAI** | ä¼ä¸šå’Œåˆè§„éœ€æ±‚ | ä¼ä¸šçº§åŠŸèƒ½ï¼Œå®‰å…¨æ€§ | è®¾ç½®è¿‡ç¨‹è¾ƒå¤æ‚ |
| **Cohere** | å¤šè¯­è¨€å†…å®¹å¤„ç† | å‡ºè‰²çš„è¯­è¨€æ”¯æŒ | æ›´å¤šåˆ©åŸºç”¨ä¾‹ |
| **VoyageAI** | ä¿¡æ¯æ£€ç´¢å’Œæœç´¢ | é’ˆå¯¹æ£€ç´¢ä»»åŠ¡ä¼˜åŒ– | ç›¸å¯¹è¾ƒæ–°çš„æä¾›å•† |
| **Mem0** | é€ç”¨æˆ·ä¸ªæ€§åŒ– | æœç´¢ä¼˜åŒ–çš„åµŒå…¥ | ä»˜è´¹æœåŠ¡ï¼Œéœ€è¦ API å¯†é’¥ |

### ç¯å¢ƒå˜é‡é…ç½®

ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå°† API å¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼š

```python
import os

# è®¾ç½®ç¯å¢ƒå˜é‡
os.environ["OPENAI_API_KEY"] = "your-openai-key"
os.environ["GOOGLE_API_KEY"] = "your-google-key"
os.environ["COHERE_API_KEY"] = "your-cohere-key"

# ä½¿ç”¨æ—¶æ— éœ€åœ¨ä»£ç ä¸­æš´éœ²å¯†é’¥
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "model": "text-embedding-3-small"
            # API å¯†é’¥è‡ªåŠ¨ä»ç¯å¢ƒå˜é‡åŠ è½½
        }
    }
)
```

### æµ‹è¯•ä¸åŒçš„åµŒå…¥æä¾›å•†

é’ˆå¯¹ä½ çš„ç‰¹å®šç”¨ä¾‹æ¯”è¾ƒåµŒå…¥æä¾›å•†ï¼š

```python
from crewai import Crew
from crewai.utilities.paths import db_storage_path

# ä½¿ç”¨ç›¸åŒæ•°æ®æµ‹è¯•ä¸åŒæä¾›å•†
providers_to_test = [
    {
        "name": "OpenAI",
        "config": {
            "provider": "openai",
            "config": {"model": "text-embedding-3-small"}
        }
    },
    {
        "name": "Ollama",
        "config": {
            "provider": "ollama",
            "config": {"model": "mxbai-embed-large"}
        }
    }
]

for provider in providers_to_test:
    print(f"\nTesting {provider['name']} embeddings...")

    # ä½¿ç”¨ç‰¹å®š embedder åˆ›å»º crew
    crew = Crew(
        agents=[...],
        tasks=[...],
        memory=True,
        embedder=provider['config']
    )

    # è¿è¡Œæµ‹è¯•å¹¶æµ‹é‡æ€§èƒ½
    result = crew.kickoff()
    print(f"{provider['name']} completed successfully")
```

### åµŒå…¥é—®é¢˜æ•…éšœæ’é™¤

**Model not foundï¼ˆæ‰¾ä¸åˆ°æ¨¡å‹ï¼‰é”™è¯¯ï¼š**

```python
# éªŒè¯æ¨¡å‹å¯ç”¨æ€§
from crewai.rag.embeddings.configurator import EmbeddingConfigurator

configurator = EmbeddingConfigurator()
try:
    embedder = configurator.configure_embedder({
        "provider": "ollama",
        "config": {"model": "mxbai-embed-large"}
    })
    print("Embedder configured successfully")
except Exception as e:
    print(f"Configuration error: {e}")
```

**API å¯†é’¥é—®é¢˜ï¼š**

```python
import os

# æ£€æŸ¥ API å¯†é’¥æ˜¯å¦å·²è®¾ç½®
required_keys = ["OPENAI_API_KEY", "GOOGLE_API_KEY", "COHERE_API_KEY"]
for key in required_keys:
    if os.getenv(key):
        print(f"âœ… {key} is set")
    else:
        print(f"âŒ {key} is not set")
```

**æ€§èƒ½æ¯”è¾ƒï¼š**

```python
import time

def test_embedding_performance(embedder_config, test_text="This is a test document"):
    start_time = time.time()

    crew = Crew(
        agents=[...],
        tasks=[...],
        memory=True,
        embedder=embedder_config
    )

    # æ¨¡æ‹Ÿè®°å¿†æ“ä½œ
    crew.kickoff()

    end_time = time.time()
    return end_time - start_time

# æ¯”è¾ƒæ€§èƒ½
openai_time = test_embedding_performance({
    "provider": "openai",
    "config": {"model": "text-embedding-3-small"}
})

ollama_time = test_embedding_performance({
    "provider": "ollama",
    "config": {"model": "mxbai-embed-large"}
})

print(f"OpenAI: {openai_time:.2f}s")
print(f"Ollama: {ollama_time:.2f}s")
```

### å®ä½“è®°å¿†æ‰¹å¤„ç†è¡Œä¸º

å®ä½“è®°å¿†æ”¯æŒåœ¨ä¸€æ¬¡ä¿å­˜å¤šä¸ªå®ä½“æ—¶è¿›è¡Œæ‰¹å¤„ç†ã€‚å½“ä½ ä¼ é€’ä¸€ä¸ª `EntityMemoryItem` åˆ—è¡¨æ—¶ï¼Œç³»ç»Ÿä¼šï¼š

*   å‘å‡ºå¸¦æœ‰ `entity_count` çš„å•ä¸ª MemorySaveStartedEventã€‚
*   å†…éƒ¨ä¿å­˜æ¯ä¸ªå®ä½“ï¼Œæ”¶é›†ä»»ä½•éƒ¨åˆ†é”™è¯¯ã€‚
*   å‘å‡ºå¸¦æœ‰èšåˆå…ƒæ•°æ®ï¼ˆä¿å­˜è®¡æ•°ã€é”™è¯¯ï¼‰çš„ MemorySaveCompletedEventã€‚
*   å¦‚æœæŸäº›å®ä½“å¤±è´¥ï¼Œåˆ™å¼•å‘éƒ¨åˆ†ä¿å­˜å¼‚å¸¸ï¼ˆåŒ…æ‹¬è®¡æ•°ï¼‰ã€‚

è¿™åœ¨ä¸€æ¬¡æ“ä½œä¸­å†™å…¥è®¸å¤šå®ä½“æ—¶æé«˜äº†æ€§èƒ½å’Œå¯è§‚å¯Ÿæ€§ã€‚

## 2. å¤–éƒ¨è®°å¿† (External Memory)

å¤–éƒ¨è®°å¿†æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„è®°å¿†ç³»ç»Ÿï¼Œç‹¬ç«‹äº Crew çš„å†…ç½®è®°å¿†è¿è¡Œã€‚è¿™å¯¹äºä¸“é—¨çš„è®°å¿†æä¾›å•†æˆ–è·¨åº”ç”¨ç¨‹åºçš„è®°å¿†å…±äº«éå¸¸ç†æƒ³ã€‚

### åŸºäº Mem0 çš„åŸºç¡€å¤–éƒ¨è®°å¿†

```python
import os
from crewai import Agent, Crew, Process, Task
from crewai.memory.external.external_memory import ExternalMemory

# ä½¿ç”¨æœ¬åœ° Mem0 é…ç½®åˆ›å»ºå¤–éƒ¨è®°å¿†å®ä¾‹
external_memory = ExternalMemory(
    embedder_config={
        "provider": "mem0",
        "config": {
            "user_id": "john",
            "local_mem0_config": {
                "vector_store": {
                    "provider": "qdrant",
                    "config": {"host": "localhost", "port": 6333}
                },
                "llm": {
                    "provider": "openai",
                    "config": {"api_key": "your-api-key", "model": "gpt-4"}
                },
                "embedder": {
                    "provider": "openai",
                    "config": {"api_key": "your-api-key", "model": "text-embedding-3-small"}
                }
            },
            "infer": True # å¯é€‰ï¼Œé»˜è®¤ä¸º True
        },
    }
)

crew = Crew(
    agents=[...],
    tasks=[...],
    external_memory=external_memory, # ä¸åŸºç¡€è®°å¿†åˆ†å¼€
    process=Process.sequential,
    verbose=True
)
```

### åŸºäº Mem0 Client çš„é«˜çº§å¤–éƒ¨è®°å¿†

å½“ä½¿ç”¨ Mem0 Client æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ 'includes', 'excludes', 'custom_categories', 'infer' å’Œ 'run_id'ï¼ˆè¿™ä»…é€‚ç”¨äºçŸ­æœŸè®°å¿†ï¼‰ç­‰å‚æ•°æ¥è¿›ä¸€æ­¥è‡ªå®šä¹‰è®°å¿†é…ç½®ã€‚
ä½ å¯ä»¥åœ¨ [Mem0 æ–‡æ¡£](https://docs.mem0.ai/) ä¸­æ‰¾åˆ°æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

```python
import os
from crewai import Agent, Crew, Process, Task
from crewai.memory.external.external_memory import ExternalMemory

new_categories = [
    {"lifestyle_management_concerns": "Tracks daily routines, habits, hobbies and interests including cooking, time management and work-life balance"},
    {"seeking_structure": "Documents goals around creating routines, schedules, and organized systems in various life areas"},
    {"personal_information": "Basic information about the user including name, preferences, and personality traits"}
]

os.environ["MEM0_API_KEY"] = "your-api-key"

# ä½¿ç”¨ Mem0 Client åˆ›å»ºå¤–éƒ¨è®°å¿†å®ä¾‹
external_memory = ExternalMemory(
    embedder_config={
        "provider": "mem0",
        "config": {
            "user_id": "john",
            "org_id": "my_org_id",        # å¯é€‰
            "project_id": "my_project_id", # å¯é€‰
            "api_key": "custom-api-key"    # å¯é€‰ - è¦†ç›–ç¯å¢ƒå˜é‡
            "run_id": "my_run_id",        # å¯é€‰ - ç”¨äºçŸ­æœŸè®°å¿†
            "includes": "include1",       # å¯é€‰
            "excludes": "exclude1",       # å¯é€‰
            "infer": True                 # å¯é€‰ï¼Œé»˜è®¤ä¸º True
            "custom_categories": new_categories  # å¯é€‰ - ç”¨äºç”¨æˆ·è®°å¿†çš„è‡ªå®šä¹‰åˆ†ç±»
        },
    }
)

crew = Crew(
    agents=[...],
    tasks=[...],
    external_memory=external_memory, # ä¸åŸºç¡€è®°å¿†åˆ†å¼€
    process=Process.sequential,
    verbose=True
)
```

### è‡ªå®šä¹‰å­˜å‚¨å®ç°

```python
from crewai.memory.external.external_memory import ExternalMemory
from crewai.memory.storage.interface import Storage

class CustomStorage(Storage):
    def __init__(self):
        self.memories = []

    def save(self, value, metadata=None, agent=None):
        self.memories.append({
            "value": value,
            "metadata": metadata,
            "agent": agent
        })

    def search(self, query, limit=10, score_threshold=0.5):
        # å®ç°ä½ çš„æœç´¢é€»è¾‘
        return [m for m in self.memories if query.lower() in str(m["value"]).lower()]

    def reset(self):
        self.memories = []

# ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨
external_memory = ExternalMemory(storage=CustomStorage())

crew = Crew(
    agents=[...],
    tasks=[...],
    external_memory=external_memory
)
```

## ğŸ§  è®°å¿†ç³»ç»Ÿæ¯”è¾ƒ

| **ç±»åˆ«** | **ç‰¹æ€§** | **åŸºç¡€è®°å¿†** | **å¤–éƒ¨è®°å¿†** |
| :--- | :--- | :--- | :--- |
| **æ˜“ç”¨æ€§** | è®¾ç½®å¤æ‚æ€§ | ç®€å• | ä¸­ç­‰ |
|  | é›†æˆ | å†…ç½® (ä¸Šä¸‹æ–‡) | ç‹¬ç«‹ |
| **æŒä¹…æ€§** | å­˜å‚¨ | æœ¬åœ°æ–‡ä»¶ | è‡ªå®šä¹‰ / Mem0 |
|  | è·¨ä¼šè¯æ”¯æŒ | âœ… | âœ… |
| **ä¸ªæ€§åŒ–** | ç‰¹å®šäºç”¨æˆ·çš„è®°å¿† | âŒ | âœ… |
|  | è‡ªå®šä¹‰æä¾›å•† | æœ‰é™ | ä»»ä½•æä¾›å•† |
| **ç”¨ä¾‹åŒ¹é…** | æ¨èç”¨äº | å¤§å¤šæ•°é€šç”¨åœºæ™¯ | ä¸“ä¸š / å®šåˆ¶éœ€æ±‚ |

## æ”¯æŒçš„åµŒå…¥æä¾›å•† (ä»£ç ç‰‡æ®µå¿«é€Ÿå‚è€ƒ)

### OpenAI (é»˜è®¤)

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",
        "config": {"model": "text-embedding-3-small"}
    }
)
```

### Ollama

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "ollama",
        "config": {"model": "mxbai-embed-large"}
    }
)
```

### Google AI

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "google-generativeai",
        "config": {
            "api_key": "your-api-key",
            "model_name": "gemini-embedding-001"
        }
    }
)
```

### Azure OpenAI

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "api_key": "your-api-key",
            "api_base": "https://your-resource.openai.azure.com/",
            "api_version": "2023-05-15",
            "model_name": "text-embedding-3-small"
        }
    }
)
```

### Vertex AI

```python
crew = Crew(
    memory=True,
    embedder={
        "provider": "vertexai",
        "config": {
            "project_id": "your-project-id",
            "region": "your-region",
            "api_key": "your-api-key",
            "model_name": "textembedding-gecko"
        }
    }
)
```

## å®‰å…¨æœ€ä½³å®è·µ

### ç¯å¢ƒå˜é‡

```python
import os
from crewai import Crew

# å°†æ•æ„Ÿæ•°æ®å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
crew = Crew(
    memory=True,
    embedder={
        "provider": "openai",
        "config": {
            "api_key": os.getenv("OPENAI_API_KEY"),
            "model": "text-embedding-3-small"
        }
    }
)
```

### å­˜å‚¨å®‰å…¨æ€§

```python
import os
from crewai import Crew
from crewai.memory import LongTermMemory
from crewai.memory.storage.ltm_sqlite_storage import LTMSQLiteStorage

# ä½¿ç”¨å®‰å…¨å­˜å‚¨è·¯å¾„
storage_path = os.getenv("CREWAI_STORAGE_DIR", "./storage")
os.makedirs(storage_path, mode=0o700, exist_ok=True)  # é™åˆ¶æƒé™

crew = Crew(
    memory=True,
    long_term_memory=LongTermMemory(
        storage=LTMSQLiteStorage(
            db_path=f"{storage_path}/memory.db"
        )
    )
)
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**è®°å¿†åœ¨ä¼šè¯ä¹‹é—´ä¸æŒä¹…ï¼Ÿ**
*   æ£€æŸ¥ `CREWAI_STORAGE_DIR` ç¯å¢ƒå˜é‡ã€‚
*   ç¡®ä¿å­˜å‚¨ç›®å½•å…·æœ‰å†™å…¥æƒé™ã€‚
*   éªŒè¯æ˜¯å¦ä½¿ç”¨ `memory=True` å¯ç”¨äº†è®°å¿†ã€‚

**Mem0 è®¤è¯é”™è¯¯ï¼Ÿ**
*   éªŒè¯ `MEM0_API_KEY` ç¯å¢ƒå˜é‡æ˜¯å¦å·²è®¾ç½®ã€‚
*   åœ¨ Mem0 ä»ªè¡¨æ¿ä¸Šæ£€æŸ¥ API å¯†é’¥æƒé™ã€‚
*   ç¡®ä¿å·²å®‰è£… `mem0ai` åŒ…ã€‚

**å¤„ç†å¤§å‹æ•°æ®é›†æ—¶å†…å­˜å ç”¨è¿‡é«˜ï¼Ÿ**
*   è€ƒè™‘ä½¿ç”¨å¸¦æœ‰è‡ªå®šä¹‰å­˜å‚¨çš„å¤–éƒ¨è®°å¿†ã€‚
*   åœ¨è‡ªå®šä¹‰å­˜å‚¨æœç´¢æ–¹æ³•ä¸­å®ç°åˆ†é¡µã€‚
*   ä½¿ç”¨æ›´å°çš„åµŒå…¥æ¨¡å‹ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚

### æ€§èƒ½æç¤º

*   å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹ä½¿ç”¨ `memory=True`ï¼ˆæœ€ç®€å•ä¸”æœ€å¿«ï¼‰ã€‚
*   ä»…å½“ä½ éœ€è¦ç‰¹å®šäºç”¨æˆ·çš„æŒä¹…æ€§æ—¶æ‰ä½¿ç”¨ç”¨æˆ·è®°å¿†ã€‚
*   å¯¹äºå¤§è§„æ¨¡æˆ–ç‰¹æ®Šéœ€æ±‚ï¼Œè€ƒè™‘å¤–éƒ¨è®°å¿†ã€‚
*   é€‰æ‹©è¾ƒå°çš„åµŒå…¥æ¨¡å‹ä»¥åŠ å¿«å¤„ç†é€Ÿåº¦ã€‚
*   è®¾ç½®é€‚å½“çš„æœç´¢é™åˆ¶ä»¥æ§åˆ¶è®°å¿†æ£€ç´¢å¤§å°ã€‚

## ä½¿ç”¨ CrewAI è®°å¿†ç³»ç»Ÿçš„å¥½å¤„

*   ğŸ¦¾ **è‡ªé€‚åº”å­¦ä¹  (Adaptive Learning)**ï¼šCrew éšç€æ—¶é—´æ¨ç§»å˜å¾—æ›´åŠ é«˜æ•ˆï¼Œé€‚åº”æ–°ä¿¡æ¯å¹¶å®Œå–„å…¶å¤„ç†ä»»åŠ¡çš„æ–¹æ³•ã€‚
*   ğŸ«¡ **å¢å¼ºä¸ªæ€§åŒ– (Enhanced Personalization)**ï¼šè®°å¿†ä½¿ä»£ç†èƒ½å¤Ÿè®°ä½ç”¨æˆ·åå¥½å’Œå†å²äº¤äº’ï¼Œä»è€Œæä¾›ä¸ªæ€§åŒ–ä½“éªŒã€‚
*   ğŸ§  **æ”¹è¿›é—®é¢˜è§£å†³ (Improved Problem Solving)**ï¼šè®¿é—®ä¸°å¯Œçš„è®°å¿†å­˜å‚¨æœ‰åŠ©äºä»£ç†åšå‡ºæ›´æ˜æ™ºçš„å†³å®šï¼Œå€Ÿé‰´è¿‡å»çš„ç»éªŒå’Œä¸Šä¸‹æ–‡è§è§£ã€‚

## è®°å¿†äº‹ä»¶ (Memory Events)

CrewAI çš„äº‹ä»¶ç³»ç»Ÿä¸ºè®°å¿†æ“ä½œæä¾›äº†å¼ºå¤§çš„æ´å¯ŸåŠ›ã€‚é€šè¿‡åˆ©ç”¨è®°å¿†äº‹ä»¶ï¼Œä½ å¯ä»¥ç›‘æ§ã€è°ƒè¯•å¹¶ä¼˜åŒ–è®°å¿†ç³»ç»Ÿçš„æ€§èƒ½å’Œè¡Œä¸ºã€‚

### å¯ç”¨çš„è®°å¿†äº‹ä»¶

CrewAI å‘å‡ºä»¥ä¸‹ä¸è®°å¿†ç›¸å…³çš„äº‹ä»¶ï¼š

| äº‹ä»¶ | æè¿° | å…³é”®å±æ€§ |
| :--- | :--- | :--- |
| **MemoryQueryStartedEvent** | å½“è®°å¿†æŸ¥è¯¢å¼€å§‹æ—¶å‘å‡º | `query`, `limit`, `score_threshold` |
| **MemoryQueryCompletedEvent** | å½“è®°å¿†æŸ¥è¯¢æˆåŠŸå®Œæˆæ—¶å‘å‡º | `query`, `results`, `limit`, `score_threshold`, `query_time_ms` |
| **MemoryQueryFailedEvent** | å½“è®°å¿†æŸ¥è¯¢å¤±è´¥æ—¶å‘å‡º | `query`, `limit`, `score_threshold`, `error` |
| **MemorySaveStartedEvent** | å½“è®°å¿†ä¿å­˜æ“ä½œå¼€å§‹æ—¶å‘å‡º | `value`, `metadata`, `agent_role` |
| **MemorySaveCompletedEvent** | å½“è®°å¿†ä¿å­˜æ“ä½œæˆåŠŸå®Œæˆæ—¶å‘å‡º | `value`, `metadata`, `agent_role`, `save_time_ms` |
| **MemorySaveFailedEvent** | å½“è®°å¿†ä¿å­˜æ“ä½œå¤±è´¥æ—¶å‘å‡º | `value`, `metadata`, `agent_role`, `error` |
| **MemoryRetrievalStartedEvent** | å½“ä»»åŠ¡æç¤ºçš„è®°å¿†æ£€ç´¢å¼€å§‹æ—¶å‘å‡º | `task_id` |
| **MemoryRetrievalCompletedEvent** | å½“è®°å¿†æ£€ç´¢æˆåŠŸå®Œæˆæ—¶å‘å‡º | `task_id`, `memory_content`, `retrieval_time_ms` |

### å®é™…åº”ç”¨

#### 1. è®°å¿†æ€§èƒ½ç›‘æ§

è¿½è¸ªè®°å¿†æ“ä½œçš„æ—¶é—´ä»¥ä¼˜åŒ–ä½ çš„åº”ç”¨ç¨‹åºï¼š

```python
from crewai.events import (
    BaseEventListener,
    MemoryQueryCompletedEvent,
    MemorySaveCompletedEvent
)
import time

class MemoryPerformanceMonitor(BaseEventListener):
    def __init__(self):
        super().__init__()
        self.query_times = []
        self.save_times = []

    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(MemoryQueryCompletedEvent)
        def on_memory_query_completed(source, event: MemoryQueryCompletedEvent):
            self.query_times.append(event.query_time_ms)
            print(f"Memory query completed in {event.query_time_ms:.2f}ms. Query: '{event.query}'")
            print(f"Average query time: {sum(self.query_times)/len(self.query_times):.2f}ms")

        @crewai_event_bus.on(MemorySaveCompletedEvent)
        def on_memory_save_completed(source, event: MemorySaveCompletedEvent):
            self.save_times.append(event.save_time_ms)
            print(f"Memory save completed in {event.save_time_ms:.2f}ms")
            print(f"Average save time: {sum(self.save_times)/len(self.save_times):.2f}ms")

# åˆ›å»ºç›‘å¬å™¨å®ä¾‹
memory_monitor = MemoryPerformanceMonitor()
```

#### 2. è®°å¿†å†…å®¹æ—¥å¿—è®°å½•

è®°å½•è®°å¿†æ“ä½œä»¥è¿›è¡Œè°ƒè¯•å’Œæ´å¯Ÿï¼š

```python
from crewai.events import (
    BaseEventListener,
    MemorySaveStartedEvent,
    MemoryQueryStartedEvent,
    MemoryRetrievalCompletedEvent
)
import logging

# é…ç½®æ—¥å¿—
logger = logging.getLogger('memory_events')

class MemoryLogger(BaseEventListener):
    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(MemorySaveStartedEvent)
        def on_memory_save_started(source, event: MemorySaveStartedEvent):
            if event.agent_role:
                logger.info(f"Agent '{event.agent_role}' saving memory: {event.value[:50]}...")
            else:
                logger.info(f"Saving memory: {event.value[:50]}...")

        @crewai_event_bus.on(MemoryQueryStartedEvent)
        def on_memory_query_started(source, event: MemoryQueryStartedEvent):
            logger.info(f"Memory query started: '{event.query}' (limit: {event.limit})")

        @crewai_event_bus.on(MemoryRetrievalCompletedEvent)
        def on_memory_retrieval_completed(source, event: MemoryRetrievalCompletedEvent):
            if event.task_id:
                logger.info(f"Memory retrieved for task {event.task_id} in {event.retrieval_time_ms:.2f}ms")
            else:
                logger.info(f"Memory retrieved in {event.retrieval_time_ms:.2f}ms")
            logger.debug(f"Memory content: {event.memory_content}")

# åˆ›å»ºç›‘å¬å™¨å®ä¾‹
memory_logger = MemoryLogger()
```

#### 3. é”™è¯¯è¿½è¸ªå’Œé€šçŸ¥

æ•è·å¹¶å“åº”è®°å¿†é”™è¯¯ï¼š

```python
from crewai.events import (
    BaseEventListener,
    MemorySaveFailedEvent,
    MemoryQueryFailedEvent
)
import logging
from typing import Optional

# é…ç½®æ—¥å¿—
logger = logging.getLogger('memory_errors')

class MemoryErrorTracker(BaseEventListener):
    def __init__(self, notify_email: Optional[str] = None):
        super().__init__()
        self.notify_email = notify_email
        self.error_count = 0

    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(MemorySaveFailedEvent)
        def on_memory_save_failed(source, event: MemorySaveFailedEvent):
            self.error_count += 1
            agent_info = f"Agent '{event.agent_role}'" if event.agent_role else "Unknown agent"
            error_message = f"Memory save failed: {event.error}. {agent_info}"
            logger.error(error_message)

            if self.notify_email and self.error_count % 5 == 0:
                self._send_notification(error_message)

        @crewai_event_bus.on(MemoryQueryFailedEvent)
        def on_memory_query_failed(source, event: MemoryQueryFailedEvent):
            self.error_count += 1
            error_message = f"Memory query failed: {event.error}. Query: '{event.query}'"
            logger.error(error_message)

            if self.notify_email and self.error_count % 5 == 0:
                self._send_notification(error_message)

    def _send_notification(self, message):
        # å®ç°ä½ çš„é€šçŸ¥ç³»ç»Ÿï¼ˆç”µå­é‚®ä»¶ã€Slack ç­‰ï¼‰
        print(f"[NOTIFICATION] Would send to {self.notify_email}: {message}")

# åˆ›å»ºç›‘å¬å™¨å®ä¾‹
error_tracker = MemoryErrorTracker(notify_email="admin@example.com")
```

### ä¸åˆ†æå¹³å°é›†æˆ

è®°å¿†äº‹ä»¶å¯ä»¥è½¬å‘åˆ°åˆ†æå’Œç›‘æ§å¹³å°ï¼Œä»¥è¿½è¸ªæ€§èƒ½æŒ‡æ ‡ã€æ£€æµ‹å¼‚å¸¸å¹¶å¯è§†åŒ–è®°å¿†ä½¿ç”¨æ¨¡å¼ï¼š

```python
from crewai.events import (
    BaseEventListener,
    MemoryQueryCompletedEvent,
    MemorySaveCompletedEvent
)

class MemoryAnalyticsForwarder(BaseEventListener):
    def __init__(self, analytics_client):
        super().__init__()
        self.client = analytics_client

    def setup_listeners(self, crewai_event_bus):
        @crewai_event_bus.on(MemoryQueryCompletedEvent)
        def on_memory_query_completed(source, event: MemoryQueryCompletedEvent):
            # å°†æŸ¥è¯¢æŒ‡æ ‡è½¬å‘åˆ°åˆ†æå¹³å°
            self.client.track_metric({
                "event_type": "memory_query",
                "query": event.query,
                "duration_ms": event.query_time_ms,
                "result_count": len(event.results) if hasattr(event.results, "__len__") else 0,
                "timestamp": event.timestamp
            })

        @crewai_event_bus.on(MemorySaveCompletedEvent)
        def on_memory_save_completed(source, event: MemorySaveCompletedEvent):
            # å°†ä¿å­˜æŒ‡æ ‡è½¬å‘åˆ°åˆ†æå¹³å°
            self.client.track_metric({
                "event_type": "memory_save",
                "agent_role": event.agent_role,
                "duration_ms": event.save_time_ms,
                "timestamp": event.timestamp
            })
```

### è®°å¿†äº‹ä»¶ç›‘å¬å™¨çš„æœ€ä½³å®è·µ

1.  **ä¿æŒå¤„ç†ç¨‹åºè½»é‡çº§**ï¼šé¿å…åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¿›è¡Œå¤æ‚çš„å¤„ç†ï¼Œä»¥é˜²æ­¢å½±å“æ€§èƒ½ã€‚
2.  **ä½¿ç”¨é€‚å½“çš„æ—¥å¿—çº§åˆ«**ï¼šæ­£å¸¸æ“ä½œä½¿ç”¨ INFOï¼Œè¯¦ç»†ä¿¡æ¯ä½¿ç”¨ DEBUGï¼Œé—®é¢˜ä½¿ç”¨ ERRORã€‚
3.  **å°½å¯èƒ½æ‰¹é‡å¤„ç†æŒ‡æ ‡**ï¼šåœ¨å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿä¹‹å‰ç´¯ç§¯æŒ‡æ ‡ã€‚
4.  **ä¼˜é›…åœ°å¤„ç†å¼‚å¸¸**ï¼šç¡®ä¿ä½ çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸ä¼šå› æ„å¤–æ•°æ®è€Œå´©æºƒã€‚
5.  **è€ƒè™‘å†…å­˜æ¶ˆè€—**ï¼šæ³¨æ„ä¸è¦å­˜å‚¨å¤§é‡çš„äº‹ä»¶æ•°æ®ã€‚

## ç»“è®º (Conclusion)

å°† CrewAI çš„è®°å¿†ç³»ç»Ÿé›†æˆåˆ°ä½ çš„é¡¹ç›®ä¸­éå¸¸ç®€å•ã€‚é€šè¿‡åˆ©ç”¨æä¾›çš„è®°å¿†ç»„ä»¶å’Œé…ç½®ï¼Œ
ä½ å¯ä»¥å¿«é€Ÿèµ‹äºˆä»£ç†è®°å¿†ã€æ¨ç†å’Œä»äº¤äº’ä¸­å­¦ä¹ çš„èƒ½åŠ›ï¼Œä»è€Œè§£é”æ–°çš„æ™ºèƒ½å’Œèƒ½åŠ›æ°´å¹³ã€‚