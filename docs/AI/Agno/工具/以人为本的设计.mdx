---
title: 'ä»¥äººä¸ºæœ¬çš„è®¾è®¡'
description: 'å¦‚ä½•åœ¨Agnoå·¥å…·ä¸­å®ç°ä»¥äººä¸ºæœ¬çš„è®¾è®¡'
---

# ä»¥äººä¸ºæœ¬çš„è®¾è®¡

ä»¥äººä¸ºæœ¬çš„è®¾è®¡ï¼ˆHuman in the loopï¼ŒHITLï¼‰è®©æ‚¨å¯ä»¥åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨å‰æˆ–åè·å–ç”¨æˆ·è¾“å…¥ã€‚

ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‰ç½®é’©å­åœ¨æ‰§è¡Œå·¥å…·è°ƒç”¨å‰è·å–ç”¨æˆ·ç¡®è®¤ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨åç½®é’©å­ä¸­å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚

## ç¤ºä¾‹ï¼šä½¿ç”¨å‰ç½®é’©å­å®ç°ä»¥äººä¸ºæœ¬çš„è®¾è®¡

æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ï¼š

* ä¸ºå·¥å…·æ·»åŠ å‰ç½®é’©å­ä»¥è·å–ç”¨æˆ·ç¡®è®¤
* åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´å¤„ç†ç”¨æˆ·è¾“å…¥
* æ ¹æ®ç”¨æˆ·é€‰æ‹©ä¼˜é›…åœ°å–æ¶ˆæ“ä½œ

```python
"""ğŸ¤ ä»¥äººä¸ºæœ¬çš„è®¾è®¡ï¼šä¸ºå·¥å…·è°ƒç”¨æ·»åŠ ç”¨æˆ·ç¡®è®¤

æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨Agnoå·¥å…·ä¸­å®ç°ä»¥äººä¸ºæœ¬çš„åŠŸèƒ½ã€‚
å®ƒå±•ç¤ºäº†å¦‚ä½•ï¼š
- ä¸ºå·¥å…·æ·»åŠ å‰ç½®é’©å­ä»¥è·å–ç”¨æˆ·ç¡®è®¤
- åœ¨å·¥å…·æ‰§è¡ŒæœŸé—´å¤„ç†ç”¨æˆ·è¾“å…¥
- æ ¹æ®ç”¨æˆ·é€‰æ‹©ä¼˜é›…åœ°å–æ¶ˆæ“ä½œ

ä¸€äº›å®é™…åº”ç”¨ï¼š
- åœ¨æ‰§è¡Œæ•æ„Ÿæ“ä½œå‰è¿›è¡Œç¡®è®¤
- åœ¨è¿›è¡ŒAPIè°ƒç”¨å‰è¿›è¡Œå®¡æŸ¥
- éªŒè¯æ•°æ®è½¬æ¢
- åœ¨å…³é”®ç³»ç»Ÿä¸­æ‰¹å‡†è‡ªåŠ¨åŒ–æ“ä½œ

è¿è¡Œ `pip install openai httpx rich agno` å®‰è£…ä¾èµ–é¡¹ã€‚
"""

import json
from typing import Iterator

import httpx
from agno.agent import Agent
from agno.exceptions import StopAgentRun
from agno.models.openai import OpenAIChat
from agno.tools import FunctionCall, tool
from rich.console import Console
from rich.pretty import pprint
from rich.prompt import Prompt

# è¿™æ˜¯print_responseæ–¹æ³•ä½¿ç”¨çš„æ§åˆ¶å°å®ä¾‹
# æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åœæ­¢å’Œé‡æ–°å¯åŠ¨å®æ—¶æ˜¾ç¤ºï¼Œå¹¶è¯·æ±‚ç”¨æˆ·ç¡®è®¤
console = Console()


def pre_hook(fc: FunctionCall):
    # ä»æ§åˆ¶å°è·å–å®æ—¶æ˜¾ç¤ºå®ä¾‹
    live = console._live

    # æš‚æ—¶åœæ­¢å®æ—¶æ˜¾ç¤ºï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è¯·æ±‚ç”¨æˆ·ç¡®è®¤
    live.stop()  # type: ignore

    # è¯·æ±‚ç¡®è®¤
    console.print(f"\nå³å°†è¿è¡Œ [bold blue]{fc.function.name}[/]")
    message = (
        Prompt.ask("æ‚¨æƒ³ç»§ç»­å—ï¼Ÿ", choices=["y", "n"], default="y")
        .strip()
        .lower()
    )

    # é‡æ–°å¯åŠ¨å®æ—¶æ˜¾ç¤º
    live.start()  # type: ignore

    # å¦‚æœç”¨æˆ·ä¸æƒ³ç»§ç»­ï¼ŒæŠ›å‡ºStopExecutionå¼‚å¸¸
    if message != "y":
        raise StopAgentRun(
            "ç”¨æˆ·å–æ¶ˆäº†å·¥å…·è°ƒç”¨",
            agent_message="ç”±äºæœªè·å¾—è®¸å¯ï¼Œåœæ­¢æ‰§è¡Œã€‚",
        )


@tool(pre_hook=pre_hook)
def get_top_hackernews_stories(num_stories: int) -> Iterator[str]:
    """åœ¨ç”¨æˆ·ç¡®è®¤åä»Hacker Newsè·å–çƒ­é—¨æ•…äº‹ã€‚

    Args:
        num_stories (int): è¦æ£€ç´¢çš„æ•…äº‹æ•°é‡

    Returns:
        str: åŒ…å«æ•…äº‹è¯¦æƒ…çš„JSONå­—ç¬¦ä¸²
    """
    # è·å–çƒ­é—¨æ•…äº‹ID
    response = httpx.get("https://hacker-news.firebaseio.com/v0/topstories.json")
    story_ids = response.json()

    # ç”Ÿæˆæ•…äº‹è¯¦æƒ…
    for story_id in story_ids[:num_stories]:
        story_response = httpx.get(
            f"https://hacker-news.firebaseio.com/v0/item/{story_id}.json"
        )
        story = story_response.json()
        if "text" in story:
            story.pop("text", None)
        yield json.dumps(story)


# åˆå§‹åŒ–å…·æœ‰æŠ€æœ¯æ•æ„Ÿæ€§æ ¼å’Œæ˜ç¡®æŒ‡ä»¤çš„ä»£ç†
agent = Agent(
    model=OpenAIChat(id="gpt-4o-mini"),
    tools=[get_top_hackernews_stories],
    markdown=True,
)

agent.print_response(
    "è·å–å‰2ä¸ªhackernewsçƒ­é—¨æ•…äº‹ï¼Ÿ", stream=True, console=console
)
```
