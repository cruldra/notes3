<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-SoftwareEngineering/OAuth 2.0 第三方登录技术原理" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">OAuth 2.0 第三方登录技术原理 | Cruldra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/notes3/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/notes3/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="OAuth 2.0 第三方登录技术原理 | Cruldra"><meta data-rh="true" name="description" content="概述"><meta data-rh="true" property="og:description" content="概述"><link data-rh="true" rel="icon" href="/notes3/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/notes3/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/notes3/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"OAuth 2.0 第三方登录技术原理","item":"https://your-docusaurus-site.example.com/notes3/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理"}]}</script><link rel="alternate" type="application/rss+xml" href="/notes3/blog/rss.xml" title="Cruldra RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/notes3/blog/atom.xml" title="Cruldra Atom Feed"><link rel="stylesheet" href="/notes3/assets/css/styles.8c4657fb.css">
<script src="/notes3/assets/js/runtime~main.92689785.js" defer="defer"></script>
<script src="/notes3/assets/js/main.a3b21eab.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme",window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-theme-choice","system"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/notes3/img/logo.svg"><style data-mantine-styles="classes">@media (max-width: 35.99375em) {.mantine-visible-from-xs {display: none !important;}}@media (min-width: 36em) {.mantine-hidden-from-xs {display: none !important;}}@media (max-width: 47.99375em) {.mantine-visible-from-sm {display: none !important;}}@media (min-width: 48em) {.mantine-hidden-from-sm {display: none !important;}}@media (max-width: 61.99375em) {.mantine-visible-from-md {display: none !important;}}@media (min-width: 62em) {.mantine-hidden-from-md {display: none !important;}}@media (max-width: 74.99375em) {.mantine-visible-from-lg {display: none !important;}}@media (min-width: 75em) {.mantine-hidden-from-lg {display: none !important;}}@media (max-width: 87.99375em) {.mantine-visible-from-xl {display: none !important;}}@media (min-width: 88em) {.mantine-hidden-from-xl {display: none !important;}}</style><div role="region" aria-label="Skip to main content"><a class="skipToContent_aA1M" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes3/"><div class="navbar__logo"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--light_DVqC"><img src="/notes3/img/logo.svg" alt="My Site Logo" class="themedComponent_E3Xm themedComponent--dark_B_L3"></div><b class="navbar__title text--truncate">Cruldra</b></a><a class="navbar__item navbar__link" href="/notes3/docs/category/设计模式">JVM</a><a class="navbar__item navbar__link" href="/notes3/docs/category/css">前端</a><a class="navbar__item navbar__link" href="/notes3/docs/category/astrbot">工具</a><a class="navbar__item navbar__link" href="/notes3/docs/category/ai电竞酒店">个人</a><a class="navbar__item navbar__link" href="/notes3/docs/AI/Agno/介绍">AI</a><a class="navbar__item navbar__link" href="/notes3/docs/category/内置模块">Python</a><a class="navbar__item navbar__link" href="/notes3/docs/category/actix-web">Rust</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes3/docs/category/数据库系统">软件工程</a><a class="navbar__item navbar__link" href="/notes3/docs/category/上古卷轴5">游戏</a><a class="navbar__item navbar__link" href="/notes3/docs/Go/Go-Python-Java三语言全方位对比">Go</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_PufJ"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ctfR"><div class="docsWrapper_ByIB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KwvU" type="button"></button><div class="docRoot_hD6z"><aside class="theme-doc-sidebar-container docSidebarContainer_KuHC"><div class="sidebarViewport_LCjr"><div class="sidebar_L77d"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_VYAF"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/category/数据库系统"><span title="数据库系统" class="categoryLinkLabel_FHN4">数据库系统</span></a><button aria-label="Expand sidebar category &#x27;数据库系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist" href="/notes3/docs/category/软件测试"><span title="软件测试" class="categoryLinkLabel_FHN4">软件测试</span></a><button aria-label="Expand sidebar category &#x27;软件测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/8种流行网络协议详解"><span title="8种流行网络协议详解" class="linkLabel__RqX">8种流行网络协议详解</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/AI时代的程序员：当“技术壁垒”消失，我们靠什么生存？"><span title="AI时代的程序员：当“技术壁垒”消失，我们靠什么生存？" class="linkLabel__RqX">AI时代的程序员：当“技术壁垒”消失，我们靠什么生存？</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/HTTPS是如何工作的"><span title="HTTPS是如何工作的" class="linkLabel__RqX">HTTPS是如何工作的</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/IaaS、PaaS和SaaS"><span title="IaaS、PaaS和SaaS" class="linkLabel__RqX">IaaS、PaaS和SaaS</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/MVP"><span title="MVP" class="linkLabel__RqX">MVP</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/notes3/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理"><span title="OAuth 2.0 第三方登录技术原理" class="linkLabel__RqX">OAuth 2.0 第三方登录技术原理</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/PR审查"><span title="PR审查" class="linkLabel__RqX">PR审查</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/RESTful API详解"><span title="RESTful API详解" class="linkLabel__RqX">RESTful API详解</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_NhDl menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/notes3/docs/SoftwareEngineering/数据结构/有向图"><span title="数据结构" class="categoryLinkLabel_FHN4">数据结构</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes3/docs/SoftwareEngineering/语义化版本"><span title="语义化版本" class="linkLabel__RqX">语义化版本</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_WxcZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Zd2x"><div class="docItemContainer_EEW4"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_xL_w" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes3/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_zA1U"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">OAuth 2.0 第三方登录技术原理</span></li></ul></nav><div class="tocCollapsible_aZGz theme-doc-toc-mobile tocMobile_ShCt"><button type="button" class="clean-btn tocCollapsibleButton_fxzH">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>OAuth 2.0 第三方登录技术原理</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="概述">概述<a href="#概述" class="hash-link" aria-label="Direct link to 概述" title="Direct link to 概述" translate="no">​</a></h2>
<p>OAuth 2.0 是一个<strong>行业标准的授权框架</strong>,被广泛应用于各种第三方登录场景。无论是 GitHub、Google、QQ、微信、支付宝、微博等平台,都采用 OAuth 2.0 协议来实现第三方登录功能。</p>
<p><strong>OAuth 2.0 授权码流程(Authorization Code Flow)</strong> 是最常用的授权方式,它允许第三方应用在用户授权的情况下访问用户在各个平台上的资源,而无需获取用户的密码。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="核心概念">核心概念<a href="#核心概念" class="hash-link" aria-label="Direct link to 核心概念" title="Direct link to 核心概念" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="什么是-oauth-20">什么是 OAuth 2.0?<a href="#什么是-oauth-20" class="hash-link" aria-label="Direct link to 什么是 OAuth 2.0?" title="Direct link to 什么是 OAuth 2.0?" translate="no">​</a></h3>
<p>OAuth 2.0 是一个授权框架,它定义了授权协议和工作流程。主要解决的问题是:</p>
<ul>
<li class=""><strong>用户</strong>不需要将密码提供给第三方应用</li>
<li class=""><strong>第三方应用</strong>可以在用户授权下访问用户的资源</li>
<li class=""><strong>资源服务器</strong>(如 GitHub、Google、QQ 等)可以控制第三方应用的访问权限</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="oauth-20-中的角色">OAuth 2.0 中的角色<a href="#oauth-20-中的角色" class="hash-link" aria-label="Direct link to OAuth 2.0 中的角色" title="Direct link to OAuth 2.0 中的角色" translate="no">​</a></h3>
<ol>
<li class=""><strong>Resource Owner(资源所有者)</strong>: 用户本人</li>
<li class=""><strong>Client(客户端)</strong>: 第三方应用(你的网站)</li>
<li class=""><strong>Authorization Server(授权服务器)</strong>: 各平台的授权服务器(如 GitHub、Google、QQ 等)</li>
<li class=""><strong>Resource Server(资源服务器)</strong>: 各平台的 API 服务器</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="oauth-20-授权码流程详解">OAuth 2.0 授权码流程详解<a href="#oauth-20-授权码流程详解" class="hash-link" aria-label="Direct link to OAuth 2.0 授权码流程详解" title="Direct link to OAuth 2.0 授权码流程详解" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="流程图">流程图<a href="#流程图" class="hash-link" aria-label="Direct link to 流程图" title="Direct link to 流程图" translate="no">​</a></h3>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="详细步骤说明">详细步骤说明<a href="#详细步骤说明" class="hash-link" aria-label="Direct link to 详细步骤说明" title="Direct link to 详细步骤说明" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-1-用户发起登录请求">步骤 1: 用户发起登录请求<a href="#步骤-1-用户发起登录请求" class="hash-link" aria-label="Direct link to 步骤 1: 用户发起登录请求" title="Direct link to 步骤 1: 用户发起登录请求" translate="no">​</a></h4>
<p>用户在第三方应用上点击&quot;使用 XX 登录&quot;按钮(如&quot;使用 GitHub 登录&quot;、&quot;使用 Google 登录&quot;等)。</p>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-2-重定向到授权页面">步骤 2: 重定向到授权页面<a href="#步骤-2-重定向到授权页面" class="hash-link" aria-label="Direct link to 步骤 2: 重定向到授权页面" title="Direct link to 步骤 2: 重定向到授权页面" translate="no">​</a></h4>
<p>应用将用户重定向到 OAuth 提供商的授权端点。不同平台的授权 URL 不同:</p>
<p><strong>GitHub 示例:</strong></p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/login/oauth/authorize?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id=YOUR_CLIENT_ID&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  redirect_uri=https://yourapp.com/callback&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scope=user:email&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  state=RANDOM_STRING</span><br></span></code></pre></div></div>
<p><strong>Google 示例:</strong></p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">https://accounts.google.com/o/oauth2/v2/auth?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id=YOUR_CLIENT_ID&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  redirect_uri=https://yourapp.com/callback&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scope=openid%20email%20profile&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response_type=code&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  state=RANDOM_STRING</span><br></span></code></pre></div></div>
<p><strong>QQ 示例:</strong></p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">https://graph.qq.com/oauth2.0/authorize?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_id=YOUR_APP_ID&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  redirect_uri=https://yourapp.com/callback&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scope=get_user_info&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  response_type=code&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  state=RANDOM_STRING</span><br></span></code></pre></div></div>
<p><strong>参数说明:</strong></p>
<ul>
<li class=""><code>client_id</code>: 在平台注册应用时获得的客户端 ID(QQ 称为 APP_ID)</li>
<li class=""><code>redirect_uri</code>: 授权后的回调地址(必须与注册时填写的一致)</li>
<li class=""><code>scope</code>: 请求的权限范围(不同平台的 scope 定义不同)</li>
<li class=""><code>state</code>: 随机字符串,用于防止 CSRF 攻击</li>
<li class=""><code>response_type</code>: 响应类型,授权码流程固定为 <code>code</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-3-用户授权">步骤 3: 用户授权<a href="#步骤-3-用户授权" class="hash-link" aria-label="Direct link to 步骤 3: 用户授权" title="Direct link to 步骤 3: 用户授权" translate="no">​</a></h4>
<p>OAuth 提供商显示授权页面,询问用户是否允许该应用访问其信息。用户点击&quot;授权&quot;按钮。</p>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-4-回调应用">步骤 4: 回调应用<a href="#步骤-4-回调应用" class="hash-link" aria-label="Direct link to 步骤 4: 回调应用" title="Direct link to 步骤 4: 回调应用" translate="no">​</a></h4>
<p>OAuth 提供商将用户重定向回应用的回调地址,并携带授权码:</p>
<div class="language-text codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-text codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">https://yourapp.com/callback?code=AUTHORIZATION_CODE&amp;state=RANDOM_STRING</span><br></span></code></pre></div></div>
<p>应用需要验证 <code>state</code> 参数是否与之前发送的一致,以防止 CSRF 攻击。</p>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-5-交换访问令牌">步骤 5: 交换访问令牌<a href="#步骤-5-交换访问令牌" class="hash-link" aria-label="Direct link to 步骤 5: 交换访问令牌" title="Direct link to 步骤 5: 交换访问令牌" translate="no">​</a></h4>
<p>应用使用授权码向 OAuth 提供商请求访问令牌。</p>
<p><strong>GitHub 示例:</strong></p>
<div class="language-http codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-http codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">POST https://github.com/login/oauth/access_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;client_id&quot;: &quot;YOUR_CLIENT_ID&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;client_secret&quot;: &quot;YOUR_CLIENT_SECRET&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;code&quot;: &quot;AUTHORIZATION_CODE&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;redirect_uri&quot;: &quot;https://yourapp.com/callback&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Google 示例:</strong></p>
<div class="language-http codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-http codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">POST https://oauth2.googleapis.com/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_id=YOUR_CLIENT_ID&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_secret=YOUR_CLIENT_SECRET&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code=AUTHORIZATION_CODE&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redirect_uri=https://yourapp.com/callback&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grant_type=authorization_code</span><br></span></code></pre></div></div>
<p>返回访问令牌:</p>
<div class="language-json codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-json codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;access_token&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ya29.a0AfH6SMBx...&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;token_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bearer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;expires_in&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3600</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;scope&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;openid email profile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-6-使用访问令牌获取用户信息">步骤 6: 使用访问令牌获取用户信息<a href="#步骤-6-使用访问令牌获取用户信息" class="hash-link" aria-label="Direct link to 步骤 6: 使用访问令牌获取用户信息" title="Direct link to 步骤 6: 使用访问令牌获取用户信息" translate="no">​</a></h4>
<p>应用使用访问令牌调用 API 获取用户信息。</p>
<p><strong>GitHub 示例:</strong></p>
<div class="language-http codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-http codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">GET https://api.github.com/user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Bearer gho_16C7e42F292c6912E7710c838347Ae178B4a</span><br></span></code></pre></div></div>
<p><strong>Google 示例:</strong></p>
<div class="language-http codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-http codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">GET https://www.googleapis.com/oauth2/v2/userinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authorization: Bearer ya29.a0AfH6SMBx...</span><br></span></code></pre></div></div>
<p><strong>QQ 示例:</strong></p>
<div class="language-http codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-http codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">GET https://graph.qq.com/user/get_user_info?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  access_token=YOUR_ACCESS_TOKEN&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oauth_consumer_key=YOUR_APP_ID&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  openid=USER_OPENID</span><br></span></code></pre></div></div>
<p>返回用户信息(不同平台格式不同):</p>
<div class="language-json codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-json codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;张三&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;email&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;zhangsan@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;avatar&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://example.com/avatar.jpg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_aDle" id="步骤-7-创建本地会话">步骤 7: 创建本地会话<a href="#步骤-7-创建本地会话" class="hash-link" aria-label="Direct link to 步骤 7: 创建本地会话" title="Direct link to 步骤 7: 创建本地会话" translate="no">​</a></h4>
<p>应用根据获取的用户信息创建本地用户会话,完成登录流程。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="安全机制">安全机制<a href="#安全机制" class="hash-link" aria-label="Direct link to 安全机制" title="Direct link to 安全机制" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="1-state-参数防-csrf">1. State 参数(防 CSRF)<a href="#1-state-参数防-csrf" class="hash-link" aria-label="Direct link to 1. State 参数(防 CSRF)" title="Direct link to 1. State 参数(防 CSRF)" translate="no">​</a></h3>
<p><code>state</code> 参数是一个随机字符串,用于防止跨站请求伪造(CSRF)攻击:</p>
<ul>
<li class="">应用在发起授权请求时生成随机 state</li>
<li class="">OAuth 提供商在回调时原样返回 state</li>
<li class="">应用验证返回的 state 是否与发送的一致</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="2-client-secret客户端密钥">2. Client Secret(客户端密钥)<a href="#2-client-secret客户端密钥" class="hash-link" aria-label="Direct link to 2. Client Secret(客户端密钥)" title="Direct link to 2. Client Secret(客户端密钥)" translate="no">​</a></h3>
<p><code>client_secret</code> 只在服务器端使用,永远不应该暴露给客户端(浏览器),确保只有合法的应用服务器才能交换访问令牌。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="3-https">3. HTTPS<a href="#3-https" class="hash-link" aria-label="Direct link to 3. HTTPS" title="Direct link to 3. HTTPS" translate="no">​</a></h3>
<p>整个流程必须使用 HTTPS,确保数据传输的安全性。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="4-短期授权码">4. 短期授权码<a href="#4-短期授权码" class="hash-link" aria-label="Direct link to 4. 短期授权码" title="Direct link to 4. 短期授权码" translate="no">​</a></h3>
<p>授权码(code)有效期很短(通常 10 分钟),且只能使用一次,降低被窃取的风险。</p>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="5-访问令牌的作用域">5. 访问令牌的作用域<a href="#5-访问令牌的作用域" class="hash-link" aria-label="Direct link to 5. 访问令牌的作用域" title="Direct link to 5. 访问令牌的作用域" translate="no">​</a></h3>
<p>通过 <code>scope</code> 参数限制应用的访问权限,遵循最小权限原则。</p>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="常见平台的-oauth-配置">常见平台的 OAuth 配置<a href="#常见平台的-oauth-配置" class="hash-link" aria-label="Direct link to 常见平台的 OAuth 配置" title="Direct link to 常见平台的 OAuth 配置" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="github">GitHub<a href="#github" class="hash-link" aria-label="Direct link to GitHub" title="Direct link to GitHub" translate="no">​</a></h3>
<ul>
<li class=""><strong>授权端点</strong>: <code>https://github.com/login/oauth/authorize</code></li>
<li class=""><strong>令牌端点</strong>: <code>https://github.com/login/oauth/access_token</code></li>
<li class=""><strong>用户信息</strong>: <code>https://api.github.com/user</code></li>
<li class=""><strong>常用 Scope</strong>: <code>user</code>, <code>user:email</code>, <code>repo</code>, <code>read:org</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="google">Google<a href="#google" class="hash-link" aria-label="Direct link to Google" title="Direct link to Google" translate="no">​</a></h3>
<ul>
<li class=""><strong>授权端点</strong>: <code>https://accounts.google.com/o/oauth2/v2/auth</code></li>
<li class=""><strong>令牌端点</strong>: <code>https://oauth2.googleapis.com/token</code></li>
<li class=""><strong>用户信息</strong>: <code>https://www.googleapis.com/oauth2/v2/userinfo</code></li>
<li class=""><strong>常用 Scope</strong>: <code>openid</code>, <code>email</code>, <code>profile</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="qq">QQ<a href="#qq" class="hash-link" aria-label="Direct link to QQ" title="Direct link to QQ" translate="no">​</a></h3>
<ul>
<li class=""><strong>授权端点</strong>: <code>https://graph.qq.com/oauth2.0/authorize</code></li>
<li class=""><strong>令牌端点</strong>: <code>https://graph.qq.com/oauth2.0/token</code></li>
<li class=""><strong>用户信息</strong>: <code>https://graph.qq.com/user/get_user_info</code></li>
<li class=""><strong>常用 Scope</strong>: <code>get_user_info</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="微信">微信<a href="#微信" class="hash-link" aria-label="Direct link to 微信" title="Direct link to 微信" translate="no">​</a></h3>
<ul>
<li class=""><strong>授权端点</strong>: <code>https://open.weixin.qq.com/connect/qrconnect</code></li>
<li class=""><strong>令牌端点</strong>: <code>https://api.weixin.qq.com/sns/oauth2/access_token</code></li>
<li class=""><strong>用户信息</strong>: <code>https://api.weixin.qq.com/sns/userinfo</code></li>
<li class=""><strong>常用 Scope</strong>: <code>snsapi_login</code>, <code>snsapi_userinfo</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="支付宝">支付宝<a href="#支付宝" class="hash-link" aria-label="Direct link to 支付宝" title="Direct link to 支付宝" translate="no">​</a></h3>
<ul>
<li class=""><strong>授权端点</strong>: <code>https://openauth.alipay.com/oauth2/publicAppAuthorize.htm</code></li>
<li class=""><strong>令牌端点</strong>: <code>https://openapi.alipay.com/gateway.do</code></li>
<li class=""><strong>用户信息</strong>: 通过 <code>alipay.user.info.share</code> 接口获取</li>
<li class=""><strong>常用 Scope</strong>: <code>auth_user</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="优势">优势<a href="#优势" class="hash-link" aria-label="Direct link to 优势" title="Direct link to 优势" translate="no">​</a></h2>
<ol>
<li class=""><strong>安全性高</strong>: 用户密码不会泄露给第三方应用</li>
<li class=""><strong>用户体验好</strong>: 用户无需重复注册,一键登录</li>
<li class=""><strong>权限可控</strong>: 用户可以随时撤销授权</li>
<li class=""><strong>标准化</strong>: OAuth 2.0 是行业标准,被广泛支持</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="注意事项">注意事项<a href="#注意事项" class="hash-link" aria-label="Direct link to 注意事项" title="Direct link to 注意事项" translate="no">​</a></h2>
<ol>
<li class=""><strong>回调地址必须匹配</strong>: redirect_uri 必须与在平台注册时填写的完全一致</li>
<li class=""><strong>保护 Client Secret</strong>: 绝不能在前端代码中暴露</li>
<li class=""><strong>验证 State</strong>: 必须验证 state 参数防止 CSRF 攻击</li>
<li class=""><strong>令牌存储</strong>: 访问令牌应安全存储,不要暴露给客户端</li>
<li class=""><strong>令牌刷新</strong>: 访问令牌可能会过期,需要实现刷新机制</li>
<li class=""><strong>平台差异</strong>: 不同平台的 OAuth 实现细节可能有差异,需要查阅各平台的官方文档</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="python-实现示例flask">Python 实现示例(Flask)<a href="#python-实现示例flask" class="hash-link" aria-label="Direct link to Python 实现示例(Flask)" title="Direct link to Python 实现示例(Flask)" translate="no">​</a></h2>
<p>以下是使用 Flask 实现 GitHub OAuth 登录的完整示例代码:</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">OAuth 2.0 第三方登录示例 - 以 GitHub 为例</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">其他平台(Google、QQ、微信等)的实现流程类似,只需修改相应的 URL 和参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> secrets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> flask </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Flask</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jsonify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Flask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">secret_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;FLASK_SECRET_KEY&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> secrets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">token_hex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># OAuth 配置(以 GitHub 为例)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OAUTH_CONFIG </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;GITHUB_CLIENT_ID&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;GITHUB_CLIENT_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;authorize_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://github.com/login/oauth/authorize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;token_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://github.com/login/oauth/access_token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;user_info_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://api.github.com/user&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:5000/callback&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;scope&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user:email&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;首页&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">        &lt;h1&gt;欢迎, </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">user</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">!&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">        &lt;img src=&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">user</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;avatar_url&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot; width=&quot;100&quot; /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">        &lt;p&gt;用户名: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">user</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;login&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">        &lt;p&gt;邮箱: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">user</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;email&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">,</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;未公开&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">        &lt;a href=&quot;/logout&quot;&gt;退出登录&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string-interpolation string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;h1&gt;OAuth 2.0 登录示例&lt;/h1&gt;&lt;a href=&quot;/login&quot;&gt;使用 GitHub 登录&lt;/a&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/login&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">login</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;步骤 1-2: 重定向到 OAuth 授权页面&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 生成随机 state 防止 CSRF 攻击</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> secrets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">token_urlsafe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;oauth_state&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 构建授权 URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;scope&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;scope&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;state&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth_url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">OAUTH_CONFIG</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;authorize_url&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">?</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation string" style="color:#e3116c">&#x27;&amp;&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">join</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">[</span><span class="token string-interpolation interpolation string-interpolation string" style="color:#e3116c">f&#x27;</span><span class="token string-interpolation interpolation string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation string-interpolation interpolation">k</span><span class="token string-interpolation interpolation string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation interpolation string-interpolation string" style="color:#e3116c">=</span><span class="token string-interpolation interpolation string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation string-interpolation interpolation">v</span><span class="token string-interpolation interpolation string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation interpolation string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:#00009f">for</span><span class="token string-interpolation interpolation"> k</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">,</span><span class="token string-interpolation interpolation"> v </span><span class="token string-interpolation interpolation keyword" style="color:#00009f">in</span><span class="token string-interpolation interpolation"> params</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">items</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">(</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">]</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">)</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">auth_url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/callback&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;步骤 4-7: 处理回调,交换令牌,获取用户信息&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 获取回调参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;code&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;state&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 验证 state 参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> state </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;oauth_state&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;State 验证失败&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;oauth_state&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;缺少授权码&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 步骤 5: 交换访问令牌</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;code&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token_response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;token_url&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">token_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;Accept&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;application/json&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> token_response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;获取令牌失败: </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">token_response</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">text</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> token_response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;access_token&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> access_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;获取令牌失败&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 步骤 6: 获取用户信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requests</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OAUTH_CONFIG</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;user_info_url&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headers</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;Authorization&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:#e3116c">f&#x27;Bearer </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">access_token</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> user_response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;获取用户信息失败&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> user_response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 步骤 7: 创建会话</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;user&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;login&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;login&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;login&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;email&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;email&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;avatar_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;avatar_url&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/logout&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">logout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;退出登录&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;__main__&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">debug</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5000</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="使用说明">使用说明<a href="#使用说明" class="hash-link" aria-label="Direct link to 使用说明" title="Direct link to 使用说明" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>注册 OAuth 应用</strong></p>
<ul>
<li class="">GitHub: <a href="https://github.com/settings/developers" target="_blank" rel="noopener noreferrer" class="">https://github.com/settings/developers</a></li>
<li class="">Google: <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer" class="">https://console.cloud.google.com/</a></li>
<li class="">QQ: <a href="https://connect.qq.com/" target="_blank" rel="noopener noreferrer" class="">https://connect.qq.com/</a></li>
</ul>
</li>
<li class="">
<p><strong>设置环境变量</strong></p>
<div class="language-bash codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-bash codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">export GITHUB_CLIENT_ID=your_client_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export GITHUB_CLIENT_SECRET=your_client_secret</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>安装依赖</strong></p>
<div class="language-bash codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-bash codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">pip install flask requests</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>运行应用</strong></p>
<div class="language-bash codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-bash codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token plain">python app.py</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_aDle" id="适配其他平台">适配其他平台<a href="#适配其他平台" class="hash-link" aria-label="Direct link to 适配其他平台" title="Direct link to 适配其他平台" translate="no">​</a></h3>
<p>要适配其他 OAuth 提供商,只需修改 <code>OAUTH_CONFIG</code> 中的 URL 和参数:</p>
<div class="language-python codeBlockContainer_FVab theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_oMSL"><pre tabindex="0" class="prism-code language-python codeBlock_MTmK thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_KEkQ"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Google 配置示例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OAUTH_CONFIG </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;GOOGLE_CLIENT_ID&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;GOOGLE_CLIENT_SECRET&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;authorize_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://accounts.google.com/o/oauth2/v2/auth&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;token_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://oauth2.googleapis.com/token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;user_info_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://www.googleapis.com/oauth2/v2/userinfo&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:5000/callback&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;scope&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;openid email profile&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># QQ 配置示例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OAUTH_CONFIG </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;QQ_APP_ID&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getenv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;QQ_APP_KEY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;authorize_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://graph.qq.com/oauth2.0/authorize&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;token_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://graph.qq.com/oauth2.0/token&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;user_info_url&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://graph.qq.com/user/get_user_info&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;redirect_uri&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:5000/callback&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;scope&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;get_user_info&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_aDle" id="参考资料">参考资料<a href="#参考资料" class="hash-link" aria-label="Direct link to 参考资料" title="Direct link to 参考资料" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer" class="">OAuth 2.0 RFC 6749</a></li>
<li class=""><a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow" target="_blank" rel="noopener noreferrer" class="">OAuth 2.0 授权码流程</a></li>
<li class=""><a href="https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps" target="_blank" rel="noopener noreferrer" class="">GitHub OAuth Apps 官方文档</a></li>
<li class=""><a href="https://developers.google.com/identity/protocols/oauth2" target="_blank" rel="noopener noreferrer" class="">Google OAuth 2.0 文档</a></li>
<li class=""><a href="https://wiki.connect.qq.com/" target="_blank" rel="noopener noreferrer" class="">QQ 互联文档</a></li>
<li class=""><a href="https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html" target="_blank" rel="noopener noreferrer" class="">微信开放平台文档</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_iDCr"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/SoftwareEngineering/OAuth 2.0 第三方登录技术原理.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_c0mv" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mxtt"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes3/docs/SoftwareEngineering/MVP"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MVP</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes3/docs/SoftwareEngineering/PR审查"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PR审查</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_r83r thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#核心概念" class="table-of-contents__link toc-highlight">核心概念</a><ul><li><a href="#什么是-oauth-20" class="table-of-contents__link toc-highlight">什么是 OAuth 2.0?</a></li><li><a href="#oauth-20-中的角色" class="table-of-contents__link toc-highlight">OAuth 2.0 中的角色</a></li></ul></li><li><a href="#oauth-20-授权码流程详解" class="table-of-contents__link toc-highlight">OAuth 2.0 授权码流程详解</a><ul><li><a href="#流程图" class="table-of-contents__link toc-highlight">流程图</a></li><li><a href="#详细步骤说明" class="table-of-contents__link toc-highlight">详细步骤说明</a></li></ul></li><li><a href="#安全机制" class="table-of-contents__link toc-highlight">安全机制</a><ul><li><a href="#1-state-参数防-csrf" class="table-of-contents__link toc-highlight">1. State 参数(防 CSRF)</a></li><li><a href="#2-client-secret客户端密钥" class="table-of-contents__link toc-highlight">2. Client Secret(客户端密钥)</a></li><li><a href="#3-https" class="table-of-contents__link toc-highlight">3. HTTPS</a></li><li><a href="#4-短期授权码" class="table-of-contents__link toc-highlight">4. 短期授权码</a></li><li><a href="#5-访问令牌的作用域" class="table-of-contents__link toc-highlight">5. 访问令牌的作用域</a></li></ul></li><li><a href="#常见平台的-oauth-配置" class="table-of-contents__link toc-highlight">常见平台的 OAuth 配置</a><ul><li><a href="#github" class="table-of-contents__link toc-highlight">GitHub</a></li><li><a href="#google" class="table-of-contents__link toc-highlight">Google</a></li><li><a href="#qq" class="table-of-contents__link toc-highlight">QQ</a></li><li><a href="#微信" class="table-of-contents__link toc-highlight">微信</a></li><li><a href="#支付宝" class="table-of-contents__link toc-highlight">支付宝</a></li></ul></li><li><a href="#优势" class="table-of-contents__link toc-highlight">优势</a></li><li><a href="#注意事项" class="table-of-contents__link toc-highlight">注意事项</a></li><li><a href="#python-实现示例flask" class="table-of-contents__link toc-highlight">Python 实现示例(Flask)</a><ul><li><a href="#使用说明" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#适配其他平台" class="table-of-contents__link toc-highlight">适配其他平台</a></li></ul></li><li><a href="#参考资料" class="table-of-contents__link toc-highlight">参考资料</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/notes3/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_rhIP"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>