Mockï¼ˆæ¨¡æ‹Ÿï¼‰æ˜¯è½¯ä»¶æµ‹è¯•ä¸­çš„ä¸€ç§æŠ€æœ¯ï¼Œå®ƒåˆ›å»ºä¸€ä¸ª**è™šå‡ä½†å¯æ§çš„æ›¿ä»£å“**æ¥ä»£æ›¿çœŸå®çš„ä¾èµ–é¡¹ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨å‡çš„ä¸œè¥¿æ›¿æ¢çœŸçš„ä¸œè¥¿ï¼Œè®©æµ‹è¯•æ›´åŠ å¯æ§å’Œå¯é ã€‚

```typescript
// çœŸå®çš„ API è°ƒç”¨
const users = await fetch('/api/users').then(res => res.json())

// Mock çš„ API è°ƒç”¨
const mockFetch = vi.fn().mockResolvedValue({
  json: () => Promise.resolve([{ id: 1, name: 'Alice' }])
})
```

## ä¸ºä»€ä¹ˆéœ€è¦ Mockï¼Ÿ

### ğŸš« ä¸ç”¨ Mock çš„ç—›ç‚¹

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå®é™…åœºæ™¯ï¼š

```typescript
// UserProfile.tsx - æ²¡æœ‰ Mock çš„å™©æ¢¦
function UserProfile({ userId }: { userId: string }) {
  const [user, setUser] = useState(null)
  const [posts, setPosts] = useState([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState(null)
  
  useEffect(() => {
    Promise.all([
      fetch(`/api/users/${userId}`),
      fetch(`/api/users/${userId}/posts`),
      fetch(`/api/users/${userId}/followers`)
    ])
    .then(responses => Promise.all(responses.map(r => r.json())))
    .then(([userData, postsData, followersData]) => {
      setUser(userData)
      setPosts(postsData)
      setFollowers(followersData)
      setLoading(false)
    })
    .catch(err => {
      setError(err.message)
      setLoading(false)
    })
  }, [userId])
  
  return (
    <div>
      {loading && <div>åŠ è½½ä¸­...</div>}
      {error && <div>é”™è¯¯: {error}</div>}
      {user && <div>{user.name}</div>}
    </div>
  )
}
```

**æµ‹è¯•è¿™ä¸ªç»„ä»¶æ—¶é‡åˆ°çš„é—®é¢˜ï¼š**

1. **ä¾èµ–å¤–éƒ¨æœåŠ¡** ğŸŒ
   ```bash
   # æµ‹è¯•å¤±è´¥çš„åŸå› 
   âŒ API æœåŠ¡å™¨æŒ‚äº†
   âŒ ç½‘ç»œè¿æ¥ä¸ç¨³å®š  
   âŒ æ•°æ®åº“æ²¡æœ‰æµ‹è¯•æ•°æ®
   âŒ ç¬¬ä¸‰æ–¹æœåŠ¡é™æµ
   ```

2. **æµ‹è¯•ç¯å¢ƒä¸ç¨³å®š** ğŸ“ˆ
   ```bash
   # ä»Šå¤©æµ‹è¯•é€šè¿‡ï¼Œæ˜å¤©å¯èƒ½å¤±è´¥
   âœ… å‘¨ä¸€ï¼šAPI æ­£å¸¸ï¼Œæµ‹è¯•é€šè¿‡
   âŒ å‘¨äºŒï¼šAPI ç»´æŠ¤ï¼Œæµ‹è¯•å¤±è´¥
   âŒ å‘¨ä¸‰ï¼šæ•°æ®å˜äº†ï¼Œæ–­è¨€å¤±è´¥
   âœ… å‘¨å››ï¼šæ¢å¤æ­£å¸¸ï¼Œæµ‹è¯•é€šè¿‡
   ```

3. **æ— æ³•æµ‹è¯•è¾¹ç•Œæƒ…å†µ** ğŸš¨
   ```typescript
   // è¿™äº›æƒ…å†µåœ¨çœŸå®ç¯å¢ƒä¸­å¾ˆéš¾å¤ç°
   - ç½‘ç»œè¶…æ—¶æ€ä¹ˆåŠï¼Ÿ
   - æœåŠ¡å™¨è¿”å› 500 é”™è¯¯æ€ä¹ˆåŠï¼Ÿ
   - æ•°æ®æ ¼å¼ä¸æ­£ç¡®æ€ä¹ˆåŠï¼Ÿ
   - ç”¨æˆ·æ²¡æœ‰æƒé™æ€ä¹ˆåŠï¼Ÿ
   ```

### âœ… ä½¿ç”¨ Mock çš„ä¼˜åŠ¿

```typescript
// UserProfile.test.tsx - Mock ç‰ˆæœ¬
import { vi } from 'vitest'
import { render, screen, waitFor } from '@testing-library/react'

// Mock æ‰€æœ‰çš„ API è°ƒç”¨
global.fetch = vi.fn()

describe('UserProfile', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })
  
  it('æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯', async () => {
    // ğŸ¯ å®Œå…¨æ§åˆ¶è¿”å›çš„æ•°æ®
    vi.mocked(fetch)
      .mockResolvedValueOnce({
        json: () => Promise.resolve({ id: 1, name: 'Alice' })
      })
      .mockResolvedValueOnce({
        json: () => Promise.resolve([{ id: 1, title: 'Post 1' }])
      })
      .mockResolvedValueOnce({
        json: () => Promise.resolve([{ id: 2, name: 'Bob' }])
      })
    
    render(<UserProfile userId="1" />)
    
    // âœ… æµ‹è¯•ç¨³å®šï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡
    await waitFor(() => {
      expect(screen.getByText('Alice')).toBeInTheDocument()
    })
  })
  
  it('å¤„ç†åŠ è½½çŠ¶æ€', async () => {
    // ğŸ¯ æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œ
    vi.mocked(fetch).mockImplementation(
      () => new Promise(resolve => setTimeout(resolve, 100))
    )
    
    render(<UserProfile userId="1" />)
    
    // âœ… ç¡®ä¿åŠ è½½çŠ¶æ€æ­£ç¡®æ˜¾ç¤º
    expect(screen.getByText('åŠ è½½ä¸­...')).toBeInTheDocument()
  })
  
  it('å¤„ç†é”™è¯¯æƒ…å†µ', async () => {
    // ğŸ¯ è½»æ¾æ¨¡æ‹Ÿé”™è¯¯åœºæ™¯
    vi.mocked(fetch).mockRejectedValue(new Error('Network Error'))
    
    render(<UserProfile userId="1" />)
    
    // âœ… éªŒè¯é”™è¯¯å¤„ç†é€»è¾‘
    await waitFor(() => {
      expect(screen.getByText('é”™è¯¯: Network Error')).toBeInTheDocument()
    })
  })
})
```

## Mock çš„æ ¸å¿ƒä»·å€¼

### 1. ğŸ¯ æµ‹è¯•éš”ç¦» - ä¸“æ³¨è¢«æµ‹å¯¹è±¡

```typescript
// å‡è®¾ä½ åœ¨æµ‹è¯•è´­ç‰©è½¦é€»è¾‘
class ShoppingCart {
  constructor(
    private paymentService: PaymentService,
    private inventoryService: InventoryService,
    private emailService: EmailService
  ) {}
  
  async checkout(items: CartItem[]) {
    // æ£€æŸ¥åº“å­˜
    const available = await this.inventoryService.checkStock(items)
    if (!available) throw new Error('åº“å­˜ä¸è¶³')
    
    // å¤„ç†æ”¯ä»˜
    const payment = await this.paymentService.charge(this.getTotal(items))
    if (!payment.success) throw new Error('æ”¯ä»˜å¤±è´¥')
    
    // å‘é€ç¡®è®¤é‚®ä»¶
    await this.emailService.sendConfirmation(payment.id)
    
    return { orderId: payment.id, success: true }
  }
}
```

**ä¸ç”¨ Mock çš„é—®é¢˜ï¼š**
```typescript
// âŒ è¿™æ ·æµ‹è¯•ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
it('checkout process', async () => {
  const cart = new ShoppingCart(
    new RealPaymentService(),    // ğŸ’³ çœŸçš„ä¼šæ‰£é’±ï¼
    new RealInventoryService(),  // ğŸ“¦ çœŸçš„ä¼šå‡åº“å­˜ï¼
    new RealEmailService()       // ğŸ“§ çœŸçš„ä¼šå‘é‚®ä»¶ï¼
  )
  
  // è¿™ä¸ªæµ‹è¯•ä¼šï¼š
  // 1. çœŸçš„ä»ä¿¡ç”¨å¡æ‰£é’±
  // 2. çœŸçš„å‡å°‘å•†å“åº“å­˜
  // 3. çœŸçš„å‘é€é‚®ä»¶ç»™å®¢æˆ·
  // 4. ä¾èµ–ç½‘ç»œå’Œå¤–éƒ¨æœåŠ¡
})
```

**ä½¿ç”¨ Mock çš„è§£å†³æ–¹æ¡ˆï¼š**
```typescript
// âœ… ä½¿ç”¨ Mockï¼Œä¸“æ³¨æµ‹è¯•è´­ç‰©è½¦é€»è¾‘
it('successful checkout process', async () => {
  // Mock æ‰€æœ‰ä¾èµ–
  const mockPayment = vi.fn().mockResolvedValue({ success: true, id: 'order123' })
  const mockInventory = vi.fn().mockResolvedValue(true)
  const mockEmail = vi.fn().mockResolvedValue(true)
  
  const cart = new ShoppingCart(
    { charge: mockPayment },
    { checkStock: mockInventory },
    { sendConfirmation: mockEmail }
  )
  
  const result = await cart.checkout([{ id: 1, quantity: 2 }])
  
  // éªŒè¯è´­ç‰©è½¦çš„ä¸šåŠ¡é€»è¾‘
  expect(mockInventory).toHaveBeenCalledWith([{ id: 1, quantity: 2 }])
  expect(mockPayment).toHaveBeenCalled()
  expect(mockEmail).toHaveBeenCalledWith('order123')
  expect(result.success).toBe(true)
})

it('handles payment failure', async () => {
  // ğŸ¯ è½»æ¾æµ‹è¯•æ”¯ä»˜å¤±è´¥åœºæ™¯
  const mockPayment = vi.fn().mockResolvedValue({ success: false })
  const mockInventory = vi.fn().mockResolvedValue(true)
  const mockEmail = vi.fn()
  
  const cart = new ShoppingCart(
    { charge: mockPayment },
    { checkStock: mockInventory },
    { sendConfirmation: mockEmail }
  )
  
  await expect(cart.checkout([{ id: 1, quantity: 2 }])).rejects.toThrow('æ”¯ä»˜å¤±è´¥')
  
  // éªŒè¯æ”¯ä»˜å¤±è´¥æ—¶ä¸å‘é€é‚®ä»¶
  expect(mockEmail).not.toHaveBeenCalled()
})
```

### 2. ğŸš€ æµ‹è¯•é€Ÿåº¦ - å¿«å¦‚é—ªç”µ

```typescript
// çœŸå®çš„æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
describe('FileUploader - Real', () => {
  it('uploads large file', async () => {
    // âŒ è¿™ä¸ªæµ‹è¯•éœ€è¦ï¼š
    // - åˆ›å»ºçœŸå®çš„å¤§æ–‡ä»¶ (100MB)
    // - ä¸Šä¼ åˆ°çœŸå®çš„æœåŠ¡å™¨
    // - ç­‰å¾…ç½‘ç»œä¼ è¾“
    // - éªŒè¯æœåŠ¡å™¨å­˜å‚¨
    // æ€»æ—¶é—´ï¼š30-60 ç§’
  })
})

// Mock ç‰ˆæœ¬çš„æ–‡ä»¶ä¸Šä¼ æµ‹è¯•
describe('FileUploader - Mock', () => {
  it('uploads large file', async () => {
    // âœ… Mock ç‰ˆæœ¬ï¼š
    const mockUpload = vi.fn().mockResolvedValue({ 
      success: true, 
      url: 'https://cdn.example.com/file123.jpg' 
    })
    
    const uploader = new FileUploader({ uploadService: { upload: mockUpload } })
    const result = await uploader.upload('large-file.jpg')
    
    expect(result.success).toBe(true)
    expect(mockUpload).toHaveBeenCalledWith('large-file.jpg')
    // æ€»æ—¶é—´ï¼š< 1 ç§’
  })
})
```

### 3. ğŸ§ª è¾¹ç•Œæµ‹è¯• - è¦†ç›–æ‰€æœ‰æƒ…å†µ

```typescript
describe('WeatherWidget', () => {
  // âœ… å„ç§å¤©æ°”æƒ…å†µ
  it.each([
    ['sunny', 'â˜€ï¸'],
    ['rainy', 'ğŸŒ§ï¸'],
    ['snowy', 'â„ï¸'],
    ['stormy', 'â›ˆï¸'],
    ['unknown', 'â“']
  ])('displays correct icon for %s weather', async (weather, expectedIcon) => {
    vi.mocked(getWeather).mockResolvedValue({ condition: weather })
    
    render(<WeatherWidget city="Beijing" />)
    
    await waitFor(() => {
      expect(screen.getByText(expectedIcon)).toBeInTheDocument()
    })
  })
  
  // âœ… ç½‘ç»œé—®é¢˜
  it('handles network timeout', async () => {
    vi.mocked(getWeather).mockImplementation(
      () => new Promise((_, reject) => 
        setTimeout(() => reject(new Error('timeout')), 5000)
      )
    )
    
    render(<WeatherWidget city="Beijing" />)
    
    await waitFor(() => {
      expect(screen.getByText('ç½‘ç»œè¶…æ—¶')).toBeInTheDocument()
    })
  })
  
  // âœ… API é™æµ
  it('handles rate limit error', async () => {
    vi.mocked(getWeather).mockRejectedValue({ 
      status: 429, 
      message: 'Too Many Requests' 
    })
    
    render(<WeatherWidget city="Beijing" />)
    
    await waitFor(() => {
      expect(screen.getByText('è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•')).toBeInTheDocument()
    })
  })
})
```

## Mock çš„æ­£ç¡®ç†è§£

### âŒ å¸¸è§è¯¯åŒº

```typescript
// è¯¯åŒº1ï¼šæµ‹è¯• Mock æœ¬èº«
it('API returns user data', () => {
  const mockUser = { id: 1, name: 'Alice' }
  vi.mocked(getUser).mockResolvedValue(mockUser)
  
  // âŒ è¿™æ²¡æœ‰æ„ä¹‰ï¼Œå½“ç„¶ä¼šè¿”å›æˆ‘ä»¬è®¾ç½®çš„å€¼
  expect(getUser()).resolves.toEqual(mockUser)
})

// è¯¯åŒº2ï¼šMock å¾—å¤ªç»†è‡´
it('button changes color', () => {
  const mockSetState = vi.fn()
  vi.mock('react', () => ({
    useState: () => ['blue', mockSetState]
  }))
  
  // âŒ è¿™ç ´åäº†ç»„ä»¶çš„å†…éƒ¨å®ç°
  render(<ColorButton />)
})
```

### âœ… æ­£ç¡®ç”¨æ³•

```typescript
// âœ… æµ‹è¯•ç»„ä»¶å¯¹ Mock æ•°æ®çš„å¤„ç†
it('displays user profile correctly', async () => {
  const mockUser = { 
    id: 1, 
    name: 'Alice', 
    avatar: 'https://example.com/avatar.jpg',
    bio: 'Frontend Developer'
  }
  vi.mocked(getUser).mockResolvedValue(mockUser)
  
  render(<UserProfile userId="1" />)
  
  // æµ‹è¯•ç»„ä»¶æ˜¯å¦æ­£ç¡®æ¸²æŸ“æ•°æ®
  await waitFor(() => {
    expect(screen.getByText('Alice')).toBeInTheDocument()
    expect(screen.getByText('Frontend Developer')).toBeInTheDocument()
    expect(screen.getByRole('img')).toHaveAttribute('src', mockUser.avatar)
  })
})

// âœ… æµ‹è¯•äº¤äº’é€»è¾‘
it('handles user click events', async () => {
  const mockOnFollow = vi.fn()
  
  render(<UserCard user={mockUser} onFollow={mockOnFollow} />)
  
  await userEvent.click(screen.getByText('å…³æ³¨'))
  
  // æµ‹è¯•äº‹ä»¶æ˜¯å¦æ­£ç¡®è§¦å‘
  expect(mockOnFollow).toHaveBeenCalledWith(mockUser.id)
})
```

## å®é™…é¡¹ç›®ä¸­çš„ Mock ç­–ç•¥

### é’ˆå¯¹ä¸åŒç±»å‹çš„ä¾èµ–

```typescript
// 1. HTTP è¯·æ±‚
vi.mock('axios', () => ({
  default: {
    get: vi.fn(),
    post: vi.fn(),
    put: vi.fn(),
    delete: vi.fn()
  }
}))

// 2. æœ¬åœ°å­˜å‚¨
vi.mock('@/utils/storage', () => ({
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn()
}))

// 3. è·¯ç”±å¯¼èˆª
vi.mock('react-router-dom', () => ({
  useNavigate: () => vi.fn(),
  useLocation: () => ({ pathname: '/test' })
}))

// 4. æ—¶é—´ç›¸å…³
vi.mock('@/utils/date', () => ({
  getCurrentTime: vi.fn(() => '2024-01-01 12:00:00'),
  formatDate: vi.fn((date) => '2024å¹´1æœˆ1æ—¥')
}))
```

### æ™ºèƒ½ Mock ç­–ç•¥

```typescript
// utils/test-helpers.ts
export function createMockUser(overrides = {}) {
  return {
    id: Math.random().toString(),
    name: 'Test User',
    email: 'test@example.com',
    avatar: 'https://example.com/avatar.jpg',
    createdAt: new Date().toISOString(),
    ...overrides
  }
}

export function createMockApiResponse<T>(data: T, success = true) {
  return {
    success,
    data: success ? data : null,
    error: success ? null : 'Mock error',
    message: success ? 'Success' : 'Something went wrong'
  }
}

// ä½¿ç”¨
it('renders user list', async () => {
  const mockUsers = [
    createMockUser({ name: 'Alice' }),
    createMockUser({ name: 'Bob' }),
    createMockUser({ name: 'Charlie' })
  ]
  
  vi.mocked(getUsers).mockResolvedValue(
    createMockApiResponse(mockUsers)
  )
  
  render(<UserList />)
  
  await waitFor(() => {
    expect(screen.getByText('Alice')).toBeInTheDocument()
    expect(screen.getByText('Bob')).toBeInTheDocument()
    expect(screen.getByText('Charlie')).toBeInTheDocument()
  })
})
```

## ä»€ä¹ˆæ—¶å€™ä¸ç”¨ Mockï¼Ÿ

### é›†æˆæµ‹è¯•
```typescript
// e2e/user-flow.spec.ts
test('ç”¨æˆ·å®Œæ•´æµç¨‹', async ({ page }) => {
  // ä½¿ç”¨çœŸå®çš„åç«¯ API
  await page.goto('/login')
  await page.fill('[name="email"]', 'test@example.com')
  await page.fill('[name="password"]', 'password123')
  await page.click('button[type="submit"]')
  
  // éªŒè¯çœŸå®çš„ç”¨æˆ·æµç¨‹
  await expect(page).toHaveURL('/dashboard')
  await expect(page.locator('text=æ¬¢è¿å›æ¥')).toBeVisible()
})
```

### ç®—æ³•å’Œå·¥å…·å‡½æ•°æµ‹è¯•
```typescript
// çº¯å‡½æ•°ä¸éœ€è¦ Mock
describe('calculateDiscount', () => {
  it('calculates 10% discount correctly', () => {
    expect(calculateDiscount(100, 0.1)).toBe(90)
    expect(calculateDiscount(50, 0.2)).toBe(40)
  })
})
```

## æ€»ç»“

Mock çš„æ ¸å¿ƒä»·å€¼æ˜¯**è®©æµ‹è¯•å˜å¾—å¯æ§ã€å¿«é€Ÿã€å…¨é¢**ï¼š

### ğŸ¯ ä¸‰ä¸ªå…³é”®åŸåˆ™
1. **éš”ç¦»æ€§** - åªæµ‹è¯•å½“å‰å•å…ƒï¼Œä¸æµ‹è¯•ä¾èµ–
2. **å¯æ§æ€§** - ç²¾ç¡®æ§åˆ¶ä¾èµ–çš„è¡Œä¸ºå’Œè¿”å›å€¼  
3. **å…¨é¢æ€§** - è½»æ¾æµ‹è¯•å„ç§è¾¹ç•Œå’Œå¼‚å¸¸æƒ…å†µ

### ğŸ“‹ ä½¿ç”¨æŒ‡å—
- âœ… **å•å…ƒæµ‹è¯•** - å¤§é‡ä½¿ç”¨ Mock
- âš ï¸ **é›†æˆæµ‹è¯•** - é€‚åº¦ä½¿ç”¨ Mock
- âŒ **E2E æµ‹è¯•** - ä¸ä½¿ç”¨ Mock

### ğŸ’¡ è®°ä½è¿™ä¸ªæ¯”å–»
Mock å°±åƒæ˜¯**ç”µå½±æ‹æ‘„ä¸­çš„é“å…·**ï¼š
- ğŸ¬ æ¼”å‘˜ï¼ˆç»„ä»¶ï¼‰ä¸“æ³¨äºè¡¨æ¼”ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- ğŸ  é“å…·ï¼ˆMockï¼‰æä¾›å¿…è¦çš„ç¯å¢ƒ
- ğŸ¯ å¯¼æ¼”ï¼ˆæµ‹è¯•ï¼‰æ§åˆ¶æ•´ä¸ªåœºæ™¯
- âš¡ ä¸ç”¨ç­‰çœŸå®çš„æˆ¿å­å»ºå¥½æ‰èƒ½æ‹æˆ

**Mock ä¸æ˜¯ä¸ºäº†æ¬ºéª—ï¼Œè€Œæ˜¯ä¸ºäº†ä¸“æ³¨ã€‚** å®ƒè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨å¯æ§çš„ç¯å¢ƒä¸­ï¼Œä¸“æ³¨æµ‹è¯•ç»„ä»¶çš„æ ¸å¿ƒé€»è¾‘ï¼Œç¡®ä¿ä»£ç çš„è´¨é‡å’Œå¯é æ€§ã€‚
