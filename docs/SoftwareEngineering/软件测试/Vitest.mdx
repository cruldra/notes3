Vitest æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ JavaScript/TypeScript æµ‹è¯•æ¡†æ¶ï¼Œç”± Vite å›¢é˜Ÿå¼€å‘ã€‚å®ƒä¸“ä¸º Vite ç”Ÿæ€ç³»ç»Ÿè®¾è®¡ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨é Vite é¡¹ç›®ä¸­ä½¿ç”¨ã€‚Vitest ç»§æ‰¿äº† Vite çš„å¿«é€Ÿæ„å»ºå’Œçƒ­é‡è½½ç‰¹æ€§ï¼Œä¸ºå‰ç«¯å¼€å‘è€…æä¾›äº†æé€Ÿçš„æµ‹è¯•ä½“éªŒã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸš€ æé€Ÿè¿è¡Œ
- **åŸç”Ÿ ESM æ”¯æŒ**ï¼šæ— éœ€é¢å¤–çš„è½¬æ¢é…ç½®
- **æ™ºèƒ½ç›‘å¬æ¨¡å¼**ï¼šåªé‡æ–°è¿è¡Œç›¸å…³çš„æµ‹è¯•æ–‡ä»¶
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šé»˜è®¤å¹¶è¡Œè¿è¡Œæµ‹è¯•ä»¥æå‡é€Ÿåº¦
- **Vite é©±åŠ¨**ï¼šåˆ©ç”¨ Vite çš„å¿«é€Ÿ HMR å’Œæ„å»ºèƒ½åŠ›

### ğŸ”§ å¼€ç®±å³ç”¨
- **é›¶é…ç½®å¯åŠ¨**ï¼šå¤§éƒ¨åˆ†é¡¹ç›®å¯ä»¥ç›´æ¥å¼€å§‹ä½¿ç”¨
- **TypeScript åŸç”Ÿæ”¯æŒ**ï¼šæ— éœ€é¢å¤–é…ç½®å³å¯æµ‹è¯• TS ä»£ç 
- **JSX/TSX æ”¯æŒ**ï¼šç›´æ¥æ”¯æŒ Reactã€Vue ç­‰ç»„ä»¶æµ‹è¯•
- **CSS å¤„ç†**ï¼šè‡ªåŠ¨å¤„ç† CSS æ¨¡å—å’Œé¢„å¤„ç†å™¨

### ğŸ§ª ä¸°å¯Œçš„æµ‹è¯•åŠŸèƒ½
- **Jest å…¼å®¹ API**ï¼šå¯ä»¥æ— ç¼è¿ç§» Jest æµ‹è¯•
- **å¿«ç…§æµ‹è¯•**ï¼šæ”¯æŒå¿«ç…§æµ‹è¯•å’Œå†…è”å¿«ç…§
- **æ¨¡æ‹ŸåŠŸèƒ½**ï¼šå¼ºå¤§çš„ Mock å’Œ Spy åŠŸèƒ½
- **è¦†ç›–ç‡æŠ¥å‘Š**ï¼šå†…ç½®ä»£ç è¦†ç›–ç‡ç»Ÿè®¡

## å®‰è£…å’Œè®¾ç½®

### åŸºç¡€å®‰è£…

```bash
# ä½¿ç”¨ npm
npm install -D vitest

# ä½¿ç”¨ pnpm
pnpm add -D vitest

# ä½¿ç”¨ yarn
yarn add -D vitest
```

### é…ç½®æ–‡ä»¶

åˆ›å»º `vitest.config.ts`ï¼š

```typescript
import { defineConfig } from 'vitest/config'

export default defineConfig({
  test: {
    // æµ‹è¯•ç¯å¢ƒ
    environment: 'jsdom', // æˆ– 'node', 'happy-dom'
    
    // å…¨å±€è®¾ç½®
    globals: true,
    
    // æµ‹è¯•æ–‡ä»¶åŒ¹é…æ¨¡å¼
    include: ['**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    
    // è¦†ç›–ç‡é…ç½®
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html']
    }
  }
})
```

### package.json è„šæœ¬

```json
{
  "scripts": {
    "test": "vitest",
    "test:run": "vitest run",
    "test:coverage": "vitest --coverage",
    "test:ui": "vitest --ui"
  }
}
```

## åŸºæœ¬ç”¨æ³•

### ç®€å•æµ‹è¯•ç¤ºä¾‹

```javascript
// math.js
export function add(a, b) {
  return a + b
}

export function multiply(a, b) {
  return a * b
}
```

```javascript
// math.test.js
import { describe, it, expect } from 'vitest'
import { add, multiply } from './math.js'

describe('Math functions', () => {
  it('should add two numbers correctly', () => {
    expect(add(2, 3)).toBe(5)
    expect(add(-1, 1)).toBe(0)
  })

  it('should multiply two numbers correctly', () => {
    expect(multiply(3, 4)).toBe(12)
    expect(multiply(0, 5)).toBe(0)
  })
})
```

### å¼‚æ­¥æµ‹è¯•

```javascript
import { describe, it, expect } from 'vitest'

// æµ‹è¯• Promise
describe('Async tests', () => {
  it('should handle promises', async () => {
    const result = await fetchUserData(1)
    expect(result.name).toBe('John Doe')
  })

  it('should handle async/await', async () => {
    await expect(asyncFunction()).resolves.toBe('success')
  })

  it('should handle rejections', async () => {
    await expect(failingFunction()).rejects.toThrow('Error message')
  })
})
```

### Mock åŠŸèƒ½

```javascript
import { describe, it, expect, vi } from 'vitest'
import { getUserData } from './api.js'

// Mock æ¨¡å—
vi.mock('./api.js', () => ({
  getUserData: vi.fn()
}))

describe('Mock tests', () => {
  it('should mock function calls', () => {
    // è®¾ç½® mock è¿”å›å€¼
    getUserData.mockResolvedValue({ id: 1, name: 'John' })
    
    // æµ‹è¯•
    const result = await getUserData(1)
    expect(result.name).toBe('John')
    expect(getUserData).toHaveBeenCalledWith(1)
  })
})
```

## é«˜çº§åŠŸèƒ½

### æµ‹è¯•ç¯å¢ƒé…ç½®

```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    // DOM æµ‹è¯•ç¯å¢ƒ
    environment: 'jsdom',
    
    // ç¯å¢ƒé€‰é¡¹
    environmentOptions: {
      jsdom: {
        resources: 'usable'
      }
    },
    
    // è®¾ç½®æ–‡ä»¶
    setupFiles: ['./tests/setup.ts']
  }
})
```

### å¿«ç…§æµ‹è¯•

```javascript
import { describe, it, expect } from 'vitest'
import { render } from '@testing-library/react'
import Component from './Component.jsx'

describe('Component', () => {
  it('should match snapshot', () => {
    const { container } = render(<Component name="John" />)
    expect(container.firstChild).toMatchSnapshot()
  })

  it('should match inline snapshot', () => {
    expect(formatName('john doe')).toMatchInlineSnapshot('"John Doe"')
  })
})
```

### æµ‹è¯•è¦†ç›–ç‡

```bash
# è¿è¡Œè¦†ç›–ç‡æµ‹è¯•
vitest --coverage

# æŒ‡å®šè¦†ç›–ç‡é˜ˆå€¼
vitest --coverage --coverage.statements=80
```

## ä¸å…¶ä»–æµ‹è¯•æ¡†æ¶å¯¹æ¯”

### Vitest vs Jest

| ç‰¹æ€§ | Vitest | Jest |
|------|--------|------|
| å¯åŠ¨é€Ÿåº¦ | âš¡ æå¿« | ğŸŒ è¾ƒæ…¢ |
| ESM æ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ | âš ï¸ éœ€è¦é…ç½® |
| TypeScript | âœ… å¼€ç®±å³ç”¨ | âš ï¸ éœ€è¦é…ç½® |
| é…ç½®å¤æ‚åº¦ | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ |
| ç”Ÿæ€ç³»ç»Ÿ | ğŸŸ¡ æ–°å…´ | ğŸŸ¢ æˆç†Ÿ |

### è¿ç§»æŒ‡å—

ä» Jest è¿ç§»åˆ° Vitestï¼š

1. **å®‰è£… Vitest**ï¼š
   ```bash
   npm uninstall jest
   npm install -D vitest
   ```

2. **æ›´æ–°å¯¼å…¥**ï¼š
   ```javascript
   // ä»
   import { test, expect } from '@jest/globals'
   
   // æ”¹ä¸º
   import { test, expect } from 'vitest'
   ```

3. **é…ç½®è½¬æ¢**ï¼š
   å¤§éƒ¨åˆ† Jest é…ç½®å¯ä»¥ç›´æ¥åœ¨ `vitest.config.ts` ä¸­ä½¿ç”¨

## å®è·µå»ºè®®

### é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Button.tsx
â”‚   â””â”€â”€ Button.test.tsx
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ helpers.ts
â”‚   â””â”€â”€ helpers.test.ts
â””â”€â”€ __tests__/
    â”œâ”€â”€ setup.ts
    â””â”€â”€ integration/
```

### æµ‹è¯•ç­–ç•¥

1. **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•ç‹¬ç«‹çš„å‡½æ•°å’Œç»„ä»¶
2. **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
3. **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šç»“åˆ Playwright æˆ– Cypress

### æ€§èƒ½ä¼˜åŒ–

```typescript
// vitest.config.ts
export default defineConfig({
  test: {
    // å¹¶è¡Œè¿è¡Œ
    pool: 'threads',
    poolOptions: {
      threads: {
        singleThread: false
      }
    },
    
    // æ–‡ä»¶å¹¶è¡Œ
    fileParallelism: true,
    
    // éš”ç¦»æ§åˆ¶
    isolate: false // è°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½å½±å“æµ‹è¯•ç‹¬ç«‹æ€§
  }
})
```

## å¸¸ç”¨æ’ä»¶å’Œå·¥å…·

### UI ç•Œé¢
```bash
npm install -D @vitest/ui
vitest --ui
```

### æµè§ˆå™¨æµ‹è¯•
```bash
npm install -D @vitest/browser playwright
```

### è¦†ç›–ç‡å¢å¼º
```bash
npm install -D @vitest/coverage-v8
# æˆ–
npm install -D @vitest/coverage-istanbul
```

## æ€»ç»“

Vitest æ˜¯ç°ä»£å‰ç«¯å¼€å‘çš„ç†æƒ³æµ‹è¯•è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚åˆï¼š

- ğŸ”¥ **Vite é¡¹ç›®**ï¼šå¤©ç„¶é›†æˆï¼Œé›¶é…ç½®å¯åŠ¨
- âš¡ **æ³¨é‡é€Ÿåº¦çš„é¡¹ç›®**ï¼šæå¿«çš„æµ‹è¯•æ‰§è¡Œå’Œåé¦ˆ
- ğŸ¯ **TypeScript é¡¹ç›®**ï¼šåŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–é…ç½®
- ğŸ”„ **ä» Jest è¿ç§»**ï¼šAPI å…¼å®¹ï¼Œè¿ç§»æˆæœ¬ä½

é€‰æ‹© Vitestï¼Œè®©æµ‹è¯•å˜å¾—æ›´å¿«ã€æ›´ç®€å•ã€æ›´æ„‰æ‚¦ï¼

## ç›¸å…³èµ„æº

- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Vite å®˜æ–¹æ–‡æ¡£](https://vitejs.dev/)
- [æµ‹è¯•æœ€ä½³å®è·µ](https://kentcdodds.com/blog/common-mistakes-with-react-testing-library)
