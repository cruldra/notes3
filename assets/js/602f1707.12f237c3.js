"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[64298],{8194:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>x,frontMatter:()=>d,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/torch_distributed_api","title":"PyTorch \u5206\u5e03\u5f0f\u901a\u4fe1\u539f\u8bed\u4e0e\u5e38\u7528 API \u8be6\u89e3","description":"torch.distributed \u6a21\u5757\u662f PyTorch \u5206\u5e03\u5f0f\u5e76\u884c\u8ba1\u7b97\u7684\u6838\u5fc3\uff0c\u63d0\u4f9b\u4e86\u5e95\u5c42\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u539f\u8bed\u548c\u9ad8\u5c42\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u5c01\u88c5\u3002\u672c\u6587\u6863\u6df1\u5165\u89e3\u6790\u8be5\u6a21\u5757\u7684\u6838\u5fc3 API\uff0c\u6db5\u76d6\u73af\u5883\u521d\u59cb\u5316\u3001\u8fdb\u7a0b\u7ec4\u7ba1\u7406\u3001\u70b9\u5bf9\u70b9\u901a\u4fe1\uff08P2P\uff09\u53ca\u96c6\u5408\u901a\u4fe1\uff08Collective Communication\uff09\u3002","source":"@site/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/torch_distributed_api.md","sourceDirName":"AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3","slug":"/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/torch_distributed_api","permalink":"/notes3/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/torch_distributed_api","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/torch_distributed_api.md","tags":[],"version":"current","frontMatter":{},"sidebar":"ai","previous":{"title":"torch_distributed","permalink":"/notes3/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/torch_distributed"},"next":{"title":"\u793a\u4f8b1","permalink":"/notes3/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/\u793a\u4f8b1"}}');var t=r(23420),i=r(54213);const d={},c="PyTorch \u5206\u5e03\u5f0f\u901a\u4fe1\u539f\u8bed\u4e0e\u5e38\u7528 API \u8be6\u89e3",l={},o=[{value:"1. \u5206\u5e03\u5f0f\u73af\u5883\u521d\u59cb\u5316",id:"1-\u5206\u5e03\u5f0f\u73af\u5883\u521d\u59cb\u5316",level:2},{value:"<code>torch.distributed.init_process_group</code>",id:"torchdistributedinit_process_group",level:3},{value:"2. \u8fdb\u7a0b\u7ec4\u72b6\u6001\u67e5\u8be2",id:"2-\u8fdb\u7a0b\u7ec4\u72b6\u6001\u67e5\u8be2",level:2},{value:"3. \u96c6\u5408\u901a\u4fe1 (Collective Communication)",id:"3-\u96c6\u5408\u901a\u4fe1-collective-communication",level:2},{value:"3.1 \u5f52\u7ea6\u4e0e\u540c\u6b65 (Reduce &amp; Synchronization)",id:"31-\u5f52\u7ea6\u4e0e\u540c\u6b65-reduce--synchronization",level:3},{value:"<code>torch.distributed.all_reduce</code>",id:"torchdistributedall_reduce",level:4},{value:"<code>torch.distributed.barrier</code>",id:"torchdistributedbarrier",level:4},{value:"3.2 \u6536\u96c6\u4e0e\u5206\u53d1 (Gather &amp; Scatter)",id:"32-\u6536\u96c6\u4e0e\u5206\u53d1-gather--scatter",level:3},{value:"<code>torch.distributed.all_gather</code>",id:"torchdistributedall_gather",level:4},{value:"<code>torch.distributed.broadcast</code>",id:"torchdistributedbroadcast",level:4},{value:"4. \u70b9\u5bf9\u70b9\u901a\u4fe1 (Point-to-Point Communication)",id:"4-\u70b9\u5bf9\u70b9\u901a\u4fe1-point-to-point-communication",level:2},{value:"5. \u8fdb\u9636\uff1a\u8fdb\u7a0b\u7ec4\u7ba1\u7406 (Groups)",id:"5-\u8fdb\u9636\u8fdb\u7a0b\u7ec4\u7ba1\u7406-groups",level:2},{value:"<code>torch.distributed.new_group</code>",id:"torchdistributednew_group",level:3},{value:"6. \u603b\u7ed3",id:"6-\u603b\u7ed3",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"pytorch-\u5206\u5e03\u5f0f\u901a\u4fe1\u539f\u8bed\u4e0e\u5e38\u7528-api-\u8be6\u89e3",children:"PyTorch \u5206\u5e03\u5f0f\u901a\u4fe1\u539f\u8bed\u4e0e\u5e38\u7528 API \u8be6\u89e3"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"torch.distributed"})," \u6a21\u5757\u662f PyTorch \u5206\u5e03\u5f0f\u5e76\u884c\u8ba1\u7b97\u7684\u6838\u5fc3\uff0c\u63d0\u4f9b\u4e86\u5e95\u5c42\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u539f\u8bed\u548c\u9ad8\u5c42\u7684\u5206\u5e03\u5f0f\u8bad\u7ec3\u5c01\u88c5\u3002\u672c\u6587\u6863\u6df1\u5165\u89e3\u6790\u8be5\u6a21\u5757\u7684\u6838\u5fc3 API\uff0c\u6db5\u76d6\u73af\u5883\u521d\u59cb\u5316\u3001\u8fdb\u7a0b\u7ec4\u7ba1\u7406\u3001\u70b9\u5bf9\u70b9\u901a\u4fe1\uff08P2P\uff09\u53ca\u96c6\u5408\u901a\u4fe1\uff08Collective Communication\uff09\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"1-\u5206\u5e03\u5f0f\u73af\u5883\u521d\u59cb\u5316",children:"1. \u5206\u5e03\u5f0f\u73af\u5883\u521d\u59cb\u5316"}),"\n",(0,t.jsx)(n.p,{children:"\u5206\u5e03\u5f0f\u4efb\u52a1\u7684\u7b2c\u4e00\u6b65\u662f\u5efa\u7acb\u8fdb\u7a0b\u95f4\u7684\u8fde\u63a5\u5e76\u521d\u59cb\u5316\u901a\u4fe1\u540e\u7aef\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"torchdistributedinit_process_group",children:(0,t.jsx)(n.code,{children:"torch.distributed.init_process_group"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8be5\u51fd\u6570\u8d1f\u8d23\u521d\u59cb\u5316\u9ed8\u8ba4\u7684\u5206\u5e03\u5f0f\u8fdb\u7a0b\u7ec4\uff08Process Group\uff09\u3002\u5728\u8c03\u7528\u4efb\u4f55\u5176\u4ed6 ",(0,t.jsx)(n.code,{children:"distributed"})," \u51fd\u6570\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u8c03\u7528\u6b64\u51fd\u6570\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u51fd\u6570\u7b7e\u540d"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"torch.distributed.init_process_group(\n    backend: Optional[str] = None,\n    init_method: Optional[str] = None,\n    timeout: Optional[timedelta] = None,\n    world_size: int = -1,\n    rank: int = -1,\n    store: Optional[Store] = None,\n    group_name: str = '',\n    pg_options: Optional[ProcessGroupOptions] = None\n)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u5173\u952e\u53c2\u6570\u8be6\u89e3"}),"\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"backend"})," (str)"]}),": \u901a\u4fe1\u540e\u7aef\u3002","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nccl"}),": ",(0,t.jsx)(n.strong,{children:"GPU \u8bad\u7ec3\u9996\u9009"}),"\u3002NVIDIA Collective Communications Library\uff0c\u9488\u5bf9 CUDA Tensor \u8fdb\u884c\u4e86\u9ad8\u5ea6\u4f18\u5316\uff0c\u652f\u6301\u8de8\u8282\u70b9\u548c\u5355\u8282\u70b9\u591a GPU \u901a\u4fe1\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"gloo"}),": ",(0,t.jsx)(n.strong,{children:"CPU \u8bad\u7ec3\u9996\u9009"}),"\u3002Facebook \u5f00\u53d1\u7684\u8de8\u5e73\u53f0\u901a\u4fe1\u5e93\uff0c\u652f\u6301 CPU Tensor\u3002\u5728 GPU \u8bad\u7ec3\u4e2d\u5e38\u7528\u4e8e\u534f\u8c03\u63a7\u5236\u5e73\u9762\uff08\u5982 ",(0,t.jsx)(n.code,{children:"barrier"}),"\uff09\u6216\u4f5c\u4e3a NCCL \u7684\u5907\u7528\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mpi"}),": Message Passing Interface\uff0c\u4f9d\u8d56\u5916\u90e8 MPI \u5b9e\u73b0\uff08\u5982 OpenMPI\uff09\u3002\u9700\u8981\u4ece\u6e90\u7801\u91cd\u65b0\u7f16\u8bd1 PyTorch \u624d\u80fd\u542f\u7528\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"init_method"})," (str)"]}),": \u521d\u59cb\u5316\u53d1\u73b0\u673a\u5236\u3002","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"env://"}),": \u8bfb\u53d6\u73af\u5883\u53d8\u91cf\uff08",(0,t.jsx)(n.code,{children:"MASTER_ADDR"}),", ",(0,t.jsx)(n.code,{children:"MASTER_PORT"}),", ",(0,t.jsx)(n.code,{children:"WORLD_SIZE"}),", ",(0,t.jsx)(n.code,{children:"RANK"}),"\uff09\u3002\u8fd9\u662f ",(0,t.jsx)(n.code,{children:"torchrun"})," \u6216 ",(0,t.jsx)(n.code,{children:"torch.distributed.launch"})," \u7684\u9ed8\u8ba4\u65b9\u5f0f\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tcp://<ip>:<port>"}),": \u6307\u5b9a Rank 0 \u7684 IP \u548c\u7aef\u53e3\u3002\u6240\u6709\u8fdb\u7a0b\u901a\u8fc7 TCP \u63e1\u624b\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"file://<path>"}),": \u4f7f\u7528\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u6587\u4ef6\u8fdb\u884c\u540c\u6b65\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"world_size"})," (int)"]}),": \u5168\u5c40\u8fdb\u7a0b\u603b\u6570\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"rank"})," (int)"]}),": \u5f53\u524d\u8fdb\u7a0b\u7684\u5168\u5c40\u5e8f\u53f7\uff080 \u5230 ",(0,t.jsx)(n.code,{children:"world_size - 1"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u67b6\u6784\u56fe\uff1a\u521d\u59cb\u5316\u6d41\u7a0b"})}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Rank0\n    participant Rank1\n    participant RankN\n    Note over Rank0, RankN: \u521d\u59cb\u5316\u9636\u6bb5 (init_process_group)\n    Rank0->>Store: \u6ce8\u518c\u5730\u5740 (Rendezvous)\n    Rank1->>Store: \u8fde\u63a5 Rank0\n    RankN->>Store: \u8fde\u63a5 Rank0\n    Store--\x3e>Rank0: \u786e\u8ba4\u8fde\u63a5\n    Store--\x3e>Rank1: \u786e\u8ba4\u8fde\u63a5\n    Store--\x3e>RankN: \u786e\u8ba4\u8fde\u63a5\n    Note over Rank0, RankN: \u5efa\u7acb ProcessGroup (NCCL/Gloo)"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"2-\u8fdb\u7a0b\u7ec4\u72b6\u6001\u67e5\u8be2",children:"2. \u8fdb\u7a0b\u7ec4\u72b6\u6001\u67e5\u8be2"}),"\n",(0,t.jsx)(n.p,{children:"\u521d\u59cb\u5316\u540e\uff0c\u4f7f\u7528\u4ee5\u4e0b API \u83b7\u53d6\u73af\u5883\u4fe1\u606f\uff0c\u901a\u5e38\u7528\u4e8e\u63a7\u5236\u903b\u8f91\u5206\u652f\uff08\u5982\u53ea\u5728 Rank 0 \u6253\u5370\u65e5\u5fd7\uff09\u3002"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"torch.distributed.get_rank(group=None) -> int"})}),": \u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u7684 Rank ID\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"torch.distributed.get_world_size(group=None) -> int"})}),": \u83b7\u53d6\u8fdb\u7a0b\u7ec4\u5185\u7684\u8fdb\u7a0b\u603b\u6570\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"torch.distributed.is_initialized() -> bool"})}),": \u68c0\u67e5\u5206\u5e03\u5f0f\u73af\u5883\u662f\u5426\u5df2\u521d\u59cb\u5316\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"3-\u96c6\u5408\u901a\u4fe1-collective-communication",children:"3. \u96c6\u5408\u901a\u4fe1 (Collective Communication)"}),"\n",(0,t.jsx)(n.p,{children:"\u96c6\u5408\u901a\u4fe1\u6d89\u53ca\u8fdb\u7a0b\u7ec4\u5185\u7684\u6240\u6709\u8fdb\u7a0b\uff0c\u662f\u5206\u5e03\u5f0f\u8bad\u7ec3\uff08\u5982\u68af\u5ea6\u540c\u6b65\uff09\u7684\u57fa\u7840\u3002\u4ee5\u4e0b API \u5747\u4e3a\u539f\u5730\u64cd\u4f5c\uff08In-place\uff09\u6216\u63a5\u6536\u9884\u5206\u914d\u7684 Tensor\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"31-\u5f52\u7ea6\u4e0e\u540c\u6b65-reduce--synchronization",children:"3.1 \u5f52\u7ea6\u4e0e\u540c\u6b65 (Reduce & Synchronization)"}),"\n",(0,t.jsx)(n.h4,{id:"torchdistributedall_reduce",children:(0,t.jsx)(n.code,{children:"torch.distributed.all_reduce"})}),"\n",(0,t.jsx)(n.p,{children:"\u5c06\u6240\u6709\u8fdb\u7a0b\u7684 Tensor \u8fdb\u884c\u5f52\u7ea6\u64cd\u4f5c\uff08\u5982\u6c42\u548c\uff09\uff0c\u5e76\u5c06\u7ed3\u679c\u5e7f\u64ad\u56de\u6240\u6709\u8fdb\u7a0b\u3002"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u51fd\u6570\u7b7e\u540d"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"torch.distributed.all_reduce(tensor, op=ReduceOp.SUM, group=None, async_op=False)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tensor"}),": \u8f93\u5165\u548c\u8f93\u51fa\u5171\u7528\u7684 Tensor\uff08In-place \u4fee\u6539\uff09\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"op"}),": \u5f52\u7ea6\u64cd\u4f5c\u7c7b\u578b\uff0c\u5305\u62ec ",(0,t.jsx)(n.code,{children:"SUM"}),", ",(0,t.jsx)(n.code,{children:"PRODUCT"}),", ",(0,t.jsx)(n.code,{children:"MIN"}),", ",(0,t.jsx)(n.code,{children:"MAX"}),", ",(0,t.jsx)(n.code,{children:"BAND"}),", ",(0,t.jsx)(n.code,{children:"BOR"}),", ",(0,t.jsx)(n.code,{children:"BXOR"}),"\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u7406\u56fe\u793a"}),"\uff1a"]}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    subgraph Before\n    R0[Rank 0: 1]\n    R1[Rank 1: 2]\n    R2[Rank 2: 3]\n    end\n    subgraph Op\n    OpNode[SUM = 1+2+3 = 6]\n    end\n    subgraph After\n    R0_new[Rank 0: 6]\n    R1_new[Rank 1: 6]\n    R2_new[Rank 2: 6]\n    end\n    R0 --\x3e OpNode\n    R1 --\x3e OpNode\n    R2 --\x3e OpNode\n    OpNode --\x3e R0_new\n    OpNode --\x3e R1_new\n    OpNode --\x3e R2_new"}),"\n",(0,t.jsx)(n.h4,{id:"torchdistributedbarrier",children:(0,t.jsx)(n.code,{children:"torch.distributed.barrier"})}),"\n",(0,t.jsx)(n.p,{children:"\u540c\u6b65\u8def\u969c\u3002\u963b\u585e\u6240\u6709\u8c03\u7528\u6b64\u51fd\u6570\u7684\u8fdb\u7a0b\uff0c\u76f4\u5230\u7ec4\u5185\u6240\u6709\u8fdb\u7a0b\u90fd\u8c03\u7528\u4e86\u8be5\u51fd\u6570\u3002\u7528\u4e8e\u786e\u4fdd\u67d0\u4e2a\u9636\u6bb5\uff08\u5982\u6570\u636e\u9884\u5904\u7406\u3001\u6a21\u578b\u4fdd\u5b58\uff09\u6240\u6709\u8fdb\u7a0b\u90fd\u5df2\u5b8c\u6210\u3002"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"32-\u6536\u96c6\u4e0e\u5206\u53d1-gather--scatter",children:"3.2 \u6536\u96c6\u4e0e\u5206\u53d1 (Gather & Scatter)"}),"\n",(0,t.jsx)(n.h4,{id:"torchdistributedall_gather",children:(0,t.jsx)(n.code,{children:"torch.distributed.all_gather"})}),"\n",(0,t.jsx)(n.p,{children:"\u6536\u96c6\u6240\u6709\u8fdb\u7a0b\u7684 Tensor\uff0c\u7ed3\u679c\u7531\u6240\u6709\u8fdb\u7a0b\u6301\u6709\u3002"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u51fd\u6570\u7b7e\u540d"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"torch.distributed.all_gather(tensor_list, tensor, group=None, async_op=False)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tensor_list"}),": \u8f93\u51fa\u5217\u8868\uff0c\u5305\u542b ",(0,t.jsx)(n.code,{children:"world_size"})," \u4e2a Tensor\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tensor"}),": \u5f53\u524d\u8fdb\u7a0b\u53d1\u9001\u7684 Tensor\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u539f\u7406\u56fe\u793a"}),"\uff1a"]}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TD\n    subgraph Input\n    I0["Rank 0: A"]\n    I1["Rank 1: B"]\n    end\n    subgraph Output\n    O0["Rank 0: A, B"]\n    O1["Rank 1: A, B"]\n    end\n    I0 --\x3e O0\n    I0 --\x3e O1\n    I1 --\x3e O0\n    I1 --\x3e O1'}),"\n",(0,t.jsx)(n.h4,{id:"torchdistributedbroadcast",children:(0,t.jsx)(n.code,{children:"torch.distributed.broadcast"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5c06\u67d0\u4e2a\u8fdb\u7a0b\uff08",(0,t.jsx)(n.code,{children:"src"}),"\uff09\u7684 Tensor \u5e7f\u64ad\u7ed9\u6240\u6709\u5176\u4ed6\u8fdb\u7a0b\u3002"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u51fd\u6570\u7b7e\u540d"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"torch.distributed.broadcast(tensor, src, group=None, async_op=False)\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"4-\u70b9\u5bf9\u70b9\u901a\u4fe1-point-to-point-communication",children:"4. \u70b9\u5bf9\u70b9\u901a\u4fe1 (Point-to-Point Communication)"}),"\n",(0,t.jsx)(n.p,{children:"\u6d89\u53ca\u4e24\u4e2a\u7279\u5b9a\u8fdb\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u4f20\u8f93\u3002\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\uff08Async\uff09\u4e24\u79cd\u6a21\u5f0f\u3002"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"torch.distributed.send(tensor, dst, group=None, tag=0)"})}),": \u540c\u6b65\u53d1\u9001\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"torch.distributed.recv(tensor, src=None, group=None, tag=0)"})}),": \u540c\u6b65\u63a5\u6536\u3002\u4f1a\u5c06\u6570\u636e\u5199\u5165 ",(0,t.jsx)(n.code,{children:"tensor"}),"\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"torch.distributed.isend"})," / ",(0,t.jsx)(n.code,{children:"irecv"})]}),": \u5f02\u6b65\u7248\u672c\uff0c\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"Request"})," \u5bf9\u8c61\uff0c\u9700\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"wait()"})," \u7b49\u5f85\u5b8c\u6210\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6ce8\u610f"}),"\uff1a\u4f7f\u7528 P2P \u901a\u4fe1\u65f6\u9700\u6781\u5176\u5c0f\u5fc3\u6b7b\u9501\uff08Deadlock\uff09\u3002\u4f8b\u5982\u4e24\u4e2a\u8fdb\u7a0b\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u53d1\u9001\u6570\u636e\u3002"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"5-\u8fdb\u9636\u8fdb\u7a0b\u7ec4\u7ba1\u7406-groups",children:"5. \u8fdb\u9636\uff1a\u8fdb\u7a0b\u7ec4\u7ba1\u7406 (Groups)"}),"\n",(0,t.jsx)(n.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u4f5c\u7528\u4e8e\u5168\u5c40\u9ed8\u8ba4\u8fdb\u7a0b\u7ec4\u3002\u4f46\u5728\u6a21\u578b\u5e76\u884c\uff08Model Parallelism\uff09\u6216\u4e13\u5bb6\u6df7\u5408\u6a21\u578b\uff08MoE\uff09\u4e2d\uff0c\u9700\u8981\u521b\u5efa\u5b50\u7ec4\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"torchdistributednew_group",children:(0,t.jsx)(n.code,{children:"torch.distributed.new_group"})}),"\n",(0,t.jsx)(n.p,{children:"\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b50\u8fdb\u7a0b\u7ec4\u3002"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u51fd\u6570\u7b7e\u540d"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"torch.distributed.new_group(ranks=None, timeout=None, backend=None)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ranks"})," (list[int]): \u5b50\u7ec4\u5305\u542b\u7684\u5168\u5c40 Rank \u5217\u8868\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u793a\u4f8b"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# \u5047\u8bbe World Size = 4\n# \u521b\u5efa\u4e24\u4e2a\u5b50\u7ec4\uff1a[0, 1] \u548c [2, 3]\ngroup1 = dist.new_group([0, 1])\ngroup2 = dist.new_group([2, 3])\n\n# \u4ec5\u5728\u7ec4\u5185\u8fdb\u884c all_reduce\nif dist.get_rank() in [0, 1]:\n    dist.all_reduce(tensor, group=group1)\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"6-\u603b\u7ed3",children:"6. \u603b\u7ed3"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"API \u7c7b\u522b"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u6838\u5fc3\u51fd\u6570"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u5178\u578b\u5e94\u7528\u573a\u666f"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u521d\u59cb\u5316"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"init_process_group"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u542f\u52a8\u5206\u5e03\u5f0f\u73af\u5883\uff0c\u5efa\u7acb\u8fde\u63a5\u3002"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u72b6\u6001\u67e5\u8be2"})}),(0,t.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,t.jsx)(n.code,{children:"get_rank"}),", ",(0,t.jsx)(n.code,{children:"get_world_size"})]}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u533a\u5206 Master/Worker \u903b\u8f91\uff0c\u914d\u7f6e\u6570\u636e\u5206\u7247\u3002"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u89c4\u7ea6"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"all_reduce"})}),(0,t.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,t.jsx)(n.strong,{children:"DDP \u68af\u5ea6\u540c\u6b65"}),"\uff0c\u8ba1\u7b97\u5168\u5c40 Loss \u5e73\u5747\u503c\u3002"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u540c\u6b65"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"barrier"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u786e\u4fdd\u521d\u59cb\u5316\u5b8c\u6210\uff0c\u9632\u6b62\u90e8\u5206\u8fdb\u7a0b\u62a2\u8dd1\u3002"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u6536\u96c6"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"all_gather"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u8de8\u5361 Batch Norm\uff0c\u641c\u96c6\u8bc4\u4f30\u7ed3\u679c\u3002"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"\u5e7f\u64ad"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"broadcast"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u521d\u59cb\u5316\u65f6\u540c\u6b65\u6a21\u578b\u53c2\u6570\uff0c\u786e\u4fdd\u8d77\u70b9\u4e00\u81f4\u3002"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.strong,{children:"P2P"})}),(0,t.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,t.jsx)(n.code,{children:"send"}),"/",(0,t.jsx)(n.code,{children:"recv"})]}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u6d41\u6c34\u7ebf\u5e76\u884c\uff08Pipeline Parallelism\uff09\u4f20\u9012 Activation/Gradient\u3002"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["\u638c\u63e1\u8fd9\u4e9b\u5e95\u5c42 API \u5bf9\u4e8e\u7406\u89e3 ",(0,t.jsx)(n.code,{children:"DistributedDataParallel"})," (DDP) \u7684\u5de5\u4f5c\u539f\u7406\u4ee5\u53ca\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u5206\u5e03\u5f0f\u7b97\u6cd5\uff08\u5982 Tensor Parallelism, Pipeline Parallelism\uff09\u81f3\u5173\u91cd\u8981\u3002"]})]})}function x(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},54213:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>c});var s=r(36672);const t={},i=s.createContext(t);function d(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);