"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[65324],{50201:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u4f7f\u7528MCP","title":"\u4f7f\u7528MCP","description":"MCP\uff0c\u5373\u6a21\u578b\u4e0a\u4e0b\u6587\u534f\u8bae\uff08Model Context Protocol\uff09\uff0c\u662f\u4e00\u4e2a\u5f00\u653e\u534f\u8bae\uff0c\u7528\u4e8e\u6807\u51c6\u5316\u5e94\u7528\u7a0b\u5e8f\u5411 LLM \u63d0\u4f9b\u4e0a\u4e0b\u6587\u7684\u65b9\u5f0f\u3002\u5c3d\u7ba1\u6709\u4e00\u4e9b\u5f00\u53d1\u5f00\u9500\uff0c\u4f46 MCP \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9d\u8d35\u7684\u673a\u4f1a\uff0c\u8ba9\u60a8\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u5171\u4eab\u5de5\u5177\u3001\u8d44\u6e90\u548c\u63d0\u793a\u8bcd\uff0c\u65e0\u8bba\u60a8\u4f7f\u7528\u7684\u662f\u54ea\u79cd\u6280\u672f\u6808\u3002\u540c\u6837\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u6784\u5efa\u7684\u5de5\u5177\uff0c\u800c\u65e0\u9700\u91cd\u5199\u4ee3\u7801\u3002","source":"@site/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u4f7f\u7528MCP.md","sourceDirName":"AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy","slug":"/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u4f7f\u7528MCP","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u4f7f\u7528MCP","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u4f7f\u7528MCP.md","tags":[],"version":"current","frontMatter":{},"sidebar":"ai","previous":{"title":"\u901f\u67e5\u8868","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/API/\u6a21\u5757/\u901f\u67e5\u8868"},"next":{"title":"\u4fdd\u5b58\u548c\u52a0\u8f7d\u60a8\u7684 DSPy \u7a0b\u5e8f","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u4fdd\u5b58\u548c\u52a0\u8f7d\u60a8\u7684 DSPy \u7a0b\u5e8f"}}');var r=i(23420),s=i(54213);const o={},a=void 0,l={},d=[{value:"\u5b89\u88c5\u4f9d\u8d56",id:"\u5b89\u88c5\u4f9d\u8d56",level:2},{value:"MCP \u670d\u52a1\u5668\u8bbe\u7f6e",id:"mcp-\u670d\u52a1\u5668\u8bbe\u7f6e",level:2},{value:"\u7f16\u5199\u5229\u7528 MCP \u670d\u52a1\u5668\u4e2d\u5de5\u5177\u7684 DSPy \u7a0b\u5e8f",id:"\u7f16\u5199\u5229\u7528-mcp-\u670d\u52a1\u5668\u4e2d\u5de5\u5177\u7684-dspy-\u7a0b\u5e8f",level:2},{value:"\u4ece MCP \u670d\u52a1\u5668\u6536\u96c6\u5de5\u5177",id:"\u4ece-mcp-\u670d\u52a1\u5668\u6536\u96c6\u5de5\u5177",level:3},{value:"\u6784\u5efa DSPy \u4ee3\u7406\u4ee5\u5904\u7406\u5ba2\u6237\u8bf7\u6c42",id:"\u6784\u5efa-dspy-\u4ee3\u7406\u4ee5\u5904\u7406\u5ba2\u6237\u8bf7\u6c42",level:3},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function c(n){const e={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"MCP\uff0c\u5373\u6a21\u578b\u4e0a\u4e0b\u6587\u534f\u8bae\uff08Model Context Protocol\uff09\uff0c\u662f\u4e00\u4e2a\u5f00\u653e\u534f\u8bae\uff0c\u7528\u4e8e\u6807\u51c6\u5316\u5e94\u7528\u7a0b\u5e8f\u5411 LLM \u63d0\u4f9b\u4e0a\u4e0b\u6587\u7684\u65b9\u5f0f\u3002\u5c3d\u7ba1\u6709\u4e00\u4e9b\u5f00\u53d1\u5f00\u9500\uff0c\u4f46 MCP \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9d\u8d35\u7684\u673a\u4f1a\uff0c\u8ba9\u60a8\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u5171\u4eab\u5de5\u5177\u3001\u8d44\u6e90\u548c\u63d0\u793a\u8bcd\uff0c\u65e0\u8bba\u60a8\u4f7f\u7528\u7684\u662f\u54ea\u79cd\u6280\u672f\u6808\u3002\u540c\u6837\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5f00\u53d1\u4eba\u5458\u6784\u5efa\u7684\u5de5\u5177\uff0c\u800c\u65e0\u9700\u91cd\u5199\u4ee3\u7801\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["\u672c\u6307\u5357\u5c06\u5e26\u60a8\u4e86\u89e3\u5982\u4f55\u5728 DSPy \u4e2d\u4f7f\u7528 MCP \u5de5\u5177\u3002\u4e3a\u4e86\u6f14\u793a\uff0c\u6211\u4eec\u5c06\u6784\u5efa\u4e00\u4e2a\u822a\u7a7a\u516c\u53f8\u670d\u52a1\u4ee3\u7406\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u9884\u8ba2\u822a\u73ed\u4ee5\u53ca\u4fee\u6539\u6216\u53d6\u6d88\u73b0\u6709\u9884\u8ba2\u3002\u8fd9\u5c06\u4f9d\u8d56\u4e8e\u4e00\u4e2a\u5305\u542b\u81ea\u5b9a\u4e49\u5de5\u5177\u7684 MCP \u670d\u52a1\u5668\uff0c\u4f46\u8fd9\u5e94\u8be5\u5f88\u5bb9\u6613\u63a8\u5e7f\u5230 ",(0,r.jsx)(e.a,{href:"https://modelcontextprotocol.io/examples",children:"\u793e\u533a\u6784\u5efa\u7684 MCP \u670d\u52a1\u5668"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u4f55\u8fd0\u884c\u672c\u6559\u7a0b"}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6559\u7a0b\u65e0\u6cd5\u5728 Google Colab \u6216 Databricks notebooks \u7b49\u6258\u7ba1\u7684 IPython \u7b14\u8bb0\u672c\u4e2d\u8fd0\u884c\u3002\u8981\u8fd0\u884c\u4ee3\u7801\uff0c\u60a8\u9700\u8981\u6309\u7167\u6307\u5357\u5728\u672c\u5730\u8bbe\u5907\u4e0a\u7f16\u5199\u4ee3\u7801\u3002\u4ee3\u7801\u5df2\u5728 macOS \u4e0a\u6d4b\u8bd5\uff0c\u5728 Linux \u73af\u5883\u4e2d\u5e94\u8be5\u4e5f\u80fd\u4ee5\u76f8\u540c\u65b9\u5f0f\u5de5\u4f5c\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u5b89\u88c5\u4f9d\u8d56",children:"\u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5b89\u88c5\u6240\u9700\u7684\u4f9d\u8d56\u9879\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'pip install -U "dspy[mcp]"\n\n'})}),"\n",(0,r.jsx)(e.h2,{id:"mcp-\u670d\u52a1\u5668\u8bbe\u7f6e",children:"MCP \u670d\u52a1\u5668\u8bbe\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u4e3a\u822a\u7a7a\u516c\u53f8\u4ee3\u7406\u8bbe\u7f6e MCP \u670d\u52a1\u5668\uff0c\u5b83\u5305\u542b\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4e00\u7ec4\u6570\u636e\u5e93"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u7528\u6237\u6570\u636e\u5e93\uff1a\u5b58\u50a8\u7528\u6237\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u822a\u73ed\u6570\u636e\u5e93\uff1a\u5b58\u50a8\u822a\u73ed\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u673a\u7968\u6570\u636e\u5e93\uff1a\u5b58\u50a8\u5ba2\u6237\u673a\u7968\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u4e00\u7ec4\u5de5\u5177"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"fetch_flight_info"}),"\uff1a\u83b7\u53d6\u7279\u5b9a\u65e5\u671f\u7684\u822a\u73ed\u4fe1\u606f\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"fetch_itinerary"}),"\uff1a\u83b7\u53d6\u5df2\u9884\u8ba2\u7684\u884c\u7a0b\u4fe1\u606f\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"book_itinerary"}),"\uff1a\u4ee3\u8868\u7528\u6237\u9884\u8ba2\u822a\u73ed\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"modify_itinerary"}),"\uff1a\u4fee\u6539\u884c\u7a0b\uff0c\u5305\u62ec\u66f4\u6539\u822a\u73ed\u6216\u53d6\u6d88\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"get_user_info"}),"\uff1a\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u3002"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"file_ticket"}),"\uff1a\u63d0\u4ea4\u5f85\u529e\u5de5\u5355\u4ee5\u5bfb\u6c42\u4eba\u5de5\u534f\u52a9\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u60a8\u7684\u5de5\u4f5c\u76ee\u5f55\u4e2d\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a ",(0,r.jsx)(e.code,{children:"mcp_server.py"})," \u7684\u6587\u4ef6\uff0c\u5e76\u5c06\u4ee5\u4e0b\u5185\u5bb9\u7c98\u8d34\u5230\u5176\u4e2d\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import random\nimport string\n\nfrom mcp.server.fastmcp import FastMCP\nfrom pydantic import BaseModel\n\n# \u521b\u5efa\u4e00\u4e2a MCP \u670d\u52a1\u5668\nmcp = FastMCP("Airline Agent")\n\nclass Date(BaseModel):\n    # LLM \u5728\u6307\u5b9a `datetime.datetime` \u65b9\u9762\u8868\u73b0\u4e0d\u4f73\n    year: int\n    month: int\n    day: int\n    hour: int\n\nclass UserProfile(BaseModel):\n    user_id: str\n    name: str\n    email: str\n\nclass Flight(BaseModel):\n    flight_id: str\n    date_time: Date\n    origin: str\n    destination: str\n    duration: float\n    price: float\n\nclass Itinerary(BaseModel):\n    confirmation_number: str\n    user_profile: UserProfile\n    flight: Flight\n\nclass Ticket(BaseModel):\n    user_request: str\n    user_profile: UserProfile\n\nuser_database = {\n    "Adam": UserProfile(user_id="1", name="Adam", email="adam@gmail.com"),\n    "Bob": UserProfile(user_id="2", name="Bob", email="bob@gmail.com"),\n    "Chelsie": UserProfile(user_id="3", name="Chelsie", email="chelsie@gmail.com"),\n    "David": UserProfile(user_id="4", name="David", email="david@gmail.com"),\n}\n\nflight_database = {\n    "DA123": Flight(\n        flight_id="DA123",\n        origin="SFO",\n        destination="JFK",\n        date_time=Date(year=2025, month=9, day=1, hour=1),\n        duration=3,\n        price=200,\n    ),\n    "DA125": Flight(\n        flight_id="DA125",\n        origin="SFO",\n        destination="JFK",\n        date_time=Date(year=2025, month=9, day=1, hour=7),\n        duration=9,\n        price=500,\n    ),\n    "DA456": Flight(\n        flight_id="DA456",\n        origin="SFO",\n        destination="SNA",\n        date_time=Date(year=2025, month=10, day=1, hour=1),\n        duration=2,\n        price=100,\n    ),\n    "DA460": Flight(\n        flight_id="DA460",\n        origin="SFO",\n        destination="SNA",\n        date_time=Date(year=2025, month=10, day=1, hour=9),\n        duration=2,\n        price=120,\n    ),\n}\n\nitinery_database = {}\nticket_database = {}\n\n@mcp.tool()\ndef fetch_flight_info(date: Date, origin: str, destination: str):\n    """Fetch flight information from origin to destination on the given date"""\n    flights = []\n\n    for flight_id, flight in flight_database.items():\n        if (\n            flight.date_time.year == date.year\n            and flight.date_time.month == date.month\n            and flight.date_time.day == date.day\n            and flight.origin == origin\n            and flight.destination == destination\n        ):\n            flights.append(flight)\n    return flights\n\n@mcp.tool()\ndef fetch_itinerary(confirmation_number: str):\n    """Fetch a booked itinerary information from database"""\n    return itinery_database.get(confirmation_number)\n\n@mcp.tool()\ndef pick_flight(flights: list[Flight]):\n    """Pick up the best flight that matches users\' request."""\n    sorted_flights = sorted(\n        flights,\n        key=lambda x: (\n            x.get("duration") if isinstance(x, dict) else x.duration,\n            x.get("price") if isinstance(x, dict) else x.price,\n        ),\n    )\n    return sorted_flights[0]\n\ndef generate_id(length=8):\n    chars = string.ascii_lowercase + string.digits\n    return "".join(random.choices(chars, k=length))\n\n@mcp.tool()\ndef book_itinerary(flight: Flight, user_profile: UserProfile):\n    """Book a flight on behalf of the user."""\n    confirmation_number = generate_id()\n    while confirmation_number in itinery_database:\n        confirmation_number = generate_id()\n    itinery_database[confirmation_number] = Itinerary(\n        confirmation_number=confirmation_number,\n        user_profile=user_profile,\n        flight=flight,\n    )\n    return confirmation_number, itinery_database[confirmation_number]\n\n@mcp.tool()\ndef cancel_itinerary(confirmation_number: str, user_profile: UserProfile):\n    """Cancel an itinerary on behalf of the user."""\n    if confirmation_number in itinery_database:\n        del itinery_database[confirmation_number]\n        return\n    raise ValueError("Cannot find the itinerary, please check your confirmation number.")\n\n@mcp.tool()\ndef get_user_info(name: str):\n    """Fetch the user profile from database with given name."""\n    return user_database.get(name)\n\n@mcp.tool()\ndef file_ticket(user_request: str, user_profile: UserProfile):\n    """File a customer support ticket if this is something the agent cannot handle."""\n    ticket_id = generate_id(length=6)\n    ticket_database[ticket_id] = Ticket(\n        user_request=user_request,\n        user_profile=user_profile,\n    )\n    return ticket_id\n\nif __name__ == "__main__":\n    mcp.run()\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u542f\u52a8\u670d\u52a1\u5668\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5148\u770b\u4e00\u4e0b\u4ee3\u7801\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4eec\u9996\u5148\u521b\u5efa\u4e86\u4e00\u4e2a ",(0,r.jsx)(e.code,{children:"FastMCP"})," \u5b9e\u4f8b\uff0c\u8fd9\u662f\u4e00\u4e2a\u5e2e\u52a9\u5feb\u901f\u6784\u5efa MCP \u670d\u52a1\u5668\u7684\u5b9e\u7528\u5de5\u5177\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'mcp = FastMCP("Airline Agent")\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u7136\u540e\u6211\u4eec\u5b9a\u4e49\u6570\u636e\u7ed3\u6784\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd9\u5c06\u662f\u6570\u636e\u5e93\u6a21\u5f0f\uff08Schema\uff09\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"class Flight(BaseModel):\n    flight_id: str\n    date_time: Date\n    origin: str\n    destination: str\n    duration: float\n    price: float\n\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u521d\u59cb\u5316\u6570\u636e\u5e93\u5b9e\u4f8b\u3002\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd9\u4e9b\u5c06\u662f\u8fde\u63a5\u5230\u5b9e\u9645\u6570\u636e\u5e93\u7684\u8fde\u63a5\u5668\uff0c\u4f46\u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u53ea\u662f\u4f7f\u7528\u5b57\u5178\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'user_database = {\n    "Adam": UserProfile(user_id="1", name="Adam", email="adam@gmail.com"),\n    "Bob": UserProfile(user_id="2", name="Bob", email="bob@gmail.com"),\n    "Chelsie": UserProfile(user_id="3", name="Chelsie", email="chelsie@gmail.com"),\n    "David": UserProfile(user_id="4", name="David", email="david@gmail.com"),\n}\n\n'})}),"\n",(0,r.jsxs)(e.p,{children:["\u4e0b\u4e00\u6b65\u662f\u5b9a\u4e49\u5de5\u5177\u5e76\u7528 ",(0,r.jsx)(e.code,{children:"@mcp.tool()"})," \u6807\u8bb0\u5b83\u4eec\uff0c\u4ee5\u4fbf MCP \u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u5b83\u4eec\u4f5c\u4e3a MCP \u5de5\u5177\u53d1\u73b0\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'@mcp.tool()\ndef fetch_flight_info(date: Date, origin: str, destination: str):\n    """Fetch flight information from origin to destination on the given date"""\n    flights = []\n\n    for flight_id, flight in flight_database.items():\n        if (\n            flight.date_time.year == date.year\n            and flight.date_time.month == date.month\n            and flight.date_time.day == date.day\n            and flight.origin == origin\n            and flight.destination == destination\n        ):\n            flights.append(flight)\n    return flights\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6700\u540e\u4e00\u6b65\u662f\u542f\u52a8\u670d\u52a1\u5668\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'if __name__ == "__main__":\n    mcp.run()\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u5b8c\u6210\u4e86\u670d\u52a1\u5668\u7684\u7f16\u5199\uff01\u8ba9\u6211\u4eec\u542f\u52a8\u5b83\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"python path_to_your_working_directory/mcp_server.py\n\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u7f16\u5199\u5229\u7528-mcp-\u670d\u52a1\u5668\u4e2d\u5de5\u5177\u7684-dspy-\u7a0b\u5e8f",children:"\u7f16\u5199\u5229\u7528 MCP \u670d\u52a1\u5668\u4e2d\u5de5\u5177\u7684 DSPy \u7a0b\u5e8f"}),"\n",(0,r.jsxs)(e.p,{children:["\u73b0\u5728\u670d\u52a1\u5668\u6b63\u5728\u8fd0\u884c\uff0c\u8ba9\u6211\u4eec\u6784\u5efa\u5b9e\u9645\u7684\u822a\u7a7a\u516c\u53f8\u670d\u52a1\u4ee3\u7406\uff0c\u5b83\u5229\u7528\u6211\u4eec\u670d\u52a1\u5668\u4e2d\u7684 MCP \u5de5\u5177\u6765\u534f\u52a9\u7528\u6237\u3002\u5728\u60a8\u7684\u5de5\u4f5c\u76ee\u5f55\u4e2d\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a ",(0,r.jsx)(e.code,{children:"dspy_mcp_agent.py"})," \u7684\u6587\u4ef6\uff0c\u5e76\u6309\u7167\u6307\u5357\u5411\u5176\u4e2d\u6dfb\u52a0\u4ee3\u7801\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"\u4ece-mcp-\u670d\u52a1\u5668\u6536\u96c6\u5de5\u5177",children:"\u4ece MCP \u670d\u52a1\u5668\u6536\u96c6\u5de5\u5177"}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4eec\u9996\u5148\u9700\u8981\u4ece MCP \u670d\u52a1\u5668\u6536\u96c6\u6240\u6709\u53ef\u7528\u5de5\u5177\uff0c\u5e76\u4f7f\u5b83\u4eec\u53ef\u4f9b DSPy \u4f7f\u7528\u3002DSPy \u63d0\u4f9b\u4e86\u4e00\u4e2a API ",(0,r.jsx)(e.a,{href:"https://dspy.ai/api/primitives/Tool/",children:(0,r.jsx)(e.code,{children:"dspy.Tool"})})," \u4f5c\u4e3a\u6807\u51c6\u5de5\u5177\u63a5\u53e3\u3002\u8ba9\u6211\u4eec\u5c06\u6240\u6709 MCP \u5de5\u5177\u8f6c\u6362\u4e3a ",(0,r.jsx)(e.code,{children:"dspy.Tool"}),"\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a MCP \u5ba2\u6237\u7aef\u5b9e\u4f8b\u6765\u4e0e MCP \u670d\u52a1\u5668\u901a\u4fe1\uff0c\u83b7\u53d6\u6240\u6709\u53ef\u7528\u5de5\u5177\uff0c\u5e76\u4f7f\u7528\u9759\u6001\u65b9\u6cd5 ",(0,r.jsx)(e.code,{children:"from_mcp_tool"})," \u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a ",(0,r.jsx)(e.code,{children:"dspy.Tool"}),"\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from mcp import ClientSession, StdioServerParameters\nfrom mcp.client.stdio import stdio_client\n\n# \u4e3a stdio \u8fde\u63a5\u521b\u5efa\u670d\u52a1\u5668\u53c2\u6570\nserver_params = StdioServerParameters(\n    command="python",  # \u53ef\u6267\u884c\u6587\u4ef6\n    args=["path_to_your_working_directory/mcp_server.py"],\n    env=None,\n)\n\nasync def run():\n    async with stdio_client(server_params) as (read, write):\n        async with ClientSession(read, write) as session:\n            # \u521d\u59cb\u5316\u8fde\u63a5\n            await session.initialize()\n            # \u5217\u51fa\u53ef\u7528\u5de5\u5177\n            tools = await session.list_tools()\n\n            # \u5c06 MCP \u5de5\u5177\u8f6c\u6362\u4e3a DSPy \u5de5\u5177\n            dspy_tools = []\n            for tool in tools.tools:\n                dspy_tools.append(dspy.Tool.from_mcp_tool(session, tool))\n\n            print(len(dspy_tools))\n            print(dspy_tools[0].args)\n\nif __name__ == "__main__":\n    import asyncio\n\n    asyncio.run(run())\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u901a\u8fc7\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u6210\u529f\u6536\u96c6\u4e86\u6240\u6709\u53ef\u7528\u7684 MCP \u5de5\u5177\u5e76\u5c06\u5b83\u4eec\u8f6c\u6362\u4e3a DSPy \u5de5\u5177\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u6784\u5efa-dspy-\u4ee3\u7406\u4ee5\u5904\u7406\u5ba2\u6237\u8bf7\u6c42",children:"\u6784\u5efa DSPy \u4ee3\u7406\u4ee5\u5904\u7406\u5ba2\u6237\u8bf7\u6c42"}),"\n",(0,r.jsxs)(e.p,{children:["\u73b0\u5728\u6211\u4eec\u5c06\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"dspy.ReAct"})," \u6765\u6784\u5efa\u5904\u7406\u5ba2\u6237\u8bf7\u6c42\u7684\u4ee3\u7406\u3002",(0,r.jsx)(e.code,{children:"ReAct"}),' \u4ee3\u8868 "\u63a8\u7406\u548c\u884c\u52a8\uff08Reasoning and Acting\uff09"\uff0c\u5b83\u8981\u6c42 LLM \u51b3\u5b9a\u662f\u8c03\u7528\u5de5\u5177\u8fd8\u662f\u7ed3\u675f\u6d41\u7a0b\u3002\u5982\u679c\u9700\u8981\u5de5\u5177\uff0cLLM \u8d1f\u8d23\u51b3\u5b9a\u8c03\u7528\u54ea\u4e2a\u5de5\u5177\u5e76\u63d0\u4f9b\u9002\u5f53\u7684\u53c2\u6570\u3002']}),"\n",(0,r.jsxs)(e.p,{children:["\u50cf\u5f80\u5e38\u4e00\u6837\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a ",(0,r.jsx)(e.code,{children:"dspy.Signature"})," \u6765\u5b9a\u4e49\u6211\u4eec\u4ee3\u7406\u7684\u8f93\u5165\u548c\u8f93\u51fa\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import dspy\n\nclass DSPyAirlineCustomerService(dspy.Signature):\n    """You are an airline customer service agent. You are given a list of tools to handle user requests. You should decide the right tool to use in order to fulfill users\' requests."""\n\n    user_request: str = dspy.InputField()\n    process_result: str = dspy.OutputField(\n        desc=(\n            "Message that summarizes the process result, and the information users need, "\n            "e.g., the confirmation_number if it\'s a flight booking request."\n        )\n    )\n\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u5e76\u4e3a\u6211\u4eec\u7684\u4ee3\u7406\u9009\u62e9\u4e00\u4e2a LM\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'dspy.configure(lm=dspy.LM("openai/gpt-4o-mini"))\n\n'})}),"\n",(0,r.jsxs)(e.p,{children:["\u7136\u540e\u6211\u4eec\u901a\u8fc7\u5c06\u5de5\u5177\u548c\u7b7e\u540d\u4f20\u9012\u7ed9 ",(0,r.jsx)(e.code,{children:"dspy.ReAct"})," API \u6765\u521b\u5efa ReAct \u4ee3\u7406\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u5b8c\u6574\u7684\u4ee3\u7801\u811a\u672c\u7ec4\u5408\u5728\u4e00\u8d77\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from mcp import ClientSession, StdioServerParameters\nfrom mcp.client.stdio import stdio_client\n\nimport dspy\n\n# \u4e3a stdio \u8fde\u63a5\u521b\u5efa\u670d\u52a1\u5668\u53c2\u6570\nserver_params = StdioServerParameters(\n    command="python",  # \u53ef\u6267\u884c\u6587\u4ef6\n    args=["script_tmp/mcp_server.py"],  # \u53ef\u9009\u7684\u547d\u4ee4\u884c\u53c2\u6570\n    env=None,  # \u53ef\u9009\u7684\u73af\u5883\u53d8\u91cf\n)\n\nclass DSPyAirlineCustomerService(dspy.Signature):\n    """You are an airline customer service agent. You are given a list of tools to handle user requests.\n    You should decide the right tool to use in order to fulfill users\' requests."""\n\n    user_request: str = dspy.InputField()\n    process_result: str = dspy.OutputField(\n        desc=(\n            "Message that summarizes the process result, and the information users need, "\n            "e.g., the confirmation_number if it\'s a flight booking request."\n        )\n    )\n\ndspy.configure(lm=dspy.LM("openai/gpt-4o-mini"))\n\nasync def run(user_request):\n    async with stdio_client(server_params) as (read, write):\n        async with ClientSession(read, write) as session:\n            # \u521d\u59cb\u5316\u8fde\u63a5\n            await session.initialize()\n            # \u5217\u51fa\u53ef\u7528\u5de5\u5177\n            tools = await session.list_tools()\n\n            # \u5c06 MCP \u5de5\u5177\u8f6c\u6362\u4e3a DSPy \u5de5\u5177\n            dspy_tools = []\n            for tool in tools.tools:\n                dspy_tools.append(dspy.Tool.from_mcp_tool(session, tool))\n\n            # \u521b\u5efa\u4ee3\u7406\n            react = dspy.ReAct(DSPyAirlineCustomerService, tools=dspy_tools)\n\n            result = await react.acall(user_request=user_request)\n            print(result)\n\nif __name__ == "__main__":\n    import asyncio\n\n    asyncio.run(run("please help me book a flight from SFO to JFK on 09/01/2025, my name is Adam"))\n\n'})}),"\n",(0,r.jsxs)(e.p,{children:["\u6ce8\u610f\uff0c\u6211\u4eec\u5fc5\u987b\u8c03\u7528 ",(0,r.jsx)(e.code,{children:"react.acall"}),"\uff0c\u56e0\u4e3a MCP \u5de5\u5177\u9ed8\u8ba4\u662f\u5f02\u6b65\u7684\u3002\u8ba9\u6211\u4eec\u6267\u884c\u8be5\u811a\u672c\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"python path_to_your_working_directory/dspy_mcp_agent.py\n\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u60a8\u5e94\u8be5\u4f1a\u770b\u5230\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u7684\u8f93\u51fa\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'Prediction(\n    trajectory={\'thought_0\': \'I need to fetch flight information for Adam from SFO to JFK on 09/01/2025 to find available flights for booking.\', \'tool_name_0\': \'fetch_flight_info\', \'tool_args_0\': {\'date\': {\'year\': 2025, \'month\': 9, \'day\': 1, \'hour\': 0}, \'origin\': \'SFO\', \'destination\': \'JFK\'}, \'observation_0\': [\'{"flight_id": "DA123", "date_time": {"year": 2025, "month": 9, "day": 1, "hour": 1}, "origin": "SFO", "destination": "JFK", "duration": 3.0, "price": 200.0}\', \'{"flight_id": "DA125", "date_time": {"year": 2025, "month": 9, "day": 1, "hour": 7}, "origin": "SFO", "destination": "JFK", "duration": 9.0, "price": 500.0}\'], ..., \'tool_name_4\': \'finish\', \'tool_args_4\': {}, \'observation_4\': \'Completed.\'},\n    reasoning="I successfully booked a flight for Adam from SFO to JFK on 09/01/2025. I found two available flights, selected the more economical option (flight DA123 at 1 AM for $200), retrieved Adam\'s user profile, and completed the booking process. The confirmation number for the flight is 8h7clk3q.",\n    process_result=\'Your flight from SFO to JFK on 09/01/2025 has been successfully booked. Your confirmation number is 8h7clk3q.\'\n)\n\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"trajectory"})," \u5b57\u6bb5\u5305\u542b\u6574\u4e2a\u601d\u8003\u548c\u884c\u52a8\u8fc7\u7a0b\u3002\u5982\u679c\u60a8\u5bf9\u5e95\u5c42\u53d1\u751f\u7684\u4e8b\u60c5\u611f\u5230\u597d\u5947\uff0c\u8bf7\u67e5\u770b ",(0,r.jsx)(e.a,{href:"https://dspy.ai/tutorials/observability/",children:"\u53ef\u89c2\u6d4b\u6027\u6307\u5357"})," \u4ee5\u8bbe\u7f6e MLflow\uff0c\u5b83\u53ef\u4ee5\u53ef\u89c6\u5316 ",(0,r.jsx)(e.code,{children:"dspy.ReAct"})," \u5185\u90e8\u53d1\u751f\u7684\u6bcf\u4e00\u6b65\uff01"]}),"\n",(0,r.jsx)(e.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u672c\u6307\u5357\u4e2d\uff0c\u6211\u4eec\u6784\u5efa\u4e86\u4e00\u4e2a\u5229\u7528\u81ea\u5b9a\u4e49 MCP \u670d\u52a1\u5668\u548c ",(0,r.jsx)(e.code,{children:"dspy.ReAct"})," \u6a21\u5757\u7684\u822a\u7a7a\u516c\u53f8\u670d\u52a1\u4ee3\u7406\u3002\u5728 MCP \u652f\u6301\u7684\u80cc\u666f\u4e0b\uff0cDSPy \u4e3a\u4e0e MCP \u5de5\u5177\u4ea4\u4e92\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u63a5\u53e3\uff0c\u4f7f\u60a8\u53ef\u4ee5\u7075\u6d3b\u5730\u5b9e\u73b0\u6240\u9700\u7684\u4efb\u4f55\u529f\u80fd\u3002"]})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},54213:(n,e,i)=>{i.d(e,{R:()=>o,x:()=>a});var t=i(36672);const r={},s=t.createContext(r);function o(n){const e=t.useContext(s);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:o(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);