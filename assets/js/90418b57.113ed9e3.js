"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[50931],{35754:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u6a21\u5757","title":"\u6a21\u5757","description":"DSPy \u6a21\u5757 \u662f\u4f7f\u7528 LM \u7684\u7a0b\u5e8f\u7684\u6784\u5efa\u5757\u3002","source":"@site/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u6a21\u5757.md","sourceDirName":"AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b","slug":"/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u6a21\u5757","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u6a21\u5757","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u6a21\u5757.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"ai","previous":{"title":"mcp","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/mcp"},"next":{"title":"\u65ad\u8a00","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u65ad\u8a00"}}');var i=s(23420),r=s(54213);const o={sidebar_position:3},c=void 0,a={},l=[{value:"\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5185\u7f6e\u6a21\u5757\uff0c\u5982 <code>dspy.Predict</code> \u6216 <code>dspy.ChainOfThought</code>\uff1f",id:"\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5185\u7f6e\u6a21\u5757\u5982-dspypredict-\u6216-dspychainofthought",level:2},{value:"\u8fd8\u6709\u54ea\u4e9b\u5176\u4ed6 DSPy \u6a21\u5757\uff1f\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\uff1f",id:"\u8fd8\u6709\u54ea\u4e9b\u5176\u4ed6-dspy-\u6a21\u5757\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5b83\u4eec",level:2},{value:"\u6211\u5982\u4f55\u5c06\u591a\u4e2a\u6a21\u5757\u7ec4\u5408\u6210\u4e00\u4e2a\u66f4\u5927\u7684\u7a0b\u5e8f\uff1f",id:"\u6211\u5982\u4f55\u5c06\u591a\u4e2a\u6a21\u5757\u7ec4\u5408\u6210\u4e00\u4e2a\u66f4\u5927\u7684\u7a0b\u5e8f",level:2},{value:"\u6211\u5982\u4f55\u8ddf\u8e2a LM \u7684\u4f7f\u7528\u60c5\u51b5\uff1f",id:"\u6211\u5982\u4f55\u8ddf\u8e2a-lm-\u7684\u4f7f\u7528\u60c5\u51b5",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"DSPy \u6a21\u5757"})," \u662f\u4f7f\u7528 LM \u7684\u7a0b\u5e8f\u7684\u6784\u5efa\u5757\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u6bcf\u4e2a\u5185\u7f6e\u6a21\u5757\u62bd\u8c61\u4e86\u4e00\u79cd ",(0,i.jsx)(n.strong,{children:"\u63d0\u793a\u6280\u672f"}),"\uff08\u5982\u601d\u7ef4\u94fe Chain of Thought \u6216 ReAct\uff09\u3002\u81f3\u5173\u91cd\u8981\u7684\u662f\uff0c\u5b83\u4eec\u88ab\u6cdb\u5316\u4ee5\u5904\u7406\u4efb\u4f55\u7b7e\u540d\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["DSPy \u6a21\u5757\u5177\u6709 ",(0,i.jsx)(n.strong,{children:"\u53ef\u5b66\u4e60\u7684\u53c2\u6570"}),"\uff08\u5373\u6784\u6210\u63d0\u793a\u7684\u5c0f\u7247\u6bb5\u548c LM \u6743\u91cd\uff09\uff0c\u5e76\u4e14\u53ef\u4ee5\u88ab\u8c03\u7528\u4ee5\u5904\u7406\u8f93\u5165\u5e76\u8fd4\u56de\u8f93\u51fa\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u591a\u4e2a\u6a21\u5757\u53ef\u4ee5\u7ec4\u5408\u6210\u66f4\u5927\u7684\u6a21\u5757\uff08\u7a0b\u5e8f\uff09\u3002DSPy \u6a21\u5757\u76f4\u63a5\u53d7 PyTorch \u4e2d NN \u6a21\u5757\u7684\u542f\u53d1\uff0c\u4f46\u5e94\u7528\u4e8e LM \u7a0b\u5e8f\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5185\u7f6e\u6a21\u5757\u5982-dspypredict-\u6216-dspychainofthought",children:["\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5185\u7f6e\u6a21\u5757\uff0c\u5982 ",(0,i.jsx)(n.code,{children:"dspy.Predict"})," \u6216 ",(0,i.jsx)(n.code,{children:"dspy.ChainOfThought"}),"\uff1f"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8ba9\u6211\u4eec\u4ece\u6700\u57fa\u7840\u7684\u6a21\u5757 ",(0,i.jsx)(n.code,{children:"dspy.Predict"})," \u5f00\u59cb\u3002\u5728\u5185\u90e8\uff0c\u6240\u6709\u5176\u4ed6 DSPy \u6a21\u5757\u90fd\u662f\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"dspy.Predict"})," \u6784\u5efa\u7684\u3002\u6211\u4eec\u5047\u8bbe\u4f60\u5df2\u7ecf\u81f3\u5c11\u7a0d\u5fae\u719f\u6089 DSPy \u7b7e\u540d\uff0c\u8fd9\u662f\u7528\u4e8e\u5b9a\u4e49\u6211\u4eec\u5728 DSPy \u4e2d\u4f7f\u7528\u7684\u4efb\u4f55\u6a21\u5757\u884c\u4e3a\u7684\u58f0\u660e\u6027\u89c4\u8303\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u4f7f\u7528\u6a21\u5757\uff0c\u6211\u4eec\u9996\u5148\u901a\u8fc7\u4e3a\u5176\u63d0\u4f9b\u7b7e\u540d\u6765 ",(0,i.jsx)(n.strong,{children:"\u58f0\u660e"})," \u5b83\u3002\u7136\u540e\u6211\u4eec\u4f7f\u7528\u8f93\u5165\u53c2\u6570 ",(0,i.jsx)(n.strong,{children:"\u8c03\u7528"})," \u8be5\u6a21\u5757\uff0c\u5e76\u63d0\u53d6\u8f93\u51fa\u5b57\u6bb5\uff01"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"sentence = \"it's a charming and often affecting journey.\"  # \u6765\u81ea SST-2 \u6570\u636e\u96c6\u7684\u793a\u4f8b\u3002\n\n# 1) \u7528\u7b7e\u540d\u58f0\u660e\u3002\nclassify = dspy.Predict('sentence -> sentiment: bool')\n\n# 2) \u4f7f\u7528\u8f93\u5165\u53c2\u6570\u8c03\u7528\u3002 \nresponse = classify(sentence=sentence)\n\n# 3) \u8bbf\u95ee\u8f93\u51fa\u3002\nprint(response.sentiment)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"True\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u6211\u4eec\u58f0\u660e\u4e00\u4e2a\u6a21\u5757\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5411\u5176\u4f20\u9012\u914d\u7f6e\u952e\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0b\u9762\uff0c\u6211\u4eec\u5c06\u4f20\u9012 ",(0,i.jsx)(n.code,{children:"n=5"})," \u6765\u8bf7\u6c42\u4e94\u4e2a\u8865\u5168\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f20\u9012 ",(0,i.jsx)(n.code,{children:"temperature"})," \u6216 ",(0,i.jsx)(n.code,{children:"max_len"})," \u7b49\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8ba9\u6211\u4eec\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"dspy.ChainOfThought"}),"\u3002\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u7b80\u5355\u5730\u7528 ",(0,i.jsx)(n.code,{children:"dspy.ChainOfThought"})," \u66ff\u6362 ",(0,i.jsx)(n.code,{children:"dspy.Predict"})," \u5c31\u80fd\u63d0\u9ad8\u8d28\u91cf\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"question = \"What's something great about the ColBERT retrieval model?\"\n\n# 1) \u7528\u7b7e\u540d\u58f0\u660e\uff0c\u5e76\u4f20\u9012\u4e00\u4e9b\u914d\u7f6e\u3002\nclassify = dspy.ChainOfThought('question -> answer', n=5)\n\n# 2) \u4f7f\u7528\u8f93\u5165\u53c2\u6570\u8c03\u7528\u3002\nresponse = classify(question=question)\n\n# 3) \u8bbf\u95ee\u8f93\u51fa\u3002\nresponse.completions.answer\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"['One great thing about the ColBERT retrieval model is its superior efficiency and effectiveness compared to other models.',\n 'Its ability to efficiently retrieve relevant information from large document collections.',\n 'One great thing about the ColBERT retrieval model is its superior performance compared to other models and its efficient use of pre-trained language models.',\n 'One great thing about the ColBERT retrieval model is its superior efficiency and accuracy compared to other models.',\n 'One great thing about the ColBERT retrieval model is its ability to incorporate user feedback and support complex queries.']\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8ba9\u6211\u4eec\u5728\u8fd9\u91cc\u8ba8\u8bba\u4e00\u4e0b\u8f93\u51fa\u5bf9\u8c61\u3002",(0,i.jsx)(n.code,{children:"dspy.ChainOfThought"})," \u6a21\u5757\u901a\u5e38\u4f1a\u5728\u7b7e\u540d\u7684\u8f93\u51fa\u5b57\u6bb5\u4e4b\u524d\u6ce8\u5165 ",(0,i.jsx)(n.code,{children:"reasoning"}),"\uff08\u63a8\u7406\uff09\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u8ba9\u6211\u4eec\u68c0\u67e5\uff08\u7b2c\u4e00\u4e2a\uff09\u63a8\u7406\u548c\u7b54\u6848\uff01"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'print(f"Reasoning: {response.reasoning}")\nprint(f"Answer: {response.answer}")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Reasoning: We can consider the fact that ColBERT has shown to outperform other state-of-the-art retrieval models in terms of efficiency and effectiveness. It uses contextualized embeddings and performs document retrieval in a way that is both accurate and scalable.\nAnswer: One great thing about the ColBERT retrieval model is its superior efficiency and effectiveness compared to other models.\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u65e0\u8bba\u6211\u4eec\u8bf7\u6c42\u4e00\u4e2a\u8fd8\u662f\u591a\u4e2a\u8865\u5168\uff0c\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5b83\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u4eec\u8fd8\u53ef\u4ee5\u5c06\u4e0d\u540c\u7684\u8865\u5168\u4f5c\u4e3a ",(0,i.jsx)(n.code,{children:"Prediction"})," \u5217\u8868\u6216\u591a\u4e2a\u5217\u8868\uff08\u6bcf\u4e2a\u5b57\u6bb5\u4e00\u4e2a\uff09\u6765\u8bbf\u95ee\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"response.completions[3].reasoning == response.completions.reasoning[3]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"True\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u8fd8\u6709\u54ea\u4e9b\u5176\u4ed6-dspy-\u6a21\u5757\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5b83\u4eec",children:"\u8fd8\u6709\u54ea\u4e9b\u5176\u4ed6 DSPy \u6a21\u5757\uff1f\u6211\u8be5\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u4ed6\u7684\u975e\u5e38\u76f8\u4f3c\u3002\u5b83\u4eec\u4e3b\u8981\u6539\u53d8\u5b9e\u73b0\u7b7e\u540d\u7684\u5185\u90e8\u884c\u4e3a\uff01"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dspy.Predict"})}),": \u57fa\u672c\u9884\u6d4b\u5668\u3002\u4e0d\u4fee\u6539\u7b7e\u540d\u3002\u5904\u7406\u5b66\u4e60\u7684\u5173\u952e\u5f62\u5f0f\uff08\u5373\u5b58\u50a8\u6307\u4ee4\u548c\u6f14\u793a\u4ee5\u53ca\u5bf9 LM \u7684\u66f4\u65b0\uff09\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dspy.ChainOfThought"})}),": \u6559\u5bfc LM \u5728\u63d0\u4ea4\u7b7e\u540d\u7684\u54cd\u5e94\u4e4b\u524d\u9010\u6b65\u601d\u8003\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dspy.ProgramOfThought"})}),": \u6559\u5bfc LM \u8f93\u51fa\u4ee3\u7801\uff0c\u5176\u6267\u884c\u7ed3\u679c\u5c06\u51b3\u5b9a\u54cd\u5e94\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dspy.ReAct"})}),": \u4e00\u4e2a\u53ef\u4ee5\u4f7f\u7528\u5de5\u5177\u6765\u5b9e\u73b0\u7ed9\u5b9a\u7b7e\u540d\u7684\u667a\u80fd\u4f53\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dspy.MultiChainComparison"})}),": \u53ef\u4ee5\u6bd4\u8f83\u6765\u81ea ",(0,i.jsx)(n.code,{children:"ChainOfThought"})," \u7684\u591a\u4e2a\u8f93\u51fa\u4ee5\u4ea7\u751f\u6700\u7ec8\u9884\u6d4b\u3002"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u4eec\u8fd8\u6709\u4e00\u4e9b\u51fd\u6570\u5f0f\u6a21\u5757\uff1a"}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"dspy.majority"})}),": \u53ef\u4ee5\u8fdb\u884c\u57fa\u672c\u6295\u7968\uff0c\u4ece\u4e00\u7ec4\u9884\u6d4b\u4e2d\u8fd4\u56de\u6700\u53d7\u6b22\u8fce\u7684\u54cd\u5e94\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:['!!! info "\u7b80\u5355\u4efb\u52a1\u4e0a\u7684 DSPy \u6a21\u5757\u793a\u4f8b\u3002"\n\u914d\u7f6e\u597d ',(0,i.jsx)(n.code,{children:"lm"})," \u540e\uff0c\u5c1d\u8bd5\u4e0b\u9762\u7684\u793a\u4f8b\u3002\u8c03\u6574\u5b57\u6bb5\u4ee5\u63a2\u7d22\u4f60\u7684 LM \u5f00\u7bb1\u5373\u7528\u5730\u53ef\u4ee5\u5f88\u597d\u5730\u5b8c\u6210\u54ea\u4e9b\u4efb\u52a1\u3002"]}),"\n",(0,i.jsx)(n.p,{children:'=== "\u6570\u5b66 (Math)"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'linenums="1"',children:'math = dspy.ChainOfThought("question -> answer: float")\nmath(question="Two dice are tossed. What is the probability that the sum equals two?")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Prediction(\n    reasoning='When two dice are tossed, each die has 6 faces, resulting in a total of 6 x 6 = 36 possible outcomes. The sum of the numbers on the two dice equals two only when both dice show a 1. This is just one specific outcome: (1, 1). Therefore, there is only 1 favorable outcome. The probability of the sum being two is the number of favorable outcomes divided by the total number of possible outcomes, which is 1/36.',\n    answer=0.0277776\n)\n"})}),"\n",(0,i.jsx)(n.p,{children:'=== "\u68c0\u7d22\u589e\u5f3a\u751f\u6210 (RAG)"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'linenums="1"       ',children:'def search(query: str) -> list[str]:\n    """Retrieves abstracts from Wikipedia."""\n    results = dspy.ColBERTv2(url=\'http://20.102.90.50:2017/wiki17_abstracts\')(query, k=3)\n    return [x[\'text\'] for x in results]\n\nrag = dspy.ChainOfThought(\'context, question -> response\')\n\nquestion = "What\'s the name of the castle that David Gregory inherited?"\nrag(context=search(question), question=question)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Prediction(\n    reasoning='The context provides information about David Gregory, a Scottish physician and inventor. It specifically mentions that he inherited Kinnairdy Castle in 1664. This detail directly answers the question about the name of the castle that David Gregory inherited.',\n    response='Kinnairdy Castle'\n)\n"})}),"\n",(0,i.jsx)(n.p,{children:'=== "\u5206\u7c7b (Classification)"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'linenums="1"',children:'from typing import Literal\n\nclass Classify(dspy.Signature):\n    """Classify sentiment of a given sentence."""\n    \n    sentence: str = dspy.InputField()\n    sentiment: Literal[\'positive\', \'negative\', \'neutral\'] = dspy.OutputField()\n    confidence: float = dspy.OutputField()\n\nclassify = dspy.Predict(Classify)\nclassify(sentence="This book was super fun to read, though not the last chapter.")\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Prediction(\n    sentiment='positive',\n    confidence=0.75\n)\n"})}),"\n",(0,i.jsx)(n.p,{children:'=== "\u4fe1\u606f\u63d0\u53d6 (Information Extraction)"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'linenums="1"        ',children:'text = "Apple Inc. announced its latest iPhone 14 today. The CEO, Tim Cook, highlighted its new features in a press release."\n\nmodule = dspy.Predict("text -> title, headings: list[str], entities_and_metadata: list[dict[str, str]]")\nresponse = module(text=text)\n\nprint(response.title)\nprint(response.headings)\nprint(response.entities_and_metadata)\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Apple Unveils iPhone 14\n['Introduction', 'Key Features', \"CEO's Statement\"]\n[{'entity': 'Apple Inc.', 'type': 'Organization'}, {'entity': 'iPhone 14', 'type': 'Product'}, {'entity': 'Tim Cook', 'type': 'Person'}]\n"})}),"\n",(0,i.jsx)(n.p,{children:'=== "\u667a\u80fd\u4f53 (Agents)"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'linenums="1"       ',children:"def evaluate_math(expression: str) -> float:\n    return dspy.PythonInterpreter({}).execute(expression)\n\ndef search_wikipedia(query: str) -> str:\n    results = dspy.ColBERTv2(url='http://20.102.90.50:2017/wiki17_abstracts')(query, k=3)\n    return [x['text'] for x in results]\n\nreact = dspy.ReAct(\"question -> answer: float\", tools=[evaluate_math, search_wikipedia])\n\npred = react(question=\"What is 9362158 divided by the year of birth of David Gregory of Kinnairdy castle?\")\nprint(pred.answer)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u53ef\u80fd\u7684\u8f93\u51fa:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"5761.328\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6211\u5982\u4f55\u5c06\u591a\u4e2a\u6a21\u5757\u7ec4\u5408\u6210\u4e00\u4e2a\u66f4\u5927\u7684\u7a0b\u5e8f",children:"\u6211\u5982\u4f55\u5c06\u591a\u4e2a\u6a21\u5757\u7ec4\u5408\u6210\u4e00\u4e2a\u66f4\u5927\u7684\u7a0b\u5e8f\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["DSPy \u53ea\u662f\u4f7f\u7528\u6a21\u5757\u7684 Python \u4ee3\u7801\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u4f60\u559c\u6b22\u7684\u63a7\u5236\u6d41\uff0c\u53ea\u662f\u5728 ",(0,i.jsx)(n.code,{children:"compile"})," \u65f6\u5185\u90e8\u6709\u4e00\u4e9b\u9b54\u6cd5\u6765\u8ddf\u8e2a\u4f60\u7684 LM \u8c03\u7528\u3002\u8fd9\u610f\u5473\u7740\uff0c\u4f60\u53ef\u4ee5\u81ea\u7531\u5730\u8c03\u7528\u6a21\u5757\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8bf7\u53c2\u9605\u8bf8\u5982 ",(0,i.jsx)(n.a,{href:"https://dspy.ai/tutorials/multihop_search/",children:"\u591a\u8df3\u641c\u7d22"})," \u4e4b\u7c7b\u7684\u6559\u7a0b\uff0c\u5176\u6a21\u5757\u5982\u4e0b\u4f8b\u6240\u793a\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'linenums="1"        ',children:"class Hop(dspy.Module):\n    def __init__(self, num_docs=10, num_hops=4):\n        self.num_docs, self.num_hops = num_docs, num_hops\n        self.generate_query = dspy.ChainOfThought('claim, notes -> query')\n        self.append_notes = dspy.ChainOfThought('claim, notes, context -> new_notes: list[str], titles: list[str]')\n\n    def forward(self, claim: str) -> list[str]:\n        notes = []\n        titles = []\n\n        for _ in range(self.num_hops):\n            query = self.generate_query(claim=claim, notes=notes).query\n            context = search(query, k=self.num_docs)\n            prediction = self.append_notes(claim=claim, notes=notes, context=context)\n            notes.extend(prediction.new_notes)\n            titles.extend(prediction.titles)\n        \n        return dspy.Prediction(notes=notes, titles=list(set(titles)))\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u540e\u4f60\u53ef\u4ee5\u521b\u5efa\u81ea\u5b9a\u4e49\u6a21\u5757\u7c7b ",(0,i.jsx)(n.code,{children:"Hop"})," \u7684\u5b9e\u4f8b\uff0c\u7136\u540e\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"__call__"})," \u65b9\u6cd5\u8c03\u7528\u5b83\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'hop = Hop()\nprint(hop(claim="Stephen Curry is the best 3 pointer shooter ever in the human history"))\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6211\u5982\u4f55\u8ddf\u8e2a-lm-\u7684\u4f7f\u7528\u60c5\u51b5",children:"\u6211\u5982\u4f55\u8ddf\u8e2a LM \u7684\u4f7f\u7528\u60c5\u51b5\uff1f"}),"\n",(0,i.jsx)(n.p,{children:'!!! note "\u7248\u672c\u8981\u6c42"\nLM \u4f7f\u7528\u60c5\u51b5\u8ddf\u8e2a\u5728 DSPy \u7248\u672c 2.6.16 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u53ef\u7528\u3002'}),"\n",(0,i.jsx)(n.p,{children:"DSPy \u63d0\u4f9b\u4e86\u8de8\u6240\u6709\u6a21\u5757\u8c03\u7528\u8ddf\u8e2a\u8bed\u8a00\u6a21\u578b\u4f7f\u7528\u60c5\u51b5\u7684\u5185\u7f6e\u529f\u80fd\u3002\u8981\u542f\u7528\u8ddf\u8e2a\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"dspy.configure(track_usage=True)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u542f\u7528\u540e\uff0c\u4f60\u53ef\u4ee5\u4ece\u4efb\u4f55 ",(0,i.jsx)(n.code,{children:"dspy.Prediction"})," \u5bf9\u8c61\u8bbf\u95ee\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"usage = prediction_instance.get_lm_usage()\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528\u6570\u636e\u4f5c\u4e3a\u5b57\u5178\u8fd4\u56de\uff0c\u8be5\u5b57\u5178\u5c06\u6bcf\u4e2a\u8bed\u8a00\u6a21\u578b\u540d\u79f0\u6620\u5c04\u5230\u5176\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\u3002\u8fd9\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u793a\u4f8b\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import dspy\n\n# \u914d\u7f6e DSPy \u542f\u7528\u8ddf\u8e2a\ndspy.configure(\n    lm=dspy.LM("openai/gpt-4o-mini", cache=False),\n    track_usage=True\n)\n\n# \u5b9a\u4e49\u4e00\u4e2a\u8fdb\u884c\u591a\u6b21 LM \u8c03\u7528\u7684\u7b80\u5355\u7a0b\u5e8f\nclass MyProgram(dspy.Module):\n    def __init__(self):\n        self.predict1 = dspy.ChainOfThought("question -> answer")\n        self.predict2 = dspy.ChainOfThought("question, answer -> score")\n\n    def __call__(self, question: str) -> str:\n        answer = self.predict1(question=question)\n        score = self.predict2(question=question, answer=answer)\n        return score\n\n# \u8fd0\u884c\u7a0b\u5e8f\u5e76\u68c0\u67e5\u4f7f\u7528\u60c5\u51b5\nprogram = MyProgram()\noutput = program(question="What is the capital of France?")\nprint(output.get_lm_usage())\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u5c06\u8f93\u51fa\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"{\n    'openai/gpt-4o-mini': {\n        'completion_tokens': 61,\n        'prompt_tokens': 260,\n        'total_tokens': 321,\n        'completion_tokens_details': {\n            'accepted_prediction_tokens': 0,\n            'audio_tokens': 0,\n            'reasoning_tokens': 0,\n            'rejected_prediction_tokens': 0,\n            'text_tokens': None\n        },\n        'prompt_tokens_details': {\n            'audio_tokens': 0,\n            'cached_tokens': 0,\n            'text_tokens': None,\n            'image_tokens': None\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u4f7f\u7528 DSPy \u7684\u7f13\u5b58\u529f\u80fd\uff08\u65e0\u8bba\u662f\u5185\u5b58\u4e2d\u8fd8\u662f\u901a\u8fc7 litellm \u5728\u78c1\u76d8\u4e0a\uff09\u65f6\uff0c\u7f13\u5b58\u7684\u54cd\u5e94\u4e0d\u4f1a\u8ba1\u5165\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\u3002\u4f8b\u5982\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u542f\u7528\u7f13\u5b58\ndspy.configure(\n    lm=dspy.LM("openai/gpt-4o-mini", cache=True),\n    track_usage=True\n)\n\nprogram = MyProgram()\n\n# \u7b2c\u4e00\u6b21\u8c03\u7528 - \u5c06\u663e\u793a\u4f7f\u7528\u60c5\u51b5\u7edf\u8ba1\u4fe1\u606f\noutput = program(question="What is the capital of Zambia?")\nprint(output.get_lm_usage())  # \u663e\u793a\u4ee4\u724c\u4f7f\u7528\u60c5\u51b5\n\n# \u7b2c\u4e8c\u6b21\u8c03\u7528 - \u76f8\u540c\u7684\u95ee\u9898\uff0c\u5c06\u4f7f\u7528\u7f13\u5b58\noutput = program(question="What is the capital of Zambia?")\nprint(output.get_lm_usage())  # \u663e\u793a\u7a7a\u5b57\u5178: {}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},54213:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(36672);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);