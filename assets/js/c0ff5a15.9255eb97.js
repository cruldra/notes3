"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[22770],{17953:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u65ad\u8a00","title":"\u65ad\u8a00","description":"!!! warning \\"\u65ad\u8a00\u5df2\u88ab\u5f03\u7528\u4e14\u4e0d\u518d\u652f\u6301\u3002\u8bf7\u6539\u7528 dspy.Refine \u6a21\u5757\uff08\u6216 dspy.Suggest\uff09\u3002\\"","source":"@site/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u65ad\u8a00.md","sourceDirName":"AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b","slug":"/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u65ad\u8a00","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u65ad\u8a00","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u65ad\u8a00.md","tags":[],"version":"current","frontMatter":{},"sidebar":"ai","previous":{"title":"\u6a21\u5757","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u6a21\u5757"},"next":{"title":"\u9002\u914d\u5668","permalink":"/notes3/docs/AI/\u63d0\u793a\u8bcd\u5de5\u7a0b/DSPy/\u5b66\u4e60/\u7f16\u7a0b/\u9002\u914d\u5668"}}');var t=s(23420),i=s(54213);const a={},o=void 0,l={},d=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"dspy.Assert \u548c dspy.Suggest API",id:"dspyassert-\u548c-dspysuggest-api",level:3},{value:"\u7528\u4f8b\uff1a\u5728 DSPy \u7a0b\u5e8f\u4e2d\u5305\u542b\u65ad\u8a00",id:"\u7528\u4f8b\u5728-dspy-\u7a0b\u5e8f\u4e2d\u5305\u542b\u65ad\u8a00",level:2},{value:"\u65ad\u8a00\u9a71\u52a8\u7684\u4f18\u5316",id:"\u65ad\u8a00\u9a71\u52a8\u7684\u4f18\u5316",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:['!!! warning "\u65ad\u8a00\u5df2\u88ab\u5f03\u7528\u4e14\u4e0d\u518d\u652f\u6301\u3002\u8bf7\u6539\u7528 ',(0,t.jsx)(n.code,{children:"dspy.Refine"})," \u6a21\u5757\uff08\u6216 ",(0,t.jsx)(n.code,{children:"dspy.Suggest"}),'\uff09\u3002"']}),"\n",(0,t.jsx)(n.p,{children:"\u4ee5\u4e0b\u5185\u5bb9\u5df2\u88ab\u5f03\u7528\uff0c\u5e76\u8ba1\u5212\u79fb\u9664\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"}),"\n",(0,t.jsx)(n.p,{children:"\u8bed\u8a00\u6a21\u578b (LM) \u6539\u53d8\u4e86\u6211\u4eec\u4e0e\u673a\u5668\u5b66\u4e60\u4ea4\u4e92\u7684\u65b9\u5f0f\uff0c\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u81ea\u7136\u8bed\u8a00\u7406\u89e3\u548c\u751f\u6210\u80fd\u529b\u3002\u7136\u800c\uff0c\u786e\u4fdd\u8fd9\u4e9b\u6a21\u578b\u9075\u5b88\u7279\u5b9a\u9886\u57df\u7684\u7ea6\u675f\u4ecd\u7136\u662f\u4e00\u4e2a\u6311\u6218\u3002\u5c3d\u7ba1\u5fae\u8c03\u6216\u201c\u63d0\u793a\u5de5\u7a0b\u201d\u7b49\u6280\u672f\u6709\u6240\u53d1\u5c55\uff0c\u4f46\u8fd9\u4e9b\u65b9\u6cd5\u6781\u5176\u7e41\u7410\uff0c\u5e76\u4e14\u4f9d\u8d56\u4e8e\u5927\u91cf\u7684\u624b\u5de5\u8c03\u6574\u6765\u5f15\u5bfc LM \u9075\u5b88\u7279\u5b9a\u7ea6\u675f\u3002\u5373\u4f7f\u662f DSPy \u7684\u7f16\u7a0b\u63d0\u793a\u7ba1\u9053\u6a21\u5757\u5316\uff0c\u4e5f\u7f3a\u4e4f\u6709\u6548\u81ea\u52a8\u6267\u884c\u8fd9\u4e9b\u7ea6\u675f\u7684\u673a\u5236\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5f15\u5165\u4e86 DSPy Assertions\uff08\u65ad\u8a00\uff09\uff0c\u8fd9\u662f DSPy \u6846\u67b6\u5185\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u65e8\u5728\u81ea\u52a8\u6267\u884c\u5bf9 LM \u7684\u8ba1\u7b97\u7ea6\u675f\u3002DSPy Assertions \u4f7f\u5f00\u53d1\u4eba\u5458\u80fd\u591f\u4ee5\u6700\u5c11\u7684\u624b\u52a8\u5e72\u9884\u5f15\u5bfc LM \u8fbe\u5230\u9884\u671f\u7684\u7ed3\u679c\uff0c\u4ece\u800c\u63d0\u9ad8 LM \u8f93\u51fa\u7684\u53ef\u9760\u6027\u3001\u53ef\u9884\u6d4b\u6027\u548c\u6b63\u786e\u6027\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"dspyassert-\u548c-dspysuggest-api",children:"dspy.Assert \u548c dspy.Suggest API"}),"\n",(0,t.jsx)(n.p,{children:"\u6211\u4eec\u5728 DSPy Assertions \u4e2d\u5f15\u5165\u4e86\u4e24\u4e2a\u4e3b\u8981\u6784\u9020\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"dspy.Assert"})}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u6570"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"constraint (bool)"}),": Python \u5b9a\u4e49\u7684\u5e03\u5c14\u9a8c\u8bc1\u68c0\u67e5\u7684\u7ed3\u679c\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"msg (Optional[str])"}),": \u7528\u6237\u5b9a\u4e49\u7684\u9519\u8bef\u6d88\u606f\uff0c\u63d0\u4f9b\u53cd\u9988\u6216\u66f4\u6b63\u6307\u5bfc\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backtrack (Optional[module])"}),": \u6307\u5b9a\u7ea6\u675f\u5931\u8d25\u65f6\u91cd\u8bd5\u7684\u76ee\u6807\u6a21\u5757\u3002\u9ed8\u8ba4\u7684\u56de\u6eaf\u6a21\u5757\u662f\u65ad\u8a00\u4e4b\u524d\u7684\u6700\u540e\u4e00\u4e2a\u6a21\u5757\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u884c\u4e3a"}),": \u5728\u5931\u8d25\u65f6\u542f\u52a8\u91cd\u8bd5\uff0c\u52a8\u6001\u8c03\u6574\u7ba1\u9053\u7684\u6267\u884c\u3002\u5982\u679c\u5931\u8d25\u6301\u7eed\u5b58\u5728\uff0c\u5b83\u5c06\u505c\u6b62\u6267\u884c\u5e76\u5f15\u53d1 ",(0,t.jsx)(n.code,{children:"dspy.AssertionError"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"dspy.Suggest"})}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u53c2\u6570"}),": \u4e0e ",(0,t.jsx)(n.code,{children:"dspy.Assert"})," \u7c7b\u4f3c\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u884c\u4e3a"}),": \u901a\u8fc7\u91cd\u8bd5\u9f13\u52b1\u81ea\u6211\u4fee\u6b63\uff0c\u800c\u4e0d\u5f3a\u5236\u505c\u6b62\u3002\u5728\u8fbe\u5230\u6700\u5927\u56de\u6eaf\u5c1d\u8bd5\u6b21\u6570\u540e\u8bb0\u5f55\u5931\u8d25\u5e76\u7ee7\u7eed\u6267\u884c\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"dspy.Assert \u4e0e Python \u65ad\u8a00\u7684\u533a\u522b"}),": \u4e0e\u4f20\u7edf\u7684 Python ",(0,t.jsx)(n.code,{children:"assert"})," \u8bed\u53e5\u5728\u5931\u8d25\u65f6\u7ec8\u6b62\u7a0b\u5e8f\u4e0d\u540c\uff0c",(0,t.jsx)(n.code,{children:"dspy.Assert"})," \u6267\u884c\u590d\u6742\u7684\u91cd\u8bd5\u673a\u5236\uff0c\u5141\u8bb8\u7ba1\u9053\u8fdb\u884c\u8c03\u6574\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5177\u4f53\u6765\u8bf4\uff0c\u5f53\u4e0d\u6ee1\u8db3\u7ea6\u675f\u65f6\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u56de\u6eaf\u673a\u5236\uff1a\u542f\u52a8\u5e95\u5c42\u7684\u56de\u6eaf\uff0c\u4e3a\u6a21\u578b\u63d0\u4f9b\u81ea\u6211\u4fee\u6b63\u5e76\u7ee7\u7eed\u7684\u673a\u4f1a\uff0c\u8fd9\u662f\u901a\u8fc7\u7b7e\u540d\u4fee\u6539\u5b8c\u6210\u7684\u3002"}),"\n",(0,t.jsxs)(n.li,{children:["\u52a8\u6001\u7b7e\u540d\u4fee\u6539\uff1a\u901a\u8fc7\u6dfb\u52a0\u4ee5\u4e0b\u5b57\u6bb5\u5728\u5185\u90e8\u4fee\u6539 DSPy \u7a0b\u5e8f\u7684\u7b7e\u540d\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Past Output\uff08\u8fc7\u53bb\u7684\u8f93\u51fa\uff09\uff1a\u672a\u901a\u8fc7 validation_fn \u7684\u6a21\u578b\u8fc7\u53bb\u8f93\u51fa"}),"\n",(0,t.jsx)(n.li,{children:"Instruction\uff08\u6307\u4ee4\uff09\uff1a\u7528\u6237\u5b9a\u4e49\u7684\u5173\u4e8e\u51fa\u4e86\u4ec0\u4e48\u95ee\u9898\u4ee5\u53ca\u53ef\u80fd\u4fee\u590d\u4ec0\u4e48\u7684\u53cd\u9988\u6d88\u606f"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5982\u679c\u9519\u8bef\u6301\u7eed\u8d85\u8fc7 ",(0,t.jsx)(n.code,{children:"max_backtracking_attempts"}),"\uff0c\u5219 ",(0,t.jsx)(n.code,{children:"dspy.Assert"})," \u5c06\u505c\u6b62\u7ba1\u9053\u6267\u884c\uff0c\u5e76\u901a\u8fc7 ",(0,t.jsx)(n.code,{children:"dspy.AssertionError"})," \u63d0\u9192\u60a8\u3002\u8fd9\u786e\u4fdd\u60a8\u7684\u7a0b\u5e8f\u4e0d\u4f1a\u5728\u5177\u6709\u201c\u7cdf\u7cd5\u201dLM \u884c\u4e3a\u7684\u60c5\u51b5\u4e0b\u7ee7\u7eed\u6267\u884c\uff0c\u5e76\u7acb\u5373\u7a81\u51fa\u663e\u793a\u6837\u672c\u5931\u8d25\u8f93\u51fa\u4ee5\u4f9b\u7528\u6237\u8bc4\u4f30\u3002"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"dspy.Suggest \u4e0e dspy.Assert"}),": \u53e6\u4e00\u65b9\u9762\uff0c",(0,t.jsx)(n.code,{children:"dspy.Suggest"})," \u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u6e29\u548c\u7684\u65b9\u6cd5\u3002\u5b83\u4fdd\u6301\u4e0e ",(0,t.jsx)(n.code,{children:"dspy.Assert"})," \u76f8\u540c\u7684\u91cd\u8bd5\u56de\u6eaf\uff0c\u4f46\u4f5c\u4e3a\u4e00\u4e2a\u6e29\u548c\u7684\u52a9\u63a8\u5668\u3002\u5982\u679c\u6a21\u578b\u8f93\u51fa\u5728 ",(0,t.jsx)(n.code,{children:"max_backtracking_attempts"})," \u540e\u4ecd\u65e0\u6cd5\u901a\u8fc7\u6a21\u578b\u7ea6\u675f\uff0c",(0,t.jsx)(n.code,{children:"dspy.Suggest"})," \u5c06\u8bb0\u5f55\u6301\u7eed\u7684\u5931\u8d25\u5e76\u7ee7\u7eed\u5bf9\u5269\u4f59\u6570\u636e\u6267\u884c\u7a0b\u5e8f\u3002\u8fd9\u786e\u4fdd\u4e86 LM \u7ba1\u9053\u4ee5\u201c\u5c3d\u529b\u800c\u4e3a\u201d\u7684\u65b9\u5f0f\u5de5\u4f5c\uff0c\u800c\u4e0d\u4f1a\u505c\u6b62\u6267\u884c\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"dspy.Suggest"})})," \u8bed\u53e5\u6700\u597d\u5728\u8bc4\u4f30\u9636\u6bb5\u7528\u4f5c\u201c\u52a9\u624b\u201d\uff0c\u5728\u4e0d\u505c\u6b62\u7ba1\u9053\u7684\u60c5\u51b5\u4e0b\u63d0\u4f9b\u6307\u5bfc\u548c\u6f5c\u5728\u7684\u66f4\u6b63\u3002"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"dspy.Assert"})})," \u8bed\u53e5\u5efa\u8bae\u5728\u5f00\u53d1\u9636\u6bb5\u7528\u4f5c\u201c\u68c0\u67e5\u5668\u201d\uff0c\u4ee5\u786e\u4fdd LM \u6309\u9884\u671f\u884c\u4e8b\uff0c\u4e3a\u5728\u5f00\u53d1\u5468\u671f\u7684\u65e9\u671f\u8bc6\u522b\u548c\u89e3\u51b3\u9519\u8bef\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u673a\u5236\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u7528\u4f8b\u5728-dspy-\u7a0b\u5e8f\u4e2d\u5305\u542b\u65ad\u8a00",children:"\u7528\u4f8b\uff1a\u5728 DSPy \u7a0b\u5e8f\u4e2d\u5305\u542b\u65ad\u8a00"}),"\n",(0,t.jsx)(n.p,{children:"\u6211\u4eec\u4ece\u4f7f\u7528\u4ecb\u7ecd\u6f14\u7ec3\u4e2d\u5b9a\u4e49\u7684\u7b80\u5316\u7684\u591a\u8df3 QA SimplifiedBaleen \u7ba1\u9053\u793a\u4f8b\u5f00\u59cb\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'class SimplifiedBaleen(dspy.Module):\n    def __init__(self, passages_per_hop=2, max_hops=2):\n        super().__init__()\n\n        self.generate_query = [dspy.ChainOfThought(GenerateSearchQuery) for _ in range(max_hops)]\n        self.retrieve = dspy.Retrieve(k=passages_per_hop)\n        self.generate_answer = dspy.ChainOfThought(GenerateAnswer)\n        self.max_hops = max_hops\n\n    def forward(self, question):\n        context = []\n        prev_queries = [question]\n\n        for hop in range(self.max_hops):\n            query = self.generate_query[hop](context=context, question=question).query\n            prev_queries.append(query)\n            passages = self.retrieve(query).passages\n            context = deduplicate(context + passages)\n        \n        pred = self.generate_answer(context=context, question=question)\n        pred = dspy.Prediction(context=context, answer=pred.answer)\n        return pred\n\nbaleen = SimplifiedBaleen()\n\nbaleen(question = "Which award did Gary Zukav\'s first book receive?")\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u8981\u5305\u542b DSPy Assertions\uff0c\u6211\u4eec\u53ea\u9700\u5b9a\u4e49\u9a8c\u8bc1\u51fd\u6570\u5e76\u5728\u76f8\u5e94\u7684\u6a21\u578b\u751f\u6210\u540e\u58f0\u660e\u65ad\u8a00\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u5bf9\u4e8e\u6b64\u7528\u4f8b\uff0c\u5047\u8bbe\u6211\u4eec\u8981\u65bd\u52a0\u4ee5\u4e0b\u7ea6\u675f\uff1a"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u957f\u5ea6 - \u6bcf\u4e2a\u67e5\u8be2\u5e94\u5c11\u4e8e 100 \u4e2a\u5b57\u7b26"}),"\n",(0,t.jsx)(n.li,{children:"\u552f\u4e00\u6027 - \u6bcf\u4e2a\u751f\u6210\u7684\u67e5\u8be2\u5e94\u4e0e\u4e4b\u524d\u751f\u6210\u7684\u67e5\u8be2\u4e0d\u540c\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u9a8c\u8bc1\u68c0\u67e5\u5b9a\u4e49\u4e3a\u5e03\u5c14\u51fd\u6570\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'#simplistic boolean check for query length\nlen(query) <= 100\n\n#Python function for validating distinct queries\ndef validate_query_distinction_local(previous_queries, query):\n    """check if query is distinct from previous queries"""\n    if previous_queries == []:\n        return True\n    if dspy.evaluate.answer_exact_match_str(query, previous_queries, frac=0.8):\n        return False\n    return True\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",(0,t.jsx)(n.code,{children:"dspy.Suggest"})," \u8bed\u53e5\u58f0\u660e\u8fd9\u4e9b\u9a8c\u8bc1\u68c0\u67e5\uff08\u56e0\u4e3a\u6211\u4eec\u8981\u4ee5\u5c3d\u529b\u800c\u4e3a\u7684\u6f14\u793a\u6765\u6d4b\u8bd5\u7a0b\u5e8f\uff09\u3002\u6211\u4eec\u5e0c\u671b\u5c06\u8fd9\u4e9b\u4fdd\u7559\u5728\u67e5\u8be2\u751f\u6210 ",(0,t.jsx)(n.code,{children:"query = self.generate_query[hop](context=context, question=question).query"})," \u4e4b\u540e\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'dspy.Suggest(\n    len(query) <= 100,\n    "Query should be short and less than 100 characters",\n    target_module=self.generate_query\n)\n\ndspy.Suggest(\n    validate_query_distinction_local(prev_queries, query),\n    "Query should be distinct from: "\n    + "; ".join(f"{i+1}) {q}" for i, q in enumerate(prev_queries)),\n    target_module=self.generate_query\n)\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u679c\u60a8\u6b63\u5728\u8fdb\u884c\u65ad\u8a00\u6548\u679c\u7684\u6bd4\u8f83\u8bc4\u4f30\uff0c\u5efa\u8bae\u5c06\u5e26\u6709\u65ad\u8a00\u7684\u7a0b\u5e8f\u4e0e\u539f\u59cb\u7a0b\u5e8f\u5206\u5f00\u5b9a\u4e49\u3002\u5982\u679c\u4e0d\u662f\uff0c\u8bf7\u968f\u610f\u8bbe\u7f6e Assertions\uff01"}),"\n",(0,t.jsx)(n.p,{children:"\u8ba9\u6211\u4eec\u770b\u770b\u5305\u542b Assertions \u7684 SimplifiedBaleen \u7a0b\u5e8f\u662f\u4ec0\u4e48\u6837\u5b50\u7684\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'class SimplifiedBaleenAssertions(dspy.Module):\n    def __init__(self, passages_per_hop=2, max_hops=2):\n        super().__init__()\n        self.generate_query = [dspy.ChainOfThought(GenerateSearchQuery) for _ in range(max_hops)]\n        self.retrieve = dspy.Retrieve(k=passages_per_hop)\n        self.generate_answer = dspy.ChainOfThought(GenerateAnswer)\n        self.max_hops = max_hops\n\n    def forward(self, question):\n        context = []\n        prev_queries = [question]\n\n        for hop in range(self.max_hops):\n            query = self.generate_query[hop](context=context, question=question).query\n\n            dspy.Suggest(\n                len(query) <= 100,\n                "Query should be short and less than 100 characters",\n                target_module=self.generate_query\n            )\n\n            dspy.Suggest(\n                validate_query_distinction_local(prev_queries, query),\n                "Query should be distinct from: "\n                + "; ".join(f"{i+1}) {q}" for i, q in enumerate(prev_queries)),\n                target_module=self.generate_query\n            )\n\n            prev_queries.append(query)\n            passages = self.retrieve(query).passages\n            context = deduplicate(context + passages)\n        \n        if all_queries_distinct(prev_queries):\n            self.passed_suggestions += 1\n\n        pred = self.generate_answer(context=context, question=question)\n        pred = dspy.Prediction(context=context, answer=pred.answer)\n        return pred\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u73b0\u5728\u8c03\u7528\u5e26\u6709 DSPy Assertions \u7684\u7a0b\u5e8f\u9700\u8981\u6700\u540e\u4e00\u6b65\uff0c\u5373\u8f6c\u6362\u7a0b\u5e8f\u4ee5\u5c06\u5176\u5305\u88c5\u5728\u5185\u90e8\u65ad\u8a00\u56de\u6eaf\u548c\u91cd\u8bd5\u903b\u8f91\u4e2d\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from dspy.primitives.assertions import assert_transform_module, backtrack_handler\n\nbaleen_with_assertions = assert_transform_module(SimplifiedBaleenAssertions(), backtrack_handler)\n\n# backtrack_handler is parameterized over a few settings for the backtracking mechanism\n# To change the number of max retry attempts, you can do\nbaleen_with_assertions_retry_once = assert_transform_module(SimplifiedBaleenAssertions(), \n    functools.partial(backtrack_handler, max_backtracks=1))\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u6216\u8005\uff0c\u60a8\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u5e26\u6709 ",(0,t.jsx)(n.code,{children:"dspy.Assert/Suggest"})," \u8bed\u53e5\u7684\u7a0b\u5e8f\u4e0a\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"activate_assertions"}),"\uff0c\u4f7f\u7528\u9ed8\u8ba4\u7684\u56de\u6eaf\u673a\u5236\uff08",(0,t.jsx)(n.code,{children:"max_backtracks=2"}),"\uff09\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"baleen_with_assertions = SimplifiedBaleenAssertions().activate_assertions()\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u901a\u8fc7\u68c0\u67e5 LM \u67e5\u8be2\u751f\u6210\u7684\u5386\u53f2\u8bb0\u5f55\u6765\u770b\u770b\u5185\u90e8 LM \u56de\u6eaf\u3002\u5728\u8fd9\u91cc\u6211\u4eec\u770b\u5230\uff0c\u5f53\u67e5\u8be2\u672a\u80fd\u901a\u8fc7\u5c11\u4e8e 100 \u4e2a\u5b57\u7b26\u7684\u9a8c\u8bc1\u68c0\u67e5\u65f6\uff0c\u5176\u5185\u90e8 ",(0,t.jsx)(n.code,{children:"GenerateSearchQuery"})," \u7b7e\u540d\u5728\u56de\u6eaf+\u91cd\u8bd5\u8fc7\u7a0b\u4e2d\u4f1a\u88ab\u52a8\u6001\u4fee\u6539\uff0c\u4ee5\u5305\u542b\u8fc7\u53bb\u7684\u67e5\u8be2\u548c\u76f8\u5e94\u7684\u7528\u6237\u5b9a\u4e49\u6307\u4ee4\uff1a",(0,t.jsx)(n.code,{children:'"Query should be short and less than 100 characters"'}),"\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'Write a simple search query that will help answer a complex question.\n\n---\n\nFollow the following format.\n\nContext: may contain relevant facts\n\nQuestion: ${question}\n\nReasoning: Let\'s think step by step in order to ${produce the query}. We ...\n\nQuery: ${query}\n\n---\n\nContext:\n[1] \xabKerry Condon | Kerry Condon (born 4 January 1983) is [...]\xbb\n[2] \xabCorona Riccardo | Corona Riccardo (c. 1878October 15, 1917) was [...]\xbb\n\nQuestion: Who acted in the shot film The Shore and is also the youngest actress ever to play Ophelia in a Royal Shakespeare Company production of "Hamlet." ?\n\nReasoning: Let\'s think step by step in order to find the answer to this question. First, we need to identify the actress who played Ophelia in a Royal Shakespeare Company production of "Hamlet." Then, we need to find out if this actress also acted in the short film "The Shore."\n\nQuery: "actress who played Ophelia in Royal Shakespeare Company production of Hamlet" + "actress in short film The Shore"\n\n\n\nWrite a simple search query that will help answer a complex question.\n\n---\n\nFollow the following format.\n\nContext: may contain relevant facts\n\nQuestion: ${question}\n\nPast Query: past output with errors\n\nInstructions: Some instructions you must satisfy\n\nQuery: ${query}\n\n---\n\nContext:\n[1] \xabKerry Condon | Kerry Condon (born 4 January 1983) is an Irish television and film actress, best known for her role as Octavia of the Julii in the HBO/BBC series "Rome," as Stacey Ehrmantraut in AMC\'s "Better Call Saul" and as the voice of F.R.I.D.A.Y. in various films in the Marvel Cinematic Universe. She is also the youngest actress ever to play Ophelia in a Royal Shakespeare Company production of "Hamlet."\xbb\n[2] \xabCorona Riccardo | Corona Riccardo (c. 1878October 15, 1917) was an Italian born American actress who had a brief Broadway stage career before leaving to become a wife and mother. Born in Naples she came to acting in 1894 playing a Mexican girl in a play at the Empire Theatre. Wilson Barrett engaged her for a role in his play "The Sign of the Cross" which he took on tour of the United States. Riccardo played the role of Ancaria and later played Berenice in the same play. Robert B. Mantell in 1898 who struck by her beauty also cast her in two Shakespeare plays, "Romeo and Juliet" and "Othello". Author Lewis Strang writing in 1899 said Riccardo was the most promising actress in America at the time. Towards the end of 1898 Mantell chose her for another Shakespeare part, Ophelia im Hamlet. Afterwards she was due to join Augustin Daly\'s Theatre Company but Daly died in 1899. In 1899 she gained her biggest fame by playing Iras in the first stage production of Ben-Hur.\xbb\n\nQuestion: Who acted in the shot film The Shore and is also the youngest actress ever to play Ophelia in a Royal Shakespeare Company production of "Hamlet." ?\n\nPast Query: "actress who played Ophelia in Royal Shakespeare Company production of Hamlet" + "actress in short film The Shore"\n\nInstructions: Query should be short and less than 100 characters\n\nQuery: "actress Ophelia RSC Hamlet" + "actress The Shore"\n\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u65ad\u8a00\u9a71\u52a8\u7684\u4f18\u5316",children:"\u65ad\u8a00\u9a71\u52a8\u7684\u4f18\u5316"}),"\n",(0,t.jsxs)(n.p,{children:["DSPy Assertions \u4e0e DSPy \u63d0\u4f9b\u7684\u4f18\u5316\u4e00\u8d77\u5de5\u4f5c\uff0c\u7279\u522b\u662f ",(0,t.jsx)(n.code,{children:"BootstrapFewShotWithRandomSearch"}),"\uff0c\u5305\u62ec\u4ee5\u4e0b\u8bbe\u7f6e\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5e26\u65ad\u8a00\u7684\u7f16\u8bd1 (Compilation with Assertions)\n\u8fd9\u5305\u62ec\u7f16\u8bd1\u671f\u95f4\u7684\u65ad\u8a00\u9a71\u52a8\u793a\u4f8b\u5f15\u5bfc\u548c\u53cd\u4f8b\u5f15\u5bfc\u3002\u7528\u4e8e\u5f15\u5bfc\u5c11\u6837\u672c\u6f14\u793a\u7684\u6559\u5e08\u6a21\u578b\u53ef\u4ee5\u5229\u7528 DSPy Assertions \u6765\u63d0\u4f9b\u5f3a\u5927\u7684\u5f15\u5bfc\u793a\u4f8b\uff0c\u4f9b\u5b66\u751f\u6a21\u578b\u5728\u63a8\u7406\u671f\u95f4\u5b66\u4e60\u3002\u5728\u8fd9\u79cd\u8bbe\u7f6e\u4e0b\uff0c\u5b66\u751f\u6a21\u578b\u5728\u63a8\u7406\u671f\u95f4\u4e0d\u6267\u884c\u65ad\u8a00\u611f\u77e5\u4f18\u5316\uff08\u56de\u6eaf\u548c\u91cd\u8bd5\uff09\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u5e26\u65ad\u8a00\u7684\u7f16\u8bd1 + \u63a8\u7406 (Compilation + Inference with Assertions)\n-\u8fd9\u5305\u62ec\u7f16\u8bd1\u548c\u63a8\u7406\u4e2d\u7684\u65ad\u8a00\u9a71\u52a8\u4f18\u5316\u3002\u73b0\u5728\u6559\u5e08\u6a21\u578b\u63d0\u4f9b\u65ad\u8a00\u9a71\u52a8\u7684\u793a\u4f8b\uff0c\u4f46\u5b66\u751f\u53ef\u4ee5\u5728\u63a8\u7406\u65f6\u5229\u7528\u81ea\u5df1\u7684\u65ad\u8a00\u8fdb\u4e00\u6b65\u4f18\u5316\u3002"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"teleprompter = BootstrapFewShotWithRandomSearch(\n    metric=validate_context_and_answer_and_hops,\n    max_bootstrapped_demos=max_bootstrapped_demos,\n    num_candidate_programs=6,\n)\n\n#Compilation with Assertions\ncompiled_with_assertions_baleen = teleprompter.compile(student = baleen, teacher = baleen_with_assertions, trainset = trainset, valset = devset)\n\n#Compilation + Inference with Assertions\ncompiled_baleen_with_assertions = teleprompter.compile(student=baleen_with_assertions, teacher = baleen_with_assertions, trainset=trainset, valset=devset)\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},54213:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(36672);const t={},i=r.createContext(t);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);