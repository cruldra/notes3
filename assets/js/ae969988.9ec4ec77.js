"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[514],{54213:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var l=s(36672);const a={},r=l.createContext(a);function c(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),l.createElement(r.Provider,{value:n},e.children)}},75082:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>m,frontMatter:()=>c,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"Python/Libraries/\u6570\u636e\u5e93/alembic_postgresql_enum_usage","title":"alembic_postgresql_enum_usage","description":"\u4f7f\u7528 alembic-postgresql-enum \u5e93\u6765\u89e3\u51b3 Alembic \u4e0d\u8ddf\u8e2a PostgreSQL \u679a\u4e3e\u53d8\u5316\u7684\u95ee\u9898\u3002\u8fd9\u4e2a\u5e93\u53ef\u4ee5\u81ea\u52a8\u5904\u7406\u4ee5\u4e0b\u64cd\u4f5c\uff1a","source":"@site/docs/Python/Libraries/\u6570\u636e\u5e93/alembic_postgresql_enum_usage.mdx","sourceDirName":"Python/Libraries/\u6570\u636e\u5e93","slug":"/Python/Libraries/\u6570\u636e\u5e93/alembic_postgresql_enum_usage","permalink":"/notes3/docs/Python/Libraries/\u6570\u636e\u5e93/alembic_postgresql_enum_usage","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Python/Libraries/\u6570\u636e\u5e93/alembic_postgresql_enum_usage.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"python","previous":{"title":"SQLModel","permalink":"/notes3/docs/Python/Libraries/\u6570\u636e\u5e93/SQLModel"},"next":{"title":"\u6587\u6863\u7ba1\u7406","permalink":"/notes3/docs/category/\u6587\u6863\u7ba1\u7406"}}');var a=s(23420),r=s(54213);const c={},t=void 0,i={},o=[{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"\u521b\u5efa\u65b0\u7684\u679a\u4e3e\u7c7b\u578b",id:"\u521b\u5efa\u65b0\u7684\u679a\u4e3e\u7c7b\u578b",level:3},{value:"\u6dfb\u52a0\u65b0\u7684\u679a\u4e3e\u503c",id:"\u6dfb\u52a0\u65b0\u7684\u679a\u4e3e\u503c",level:3},{value:"\u5220\u9664\u679a\u4e3e\u503c",id:"\u5220\u9664\u679a\u4e3e\u503c",level:3},{value:"\u91cd\u547d\u540d\u679a\u4e3e\u503c",id:"\u91cd\u547d\u540d\u679a\u4e3e\u503c",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u66f4\u591a\u4fe1\u606f",id:"\u66f4\u591a\u4fe1\u606f",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"alembic-postgresql-enum"})," \u5e93\u6765\u89e3\u51b3 Alembic \u4e0d\u8ddf\u8e2a PostgreSQL \u679a\u4e3e\u53d8\u5316\u7684\u95ee\u9898\u3002\u8fd9\u4e2a\u5e93\u53ef\u4ee5\u81ea\u52a8\u5904\u7406\u4ee5\u4e0b\u64cd\u4f5c\uff1a"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u521b\u5efa\u65b0\u7684\u679a\u4e3e\u7c7b\u578b"}),"\n",(0,a.jsx)(n.li,{children:"\u6dfb\u52a0/\u5220\u9664/\u4fee\u6539\u679a\u4e3e\u503c"}),"\n",(0,a.jsx)(n.li,{children:"\u91cd\u65b0\u6392\u5e8f\u679a\u4e3e\u503c"}),"\n",(0,a.jsx)(n.li,{children:"\u5220\u9664\u672a\u4f7f\u7528\u7684\u679a\u4e3e\u7c7b\u578b"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,a.jsxs)(n.p,{children:["\u914d\u7f6e\u5df2\u7ecf\u5728 ",(0,a.jsx)(n.code,{children:"api/app/db/migrations/env.py"})," \u6587\u4ef6\u4e2d\u5b8c\u6210\uff0c\u5305\u62ec\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"# \u5bfc\u5165 alembic_postgresql_enum \u4ee5\u652f\u6301 PostgreSQL \u679a\u4e3e\u7c7b\u578b\u7684\u53d8\u66f4\nimport alembic_postgresql_enum\n\n# \u914d\u7f6e alembic_postgresql_enum\nalembic_postgresql_enum.set_configuration(\n    alembic_postgresql_enum.Config(\n        # \u542f\u7528\u7c7b\u578b\u5ffd\u7565\u6ce8\u91ca\uff0c\u89e3\u51b3\u7c7b\u578b\u68c0\u67e5\u5668\u7684\u8b66\u544a\n        add_type_ignore=True,\n        # \u542f\u7528\u672a\u4f7f\u7528\u679a\u4e3e\u7684\u6e05\u7406\n        drop_unused_enums=True,\n        # \u542f\u7528\u679a\u4e3e\u503c\u53d8\u66f4\u68c0\u6d4b\n        detect_enum_values_changes=True,\n    )\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,a.jsx)(n.h3,{id:"\u521b\u5efa\u65b0\u7684\u679a\u4e3e\u7c7b\u578b",children:"\u521b\u5efa\u65b0\u7684\u679a\u4e3e\u7c7b\u578b"}),"\n",(0,a.jsx)(n.p,{children:"\u5f53\u4f60\u5728\u6a21\u578b\u4e2d\u5b9a\u4e49\u65b0\u7684\u679a\u4e3e\u7c7b\u578b\u65f6\uff0cAlembic \u4f1a\u81ea\u52a8\u521b\u5efa\u76f8\u5e94\u7684 PostgreSQL \u679a\u4e3e\u7c7b\u578b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class MyEnum(str, Enum):\n    ONE = "one"\n    TWO = "two"\n    THREE = "three"\n\nclass MyModel(SQLModel, table=True):\n    id: Optional[int] = Field(default=None, primary_key=True)\n    status: MyEnum = Field(\n        sa_column=Column(\n            SQLAlchemyEnum(MyEnum, name="my_enum"),\n            comment="\u72b6\u6001",\n        ),\n        description="\u72b6\u6001",\n    )\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u6dfb\u52a0\u65b0\u7684\u679a\u4e3e\u503c",children:"\u6dfb\u52a0\u65b0\u7684\u679a\u4e3e\u503c"}),"\n",(0,a.jsx)(n.p,{children:"\u5f53\u4f60\u5728\u679a\u4e3e\u7c7b\u4e2d\u6dfb\u52a0\u65b0\u7684\u503c\u65f6\uff0cAlembic \u4f1a\u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c\u6765\u66f4\u65b0 PostgreSQL \u679a\u4e3e\u7c7b\u578b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class MyEnum(str, Enum):\n    ONE = "one"\n    TWO = "two"\n    THREE = "three"\n    FOUR = "four"  # \u65b0\u589e\u7684\u679a\u4e3e\u503c\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u751f\u6210\u7684\u8fc1\u79fb\u811a\u672c\u4f1a\u5305\u542b\u7c7b\u4f3c\u4ee5\u4e0b\u5185\u5bb9\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    # ### commands auto generated by Alembic - please adjust! ###\n    op.sync_enum_values(\n        enum_schema='public', \n        enum_name='my_enum', \n        new_values=['one', 'two', 'three', 'four'], \n        affected_columns=[TableReference(table_schema='public', table_name='my_model', column_name='status')],\n        enum_values_to_rename=[],\n    )\n    # ### end Alembic commands ###\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u5220\u9664\u679a\u4e3e\u503c",children:"\u5220\u9664\u679a\u4e3e\u503c"}),"\n",(0,a.jsx)(n.p,{children:"\u5f53\u4f60\u4ece\u679a\u4e3e\u7c7b\u4e2d\u5220\u9664\u503c\u65f6\uff0cAlembic \u4e5f\u4f1a\u81ea\u52a8\u751f\u6210\u8fc1\u79fb\u811a\u672c\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class MyEnum(str, Enum):\n    ONE = "one"\n    TWO = "two"\n    # THREE = "three"  # \u5df2\u5220\u9664\u7684\u679a\u4e3e\u503c\n    FOUR = "four"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u91cd\u547d\u540d\u679a\u4e3e\u503c",children:"\u91cd\u547d\u540d\u679a\u4e3e\u503c"}),"\n",(0,a.jsx)(n.p,{children:"\u5f53\u4f60\u9700\u8981\u91cd\u547d\u540d\u679a\u4e3e\u503c\u65f6\uff0cAlembic \u4f1a\u751f\u6210\u8fc1\u79fb\u811a\u672c\uff0c\u4f46\u4f60\u9700\u8981\u624b\u52a8\u7f16\u8f91\u5b83\u6765\u6307\u5b9a\u91cd\u547d\u540d\u5173\u7cfb\uff1a"}),"\n",(0,a.jsx)(n.p,{children:"\u539f\u59cb\u751f\u6210\u7684\u811a\u672c\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.sync_enum_values(\n        enum_schema='public', \n        enum_name='my_enum', \n        new_values=['one', 'two', 'four', 'five'], \n        affected_columns=[TableReference(table_schema='public', table_name='my_model', column_name='status')],\n        enum_values_to_rename=[],\n    )\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u624b\u52a8\u7f16\u8f91\u540e\u7684\u811a\u672c\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"def upgrade():\n    op.sync_enum_values(\n        enum_schema='public', \n        enum_name='my_enum', \n        new_values=['one', 'two', 'four', 'five'], \n        affected_columns=[TableReference(table_schema='public', table_name='my_model', column_name='status')],\n        enum_values_to_rename=[('three', 'five')],  # \u6307\u5b9a\u91cd\u547d\u540d\u5173\u7cfb\uff1a\u4ece 'three' \u91cd\u547d\u540d\u4e3a 'five'\n    )\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u786e\u4fdd\u5728\u4fee\u6539\u679a\u4e3e\u7c7b\u578b\u65f6\uff0c\u8003\u8651\u5230\u73b0\u6709\u6570\u636e\u7684\u517c\u5bb9\u6027"}),"\n",(0,a.jsx)(n.li,{children:"\u91cd\u547d\u540d\u679a\u4e3e\u503c\u65f6\uff0c\u5fc5\u987b\u624b\u52a8\u7f16\u8f91\u8fc1\u79fb\u811a\u672c\uff0c\u6307\u5b9a\u91cd\u547d\u540d\u5173\u7cfb"}),"\n",(0,a.jsx)(n.li,{children:"\u5220\u9664\u679a\u4e3e\u503c\u65f6\uff0c\u786e\u4fdd\u6ca1\u6709\u6570\u636e\u5f15\u7528\u8fd9\u4e9b\u503c\uff0c\u5426\u5219\u8fc1\u79fb\u4f1a\u5931\u8d25"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u66f4\u591a\u4fe1\u606f",children:"\u66f4\u591a\u4fe1\u606f"}),"\n",(0,a.jsxs)(n.p,{children:["\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003 ",(0,a.jsx)(n.a,{href:"https://github.com/Pogchamp-company/alembic-postgresql-enum",children:"alembic-postgresql-enum \u5b98\u65b9\u6587\u6863"}),"\u3002"]})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}}}]);