"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[4236],{49113:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>u,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/subscribeWithSelector","title":"subscribeWithSelector","description":"\u7b80\u4ecb","source":"@site/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/subscribeWithSelector.mdx","sourceDirName":"FrontEnd/Zustand/\u4e2d\u95f4\u4ef6","slug":"/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/subscribeWithSelector","permalink":"/notes3/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/subscribeWithSelector","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/subscribeWithSelector.mdx","tags":[],"version":"current","frontMatter":{"title":"subscribeWithSelector","comment":false,"editLink":false,"prev":false,"next":false,"order":1},"sidebar":"frontEnd","previous":{"title":"persist","permalink":"/notes3/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/persist"},"next":{"title":"\u7b80\u4ecb","permalink":"/notes3/docs/FrontEnd/Zustand/\u7b80\u4ecb"}}');var r=t(23420),c=t(54213);const o={title:"subscribeWithSelector",comment:!1,editLink:!1,prev:!1,next:!1,order:1},u=void 0,i={},d=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50",id:"\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50",level:2},{value:"\u8ba2\u9605\u591a\u4e2a\u72b6\u6001\u7247\u6bb5",id:"\u8ba2\u9605\u591a\u4e2a\u72b6\u6001\u7247\u6bb5",level:2}];function a(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"subscribeWithSelector"}),"\u4e2d\u95f4\u4ef6\u7528\u4e8e\u53d1\u5e03\u72b6\u6001\u7247\u6bb5\u7684\u53d8\u5316.\u5b83\u53ef\u4ee5\u8ba9\u4f60\u53ea\u5173\u6ce8\u611f\u5174\u8da3\u7684\u72b6\u6001\u7247\u6bb5\u7684\u53d8\u5316,\u8fd9\u6709\u52a9\u4e8e\u9632\u6b62\u4e0d\u5fc5\u8981\u7684\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3."]}),"\n",(0,r.jsx)(n.h2,{id:"\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50",children:"\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import {subscribeWithSelector} from "zustand/middleware";\nimport create from "zustand";\nimport {StateCreator} from "zustand/vanilla";\n//\u5b9a\u4e49\u72b6\u6001\u7684\u7c7b\u578b\ntype TestStore = {\n    count: number;\n    avg: number;\n    incrementCount: () => void;\n    decrementCount: () => void;\n};\n//\u521b\u5efa\u5b58\u50a8\u5e93\nconst createStore: StateCreator<TestStore> = (\n    set, get\n) => ({\n    count: 0,\n    avg: 0,\n    incrementCount: () => set((state) => ({count: state.count + 1})),\n    decrementCount: () => set((state) => ({count: state.count - 1})),\n    incrementAvg: () => set((state) => ({avg: state.avg + 1})),\n    decrementAvg: () => set((state) => ({avg: state.avg - 1})),\n})\n\nexport const useTestStore = create<TestStore>(\n    subscribeWithSelector(createStore),\n); \n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {useTestStore} from './store';\nimport {useEffect} from 'react'\n\nexport default () => {\n    const [count, avg, incrementCount, decrementCount, incrementAvg, decrementAvg] = useTestStore((s) => [\n        s.count,\n        s.avg,\n        s.incrementCount,\n        s.decrementCount,\n        s.incrementAvg,\n        s.decrementAvg\n    ]);\n\n    useEffect(() => {\n        const unsubscribe = useTestStore.subscribe(\n            (s) => s.count,\n            (a) => {\n                alert(`count:${a}`)\n            },\n        );\n        return () => {\n            unsubscribe();\n        };\n    }, [])\n    return <div>\n        <h1>count:{count}</h1>\n        <button onClick={incrementCount}>+</button>\n        <button onClick={decrementCount}>-</button>\n        <h1>avg:{avg}</h1>\n        <button onClick={incrementAvg}>+</button>\n        <button onClick={decrementAvg}>-</button>\n    </div>;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u4f7f\u7528",(0,r.jsx)(n.code,{children:"subscribeWithSelector"}),"\u4e2d\u95f4\u4ef6\u6765\u521b\u5efa\u72b6\u6001\u5e93:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export const useTestStore = create<TestStore>(\n    subscribeWithSelector(createStore),\n); \n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u4f7f\u7528",(0,r.jsx)(n.code,{children:"subscribe"}),"\u65b9\u6cd5\u6765\u8ba2\u9605\u72b6\u6001\u7247\u6bb5\u7684\u53d8\u5316:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {useTestStore} from './store';\n\nuseEffect(() => {\n    const unsubscribe = useTestStore.subscribe(\n        (s) => s.count,\n        (a) => {\n            alert(`count:${a}`)\n        },\n    );\n    return () => {\n        unsubscribe();\n    };\n}, [])\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u73b0\u5728\u70b9\u51fb",(0,r.jsx)(n.code,{children:"Count"}),"\u4e0b\u9762\u7684",(0,r.jsx)(n.code,{children:"+"}),"\u548c",(0,r.jsx)(n.code,{children:"-"}),"\u53f7\u65f6,\u6d4f\u89c8\u5668\u5f39\u6846\u4f1a\u663e\u793a",(0,r.jsx)(n.code,{children:"count"}),"\u7684\u503c,\u800c\u70b9\u51fb",(0,r.jsx)(n.code,{children:"Avg"}),"\u4e0b\u9762\u7684",(0,r.jsx)(n.code,{children:"+"}),"\u548c",(0,r.jsx)(n.code,{children:"-"}),"\n\u53f7\u65f6\u4e0d\u4f1a\u6709\u4efb\u4f55\u53cd\u5e94,\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u53ea\u8ba2\u9605\u4e86",(0,r.jsx)(n.code,{children:"count"}),"\u7684\u53d8\u5316."]}),"\n",(0,r.jsx)(n.h2,{id:"\u8ba2\u9605\u591a\u4e2a\u72b6\u6001\u7247\u6bb5",children:"\u8ba2\u9605\u591a\u4e2a\u72b6\u6001\u7247\u6bb5"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"subscribe"}),"\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u53ef\u4ee5\u662f\u4e00\u4e2a\u6570\u7ec4,\u7528\u4e8e\u8ba2\u9605\u591a\u4e2a\u72b6\u6001\u7247\u6bb5\u7684\u53d8\u5316:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {useTestStore} from './store';\n\nuseEffect(() => {\n    const unsubscribe = useTestStore.subscribe(\n        (s) => [s.count,s.avg],\n        ([count,avg]) => {\n            alert(`count:${count},avg:${avg}`)\n        },\n    );\n    return () => {\n        unsubscribe();\n    };\n}, [])\n"})})]})}function l(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},54213:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>u});var s=t(36672);const r={},c=s.createContext(r);function o(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function u(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);