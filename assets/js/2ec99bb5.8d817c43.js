"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[9134],{54213:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(36672);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},62654:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Python/Libraries/\u963f\u91cc\u4e91/OSS","title":"OSS","description":"\u5b89\u88c5","source":"@site/docs/Python/Libraries/\u963f\u91cc\u4e91/OSS.mdx","sourceDirName":"Python/Libraries/\u963f\u91cc\u4e91","slug":"/Python/Libraries/\u963f\u91cc\u4e91/OSS","permalink":"/notes3/docs/Python/Libraries/\u963f\u91cc\u4e91/OSS","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Python/Libraries/\u963f\u91cc\u4e91/OSS.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"python","previous":{"title":"\u963f\u91cc\u4e91","permalink":"/notes3/docs/category/\u963f\u91cc\u4e91"},"next":{"title":"\u77ed\u4fe1","permalink":"/notes3/docs/Python/Libraries/\u963f\u91cc\u4e91/\u77ed\u4fe1"}}');var r=t(23420),o=t(54213);const i={},a=void 0,c={},l=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u4e0a\u4f20\u6587\u4ef6",id:"\u4e0a\u4f20\u6587\u4ef6",level:2}];function u(e){const n={code:"code",h2:"h2",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"pip install oss2\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e0a\u4f20\u6587\u4ef6",children:"\u4e0a\u4f20\u6587\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import oss2\r\n\r\n@router.post("/upload", response_model=UploadResponse)\r\nasync def upload_file(file: UploadFile = File(...)):\r\n    # \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\r\n    contents = await file.read()\r\n\r\n    # \u751f\u6210\u6587\u4ef6\u540d\r\n    file_name = f"{int(datetime.now().timestamp())}-{file.filename}"\r\n\r\n    # \u521d\u59cb\u5316 OSS \u5ba2\u6237\u7aef\r\n    auth = oss2.Auth(\r\n        settings.oss_access_key_id,\r\n        settings.oss_access_key_secret\r\n    )\r\n\r\n    # \u6b63\u786e\u6784\u5efa endpoint\r\n    endpoint = "https://oss-cn-hangzhou.aliyuncs.com"\r\n    bucket = oss2.Bucket(\r\n        auth,\r\n        endpoint,  # \u4f7f\u7528\u4e0d\u5e26 bucket \u7684 endpoint\r\n        settings.oss_bucket,\r\n        connect_timeout=30  # \u589e\u52a0\u8d85\u65f6\u65f6\u95f4\r\n    )\r\n\r\n    # \u4e0a\u4f20\u5230OSS\r\n    result = bucket.put_object(file_name, contents)\r\n\r\n    # \u6784\u5efa\u6587\u4ef6URL\r\n    file_url = f"https://{settings.oss_bucket}.oss-cn-hangzhou.aliyuncs.com/{file_name}"\r\n\r\n    return UploadResponse(\r\n        data={\r\n            "url": file_url,\r\n            "fileName": file_name\r\n        }\r\n    )\n'})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);