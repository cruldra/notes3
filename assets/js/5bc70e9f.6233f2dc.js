"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[5052],{46642:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"AI/Pytorch/\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a","title":"\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a","description":"\u672c\u7b14\u8bb0\u672c\u6f14\u793a\u4ece\u539f\u59cb\u6587\u672c\u5230\u8bcd\u5d4c\u5165\u5411\u91cf\u7684\u5b8c\u6574\u8f6c\u6362\u8fc7\u7a0b\u3002","source":"@site/docs/AI/Pytorch/\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a.md","sourceDirName":"AI/Pytorch","slug":"/AI/Pytorch/\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a","permalink":"/notes3/docs/AI/Pytorch/\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/Pytorch/\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a.md","tags":[],"version":"current","frontMatter":{"title":"\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a","marimo-version":"0.19.2","width":"medium"},"sidebar":"ai","previous":{"title":"\u793a\u4f8b1","permalink":"/notes3/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/\u793a\u4f8b1"},"next":{"title":"\u4ec0\u4e48\u662f\u201cGPU \u52a0\u901f\u5f20\u91cf\u8ba1\u7b97\u201d\uff1f","permalink":"/notes3/docs/AI/Pytorch/\u53c2\u8003/1"}}');var s=i(23420),d=i(54213);const r={title:"\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a","marimo-version":"0.19.2",width:"medium"},o="\ud83c\udfaf \u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a",l={},c=[{value:"\ud83d\udcca \u6d41\u7a0b\u6982\u89c8",id:"-\u6d41\u7a0b\u6982\u89c8",level:2},{value:"\ud83d\udd27 \u6b65\u9aa41: \u52a0\u8f7d\u9884\u8bad\u7ec3\u5206\u8bcd\u5668",id:"-\u6b65\u9aa41-\u52a0\u8f7d\u9884\u8bad\u7ec3\u5206\u8bcd\u5668",level:2},{value:"\ud83d\udd24 \u6b65\u9aa42: \u6587\u672c\u5206\u8bcd (Tokenization)",id:"-\u6b65\u9aa42-\u6587\u672c\u5206\u8bcd-tokenization",level:2},{value:"\ud83d\udca1 \u5206\u8bcd\u5668\u5df2\u5c31\u7eea",id:"-\u5206\u8bcd\u5668\u5df2\u5c31\u7eea",level:3},{value:"\ud83d\udcdd \u5b9e\u9645\u6f14\u793a: \u5bf9 &quot;\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797&quot; \u8fdb\u884c\u5206\u8bcd",id:"-\u5b9e\u9645\u6f14\u793a-\u5bf9-\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797-\u8fdb\u884c\u5206\u8bcd",level:3},{value:"\ud83c\udfa8 \u6b65\u9aa43: \u8bcd\u5d4c\u5165 (Embedding)",id:"-\u6b65\u9aa43-\u8bcd\u5d4c\u5165-embedding",level:2},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:3},{value:"\ud83d\udd0d \u6f14\u793a: \u5c06 Token IDs \u8f6c\u6362\u4e3a\u5d4c\u5165\u5411\u91cf",id:"-\u6f14\u793a-\u5c06-token-ids-\u8f6c\u6362\u4e3a\u5d4c\u5165\u5411\u91cf",level:3},{value:"\ud83d\udcca \u53ef\u89c6\u5316: Embedding \u67e5\u627e\u8fc7\u7a0b",id:"-\u53ef\u89c6\u5316-embedding-\u67e5\u627e\u8fc7\u7a0b",level:2},{value:"\ud83e\uddee \u6b65\u9aa44: \u5b8c\u6574\u6d41\u7a0b\u4e32\u8054",id:"-\u6b65\u9aa44-\u5b8c\u6574\u6d41\u7a0b\u4e32\u8054",level:2},{value:"\ud83c\udf93 \u5173\u952e\u8981\u70b9\u603b\u7ed3",id:"-\u5173\u952e\u8981\u70b9\u603b\u7ed3",level:2},{value:"1\ufe0f\u20e3 \u4e3a\u4ec0\u4e48\u9700\u8981 Embedding?",id:"1\ufe0f\u20e3-\u4e3a\u4ec0\u4e48\u9700\u8981-embedding",level:3},{value:"2\ufe0f\u20e3 Embedding \u5982\u4f55\u5b66\u4e60\u8bed\u4e49?",id:"2\ufe0f\u20e3-embedding-\u5982\u4f55\u5b66\u4e60\u8bed\u4e49",level:3},{value:"3\ufe0f\u20e3 \u5b9e\u9645\u4ee3\u7801\u5bf9\u5e94",id:"3\ufe0f\u20e3-\u5b9e\u9645\u4ee3\u7801\u5bf9\u5e94",level:3},{value:"4\ufe0f\u20e3 \u4e0b\u4e00\u6b65",id:"4\ufe0f\u20e3-\u4e0b\u4e00\u6b65",level:3},{value:"\ud83d\udd2c \u6269\u5c55\u5b9e\u9a8c: \u591a\u4e2a\u53e5\u5b50\u7684\u6279\u5904\u7406",id:"-\u6269\u5c55\u5b9e\u9a8c-\u591a\u4e2a\u53e5\u5b50\u7684\u6279\u5904\u7406",level:2},{value:"\ud83d\udcda \u53c2\u8003\u8d44\u6599",id:"-\u53c2\u8003\u8d44\u6599",level:2}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:"import marimo as mo\nimport torch\nimport torch.nn as nn\nfrom transformers import AutoTokenizer\nfrom pathlib import Path\n"})}),"\n",(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"-\u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a",children:"\ud83c\udfaf \u5206\u8bcd\u5668\u4e0e\u8bcd\u5d4c\u5165\u5b8c\u6574\u6d41\u7a0b\u6f14\u793a"})}),"\n",(0,s.jsxs)(e.p,{children:["\u672c\u7b14\u8bb0\u672c\u6f14\u793a\u4ece",(0,s.jsx)(e.strong,{children:"\u539f\u59cb\u6587\u672c"}),"\u5230",(0,s.jsx)(e.strong,{children:"\u8bcd\u5d4c\u5165\u5411\u91cf"}),"\u7684\u5b8c\u6574\u8f6c\u6362\u8fc7\u7a0b\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"-\u6d41\u7a0b\u6982\u89c8",children:"\ud83d\udcca \u6d41\u7a0b\u6982\u89c8"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'{.marimo hide_code="true"}',children:'mo.mermaid(r"""\n    graph TD\n        A[\u539f\u59cb\u6587\u672c<br/>\'\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797\'] --\x3e|\u5206\u8bcd| B[Tokenizer]\n        B --\x3e|\u5207\u5206\u8bcd\u8bed| C[Tokens<br/>\u5c0f\u7ea2\u5e3d,\u53bb,\u68ee\u6797]\n        C --\x3e|\u67e5\u8bcd\u5178| D[Token IDs<br/>1,453,234,789,2]\n        D --\x3e|\u7d22\u5f15\u67e5\u627e| E[Embedding Table<br/>6400\xd7512\u77e9\u9635]\n        E --\x3e|\u83b7\u53d6\u5411\u91cf| F[Embedding Vectors<br/>5\xd7512\u77e9\u9635]\n""")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-\u6b65\u9aa41-\u52a0\u8f7d\u9884\u8bad\u7ec3\u5206\u8bcd\u5668",children:"\ud83d\udd27 \u6b65\u9aa41: \u52a0\u8f7d\u9884\u8bad\u7ec3\u5206\u8bcd\u5668"}),"\n",(0,s.jsxs)(e.p,{children:["\u6211\u4eec\u4f7f\u7528 HuggingFace \u7684 ",(0,s.jsx)(e.code,{children:"AutoTokenizer"})," \u52a0\u8f7d\u9884\u8bad\u7ec3\u7684\u5206\u8bcd\u5668\u3002\n\u8fd9\u91cc\u4f7f\u7528 Qwen2.5-7B-Instruct \u7684\u5206\u8bcd\u5668\u4f5c\u4e3a\u793a\u4f8b\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'# \u52a0\u8f7d\u9884\u8bad\u7ec3\u5206\u8bcd\u5668\n# \u53ef\u4ee5\u66ff\u6362\u4e3a\u5176\u4ed6\u6a21\u578b: "Qwen/Qwen2.5-1.5B-Instruct", "meta-llama/Llama-3.1-8B-Instruct" \u7b49\ntokenizer_path = "Qwen/Qwen2.5-7B-Instruct"\n\nprint(f"\ud83d\udce5 \u6b63\u5728\u52a0\u8f7d\u5206\u8bcd\u5668: {tokenizer_path}")\nprint("\u23f3 \u9996\u6b21\u8fd0\u884c\u4f1a\u4ece HuggingFace \u4e0b\u8f7d,\u8bf7\u7a0d\u5019...")\n\ntokenizer = AutoTokenizer.from_pretrained(\n    tokenizer_path,\n    trust_remote_code=True,  # Qwen \u6a21\u578b\u9700\u8981\u6b64\u53c2\u6570\n)\n\nprint(f"\u2705 \u5206\u8bcd\u5668\u52a0\u8f7d\u6210\u529f!")\nprint(f"\ud83d\udcca \u8bcd\u6c47\u8868\u5927\u5c0f: {tokenizer.vocab_size:,}")\nprint(f"\ud83d\udd24 \u7279\u6b8a Token:")\nprint(f"   BOS (\u5f00\u59cb): \'{tokenizer.bos_token}\' (ID: {tokenizer.bos_token_id})")\nprint(f"   EOS (\u7ed3\u675f): \'{tokenizer.eos_token}\' (ID: {tokenizer.eos_token_id})")\nprint(f"   PAD (\u586b\u5145): \'{tokenizer.pad_token}\' (ID: {tokenizer.pad_token_id})")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-\u6b65\u9aa42-\u6587\u672c\u5206\u8bcd-tokenization",children:"\ud83d\udd24 \u6b65\u9aa42: \u6587\u672c\u5206\u8bcd (Tokenization)"}),"\n","\n",(0,s.jsx)(e.h3,{id:"-\u5206\u8bcd\u5668\u5df2\u5c31\u7eea",children:"\ud83d\udca1 \u5206\u8bcd\u5668\u5df2\u5c31\u7eea"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"AutoTokenizer.from_pretrained()"})," \u81ea\u52a8\u52a0\u8f7d\u4e86:"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8bcd\u6c47\u8868 (vocab.json)"}),": \u6240\u6709\u652f\u6301\u7684 Token \u53ca\u5176 ID"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5408\u5e76\u89c4\u5219 (merges.txt/tokenizer.json)"}),": BPE/WordPiece \u5206\u8bcd\u89c4\u5219"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7279\u6b8a Token \u914d\u7f6e"}),": BOS/EOS/PAD \u7b49\u6807\u8bb0"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5206\u8bcd\u903b\u8f91"}),": \u5b8c\u6574\u7684\u7f16\u7801/\u89e3\u7801\u529f\u80fd"]}),"\n"]}),"\n","\n",(0,s.jsx)(e.h3,{id:"-\u5b9e\u9645\u6f14\u793a-\u5bf9-\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797-\u8fdb\u884c\u5206\u8bcd",children:'\ud83d\udcdd \u5b9e\u9645\u6f14\u793a: \u5bf9 "\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797" \u8fdb\u884c\u5206\u8bcd'}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'# \u539f\u59cb\u6587\u672c\ntext = "\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797"\n\n# \u6b65\u9aa41: \u5206\u8bcd\ntokens = tokenizer.tokenize(text)\nprint(f"\ud83d\udd24 \u539f\u59cb\u6587\u672c: {text}")\nprint(f"\ud83d\udccb Tokens: {tokens}")\n\n# \u6b65\u9aa42: \u8f6c\u6362\u4e3a IDs\ntoken_ids = tokenizer.encode(text, add_special_tokens=False)\nprint(f"\ud83d\udd22 Token IDs: {token_ids}")\n\n# \u663e\u793a\u5bf9\u5e94\u5173\u7cfb\nprint("\\n\ud83d\udcca Token <-> ID \u6620\u5c04:")\nfor token, tid in zip(tokens, token_ids):\n    print(f"  \'{token}\' -> {tid}")\n\n# \u9a8c\u8bc1\u89e3\u7801\ndecoded_text = tokenizer.decode(token_ids, skip_special_tokens=True)\nprint(f"\\n\ud83d\udd04 \u89e3\u7801\u7ed3\u679c: {decoded_text}")\nprint(f"\u2705 \u89e3\u7801\u6b63\u786e: {decoded_text == text}")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-\u6b65\u9aa43-\u8bcd\u5d4c\u5165-embedding",children:"\ud83c\udfa8 \u6b65\u9aa43: \u8bcd\u5d4c\u5165 (Embedding)"}),"\n",(0,s.jsx)(e.h3,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Embedding Layer"})," = \u4e00\u4e2a\u67e5\u627e\u8868 (Lookup Table)"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8f93\u5165"}),": Token ID (\u6574\u6570, \u4f8b\u5982 453)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8f93\u51fa"}),": \u5bc6\u96c6\u5411\u91cf (\u4f8b\u5982 512 \u7ef4\u7684\u6d6e\u70b9\u6570\u5411\u91cf)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u672c\u8d28"}),": \u4ece ",(0,s.jsx)(e.code,{children:"vocab_size \xd7 hidden_size"})," \u7684\u5927\u77e9\u9635\u4e2d,\u6839\u636e ID \u63d0\u53d6\u5bf9\u5e94\u7684\u884c"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'# \u521b\u5efa Embedding \u5c42 - \u4f7f\u7528\u771f\u5b9e\u7684\u8bcd\u6c47\u8868\u5927\u5c0f\nvocab_size = tokenizer.vocab_size  # \u4f7f\u7528\u5206\u8bcd\u5668\u7684\u5b9e\u9645\u8bcd\u6c47\u8868\u5927\u5c0f\nhidden_size = 512  # \u5d4c\u5165\u7ef4\u5ea6 (\u53ef\u4ee5\u8c03\u6574,\u5b9e\u9645\u6a21\u578b\u53ef\u80fd\u662f 2048, 4096 \u7b49)\n\nembedding_layer = nn.Embedding(vocab_size, hidden_size)\n\n# \u521d\u59cb\u5316\u4e3a\u5c0f\u968f\u673a\u6570 (\u5b9e\u9645\u8bad\u7ec3\u4e2d\u4f1a\u5b66\u4e60\u5230\u8bed\u4e49\u4fe1\u606f)\nnn.init.normal_(embedding_layer.weight, mean=0.0, std=0.02)\n\nprint(f"\ud83d\udcd0 Embedding \u5c42\u5f62\u72b6: {embedding_layer.weight.shape}")\nprint(f"   = {vocab_size:,} \u4e2a\u8bcd \xd7 {hidden_size} \u7ef4\u5411\u91cf")\nprint(f"   = \u603b\u5171 {vocab_size * hidden_size:,} \u4e2a\u53c2\u6570")\nprint(f"   \u2248 {vocab_size * hidden_size * 4 / 1024 / 1024:.2f} MB (float32)")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"-\u6f14\u793a-\u5c06-token-ids-\u8f6c\u6362\u4e3a\u5d4c\u5165\u5411\u91cf",children:"\ud83d\udd0d \u6f14\u793a: \u5c06 Token IDs \u8f6c\u6362\u4e3a\u5d4c\u5165\u5411\u91cf"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'# \u8f6c\u6362\u4e3a Tensor\ninput_ids = torch.tensor([token_ids])  # shape: [1, seq_len]\n\n# \u901a\u8fc7 Embedding \u5c42\nembeddings = embedding_layer(input_ids)\n\nprint(f"\ud83d\udce5 \u8f93\u5165 Token IDs: {input_ids.shape} = [batch_size, seq_len]")\nprint(f"   \u5b9e\u9645\u503c: {input_ids.tolist()}")\nprint(\n    f"\\n\ud83d\udce4 \u8f93\u51fa Embeddings: {embeddings.shape} = [batch_size, seq_len, hidden_size]"\n)\nprint(f"\\n\ud83d\udd0d \u7b2c\u4e00\u4e2a Token (\'{tokens[0]}\', ID={token_ids[0]}) \u7684\u5d4c\u5165\u5411\u91cf (\u524d10\u7ef4):")\nprint(f"   {embeddings[0, 0, :10].detach().numpy()}")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-\u53ef\u89c6\u5316-embedding-\u67e5\u627e\u8fc7\u7a0b",children:"\ud83d\udcca \u53ef\u89c6\u5316: Embedding \u67e5\u627e\u8fc7\u7a0b"}),"\n",(0,s.jsx)(e.p,{children:'\u4ee5 Token "\u5c0f\u7ea2\u5e3d" (ID=453) \u4e3a\u4f8b:'}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'# \u5355\u72ec\u67e5\u8be2\u4e00\u4e2a Token \u7684\u5d4c\u5165\ntest_text = "\u5c0f\u7ea2\u5e3d"\ntoken_id_test = tokenizer.encode(test_text, add_special_tokens=False)[0]\nembedding_test = embedding_layer(torch.tensor([token_id_test]))\n\nprint(f"\ud83c\udfaf Token: \'{test_text}\'")\nprint(f"\ud83d\udd22 ID: {token_id_test}")\nprint(f"\ud83d\udcd0 \u5d4c\u5165\u5411\u91cf\u5f62\u72b6: {embedding_test.shape}")\nprint(f"\\n\ud83d\udd0d \u5411\u91cf\u5185\u5bb9 (\u524d20\u7ef4):")\nprint(embedding_test[0, :20].detach().numpy())\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-\u6b65\u9aa44-\u5b8c\u6574\u6d41\u7a0b\u4e32\u8054",children:"\ud83e\uddee \u6b65\u9aa44: \u5b8c\u6574\u6d41\u7a0b\u4e32\u8054"}),"\n",(0,s.jsxs)(e.p,{children:["\u6a21\u62df\u5b8c\u6574\u7684 ",(0,s.jsx)(e.strong,{children:"\u6587\u672c -> Transformer"})," \u8f93\u5165\u51c6\u5907\u8fc7\u7a0b"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'def text_to_embeddings(text, tokenizer, embedding_layer):\n    """\u5b8c\u6574\u6d41\u7a0b: \u6587\u672c -> Embeddings"""\n    # 1. \u5206\u8bcd\n    tokens_1 = tokenizer.tokenize(text)\n\n    # 2. \u8f6c IDs (\u4e0d\u6dfb\u52a0\u7279\u6b8a token,\u4ec5\u4e3a\u6f14\u793a)\n    ids = tokenizer.encode(text, add_special_tokens=False)\n\n    # 3. \u8f6c Tensor\n    input_tensor = torch.tensor([ids])\n\n    # 4. \u83b7\u53d6 Embeddings\n    embeddings_1 = embedding_layer(input_tensor)\n\n    return {\n        "text": text,\n        "tokens": tokens_1,\n        "ids": ids,\n        "input_shape": input_tensor.shape,\n        "embedding_shape": embeddings_1.shape,\n        "embeddings": embeddings_1,\n    }\n\n# \u6f14\u793a\nresult = text_to_embeddings(text, tokenizer, embedding_layer)\n\nprint("=" * 60)\nprint("\ud83c\udfaf \u5b8c\u6574\u6d41\u7a0b\u6f14\u793a")\nprint("=" * 60)\nprint(f"\ud83d\udcdd \u539f\u59cb\u6587\u672c: {result[\'text\']}")\nprint(f"\ud83d\udd24 Tokens: {result[\'tokens\']}")\nprint(f"\ud83d\udd22 Token IDs: {result[\'ids\']}")\nprint(f"\ud83d\udce5 \u8f93\u5165\u5f62\u72b6: {result[\'input_shape\']}")\nprint(f"\ud83d\udce4 \u5d4c\u5165\u5f62\u72b6: {result[\'embedding_shape\']}")\nprint(f"\\n\u2705 \u6b64\u65f6\u5d4c\u5165\u5411\u91cf\u5df2\u51c6\u5907\u597d\u9001\u5165 Transformer \u8fdb\u884c\u5904\u7406!")\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-\u5173\u952e\u8981\u70b9\u603b\u7ed3",children:"\ud83c\udf93 \u5173\u952e\u8981\u70b9\u603b\u7ed3"}),"\n",(0,s.jsx)(e.h3,{id:"1\ufe0f\u20e3-\u4e3a\u4ec0\u4e48\u9700\u8981-embedding",children:"1\ufe0f\u20e3 \u4e3a\u4ec0\u4e48\u9700\u8981 Embedding?"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u8868\u793a\u65b9\u5f0f"}),(0,s.jsx)(e.th,{children:"\u4f18\u70b9"}),(0,s.jsx)(e.th,{children:"\u7f3a\u70b9"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsxs)(e.td,{children:[(0,s.jsx)(e.strong,{children:"One-Hot"})," (\u72ec\u70ed\u7f16\u7801)"]}),(0,s.jsx)(e.td,{children:"\u7b80\u5355\u76f4\u89c2"}),(0,s.jsx)(e.td,{children:"\u7ef4\u5ea6\u7206\u70b8 (6400\u7ef4), \u65e0\u8bed\u4e49\u4fe1\u606f"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsxs)(e.td,{children:[(0,s.jsx)(e.strong,{children:"Embedding"})," (\u5bc6\u96c6\u5411\u91cf)"]}),(0,s.jsx)(e.td,{children:"\u4f4e\u7ef4 (512\u7ef4), \u5305\u542b\u8bed\u4e49"}),(0,s.jsx)(e.td,{children:"\u9700\u8981\u8bad\u7ec3\u5b66\u4e60"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"2\ufe0f\u20e3-embedding-\u5982\u4f55\u5b66\u4e60\u8bed\u4e49",children:"2\ufe0f\u20e3 Embedding \u5982\u4f55\u5b66\u4e60\u8bed\u4e49?"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u521d\u59cb\u5316"}),": \u968f\u673a\u5c0f\u6570\u503c"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8bad\u7ec3\u8fc7\u7a0b"}),": \u901a\u8fc7\u53cd\u5411\u4f20\u64ad,\u6839\u636e\u4e0a\u4e0b\u6587\u81ea\u52a8\u8c03\u6574"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7ed3\u679c"}),": \u8bed\u4e49\u76f8\u8fd1\u7684\u8bcd\u5411\u91cf\u8ddd\u79bb\u66f4\u8fd1"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4f8b\u5982\u8bad\u7ec3\u540e:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'similarity("\u56fd\u738b", "\u738b\u540e") > similarity("\u56fd\u738b", "\u82f9\u679c")\n'})}),"\n",(0,s.jsx)(e.h3,{id:"3\ufe0f\u20e3-\u5b9e\u9645\u4ee3\u7801\u5bf9\u5e94",children:"3\ufe0f\u20e3 \u5b9e\u9645\u4ee3\u7801\u5bf9\u5e94"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"# \u6765\u81ea \u4ece\u5934\u5f00\u59cb\u8bad\u7ec3\u81ea\u5df1\u7684\u5927\u6a21\u578b.py\n\n# \u5b9a\u4e49 Embedding \u5c42 (py:1160)\nself.embedding = nn.Embedding(config.vocab_size, config.hidden_size)\n\n# \u524d\u5411\u4f20\u64ad (py:1393)\nh = self.embedding(idx)  # [batch, seq_len] -> [batch, seq_len, hidden_size]\n"})}),"\n",(0,s.jsx)(e.h3,{id:"4\ufe0f\u20e3-\u4e0b\u4e00\u6b65",children:"4\ufe0f\u20e3 \u4e0b\u4e00\u6b65"}),"\n",(0,s.jsxs)(e.p,{children:["\u5d4c\u5165\u5411\u91cf\u4f1a\u9001\u5165 ",(0,s.jsx)(e.strong,{children:"Transformer Blocks"})," \u8fdb\u884c\u591a\u5c42\u5904\u7406:"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4f4d\u7f6e\u7f16\u7801 (RoPE)"}),"\n",(0,s.jsx)(e.li,{children:"\u81ea\u6ce8\u610f\u529b\u673a\u5236 (Attention)"}),"\n",(0,s.jsx)(e.li,{children:"\u524d\u9988\u7f51\u7edc (FeedForward)"}),"\n",(0,s.jsx)(e.li,{children:"\u5c42\u5f52\u4e00\u5316 (RMSNorm)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u6700\u7ec8\u8f93\u51fa\u9884\u6d4b\u4e0b\u4e00\u4e2a\u8bcd\u7684\u6982\u7387\u5206\u5e03\u3002"}),"\n","\n",(0,s.jsx)(e.h2,{id:"-\u6269\u5c55\u5b9e\u9a8c-\u591a\u4e2a\u53e5\u5b50\u7684\u6279\u5904\u7406",children:"\ud83d\udd2c \u6269\u5c55\u5b9e\u9a8c: \u591a\u4e2a\u53e5\u5b50\u7684\u6279\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u5b9e\u9645\u8bad\u7ec3\u65f6,\u6211\u4eec\u4f1a\u540c\u65f6\u5904\u7406\u591a\u4e2a\u53e5\u5b50 (batch)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:"{.marimo}",children:'# \u591a\u4e2a\u53e5\u5b50\nsentences = [\n    "\u5c0f\u7ea2\u5e3d\u53bb\u68ee\u6797",\n    "\u5c0f\u7ea2\u5e3d\u7231\u5b66\u4e60",\n]\n\n# \u4f7f\u7528 tokenizer \u81ea\u5e26\u7684\u6279\u5904\u7406\u529f\u80fd\n# padding=True \u4f1a\u81ea\u52a8\u8865\u9f50\u5230\u6700\u957f\u5e8f\u5217\n# return_tensors="pt" \u8fd4\u56de PyTorch tensor\nbatch_encoding = tokenizer(\n    sentences, padding=True, return_tensors="pt", add_special_tokens=False\n)\n\nbatch_tensor = batch_encoding["input_ids"]  # shape: [batch_size, max_len]\nattention_mask = batch_encoding[\n    "attention_mask"\n]  # 0 \u8868\u793a padding, 1 \u8868\u793a\u771f\u5b9e token\n\n# \u83b7\u53d6 Embeddings\nbatch_embeddings = embedding_layer(batch_tensor)\n\nprint(f"\ud83d\udcda \u6279\u5904\u7406 {len(sentences)} \u4e2a\u53e5\u5b50")\nprint(f"\ud83d\udce5 \u8f93\u5165\u5f62\u72b6: {batch_tensor.shape} = [batch_size, max_seq_len]")\nprint(\n    f"\ud83d\udce4 \u8f93\u51fa\u5f62\u72b6: {batch_embeddings.shape} = [batch_size, max_seq_len, hidden_size]"\n)\nprint(f"\\n\ud83d\udd0d \u6bcf\u4e2a\u53e5\u5b50\u7684 IDs (\u5df2\u81ea\u52a8 Padding):")\nfor i, sent in enumerate(sentences):\n    print(f"  [{i}] \'{sent}\'")\n    print(f"      IDs: {batch_tensor[i].tolist()}")\n    print(f"      Mask: {attention_mask[i].tolist()}")\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"-\u53c2\u8003\u8d44\u6599",children:"\ud83d\udcda \u53c2\u8003\u8d44\u6599"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5b8c\u6574\u4ee3\u7801: ",(0,s.jsx)(e.code,{children:"\u4ece\u5934\u5f00\u59cb\u8bad\u7ec3\u81ea\u5df1\u7684\u5927\u6a21\u578b.py"})]}),"\n",(0,s.jsxs)(e.li,{children:["\u8be6\u7ec6\u89e3\u91ca: ",(0,s.jsx)(e.code,{children:"\u4ece\u5934\u5f00\u59cb\u8bad\u7ec3\u81ea\u5df1\u7684\u5927\u6a21\u578b.md"})]}),"\n",(0,s.jsxs)(e.li,{children:["Transformer \u8bba\u6587: ",(0,s.jsx)(e.a,{href:"https://arxiv.org/abs/1706.03762",children:"Attention Is All You Need"})]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},54213:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>o});var t=i(36672);const s={},d=t.createContext(s);function r(n){const e=t.useContext(d);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),t.createElement(d.Provider,{value:e},n.children)}}}]);