"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[7397],{54213:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var s=r(36672);const c={},i=s.createContext(c);function t(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),s.createElement(i.Provider,{value:n},e.children)}},87129:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"FrontEnd/ServiceWorker","title":"ServiceWorker","description":"Service Worker\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u6d4f\u89c8\u5668\u540e\u53f0\u7684JavaScript\u811a\u672c\uff0c\u4f5c\u4e3aWeb\u5e94\u7528\u548c\u7f51\u7edc\u4e4b\u95f4\u7684\u4ee3\u7406\u5c42\uff0c\u4e3a\u73b0\u4ee3Web\u5e94\u7528\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u79bb\u7ebf\u548c\u6027\u80fd\u4f18\u5316\u80fd\u529b\u3002","source":"@site/docs/FrontEnd/ServiceWorker.mdx","sourceDirName":"FrontEnd","slug":"/FrontEnd/ServiceWorker","permalink":"/notes3/docs/FrontEnd/ServiceWorker","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/FrontEnd/ServiceWorker.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"frontEnd","previous":{"title":"Mantine \u5bb9\u5668\u7ec4\u4ef6\u5bf9\u6bd4","permalink":"/notes3/docs/FrontEnd/Mantine/\u5bb9\u5668\u7ec4\u4ef6"},"next":{"title":"Remeda - TypeScript \u4f18\u5148\u7684\u51fd\u6570\u5f0f\u5de5\u5177\u5e93","permalink":"/notes3/docs/FrontEnd/TypeScript/remeda"}}');var c=r(23420),i=r(54213);const t={},l=void 0,a={},d=[{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f",level:2},{value:"\u79bb\u7ebf\u8bbf\u95ee\u548c\u7f13\u5b58\u7ba1\u7406",id:"\u79bb\u7ebf\u8bbf\u95ee\u548c\u7f13\u5b58\u7ba1\u7406",level:3},{value:"\u7f51\u7edc\u8bf7\u6c42\u62e6\u622a\u548c\u5904\u7406",id:"\u7f51\u7edc\u8bf7\u6c42\u62e6\u622a\u548c\u5904\u7406",level:3},{value:"\u540e\u53f0\u540c\u6b65",id:"\u540e\u53f0\u540c\u6b65",level:3},{value:"\u63a8\u9001\u901a\u77e5",id:"\u63a8\u9001\u901a\u77e5",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:3},{value:"PWA\uff08\u6e10\u8fdb\u5f0fWeb\u5e94\u7528\uff09\u57fa\u7840",id:"pwa\u6e10\u8fdb\u5f0fweb\u5e94\u7528\u57fa\u7840",level:3},{value:"\u6838\u5fc3\u6982\u5ff5",id:"\u6838\u5fc3\u6982\u5ff5",level:2},{value:"1. \u751f\u547d\u5468\u671f",id:"1-\u751f\u547d\u5468\u671f",level:3},{value:"2. \u4f5c\u7528\u57df (Scope)",id:"2-\u4f5c\u7528\u57df-scope",level:3},{value:"3. \u7ebf\u7a0b\u9694\u79bb",id:"3-\u7ebf\u7a0b\u9694\u79bb",level:3},{value:"\u6838\u5fc3\u7ec4\u4ef6",id:"\u6838\u5fc3\u7ec4\u4ef6",level:2},{value:"1. Cache API",id:"1-cache-api",level:3},{value:"2. Fetch Event",id:"2-fetch-event",level:3},{value:"3. Install Event",id:"3-install-event",level:3},{value:"4. Activate Event",id:"4-activate-event",level:3},{value:"5. Push Event",id:"5-push-event",level:3},{value:"6. Background Sync",id:"6-background-sync",level:3},{value:"\u5e38\u7528\u7f13\u5b58\u7b56\u7565",id:"\u5e38\u7528\u7f13\u5b58\u7b56\u7565",level:2},{value:"1. Cache First (\u7f13\u5b58\u4f18\u5148)",id:"1-cache-first-\u7f13\u5b58\u4f18\u5148",level:3},{value:"2. Network First (\u7f51\u7edc\u4f18\u5148)",id:"2-network-first-\u7f51\u7edc\u4f18\u5148",level:3},{value:"3. Stale While Revalidate (\u8fc7\u671f\u91cd\u65b0\u9a8c\u8bc1)",id:"3-stale-while-revalidate-\u8fc7\u671f\u91cd\u65b0\u9a8c\u8bc1",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",children:"Service Worker"}),"\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u6d4f\u89c8\u5668\u540e\u53f0\u7684JavaScript\u811a\u672c\uff0c\u4f5c\u4e3aWeb\u5e94\u7528\u548c\u7f51\u7edc\u4e4b\u95f4\u7684\u4ee3\u7406\u5c42\uff0c\u4e3a\u73b0\u4ee3Web\u5e94\u7528\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u79bb\u7ebf\u548c\u6027\u80fd\u4f18\u5316\u80fd\u529b\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"\u5e94\u7528\u573a\u666f",children:"\u5e94\u7528\u573a\u666f"}),"\n",(0,c.jsx)(n.h3,{id:"\u79bb\u7ebf\u8bbf\u95ee\u548c\u7f13\u5b58\u7ba1\u7406",children:"\u79bb\u7ebf\u8bbf\u95ee\u548c\u7f13\u5b58\u7ba1\u7406"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5141\u8bb8\u7f51\u9875\u5728\u6ca1\u6709\u7f51\u7edc\u8fde\u63a5\u65f6\u4ecd\u80fd\u6b63\u5e38\u8fd0\u884c"}),"\n",(0,c.jsx)(n.li,{children:"\u667a\u80fd\u7f13\u5b58\u9759\u6001\u8d44\u6e90\uff08HTML\u3001CSS\u3001JS\u3001\u56fe\u7247\u7b49\uff09"}),"\n",(0,c.jsx)(n.li,{children:"\u63d0\u4f9b\u66f4\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff0c\u51cf\u5c11\u7f51\u7edc\u4f9d\u8d56"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u7f51\u7edc\u8bf7\u6c42\u62e6\u622a\u548c\u5904\u7406",children:"\u7f51\u7edc\u8bf7\u6c42\u62e6\u622a\u548c\u5904\u7406"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u62e6\u622a\u9875\u9762\u53d1\u51fa\u7684\u6240\u6709\u7f51\u7edc\u8bf7\u6c42"}),"\n",(0,c.jsx)(n.li,{children:"\u53ef\u4ee5\u4fee\u6539\u8bf7\u6c42\u3001\u63d0\u4f9b\u7f13\u5b58\u54cd\u5e94\u6216\u8f6c\u53d1\u5230\u7f51\u7edc"}),"\n",(0,c.jsx)(n.li,{children:"\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u7f13\u5b58\u7b56\u7565\uff08\u5982\u7f13\u5b58\u4f18\u5148\u3001\u7f51\u7edc\u4f18\u5148\u7b49\uff09"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u540e\u53f0\u540c\u6b65",children:"\u540e\u53f0\u540c\u6b65"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5373\u4f7f\u7528\u6237\u5173\u95ed\u4e86\u7f51\u9875\uff0c\u4e5f\u80fd\u5728\u540e\u53f0\u6267\u884c\u4efb\u52a1"}),"\n",(0,c.jsx)(n.li,{children:"\u652f\u6301\u540e\u53f0\u6570\u636e\u540c\u6b65\uff0c\u5982\u7528\u6237\u79bb\u7ebf\u65f6\u7684\u6570\u636e\u4e0a\u4f20"}),"\n",(0,c.jsx)(n.li,{children:"\u5904\u7406\u5ef6\u8fdf\u7684\u7f51\u7edc\u64cd\u4f5c"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u63a8\u9001\u901a\u77e5",children:"\u63a8\u9001\u901a\u77e5"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u63a5\u6536\u670d\u52a1\u5668\u63a8\u9001\u7684\u6d88\u606f"}),"\n",(0,c.jsx)(n.li,{children:"\u5411\u7528\u6237\u663e\u793a\u901a\u77e5\uff0c\u5373\u4f7f\u7f51\u9875\u672a\u6253\u5f00"}),"\n",(0,c.jsx)(n.li,{children:"\u63d0\u5347\u7528\u6237\u53c2\u4e0e\u5ea6\u548c\u7559\u5b58\u7387"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u9884\u7f13\u5b58\u5173\u952e\u8d44\u6e90"}),"\n",(0,c.jsx)(n.li,{children:"\u51cf\u5c11\u7f51\u7edc\u8bf7\u6c42\u6b21\u6570"}),"\n",(0,c.jsx)(n.li,{children:"\u63d0\u4f9b\u66f4\u5feb\u7684\u9875\u9762\u52a0\u8f7d\u901f\u5ea6"}),"\n",(0,c.jsx)(n.li,{children:"\u6539\u5584\u79fb\u52a8\u8bbe\u5907\u4e0a\u7684\u4f53\u9a8c"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"pwa\u6e10\u8fdb\u5f0fweb\u5e94\u7528\u57fa\u7840",children:"PWA\uff08\u6e10\u8fdb\u5f0fWeb\u5e94\u7528\uff09\u57fa\u7840"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u662f\u6784\u5efaPWA\u7684\u6838\u5fc3\u6280\u672f"}),"\n",(0,c.jsx)(n.li,{children:"\u8ba9Web\u5e94\u7528\u5177\u5907\u7c7b\u4f3c\u539f\u751f\u5e94\u7528\u7684\u4f53\u9a8c"}),"\n",(0,c.jsx)(n.li,{children:"\u652f\u6301\u79bb\u7ebf\u4f7f\u7528\u3001\u6dfb\u52a0\u5230\u4e3b\u5c4f\u5e55\u7b49\u529f\u80fd"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u6838\u5fc3\u6982\u5ff5",children:"\u6838\u5fc3\u6982\u5ff5"}),"\n",(0,c.jsx)(n.h3,{id:"1-\u751f\u547d\u5468\u671f",children:"1. \u751f\u547d\u5468\u671f"}),"\n",(0,c.jsx)(n.p,{children:"Service Worker \u5177\u6709\u72ec\u7acb\u7684\u751f\u547d\u5468\u671f\uff0c\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u4e3b\u8981\u9636\u6bb5\uff1a"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u6ce8\u518c (Register)"}),": \u901a\u8fc7 ",(0,c.jsx)(n.code,{children:"navigator.serviceWorker.register()"})," \u6ce8\u518c Service Worker"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5b89\u88c5 (Install)"}),": \u7b2c\u4e00\u6b21\u6ce8\u518c\u6216\u6587\u4ef6\u66f4\u65b0\u65f6\u89e6\u53d1 ",(0,c.jsx)(n.code,{children:"install"})," \u4e8b\u4ef6"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u6fc0\u6d3b (Activate)"}),": \u5b89\u88c5\u5b8c\u6210\u540e\u89e6\u53d1 ",(0,c.jsx)(n.code,{children:"activate"})," \u4e8b\u4ef6\uff0c\u6e05\u7406\u65e7\u7f13\u5b58"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u7a7a\u95f2 (Idle)"}),": \u7b49\u5f85\u4e8b\u4ef6\u89e6\u53d1"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u7ec8\u6b62 (Terminated)"}),": \u6d4f\u89c8\u5668\u53ef\u80fd\u4f1a\u7ec8\u6b62\u7a7a\u95f2\u7684 Service Worker \u4ee5\u8282\u7701\u5185\u5b58"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"2-\u4f5c\u7528\u57df-scope",children:"2. \u4f5c\u7528\u57df (Scope)"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Service Worker \u53ea\u80fd\u63a7\u5236\u5176\u4f5c\u7528\u57df\u5185\u7684\u9875\u9762"}),"\n",(0,c.jsx)(n.li,{children:"\u9ed8\u8ba4\u4f5c\u7528\u57df\u662f Service Worker \u6587\u4ef6\u6240\u5728\u7684\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55"}),"\n",(0,c.jsxs)(n.li,{children:["\u53ef\u4ee5\u901a\u8fc7 ",(0,c.jsx)(n.code,{children:"scope"})," \u53c2\u6570\u9650\u5236\u4f5c\u7528\u57df\u8303\u56f4"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"3-\u7ebf\u7a0b\u9694\u79bb",children:"3. \u7ebf\u7a0b\u9694\u79bb"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Service Worker \u8fd0\u884c\u5728\u72ec\u7acb\u7684\u5de5\u4f5c\u7ebf\u7a0b\u4e2d"}),"\n",(0,c.jsx)(n.li,{children:"\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee DOM \u548c\u4e3b\u7ebf\u7a0b\u7684\u53d8\u91cf"}),"\n",(0,c.jsxs)(n.li,{children:["\u901a\u8fc7 ",(0,c.jsx)(n.code,{children:"postMessage"})," \u4e0e\u4e3b\u7ebf\u7a0b\u901a\u4fe1"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u6838\u5fc3\u7ec4\u4ef6",children:"\u6838\u5fc3\u7ec4\u4ef6"}),"\n",(0,c.jsx)(n.h3,{id:"1-cache-api",children:"1. Cache API"}),"\n",(0,c.jsx)(n.p,{children:"\u7528\u4e8e\u7ba1\u7406\u7f13\u5b58\u5b58\u50a8\u7684\u6838\u5fc3API\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// \u6253\u5f00\u7f13\u5b58\r\nconst cache = await caches.open('my-cache-v1');\r\n\r\n// \u6dfb\u52a0\u8d44\u6e90\u5230\u7f13\u5b58\r\nawait cache.addAll([\r\n  '/index.html',\r\n  '/styles.css',\r\n  '/script.js'\r\n]);\r\n\r\n// \u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\r\nconst response = await cache.match('/index.html');\n"})}),"\n",(0,c.jsx)(n.h3,{id:"2-fetch-event",children:"2. Fetch Event"}),"\n",(0,c.jsx)(n.p,{children:"\u62e6\u622a\u548c\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('fetch', event => {\r\n  event.respondWith(\r\n    caches.match(event.request)\r\n      .then(response => {\r\n        // \u7f13\u5b58\u547d\u4e2d\uff0c\u8fd4\u56de\u7f13\u5b58\u7684\u54cd\u5e94\r\n        if (response) {\r\n          return response;\r\n        }\r\n        // \u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\r\n        return fetch(event.request);\r\n      })\r\n  );\r\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"3-install-event",children:"3. Install Event"}),"\n",(0,c.jsx)(n.p,{children:"\u5904\u7406 Service Worker \u5b89\u88c5\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('install', event => {\r\n  event.waitUntil(\r\n    caches.open('my-cache-v1')\r\n      .then(cache => {\r\n        return cache.addAll([\r\n          '/',\r\n          '/index.html',\r\n          '/styles.css',\r\n          '/script.js'\r\n        ]);\r\n      })\r\n  );\r\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"4-activate-event",children:"4. Activate Event"}),"\n",(0,c.jsx)(n.p,{children:"\u5904\u7406 Service Worker \u6fc0\u6d3b\u548c\u6e05\u7406\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('activate', event => {\r\n  event.waitUntil(\r\n    caches.keys().then(cacheNames => {\r\n      return Promise.all(\r\n        cacheNames.map(cacheName => {\r\n          if (cacheName !== 'my-cache-v1') {\r\n            return caches.delete(cacheName);\r\n          }\r\n        })\r\n      );\r\n    })\r\n  );\r\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"5-push-event",children:"5. Push Event"}),"\n",(0,c.jsx)(n.p,{children:"\u5904\u7406\u63a8\u9001\u901a\u77e5\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('push', event => {\r\n  const options = {\r\n    body: event.data.text(),\r\n    icon: '/icon.png',\r\n    badge: '/badge.png'\r\n  };\r\n\r\n  event.waitUntil(\r\n    self.registration.showNotification('\u65b0\u6d88\u606f', options)\r\n  );\r\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"6-background-sync",children:"6. Background Sync"}),"\n",(0,c.jsx)(n.p,{children:"\u5904\u7406\u540e\u53f0\u540c\u6b65\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('sync', event => {\r\n  if (event.tag === 'background-sync') {\r\n    event.waitUntil(doBackgroundSync());\r\n  }\r\n});\r\n\r\nasync function doBackgroundSync() {\r\n  // \u6267\u884c\u540e\u53f0\u540c\u6b65\u903b\u8f91\r\n  const data = await getOfflineData();\r\n  await sendDataToServer(data);\r\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u5e38\u7528\u7f13\u5b58\u7b56\u7565",children:"\u5e38\u7528\u7f13\u5b58\u7b56\u7565"}),"\n",(0,c.jsx)(n.h3,{id:"1-cache-first-\u7f13\u5b58\u4f18\u5148",children:"1. Cache First (\u7f13\u5b58\u4f18\u5148)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('fetch', event => {\r\n  event.respondWith(\r\n    caches.match(event.request)\r\n      .then(response => response || fetch(event.request))\r\n  );\r\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"2-network-first-\u7f51\u7edc\u4f18\u5148",children:"2. Network First (\u7f51\u7edc\u4f18\u5148)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('fetch', event => {\r\n  event.respondWith(\r\n    fetch(event.request)\r\n      .catch(() => caches.match(event.request))\r\n  );\r\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"3-stale-while-revalidate-\u8fc7\u671f\u91cd\u65b0\u9a8c\u8bc1",children:"3. Stale While Revalidate (\u8fc7\u671f\u91cd\u65b0\u9a8c\u8bc1)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"self.addEventListener('fetch', event => {\r\n  event.respondWith(\r\n    caches.open('my-cache').then(cache => {\r\n      return cache.match(event.request).then(cachedResponse => {\r\n        const fetchPromise = fetch(event.request).then(networkResponse => {\r\n          cache.put(event.request, networkResponse.clone());\r\n          return networkResponse;\r\n        });\r\n        return cachedResponse || fetchPromise;\r\n      });\r\n    })\r\n  );\r\n});\n"})})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(h,{...e})}):h(e)}}}]);