"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[3218],{33383:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>f,frontMatter:()=>i,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"Tools/Astrbot/\u63d2\u4ef6\u5f00\u53d1\u6307\u5357","title":"\u63d2\u4ef6\u5f00\u53d1\u6307\u5357","description":"AstrBot \u7684\u63d2\u4ef6\u7cfb\u7edf(Star\u7cfb\u7edf)\u662f\u5176\u6838\u5fc3\u7279\u6027\u4e4b\u4e00\uff0c\u5141\u8bb8\u5f00\u53d1\u8005\u8f7b\u677e\u6269\u5c55\u673a\u5668\u4eba\u529f\u80fd\u3002\u63d2\u4ef6\u7cfb\u7edf\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a","source":"@site/docs/Tools/Astrbot/\u63d2\u4ef6\u5f00\u53d1\u6307\u5357.mdx","sourceDirName":"Tools/Astrbot","slug":"/Tools/Astrbot/\u63d2\u4ef6\u5f00\u53d1\u6307\u5357","permalink":"/notes3/docs/Tools/Astrbot/\u63d2\u4ef6\u5f00\u53d1\u6307\u5357","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Tools/Astrbot/\u63d2\u4ef6\u5f00\u53d1\u6307\u5357.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tools","previous":{"title":"\u90e8\u7f72\u6307\u5357","permalink":"/notes3/docs/Tools/Astrbot/\u90e8\u7f72\u6307\u5357"},"next":{"title":"\u51e0\u79cd\u4f01\u5fae\u673a\u5668\u4eba","permalink":"/notes3/docs/Tools/Astrbot/\u51e0\u79cd\u4f01\u5fae\u673a\u5668\u4eba"}}');var a=s(23420),l=s(54213);const i={sidebar_position:3},r=void 0,d={},o=[{value:"\u57fa\u7840\u6982\u5ff5",id:"\u57fa\u7840\u6982\u5ff5",level:2},{value:"Star(\u63d2\u4ef6)",id:"star\u63d2\u4ef6",level:3},{value:"AstrMessageEvent",id:"astrmessageevent",level:3},{value:"Context",id:"context",level:3},{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6",id:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6",level:3},{value:"\u63d2\u4ef6\u5143\u6570\u636e",id:"\u63d2\u4ef6\u5143\u6570\u636e",level:3},{value:"\u6d88\u606f\u5904\u7406",id:"\u6d88\u606f\u5904\u7406",level:2},{value:"\u57fa\u7840\u6d88\u606f\u5904\u7406",id:"\u57fa\u7840\u6d88\u606f\u5904\u7406",level:3},{value:"\u6d88\u606f\u7c7b\u578b\u5904\u7406",id:"\u6d88\u606f\u7c7b\u578b\u5904\u7406",level:3},{value:"\u7fa4\u804a\u548c\u79c1\u804a\u5904\u7406",id:"\u7fa4\u804a\u548c\u79c1\u804a\u5904\u7406",level:3},{value:"\u9ad8\u7ea7\u529f\u80fd",id:"\u9ad8\u7ea7\u529f\u80fd",level:2},{value:"\u72b6\u6001\u7ba1\u7406",id:"\u72b6\u6001\u7ba1\u7406",level:3},{value:"\u5b9a\u65f6\u4efb\u52a1",id:"\u5b9a\u65f6\u4efb\u52a1",level:3},{value:"\u6570\u636e\u6301\u4e45\u5316",id:"\u6570\u636e\u6301\u4e45\u5316",level:3},{value:"HTTP\u8bf7\u6c42",id:"http\u8bf7\u6c42",level:3},{value:"\u63d2\u4ef6\u914d\u7f6e",id:"\u63d2\u4ef6\u914d\u7f6e",level:2},{value:"\u914d\u7f6e\u6587\u4ef6",id:"\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:2},{value:"\u63d2\u4ef6\u6d4b\u8bd5",id:"\u63d2\u4ef6\u6d4b\u8bd5",level:2},{value:"\u5355\u5143\u6d4b\u8bd5",id:"\u5355\u5143\u6d4b\u8bd5",level:3},{value:"\u63d2\u4ef6\u53d1\u5e03",id:"\u63d2\u4ef6\u53d1\u5e03",level:2},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784",level:3},{value:"\u63d2\u4ef6\u4fe1\u606f\u6587\u4ef6",id:"\u63d2\u4ef6\u4fe1\u606f\u6587\u4ef6",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u6027\u80fd\u4f18\u5316",id:"1-\u6027\u80fd\u4f18\u5316",level:3},{value:"2. \u5b89\u5168\u8003\u8651",id:"2-\u5b89\u5168\u8003\u8651",level:3},{value:"3. \u7528\u6237\u4f53\u9a8c",id:"3-\u7528\u6237\u4f53\u9a8c",level:3},{value:"4. \u4ee3\u7801\u8d28\u91cf",id:"4-\u4ee3\u7801\u8d28\u91cf",level:3}];function c(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"AstrBot \u7684\u63d2\u4ef6\u7cfb\u7edf(Star\u7cfb\u7edf)\u662f\u5176\u6838\u5fc3\u7279\u6027\u4e4b\u4e00\uff0c\u5141\u8bb8\u5f00\u53d1\u8005\u8f7b\u677e\u6269\u5c55\u673a\u5668\u4eba\u529f\u80fd\u3002\u63d2\u4ef6\u7cfb\u7edf\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"\u6781\u7b80API"}),": \u53ea\u9700\u51e0\u884c\u4ee3\u7801\u5373\u53ef\u521b\u5efa\u529f\u80fd\u63d2\u4ef6"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"\u4e8b\u4ef6\u9a71\u52a8"}),": \u57fa\u4e8e\u6d88\u606f\u4e8b\u4ef6\u7684\u5904\u7406\u673a\u5236"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"\u5f02\u6b65\u652f\u6301"}),": \u539f\u751f\u652f\u6301\u5f02\u6b65\u7f16\u7a0b"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"\u70ed\u52a0\u8f7d"}),": \u652f\u6301\u63d2\u4ef6\u7684\u52a8\u6001\u52a0\u8f7d\u548c\u5378\u8f7d"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"\u4e30\u5bcc\u4e0a\u4e0b\u6587"}),": \u63d0\u4f9b\u5b8c\u6574\u7684\u6d88\u606f\u548c\u5e73\u53f0\u4fe1\u606f"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u57fa\u7840\u6982\u5ff5",children:"\u57fa\u7840\u6982\u5ff5"}),"\n",(0,a.jsx)(n.h3,{id:"star\u63d2\u4ef6",children:"Star(\u63d2\u4ef6)"}),"\n",(0,a.jsxs)(n.p,{children:["Star\u662fAstrBot\u4e2d\u63d2\u4ef6\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u6bcf\u4e2a\u63d2\u4ef6\u90fd\u7ee7\u627f\u81ea",(0,a.jsx)(n.code,{children:"Star"}),"\u57fa\u7c7b\u3002"]}),"\n",(0,a.jsx)(n.h3,{id:"astrmessageevent",children:"AstrMessageEvent"}),"\n",(0,a.jsx)(n.p,{children:"\u6d88\u606f\u4e8b\u4ef6\u5bf9\u8c61\uff0c\u5305\u542b\u4e86\u6d88\u606f\u7684\u6240\u6709\u4fe1\u606f\u548c\u4e0a\u4e0b\u6587\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"context",children:"Context"}),"\n",(0,a.jsx)(n.p,{children:"\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u63d0\u4f9b\u4e86\u4e0eAstrBot\u6838\u5fc3\u529f\u80fd\u4ea4\u4e92\u7684\u63a5\u53e3\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,a.jsx)(n.h3,{id:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6",children:"\u521b\u5efa\u7b2c\u4e00\u4e2a\u63d2\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# plugins/hello_world.py\nfrom astrbot.api import Star, AstrMessageEvent\n\nclass HelloWorldStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "Hello World"\n        self.description = "\u4e00\u4e2a\u7b80\u5355\u7684\u95ee\u5019\u63d2\u4ef6"\n        self.author = "Your Name"\n        self.version = "1.0.0"\n    \n    async def handle(self, event: AstrMessageEvent):\n        """\u5904\u7406\u6d88\u606f\u4e8b\u4ef6"""\n        if event.message.content == "hello":\n            await event.reply("Hello, World! \ud83c\udf1f")\n            return True  # \u8fd4\u56deTrue\u8868\u793a\u6d88\u606f\u5df2\u5904\u7406\n        return False  # \u8fd4\u56deFalse\u8868\u793a\u6d88\u606f\u672a\u5904\u7406\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u63d2\u4ef6\u5143\u6570\u636e",children:"\u63d2\u4ef6\u5143\u6570\u636e"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class MyPluginStar(Star):\n    def __init__(self):\n        super().__init__()\n        # \u57fa\u7840\u4fe1\u606f\n        self.name = "\u6211\u7684\u63d2\u4ef6"\n        self.description = "\u63d2\u4ef6\u529f\u80fd\u63cf\u8ff0"\n        self.author = "\u4f5c\u8005\u540d\u79f0"\n        self.version = "1.0.0"\n        \n        # \u53ef\u9009\u914d\u7f6e\n        self.enabled = True  # \u662f\u5426\u542f\u7528\n        self.priority = 100  # \u4f18\u5148\u7ea7(\u6570\u5b57\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8)\n        self.commands = ["cmd1", "cmd2"]  # \u652f\u6301\u7684\u547d\u4ee4\n        self.platforms = ["qq", "wechat"]  # \u652f\u6301\u7684\u5e73\u53f0\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u6d88\u606f\u5904\u7406",children:"\u6d88\u606f\u5904\u7406"}),"\n",(0,a.jsx)(n.h3,{id:"\u57fa\u7840\u6d88\u606f\u5904\u7406",children:"\u57fa\u7840\u6d88\u606f\u5904\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'async def handle(self, event: AstrMessageEvent):\n    """\u57fa\u7840\u6d88\u606f\u5904\u7406"""\n    message = event.message.content\n    \n    # \u6587\u672c\u5339\u914d\n    if message == "ping":\n        await event.reply("pong!")\n        return True\n    \n    # \u524d\u7f00\u5339\u914d\n    if message.startswith("/weather"):\n        city = message[8:].strip()\n        weather_info = await self.get_weather(city)\n        await event.reply(f"{city}\u7684\u5929\u6c14: {weather_info}")\n        return True\n    \n    # \u6b63\u5219\u5339\u914d\n    import re\n    pattern = r"^\u8ba1\u7b97\\s+(.+)$"\n    match = re.match(pattern, message)\n    if match:\n        expression = match.group(1)\n        result = eval(expression)  # \u6ce8\u610f\uff1a\u5b9e\u9645\u4f7f\u7528\u4e2d\u8981\u505a\u5b89\u5168\u68c0\u67e5\n        await event.reply(f"\u8ba1\u7b97\u7ed3\u679c: {result}")\n        return True\n    \n    return False\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u6d88\u606f\u7c7b\u578b\u5904\u7406",children:"\u6d88\u606f\u7c7b\u578b\u5904\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from astrbot.api import MessageType\n\nasync def handle(self, event: AstrMessageEvent):\n    """\u5904\u7406\u4e0d\u540c\u7c7b\u578b\u7684\u6d88\u606f"""\n    \n    # \u6587\u672c\u6d88\u606f\n    if event.message.type == MessageType.TEXT:\n        await self.handle_text(event)\n    \n    # \u56fe\u7247\u6d88\u606f\n    elif event.message.type == MessageType.IMAGE:\n        await self.handle_image(event)\n    \n    # \u8bed\u97f3\u6d88\u606f\n    elif event.message.type == MessageType.VOICE:\n        await self.handle_voice(event)\n    \n    # \u6587\u4ef6\u6d88\u606f\n    elif event.message.type == MessageType.FILE:\n        await self.handle_file(event)\n\nasync def handle_image(self, event: AstrMessageEvent):\n    """\u5904\u7406\u56fe\u7247\u6d88\u606f"""\n    image_url = event.message.content  # \u56fe\u7247URL\n    # \u4e0b\u8f7d\u5e76\u5904\u7406\u56fe\u7247\n    await event.reply("\u6536\u5230\u56fe\u7247\uff0c\u6b63\u5728\u5904\u7406...")\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u7fa4\u804a\u548c\u79c1\u804a\u5904\u7406",children:"\u7fa4\u804a\u548c\u79c1\u804a\u5904\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'async def handle(self, event: AstrMessageEvent):\n    """\u533a\u5206\u7fa4\u804a\u548c\u79c1\u804a"""\n    \n    # \u68c0\u67e5\u662f\u5426\u4e3a\u7fa4\u804a\n    if event.is_group():\n        await self.handle_group_message(event)\n    else:\n        await self.handle_private_message(event)\n\nasync def handle_group_message(self, event: AstrMessageEvent):\n    """\u5904\u7406\u7fa4\u804a\u6d88\u606f"""\n    group_id = event.group_id\n    user_id = event.user_id\n    \n    # \u68c0\u67e5\u662f\u5426@\u673a\u5668\u4eba\n    if event.is_at_bot():\n        await event.reply("\u4f60@\u4e86\u6211\uff01")\n    \n    # \u7fa4\u7ba1\u7406\u529f\u80fd\n    if event.message.content == "/\u7fa4\u4fe1\u606f":\n        group_info = await self.get_group_info(group_id)\n        await event.reply(f"\u7fa4\u540d\u79f0: {group_info[\'name\']}")\n\nasync def handle_private_message(self, event: AstrMessageEvent):\n    """\u5904\u7406\u79c1\u804a\u6d88\u606f"""\n    user_id = event.user_id\n    await event.reply("\u8fd9\u662f\u79c1\u804a\u6d88\u606f")\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u9ad8\u7ea7\u529f\u80fd",children:"\u9ad8\u7ea7\u529f\u80fd"}),"\n",(0,a.jsx)(n.h3,{id:"\u72b6\u6001\u7ba1\u7406",children:"\u72b6\u6001\u7ba1\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'class StatefulStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "\u72b6\u6001\u7ba1\u7406\u63d2\u4ef6"\n        self.user_states = {}  # \u7528\u6237\u72b6\u6001\u5b58\u50a8\n    \n    async def handle(self, event: AstrMessageEvent):\n        user_id = event.user_id\n        \n        # \u83b7\u53d6\u7528\u6237\u72b6\u6001\n        state = self.user_states.get(user_id, "idle")\n        \n        if state == "idle":\n            if event.message.content == "/start_game":\n                self.user_states[user_id] = "gaming"\n                await event.reply("\u6e38\u620f\u5f00\u59cb\uff01\u8bf7\u8f93\u5165\u4f60\u7684\u9009\u62e9\uff1a")\n                return True\n        \n        elif state == "gaming":\n            choice = event.message.content\n            result = self.process_game_choice(choice)\n            await event.reply(result)\n            self.user_states[user_id] = "idle"\n            return True\n        \n        return False\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u5b9a\u65f6\u4efb\u52a1",children:"\u5b9a\u65f6\u4efb\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import asyncio\nfrom datetime import datetime, timedelta\n\nclass ScheduledStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "\u5b9a\u65f6\u4efb\u52a1\u63d2\u4ef6"\n        self.scheduled_tasks = []\n    \n    async def on_startup(self):\n        """\u63d2\u4ef6\u542f\u52a8\u65f6\u6267\u884c"""\n        # \u542f\u52a8\u5b9a\u65f6\u4efb\u52a1\n        asyncio.create_task(self.daily_reminder())\n    \n    async def daily_reminder(self):\n        """\u6bcf\u65e5\u63d0\u9192\u4efb\u52a1"""\n        while True:\n            now = datetime.now()\n            # \u8ba1\u7b97\u5230\u660e\u5929\u65e9\u4e0a8\u70b9\u7684\u65f6\u95f4\n            tomorrow_8am = (now + timedelta(days=1)).replace(\n                hour=8, minute=0, second=0, microsecond=0\n            )\n            sleep_seconds = (tomorrow_8am - now).total_seconds()\n            \n            await asyncio.sleep(sleep_seconds)\n            \n            # \u53d1\u9001\u63d0\u9192\u6d88\u606f\u5230\u6307\u5b9a\u7fa4\u7ec4\n            await self.send_reminder()\n    \n    async def send_reminder(self):\n        """\u53d1\u9001\u63d0\u9192\u6d88\u606f"""\n        # \u901a\u8fc7context\u53d1\u9001\u6d88\u606f\u5230\u6307\u5b9a\u5e73\u53f0\n        message = "\u65e9\u4e0a\u597d\uff01\u65b0\u7684\u4e00\u5929\u5f00\u59cb\u4e86\uff01"\n        await self.context.send_message(\n            platform="qq",\n            target="123456789",  # \u7fa4\u53f7\u6216\u7528\u6237ID\n            message=message\n        )\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u6570\u636e\u6301\u4e45\u5316",children:"\u6570\u636e\u6301\u4e45\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import json\nimport os\n\nclass DataPersistenceStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "\u6570\u636e\u6301\u4e45\u5316\u63d2\u4ef6"\n        self.data_file = "data/plugins/my_plugin_data.json"\n        self.data = self.load_data()\n    \n    def load_data(self):\n        """\u52a0\u8f7d\u6570\u636e"""\n        if os.path.exists(self.data_file):\n            with open(self.data_file, \'r\', encoding=\'utf-8\') as f:\n                return json.load(f)\n        return {}\n    \n    def save_data(self):\n        """\u4fdd\u5b58\u6570\u636e"""\n        os.makedirs(os.path.dirname(self.data_file), exist_ok=True)\n        with open(self.data_file, \'w\', encoding=\'utf-8\') as f:\n            json.dump(self.data, f, ensure_ascii=False, indent=2)\n    \n    async def handle(self, event: AstrMessageEvent):\n        user_id = str(event.user_id)\n        \n        if event.message.content.startswith("/save "):\n            # \u4fdd\u5b58\u7528\u6237\u6570\u636e\n            data = event.message.content[6:]\n            self.data[user_id] = data\n            self.save_data()\n            await event.reply("\u6570\u636e\u5df2\u4fdd\u5b58\uff01")\n            return True\n        \n        elif event.message.content == "/load":\n            # \u52a0\u8f7d\u7528\u6237\u6570\u636e\n            data = self.data.get(user_id, "\u6ca1\u6709\u4fdd\u5b58\u7684\u6570\u636e")\n            await event.reply(f"\u4f60\u7684\u6570\u636e: {data}")\n            return True\n        \n        return False\n'})}),"\n",(0,a.jsx)(n.h3,{id:"http\u8bf7\u6c42",children:"HTTP\u8bf7\u6c42"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import aiohttp\n\nclass HttpRequestStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "HTTP\u8bf7\u6c42\u63d2\u4ef6"\n    \n    async def handle(self, event: AstrMessageEvent):\n        if event.message.content.startswith("/weather "):\n            city = event.message.content[9:]\n            weather = await self.get_weather(city)\n            await event.reply(weather)\n            return True\n        return False\n    \n    async def get_weather(self, city):\n        """\u83b7\u53d6\u5929\u6c14\u4fe1\u606f"""\n        try:\n            async with aiohttp.ClientSession() as session:\n                url = f"http://api.weather.com/v1/current?city={city}"\n                async with session.get(url) as response:\n                    if response.status == 200:\n                        data = await response.json()\n                        return f"{city}\u7684\u5929\u6c14: {data[\'weather\']}, \u6e29\u5ea6: {data[\'temperature\']}\xb0C"\n                    else:\n                        return "\u83b7\u53d6\u5929\u6c14\u4fe1\u606f\u5931\u8d25"\n        except Exception as e:\n            return f"\u8bf7\u6c42\u51fa\u9519: {str(e)}"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u63d2\u4ef6\u914d\u7f6e",children:"\u63d2\u4ef6\u914d\u7f6e"}),"\n",(0,a.jsx)(n.h3,{id:"\u914d\u7f6e\u6587\u4ef6",children:"\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import yaml\n\nclass ConfigurableStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "\u53ef\u914d\u7f6e\u63d2\u4ef6"\n        self.config = self.load_config()\n    \n    def load_config(self):\n        """\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6"""\n        config_file = "data/plugins/my_plugin_config.yaml"\n        if os.path.exists(config_file):\n            with open(config_file, \'r\', encoding=\'utf-8\') as f:\n                return yaml.safe_load(f)\n        \n        # \u9ed8\u8ba4\u914d\u7f6e\n        default_config = {\n            "api_key": "",\n            "max_requests": 100,\n            "timeout": 30,\n            "enabled_features": ["feature1", "feature2"]\n        }\n        \n        # \u4fdd\u5b58\u9ed8\u8ba4\u914d\u7f6e\n        os.makedirs(os.path.dirname(config_file), exist_ok=True)\n        with open(config_file, \'w\', encoding=\'utf-8\') as f:\n            yaml.dump(default_config, f, default_flow_style=False)\n        \n        return default_config\n    \n    async def handle(self, event: AstrMessageEvent):\n        if not self.config.get("api_key"):\n            await event.reply("\u8bf7\u5148\u914d\u7f6eAPI\u5bc6\u94a5")\n            return True\n        \n        # \u4f7f\u7528\u914d\u7f6e\u8fdb\u884c\u5904\u7406\n        max_requests = self.config.get("max_requests", 100)\n        # ...\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import logging\n\nclass RobustStar(Star):\n    def __init__(self):\n        super().__init__()\n        self.name = "\u5065\u58ee\u63d2\u4ef6"\n        self.logger = logging.getLogger(self.name)\n    \n    async def handle(self, event: AstrMessageEvent):\n        try:\n            # \u4e3b\u8981\u903b\u8f91\n            await self.main_logic(event)\n        except Exception as e:\n            # \u8bb0\u5f55\u9519\u8bef\n            self.logger.error(f"\u5904\u7406\u6d88\u606f\u65f6\u51fa\u9519: {e}", exc_info=True)\n            \n            # \u5411\u7528\u6237\u62a5\u544a\u9519\u8bef\n            await event.reply("\u62b1\u6b49\uff0c\u5904\u7406\u8bf7\u6c42\u65f6\u51fa\u73b0\u4e86\u9519\u8bef")\n        \n        return True\n    \n    async def main_logic(self, event: AstrMessageEvent):\n        """\u4e3b\u8981\u4e1a\u52a1\u903b\u8f91"""\n        # \u53ef\u80fd\u51fa\u9519\u7684\u4ee3\u7801\n        pass\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u63d2\u4ef6\u6d4b\u8bd5",children:"\u63d2\u4ef6\u6d4b\u8bd5"}),"\n",(0,a.jsx)(n.h3,{id:"\u5355\u5143\u6d4b\u8bd5",children:"\u5355\u5143\u6d4b\u8bd5"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import unittest\nfrom unittest.mock import AsyncMock, MagicMock\n\nclass TestMyPlugin(unittest.IsolatedAsyncioTestCase):\n    def setUp(self):\n        self.plugin = MyPluginStar()\n    \n    async def test_hello_response(self):\n        """\u6d4b\u8bd5hello\u547d\u4ee4"""\n        # \u521b\u5efa\u6a21\u62df\u4e8b\u4ef6\n        event = MagicMock()\n        event.message.content = "hello"\n        event.reply = AsyncMock()\n        \n        # \u6267\u884c\u5904\u7406\n        result = await self.plugin.handle(event)\n        \n        # \u9a8c\u8bc1\u7ed3\u679c\n        self.assertTrue(result)\n        event.reply.assert_called_once_with("Hello, World! \ud83c\udf1f")\n    \n    async def test_unknown_command(self):\n        """\u6d4b\u8bd5\u672a\u77e5\u547d\u4ee4"""\n        event = MagicMock()\n        event.message.content = "unknown"\n        \n        result = await self.plugin.handle(event)\n        \n        self.assertFalse(result)\n\nif __name__ == "__main__":\n    unittest.main()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u63d2\u4ef6\u53d1\u5e03",children:"\u63d2\u4ef6\u53d1\u5e03"}),"\n",(0,a.jsx)(n.h3,{id:"\u76ee\u5f55\u7ed3\u6784",children:"\u76ee\u5f55\u7ed3\u6784"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"my_plugin/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 main.py          # \u4e3b\u63d2\u4ef6\u6587\u4ef6\n\u251c\u2500\u2500 config.yaml      # \u914d\u7f6e\u6587\u4ef6\u6a21\u677f\n\u251c\u2500\u2500 requirements.txt # \u4f9d\u8d56\u5217\u8868\n\u251c\u2500\u2500 README.md        # \u8bf4\u660e\u6587\u6863\n\u2514\u2500\u2500 tests/           # \u6d4b\u8bd5\u6587\u4ef6\n    \u2514\u2500\u2500 test_main.py\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u63d2\u4ef6\u4fe1\u606f\u6587\u4ef6",children:"\u63d2\u4ef6\u4fe1\u606f\u6587\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# __init__.py\nfrom .main import MyPluginStar\n\n__plugin_name__ = "\u6211\u7684\u63d2\u4ef6"\n__plugin_version__ = "1.0.0"\n__plugin_author__ = "\u4f5c\u8005\u540d\u79f0"\n__plugin_description__ = "\u63d2\u4ef6\u529f\u80fd\u63cf\u8ff0"\n__plugin_star__ = MyPluginStar\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,a.jsx)(n.h3,{id:"1-\u6027\u80fd\u4f18\u5316",children:"1. \u6027\u80fd\u4f18\u5316"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u907f\u514d\u963b\u585e"}),"\n",(0,a.jsx)(n.li,{children:"\u5408\u7406\u4f7f\u7528\u7f13\u5b58\u51cf\u5c11\u91cd\u590d\u8ba1\u7b97"}),"\n",(0,a.jsx)(n.li,{children:"\u907f\u514d\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u8017\u65f6\u64cd\u4f5c"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-\u5b89\u5168\u8003\u8651",children:"2. \u5b89\u5168\u8003\u8651"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u9a8c\u8bc1\u7528\u6237\u8f93\u5165"}),"\n",(0,a.jsx)(n.li,{children:"\u907f\u514d\u6267\u884c\u5371\u9669\u4ee3\u7801"}),"\n",(0,a.jsx)(n.li,{children:"\u4fdd\u62a4\u654f\u611f\u4fe1\u606f"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-\u7528\u6237\u4f53\u9a8c",children:"3. \u7528\u6237\u4f53\u9a8c"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u63d0\u4f9b\u6e05\u6670\u7684\u9519\u8bef\u4fe1\u606f"}),"\n",(0,a.jsx)(n.li,{children:"\u652f\u6301\u5e2e\u52a9\u547d\u4ee4"}),"\n",(0,a.jsx)(n.li,{children:"\u54cd\u5e94\u65f6\u95f4\u63a7\u5236"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"4-\u4ee3\u7801\u8d28\u91cf",children:"4. \u4ee3\u7801\u8d28\u91cf"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u9075\u5faaPEP 8\u7f16\u7801\u89c4\u8303"}),"\n",(0,a.jsx)(n.li,{children:"\u6dfb\u52a0\u9002\u5f53\u7684\u6ce8\u91ca\u548c\u6587\u6863"}),"\n",(0,a.jsx)(n.li,{children:"\u7f16\u5199\u5355\u5143\u6d4b\u8bd5"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.em,{children:"\u66f4\u591a\u63d2\u4ef6\u5f00\u53d1\u793a\u4f8b\u548cAPI\u6587\u6863\uff0c\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863\u548c\u793e\u533a\u63d2\u4ef6\u4ed3\u5e93\u3002"})})]})}function f(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},54213:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(36672);const a={},l=t.createContext(a);function i(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);