"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[59404],{54213:(n,e,s)=>{s.d(e,{R:()=>t,x:()=>d});var l=s(36672);const i={},r=l.createContext(i);function t(n){const e=l.useContext(r);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),l.createElement(r.Provider,{value:e},n.children)}},74645:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"Rust/Unsafe Rust\u8be6\u89e3","title":"Unsafe Rust \u8be6\u89e3","description":"\ud83d\udcda \u4ec0\u4e48\u662f Unsafe Rust\uff1f","source":"@site/docs/Rust/Unsafe Rust\u8be6\u89e3.md","sourceDirName":"Rust","slug":"/Rust/Unsafe Rust\u8be6\u89e3","permalink":"/notes3/docs/Rust/Unsafe Rust\u8be6\u89e3","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Rust/Unsafe Rust\u8be6\u89e3.md","tags":[],"version":"current","frontMatter":{},"sidebar":"rust","previous":{"title":"Rust Trait \u8be6\u89e3","permalink":"/notes3/docs/Rust/Trait\u8be6\u89e3"},"next":{"title":"panic! \u4e0e\u5f02\u5e38\uff08throw\uff09\u7684\u533a\u522b","permalink":"/notes3/docs/Rust/panic\u4e0e\u5f02\u5e38\u7684\u533a\u522b"}}');var i=s(23420),r=s(54213);const t={},d="Unsafe Rust \u8be6\u89e3",a={},c=[{value:"\ud83d\udcda \u4ec0\u4e48\u662f Unsafe Rust\uff1f",id:"-\u4ec0\u4e48\u662f-unsafe-rust",level:2},{value:"\u4e3a\u4ec0\u4e48\u9700\u8981 Unsafe\uff1f",id:"\u4e3a\u4ec0\u4e48\u9700\u8981-unsafe",level:3},{value:"1\ufe0f\u20e3 \u7f16\u8bd1\u5668\u592a\u4fdd\u5b88",id:"1\ufe0f\u20e3-\u7f16\u8bd1\u5668\u592a\u4fdd\u5b88",level:4},{value:"2\ufe0f\u20e3 \u5e95\u5c42\u7f16\u7a0b\u7684\u9700\u8981",id:"2\ufe0f\u20e3-\u5e95\u5c42\u7f16\u7a0b\u7684\u9700\u8981",level:4},{value:"\ud83d\udd25 Unsafe \u7684\u4e94\u79cd\u8d85\u80fd\u529b",id:"-unsafe-\u7684\u4e94\u79cd\u8d85\u80fd\u529b",level:2},{value:"1\ufe0f\u20e3 \u89e3\u5f15\u7528\u88f8\u6307\u9488",id:"1\ufe0f\u20e3-\u89e3\u5f15\u7528\u88f8\u6307\u9488",level:3},{value:"2\ufe0f\u20e3 \u8c03\u7528 unsafe \u51fd\u6570\u6216\u65b9\u6cd5",id:"2\ufe0f\u20e3-\u8c03\u7528-unsafe-\u51fd\u6570\u6216\u65b9\u6cd5",level:3},{value:"3\ufe0f\u20e3 \u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf",id:"3\ufe0f\u20e3-\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf",level:3},{value:"4\ufe0f\u20e3 \u5b9e\u73b0 unsafe trait",id:"4\ufe0f\u20e3-\u5b9e\u73b0-unsafe-trait",level:3},{value:"5\ufe0f\u20e3 \u8bbf\u95ee union \u7684\u5b57\u6bb5",id:"5\ufe0f\u20e3-\u8bbf\u95ee-union-\u7684\u5b57\u6bb5",level:3},{value:"\ud83c\udfaf 1. \u88f8\u6307\u9488\u8be6\u89e3",id:"-1-\u88f8\u6307\u9488\u8be6\u89e3",level:2},{value:"\u4ec0\u4e48\u662f\u88f8\u6307\u9488\uff1f",id:"\u4ec0\u4e48\u662f\u88f8\u6307\u9488",level:3},{value:"\u88f8\u6307\u9488 vs \u5f15\u7528",id:"\u88f8\u6307\u9488-vs-\u5f15\u7528",level:3},{value:"\u521b\u5efa\u88f8\u6307\u9488\u7684\u4e09\u79cd\u65b9\u5f0f",id:"\u521b\u5efa\u88f8\u6307\u9488\u7684\u4e09\u79cd\u65b9\u5f0f",level:3},{value:"\u65b9\u5f0f 1: \u4ece\u5f15\u7528\u521b\u5efa(\u5b89\u5168)",id:"\u65b9\u5f0f-1-\u4ece\u5f15\u7528\u521b\u5efa\u5b89\u5168",level:4},{value:"\u65b9\u5f0f 2: \u4ece\u5185\u5b58\u5730\u5740\u521b\u5efa(\u5371\u9669)",id:"\u65b9\u5f0f-2-\u4ece\u5185\u5b58\u5730\u5740\u521b\u5efa\u5371\u9669",level:4},{value:"\u65b9\u5f0f 3: \u4ece\u667a\u80fd\u6307\u9488\u521b\u5efa",id:"\u65b9\u5f0f-3-\u4ece\u667a\u80fd\u6307\u9488\u521b\u5efa",level:4},{value:"\u88f8\u6307\u9488\u7684\u5b9e\u6218\u793a\u4f8b",id:"\u88f8\u6307\u9488\u7684\u5b9e\u6218\u793a\u4f8b",level:3},{value:"\u793a\u4f8b 1: \u5b9e\u73b0 split_at_mut",id:"\u793a\u4f8b-1-\u5b9e\u73b0-split_at_mut",level:4},{value:"\u793a\u4f8b 2: \u8bfb\u53d6\u5b57\u7b26\u4e32\u5185\u5b58",id:"\u793a\u4f8b-2-\u8bfb\u53d6\u5b57\u7b26\u4e32\u5185\u5b58",level:4},{value:"\ud83d\udd17 2. FFI (\u5916\u90e8\u51fd\u6570\u63a5\u53e3)",id:"-2-ffi-\u5916\u90e8\u51fd\u6570\u63a5\u53e3",level:2},{value:"\u4ec0\u4e48\u662f FFI\uff1f",id:"\u4ec0\u4e48\u662f-ffi",level:3},{value:"\u8c03\u7528 C \u51fd\u6570",id:"\u8c03\u7528-c-\u51fd\u6570",level:3},{value:"\u793a\u4f8b 1: \u8c03\u7528 C \u6807\u51c6\u5e93",id:"\u793a\u4f8b-1-\u8c03\u7528-c-\u6807\u51c6\u5e93",level:4},{value:"\u793a\u4f8b 2: \u5b8c\u6574\u7684 C \u5e93\u7ed1\u5b9a",id:"\u793a\u4f8b-2-\u5b8c\u6574\u7684-c-\u5e93\u7ed1\u5b9a",level:4},{value:"ABI (\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3)",id:"abi-\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3",level:3},{value:"\u4ece\u5176\u4ed6\u8bed\u8a00\u8c03\u7528 Rust",id:"\u4ece\u5176\u4ed6\u8bed\u8a00\u8c03\u7528-rust",level:3},{value:"\u56de\u8c03\u51fd\u6570",id:"\u56de\u8c03\u51fd\u6570",level:3},{value:"\u2699\ufe0f 3. \u5185\u8054\u6c47\u7f16",id:"\ufe0f-3-\u5185\u8054\u6c47\u7f16",level:2},{value:"\u4ec0\u4e48\u662f\u5185\u8054\u6c47\u7f16\uff1f",id:"\u4ec0\u4e48\u662f\u5185\u8054\u6c47\u7f16",level:3},{value:"\u57fa\u672c\u8bed\u6cd5",id:"\u57fa\u672c\u8bed\u6cd5",level:3},{value:"\u8f93\u5165\u548c\u8f93\u51fa",id:"\u8f93\u5165\u548c\u8f93\u51fa",level:3},{value:"\u793a\u4f8b 1: \u8f93\u51fa",id:"\u793a\u4f8b-1-\u8f93\u51fa",level:4},{value:"\u793a\u4f8b 2: \u8f93\u5165\u548c\u8f93\u51fa",id:"\u793a\u4f8b-2-\u8f93\u5165\u548c\u8f93\u51fa",level:4},{value:"\u793a\u4f8b 3: inout (\u8f93\u5165\u8f93\u51fa\u540c\u4e00\u4e2a\u53d8\u91cf)",id:"\u793a\u4f8b-3-inout-\u8f93\u5165\u8f93\u51fa\u540c\u4e00\u4e2a\u53d8\u91cf",level:4},{value:"\u6307\u5b9a\u5bc4\u5b58\u5668",id:"\u6307\u5b9a\u5bc4\u5b58\u5668",level:3},{value:"\u5b9e\u6218\u793a\u4f8b: \u4e58\u6cd5",id:"\u5b9e\u6218\u793a\u4f8b-\u4e58\u6cd5",level:3},{value:"\u9009\u9879",id:"\u9009\u9879",level:3},{value:"\ud83d\udca1 \u4f7f\u7528 Unsafe \u7684\u6700\u4f73\u65f6\u673a",id:"-\u4f7f\u7528-unsafe-\u7684\u6700\u4f73\u65f6\u673a",level:2},{value:"\u2705 \u5e94\u8be5\u4f7f\u7528 Unsafe \u7684\u573a\u666f",id:"-\u5e94\u8be5\u4f7f\u7528-unsafe-\u7684\u573a\u666f",level:3},{value:"1. \u6027\u80fd\u5173\u952e\u8def\u5f84",id:"1-\u6027\u80fd\u5173\u952e\u8def\u5f84",level:4},{value:"2. \u5b9e\u73b0\u5e95\u5c42\u6570\u636e\u7ed3\u6784",id:"2-\u5b9e\u73b0\u5e95\u5c42\u6570\u636e\u7ed3\u6784",level:4},{value:"3. FFI \u8c03\u7528",id:"3-ffi-\u8c03\u7528",level:4},{value:"4. \u5185\u5b58\u6620\u5c04 I/O",id:"4-\u5185\u5b58\u6620\u5c04-io",level:4},{value:"\u274c \u4e0d\u5e94\u8be5\u4f7f\u7528 Unsafe \u7684\u573a\u666f",id:"-\u4e0d\u5e94\u8be5\u4f7f\u7528-unsafe-\u7684\u573a\u666f",level:3},{value:"1. \u7b80\u5355\u7684\u7c7b\u578b\u8f6c\u6362",id:"1-\u7b80\u5355\u7684\u7c7b\u578b\u8f6c\u6362",level:4},{value:"2. \u53ef\u4ee5\u7528\u5b89\u5168\u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd",id:"2-\u53ef\u4ee5\u7528\u5b89\u5168\u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd",level:4},{value:"\ud83d\udee1\ufe0f Unsafe \u7684\u5b89\u5168\u4fdd\u8bc1",id:"\ufe0f-unsafe-\u7684\u5b89\u5168\u4fdd\u8bc1",level:2},{value:"Unsafe \u4e0d\u80fd\u7ed5\u8fc7\u7684\u68c0\u67e5",id:"unsafe-\u4e0d\u80fd\u7ed5\u8fc7\u7684\u68c0\u67e5",level:3},{value:"\u63a7\u5236 Unsafe \u8fb9\u754c",id:"\u63a7\u5236-unsafe-\u8fb9\u754c",level:3},{value:"\ud83d\udcca \u603b\u7ed3",id:"-\u603b\u7ed3",level:2},{value:"\u6838\u5fc3\u8981\u70b9",id:"\u6838\u5fc3\u8981\u70b9",level:3},{value:"\u8bb0\u5fc6\u53e3\u8bc0",id:"\u8bb0\u5fc6\u53e3\u8bc0",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:3}];function u(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"unsafe-rust-\u8be6\u89e3",children:"Unsafe Rust \u8be6\u89e3"})}),"\n",(0,i.jsx)(e.h2,{id:"-\u4ec0\u4e48\u662f-unsafe-rust",children:"\ud83d\udcda \u4ec0\u4e48\u662f Unsafe Rust\uff1f"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Unsafe Rust"})," \u662f Rust \u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u5b50\u96c6,\u5141\u8bb8\u4f60\u7ed5\u8fc7\u7f16\u8bd1\u5668\u7684\u67d0\u4e9b\u5b89\u5168\u68c0\u67e5\u3002\u867d\u7136\u540d\u5b57\u542c\u8d77\u6765\u5f88\u5371\u9669,\u4f46\u5b83\u662f Rust \u5b9e\u73b0\u5e95\u5c42\u7f16\u7a0b\u548c\u7cfb\u7edf\u7f16\u7a0b\u7684\u5173\u952e\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u4e3a\u4ec0\u4e48\u9700\u8981-unsafe",children:"\u4e3a\u4ec0\u4e48\u9700\u8981 Unsafe\uff1f"}),"\n",(0,i.jsx)(e.h4,{id:"1\ufe0f\u20e3-\u7f16\u8bd1\u5668\u592a\u4fdd\u5b88",children:"1\ufe0f\u20e3 \u7f16\u8bd1\u5668\u592a\u4fdd\u5b88"}),"\n",(0,i.jsx)(e.p,{children:"Rust \u7684\u7f16\u8bd1\u5668\u975e\u5e38\u4fdd\u5b88,\u6709\u65f6\u4f1a\u62d2\u7edd\u4e00\u4e9b\u5b9e\u9645\u4e0a\u662f\u5b89\u5168\u7684\u4ee3\u7801,\u56e0\u4e3a\u5b83\u65e0\u6cd5\u8bc1\u660e\u8fd9\u4e9b\u4ee3\u7801\u7684\u5b89\u5168\u6027\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"// \u7f16\u8bd1\u5668\u53ef\u80fd\u65e0\u6cd5\u7406\u89e3\u8fd9\u6bb5\u4ee3\u7801\u662f\u5b89\u5168\u7684\n// \u4f46\u6211\u4eec\u77e5\u9053\u5b83\u662f\u5b89\u5168\u7684\nfn split_at_mut(slice: &mut [i32], mid: usize) -> (&mut [i32], &mut [i32]) {\n    // \u7f16\u8bd1\u5668\u4f1a\u62a5\u9519:\u4e0d\u80fd\u540c\u65f6\u6709\u4e24\u4e2a\u53ef\u53d8\u5f15\u7528\n    // (&mut slice[..mid], &mut slice[mid..]) // \u274c \u7f16\u8bd1\u9519\u8bef\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"2\ufe0f\u20e3-\u5e95\u5c42\u7f16\u7a0b\u7684\u9700\u8981",children:"2\ufe0f\u20e3 \u5e95\u5c42\u7f16\u7a0b\u7684\u9700\u8981"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7cfb\u7edf\u7f16\u7a0b"})," - \u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u64cd\u4f5c\u7cfb\u7edf\u5f00\u53d1"})," - \u9700\u8981\u8bbf\u95ee\u5e95\u5c42\u8d44\u6e90"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u6027\u80fd\u4f18\u5316"})," - \u67d0\u4e9b\u4f18\u5316\u9700\u8981\u7ed5\u8fc7\u5b89\u5168\u68c0\u67e5"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"FFI"})," - \u4e0e C/C++ \u7b49\u8bed\u8a00\u4ea4\u4e92"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"-unsafe-\u7684\u4e94\u79cd\u8d85\u80fd\u529b",children:"\ud83d\udd25 Unsafe \u7684\u4e94\u79cd\u8d85\u80fd\u529b"}),"\n",(0,i.jsxs)(e.p,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"unsafe"})," \u5173\u952e\u5b57\u53ef\u4ee5\u83b7\u5f97\u4ee5\u4e0b 5 \u79cd\u80fd\u529b:"]}),"\n",(0,i.jsx)(e.h3,{id:"1\ufe0f\u20e3-\u89e3\u5f15\u7528\u88f8\u6307\u9488",children:"1\ufe0f\u20e3 \u89e3\u5f15\u7528\u88f8\u6307\u9488"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'fn main() {\n    let mut num = 5;\n    \n    // \u521b\u5efa\u88f8\u6307\u9488(\u5b89\u5168)\n    let r1 = &num as *const i32;\n    let r2 = &mut num as *mut i32;\n    \n    // \u89e3\u5f15\u7528\u88f8\u6307\u9488(\u4e0d\u5b89\u5168)\n    unsafe {\n        println!("r1 is: {}", *r1);\n        *r2 = 10;\n        println!("r2 is: {}", *r2);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"2\ufe0f\u20e3-\u8c03\u7528-unsafe-\u51fd\u6570\u6216\u65b9\u6cd5",children:"2\ufe0f\u20e3 \u8c03\u7528 unsafe \u51fd\u6570\u6216\u65b9\u6cd5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'unsafe fn dangerous() {\n    println!("This is dangerous!");\n}\n\nfn main() {\n    unsafe {\n        dangerous();\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"3\ufe0f\u20e3-\u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf",children:"3\ufe0f\u20e3 \u8bbf\u95ee\u6216\u4fee\u6539\u53ef\u53d8\u9759\u6001\u53d8\u91cf"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'static mut COUNTER: u32 = 0;\n\nfn add_to_count(inc: u32) {\n    unsafe {\n        COUNTER += inc;\n    }\n}\n\nfn main() {\n    add_to_count(3);\n    \n    unsafe {\n        println!("COUNTER: {}", COUNTER);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"4\ufe0f\u20e3-\u5b9e\u73b0-unsafe-trait",children:"4\ufe0f\u20e3 \u5b9e\u73b0 unsafe trait"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"unsafe trait Foo {\n    // \u65b9\u6cd5\u5217\u8868\n}\n\nunsafe impl Foo for i32 {\n    // \u5b9e\u73b0\u65b9\u6cd5\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"5\ufe0f\u20e3-\u8bbf\u95ee-union-\u7684\u5b57\u6bb5",children:"5\ufe0f\u20e3 \u8bbf\u95ee union \u7684\u5b57\u6bb5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[repr(C)]\nunion MyUnion {\n    f1: u32,\n    f2: f32,\n}\n\nfn main() {\n    let u = MyUnion { f1: 1 };\n    \n    unsafe {\n        println!("f1: {}", u.f1);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"-1-\u88f8\u6307\u9488\u8be6\u89e3",children:"\ud83c\udfaf 1. \u88f8\u6307\u9488\u8be6\u89e3"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u88f8\u6307\u9488",children:"\u4ec0\u4e48\u662f\u88f8\u6307\u9488\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u88f8\u6307\u9488\u7c7b\u4f3c\u4e8e C \u8bed\u8a00\u4e2d\u7684\u6307\u9488,\u6709\u4e24\u79cd\u7c7b\u578b:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"*const T"})," - \u4e0d\u53ef\u53d8\u88f8\u6307\u9488"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"*mut T"})," - \u53ef\u53d8\u88f8\u6307\u9488"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u88f8\u6307\u9488-vs-\u5f15\u7528",children:"\u88f8\u6307\u9488 vs \u5f15\u7528"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u7279\u6027"}),(0,i.jsx)(e.th,{children:"\u5f15\u7528"}),(0,i.jsx)(e.th,{children:"\u88f8\u6307\u9488"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u501f\u7528\u68c0\u67e5"})}),(0,i.jsx)(e.td,{children:"\u53d7\u68c0\u67e5"}),(0,i.jsx)(e.td,{children:"\u4e0d\u53d7\u68c0\u67e5"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u53ef\u7a7a\u6027"})}),(0,i.jsx)(e.td,{children:"\u4e0d\u53ef\u4e3a null"}),(0,i.jsx)(e.td,{children:"\u53ef\u4ee5\u4e3a null"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5b89\u5168\u6027"})}),(0,i.jsx)(e.td,{children:"\u4fdd\u8bc1\u5b89\u5168"}),(0,i.jsx)(e.td,{children:"\u4e0d\u4fdd\u8bc1\u5b89\u5168"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u591a\u4e2a\u53ef\u53d8"})}),(0,i.jsx)(e.td,{children:"\u4e0d\u5141\u8bb8"}),(0,i.jsx)(e.td,{children:"\u5141\u8bb8"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u81ea\u52a8\u56de\u6536"})}),(0,i.jsx)(e.td,{children:"\u6709"}),(0,i.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u521b\u5efa\u88f8\u6307\u9488\u7684\u4e09\u79cd\u65b9\u5f0f",children:"\u521b\u5efa\u88f8\u6307\u9488\u7684\u4e09\u79cd\u65b9\u5f0f"}),"\n",(0,i.jsx)(e.h4,{id:"\u65b9\u5f0f-1-\u4ece\u5f15\u7528\u521b\u5efa\u5b89\u5168",children:"\u65b9\u5f0f 1: \u4ece\u5f15\u7528\u521b\u5efa(\u5b89\u5168)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"fn main() {\n    let mut num = 5;\n    \n    // \u4ece\u5f15\u7528\u521b\u5efa\u88f8\u6307\u9488\u662f\u5b89\u5168\u7684\n    let r1 = &num as *const i32;\n    let r2 = &mut num as *mut i32;\n    \n    // \u4e5f\u53ef\u4ee5\u9690\u5f0f\u8f6c\u6362\n    let r3: *const i32 = &num;\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u65b9\u5f0f-2-\u4ece\u5185\u5b58\u5730\u5740\u521b\u5efa\u5371\u9669",children:"\u65b9\u5f0f 2: \u4ece\u5185\u5b58\u5730\u5740\u521b\u5efa(\u5371\u9669)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'fn main() {\n    // \u26a0\ufe0f \u975e\u5e38\u5371\u9669!\u53ef\u80fd\u5bfc\u81f4\u6bb5\u9519\u8bef\n    let address = 0x012345usize;\n    let r = address as *const i32;\n    \n    // \u4e0d\u8981\u8fd9\u6837\u505a!\n    // unsafe {\n    //     println!("{}", *r); // \ud83d\udca5 \u6bb5\u9519\u8bef\n    // }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u65b9\u5f0f-3-\u4ece\u667a\u80fd\u6307\u9488\u521b\u5efa",children:"\u65b9\u5f0f 3: \u4ece\u667a\u80fd\u6307\u9488\u521b\u5efa"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"fn main() {\n    let a: Box<i32> = Box::new(10);\n    \n    // \u9700\u8981\u5148\u89e3\u5f15\u7528\n    let b: *const i32 = &*a;\n    \n    // \u4f7f\u7528 into_raw\n    let c: *const i32 = Box::into_raw(a);\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u88f8\u6307\u9488\u7684\u5b9e\u6218\u793a\u4f8b",children:"\u88f8\u6307\u9488\u7684\u5b9e\u6218\u793a\u4f8b"}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-1-\u5b9e\u73b0-split_at_mut",children:"\u793a\u4f8b 1: \u5b9e\u73b0 split_at_mut"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"use std::slice;\n\nfn split_at_mut(slice: &mut [i32], mid: usize) -> (&mut [i32], &mut [i32]) {\n    let len = slice.len();\n    let ptr = slice.as_mut_ptr();\n    \n    assert!(mid <= len);\n    \n    unsafe {\n        (\n            slice::from_raw_parts_mut(ptr, mid),\n            slice::from_raw_parts_mut(ptr.add(mid), len - mid),\n        )\n    }\n}\n\nfn main() {\n    let mut v = vec![1, 2, 3, 4, 5, 6];\n    let r = &mut v[..];\n    \n    let (a, b) = split_at_mut(r, 3);\n    \n    assert_eq!(a, &mut [1, 2, 3]);\n    assert_eq!(b, &mut [4, 5, 6]);\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-2-\u8bfb\u53d6\u5b57\u7b26\u4e32\u5185\u5b58",children:"\u793a\u4f8b 2: \u8bfb\u53d6\u5b57\u7b26\u4e32\u5185\u5b58"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use std::{slice::from_raw_parts, str::from_utf8_unchecked};\n\nfn get_memory_location() -> (usize, usize) {\n    let string = "Hello World!";\n    let pointer = string.as_ptr() as usize;\n    let length = string.len();\n    (pointer, length)\n}\n\nfn get_str_at_location(pointer: usize, length: usize) -> &\'static str {\n    unsafe {\n        from_utf8_unchecked(from_raw_parts(pointer as *const u8, length))\n    }\n}\n\nfn main() {\n    let (pointer, length) = get_memory_location();\n    let message = get_str_at_location(pointer, length);\n    println!("The {} bytes at 0x{:X} stored: {}", length, pointer, message);\n}\n'})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"-2-ffi-\u5916\u90e8\u51fd\u6570\u63a5\u53e3",children:"\ud83d\udd17 2. FFI (\u5916\u90e8\u51fd\u6570\u63a5\u53e3)"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f-ffi",children:"\u4ec0\u4e48\u662f FFI\uff1f"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"FFI"})," (Foreign Function Interface) \u5141\u8bb8 Rust \u4ee3\u7801\u8c03\u7528\u5176\u4ed6\u8bed\u8a00(\u4e3b\u8981\u662f C)\u7f16\u5199\u7684\u51fd\u6570\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u8c03\u7528-c-\u51fd\u6570",children:"\u8c03\u7528 C \u51fd\u6570"}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-1-\u8c03\u7528-c-\u6807\u51c6\u5e93",children:"\u793a\u4f8b 1: \u8c03\u7528 C \u6807\u51c6\u5e93"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use libc::size_t;\n\n#[link(name = "snappy")]\nextern "C" {\n    fn snappy_max_compressed_length(source_length: size_t) -> size_t;\n}\n\nfn main() {\n    let x = unsafe {\n        snappy_max_compressed_length(100)\n    };\n    println!("max compressed length: {}", x);\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-2-\u5b8c\u6574\u7684-c-\u5e93\u7ed1\u5b9a",children:"\u793a\u4f8b 2: \u5b8c\u6574\u7684 C \u5e93\u7ed1\u5b9a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use libc::{c_int, size_t};\n\n#[link(name = "snappy")]\nextern "C" {\n    fn snappy_compress(\n        input: *const u8,\n        input_length: size_t,\n        compressed: *mut u8,\n        compressed_length: *mut size_t\n    ) -> c_int;\n    \n    fn snappy_uncompress(\n        compressed: *const u8,\n        compressed_length: size_t,\n        uncompressed: *mut u8,\n        uncompressed_length: *mut size_t\n    ) -> c_int;\n}\n\npub fn compress(src: &[u8]) -> Vec<u8> {\n    unsafe {\n        let srclen = src.len() as size_t;\n        let psrc = src.as_ptr();\n        \n        let mut dstlen = srclen * 2; // \u7b80\u5316\u793a\u4f8b\n        let mut dst = Vec::with_capacity(dstlen as usize);\n        let pdst = dst.as_mut_ptr();\n        \n        snappy_compress(psrc, srclen, pdst, &mut dstlen);\n        dst.set_len(dstlen as usize);\n        dst\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"abi-\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3",children:"ABI (\u5e94\u7528\u4e8c\u8fdb\u5236\u63a5\u53e3)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'// C ABI (\u6700\u5e38\u89c1)\nextern "C" {\n    fn abs(input: i32) -> i32;\n}\n\n// Windows API\n#[cfg(all(target_os = "win32", target_arch = "x86"))]\nextern "stdcall" {\n    fn SetEnvironmentVariableA(n: *const u8, v: *const u8) -> i32;\n}\n\n// System ABI (\u6839\u636e\u5e73\u53f0\u81ea\u52a8\u9009\u62e9)\nextern "system" {\n    // ...\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u4ece\u5176\u4ed6\u8bed\u8a00\u8c03\u7528-rust",children:"\u4ece\u5176\u4ed6\u8bed\u8a00\u8c03\u7528 Rust"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[no_mangle]\npub extern "C" fn call_from_c() {\n    println!("Just called a Rust function from C!");\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"C \u4ee3\u7801"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"// \u58f0\u660e\nextern void call_from_c();\n\nint main() {\n    call_from_c();\n    return 0;\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u56de\u8c03\u51fd\u6570",children:"\u56de\u8c03\u51fd\u6570"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'// Rust \u4ee3\u7801\nextern "C" fn callback(a: i32) {\n    println!("I\'m called from C with value {}", a);\n}\n\n#[link(name = "extlib")]\nextern "C" {\n    fn register_callback(cb: extern "C" fn(i32)) -> i32;\n    fn trigger_callback();\n}\n\nfn main() {\n    unsafe {\n        register_callback(callback);\n        trigger_callback();\n    }\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"C \u4ee3\u7801"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"typedef void (*rust_callback)(int32_t);\nrust_callback cb;\n\nint32_t register_callback(rust_callback callback) {\n    cb = callback;\n    return 1;\n}\n\nvoid trigger_callback() {\n    cb(7);\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\ufe0f-3-\u5185\u8054\u6c47\u7f16",children:"\u2699\ufe0f 3. \u5185\u8054\u6c47\u7f16"}),"\n",(0,i.jsx)(e.h3,{id:"\u4ec0\u4e48\u662f\u5185\u8054\u6c47\u7f16",children:"\u4ec0\u4e48\u662f\u5185\u8054\u6c47\u7f16\uff1f"}),"\n",(0,i.jsx)(e.p,{children:"\u5185\u8054\u6c47\u7f16\u5141\u8bb8\u4f60\u5728 Rust \u4ee3\u7801\u4e2d\u76f4\u63a5\u5d4c\u5165\u6c47\u7f16\u6307\u4ee4,\u7528\u4e8e:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u6781\u81f4\u6027\u80fd\u4f18\u5316"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u8bbf\u95ee\u7279\u6b8a CPU \u6307\u4ee4"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"\u5e95\u5c42\u786c\u4ef6\u64cd\u4f5c"})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u57fa\u672c\u8bed\u6cd5",children:"\u57fa\u672c\u8bed\u6cd5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'use std::arch::asm;\n\nfn main() {\n    #[cfg(target_arch = "x86_64")]\n    unsafe {\n        asm!("nop"); // \u63d2\u5165\u4e00\u4e2a NOP \u6307\u4ee4\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u8f93\u5165\u548c\u8f93\u51fa",children:"\u8f93\u5165\u548c\u8f93\u51fa"}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-1-\u8f93\u51fa",children:"\u793a\u4f8b 1: \u8f93\u51fa"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[cfg(target_arch = "x86_64")]\nfn main() {\n    use std::arch::asm;\n    \n    let x: u64;\n    unsafe {\n        asm!("mov {}, 5", out(reg) x);\n    }\n    assert_eq!(x, 5);\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-2-\u8f93\u5165\u548c\u8f93\u51fa",children:"\u793a\u4f8b 2: \u8f93\u5165\u548c\u8f93\u51fa"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[cfg(target_arch = "x86_64")]\nfn main() {\n    use std::arch::asm;\n    \n    let i: u64 = 3;\n    let o: u64;\n    unsafe {\n        asm!(\n            "mov {0}, {1}",\n            "add {0}, 5",\n            out(reg) o,\n            in(reg) i,\n        );\n    }\n    assert_eq!(o, 8);\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b-3-inout-\u8f93\u5165\u8f93\u51fa\u540c\u4e00\u4e2a\u53d8\u91cf",children:"\u793a\u4f8b 3: inout (\u8f93\u5165\u8f93\u51fa\u540c\u4e00\u4e2a\u53d8\u91cf)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[cfg(target_arch = "x86_64")]\nfn main() {\n    use std::arch::asm;\n    \n    let mut x: u64 = 3;\n    unsafe {\n        asm!("add {0}, 5", inout(reg) x);\n    }\n    assert_eq!(x, 8);\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u6307\u5b9a\u5bc4\u5b58\u5668",children:"\u6307\u5b9a\u5bc4\u5b58\u5668"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[cfg(target_arch = "x86_64")]\nfn main() {\n    use std::arch::asm;\n    \n    let cmd = 0xd1;\n    unsafe {\n        asm!("out 0x64, eax", in("eax") cmd);\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u5b9e\u6218\u793a\u4f8b-\u4e58\u6cd5",children:"\u5b9e\u6218\u793a\u4f8b: \u4e58\u6cd5"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[cfg(target_arch = "x86_64")]\nfn mul(a: u64, b: u64) -> u128 {\n    use std::arch::asm;\n    \n    let lo: u64;\n    let hi: u64;\n    \n    unsafe {\n        asm!(\n            "mul {}",\n            in(reg) a,\n            inlateout("rax") b => lo,\n            lateout("rdx") hi\n        );\n    }\n    \n    ((hi as u128) << 64) + lo as u128\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u9009\u9879",children:"\u9009\u9879"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'#[cfg(target_arch = "x86_64")]\nfn main() {\n    use std::arch::asm;\n    \n    let mut a: u64 = 4;\n    let b: u64 = 4;\n    unsafe {\n        asm!(\n            "add {0}, {1}",\n            inlateout(reg) a,\n            in(reg) b,\n            options(pure, nomem, nostack), // \u4f18\u5316\u9009\u9879\n        );\n    }\n    assert_eq!(a, 8);\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u5e38\u7528\u9009\u9879"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"pure"})," - \u65e0\u526f\u4f5c\u7528"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"nomem"})," - \u4e0d\u8bbf\u95ee\u5185\u5b58"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"readonly"})," - \u53ea\u8bfb\u5185\u5b58"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"nostack"})," - \u4e0d\u4f7f\u7528\u6808"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"noreturn"})," - \u4e0d\u8fd4\u56de"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"-\u4f7f\u7528-unsafe-\u7684\u6700\u4f73\u65f6\u673a",children:"\ud83d\udca1 \u4f7f\u7528 Unsafe \u7684\u6700\u4f73\u65f6\u673a"}),"\n",(0,i.jsx)(e.h3,{id:"-\u5e94\u8be5\u4f7f\u7528-unsafe-\u7684\u573a\u666f",children:"\u2705 \u5e94\u8be5\u4f7f\u7528 Unsafe \u7684\u573a\u666f"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u6027\u80fd\u5173\u952e\u8def\u5f84",children:"1. \u6027\u80fd\u5173\u952e\u8def\u5f84"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"// \u907f\u514d\u8fb9\u754c\u68c0\u67e5\nfn sum_unchecked(slice: &[i32]) -> i32 {\n    let mut sum = 0;\n    for i in 0..slice.len() {\n        unsafe {\n            sum += *slice.get_unchecked(i);\n        }\n    }\n    sum\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"2-\u5b9e\u73b0\u5e95\u5c42\u6570\u636e\u7ed3\u6784",children:"2. \u5b9e\u73b0\u5e95\u5c42\u6570\u636e\u7ed3\u6784"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"pub struct Vec<T> {\n    ptr: *mut T,\n    len: usize,\n    cap: usize,\n}\n\nimpl<T> Vec<T> {\n    pub fn push(&mut self, elem: T) {\n        if self.len == self.cap {\n            self.grow();\n        }\n        unsafe {\n            std::ptr::write(self.ptr.add(self.len), elem);\n        }\n        self.len += 1;\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"3-ffi-\u8c03\u7528",children:"3. FFI \u8c03\u7528"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'extern "C" {\n    fn some_c_function(x: i32) -> i32;\n}\n\nfn call_c() -> i32 {\n    unsafe {\n        some_c_function(42)\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h4,{id:"4-\u5185\u5b58\u6620\u5c04-io",children:"4. \u5185\u5b58\u6620\u5c04 I/O"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"fn read_hardware_register(addr: usize) -> u32 {\n    unsafe {\n        std::ptr::read_volatile(addr as *const u32)\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-\u4e0d\u5e94\u8be5\u4f7f\u7528-unsafe-\u7684\u573a\u666f",children:"\u274c \u4e0d\u5e94\u8be5\u4f7f\u7528 Unsafe \u7684\u573a\u666f"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u7b80\u5355\u7684\u7c7b\u578b\u8f6c\u6362",children:"1. \u7b80\u5355\u7684\u7c7b\u578b\u8f6c\u6362"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"// \u274c \u4e0d\u8981\u7528 unsafe\nlet x: i32 = unsafe { std::mem::transmute(5u32) };\n\n// \u2705 \u4f7f\u7528\u5b89\u5168\u7684\u65b9\u6cd5\nlet x: i32 = 5u32 as i32;\n"})}),"\n",(0,i.jsx)(e.h4,{id:"2-\u53ef\u4ee5\u7528\u5b89\u5168\u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd",children:"2. \u53ef\u4ee5\u7528\u5b89\u5168\u4ee3\u7801\u5b9e\u73b0\u7684\u529f\u80fd"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"// \u274c \u4e0d\u8981\u7528 unsafe\nunsafe fn add(a: i32, b: i32) -> i32 {\n    a + b\n}\n\n// \u2705 \u4f7f\u7528\u666e\u901a\u51fd\u6570\nfn add(a: i32, b: i32) -> i32 {\n    a + b\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"\ufe0f-unsafe-\u7684\u5b89\u5168\u4fdd\u8bc1",children:"\ud83d\udee1\ufe0f Unsafe \u7684\u5b89\u5168\u4fdd\u8bc1"}),"\n",(0,i.jsx)(e.h3,{id:"unsafe-\u4e0d\u80fd\u7ed5\u8fc7\u7684\u68c0\u67e5",children:"Unsafe \u4e0d\u80fd\u7ed5\u8fc7\u7684\u68c0\u67e5"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u501f\u7528\u68c0\u67e5"})," - \u4ecd\u7136\u6709\u6548"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u751f\u547d\u5468\u671f\u68c0\u67e5"})," - \u4ecd\u7136\u6709\u6548"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u7c7b\u578b\u68c0\u67e5"})," - \u4ecd\u7136\u6709\u6548"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:'fn main() {\n    let r;\n    {\n        let x = 5;\n        r = &x;\n    }\n    // \u274c \u5373\u4f7f\u5728 unsafe \u4e2d\u4e5f\u4f1a\u62a5\u9519\n    // unsafe {\n    //     println!("{}", r);\n    // }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u63a7\u5236-unsafe-\u8fb9\u754c",children:"\u63a7\u5236 Unsafe \u8fb9\u754c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-rust",children:"// \u2705 \u597d\u7684\u505a\u6cd5:\u5c0f\u8303\u56f4\u7684 unsafe\npub fn safe_function(slice: &[i32], index: usize) -> Option<i32> {\n    if index < slice.len() {\n        Some(unsafe { *slice.get_unchecked(index) })\n    } else {\n        None\n    }\n}\n\n// \u274c \u4e0d\u597d\u7684\u505a\u6cd5:\u5927\u8303\u56f4\u7684 unsafe\npub unsafe fn unsafe_function(slice: &[i32], index: usize) -> i32 {\n    // \u5f88\u591a\u4ee3\u7801...\n    *slice.get_unchecked(index)\n    // \u66f4\u591a\u4ee3\u7801...\n}\n"})}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"-\u603b\u7ed3",children:"\ud83d\udcca \u603b\u7ed3"}),"\n",(0,i.jsx)(e.h3,{id:"\u6838\u5fc3\u8981\u70b9",children:"\u6838\u5fc3\u8981\u70b9"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"\u6982\u5ff5"}),(0,i.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Unsafe \u5173\u952e\u5b57"})}),(0,i.jsx)(e.td,{children:'\u544a\u8bc9\u7f16\u8bd1\u5668"\u6211\u77e5\u9053\u6211\u5728\u505a\u4ec0\u4e48"'})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4e94\u79cd\u8d85\u80fd\u529b"})}),(0,i.jsx)(e.td,{children:"\u88f8\u6307\u9488\u3001unsafe \u51fd\u6570\u3001\u9759\u6001\u53d8\u91cf\u3001unsafe trait\u3001union"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u4f7f\u7528\u539f\u5219"})}),(0,i.jsx)(e.td,{children:"\u80fd\u4e0d\u7528\u5c31\u4e0d\u7528,\u5fc5\u987b\u7528\u65f6\u5c3d\u91cf\u5c0f\u8303\u56f4"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"\u5b89\u5168\u4fdd\u8bc1"})}),(0,i.jsx)(e.td,{children:"\u4ecd\u7136\u6709\u501f\u7528\u68c0\u67e5\u3001\u751f\u547d\u5468\u671f\u68c0\u67e5"})]})]})]}),"\n",(0,i.jsx)(e.h3,{id:"\u8bb0\u5fc6\u53e3\u8bc0",children:"\u8bb0\u5fc6\u53e3\u8bc0"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Unsafe"})," = ",(0,i.jsx)(e.strong,{children:"\u7ed5\u8fc7\u90e8\u5206\u5b89\u5168\u68c0\u67e5"})]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u88f8\u6307\u9488"})," = ",(0,i.jsx)(e.strong,{children:"\u7c7b\u4f3c C \u6307\u9488"})]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"FFI"})," = ",(0,i.jsx)(e.strong,{children:"\u4e0e C \u4ea4\u4e92"})]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u5185\u8054\u6c47\u7f16"})," = ",(0,i.jsx)(e.strong,{children:"\u76f4\u63a5\u5199\u6c47\u7f16"})]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"\u4f7f\u7528\u65f6\u673a"})," = ",(0,i.jsx)(e.strong,{children:"\u5e95\u5c42\u7f16\u7a0b\u3001\u6027\u80fd\u4f18\u5316\u3001FFI"})]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u2705 ",(0,i.jsx)(e.strong,{children:"\u6700\u5c0f\u5316 unsafe \u8303\u56f4"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 ",(0,i.jsx)(e.strong,{children:"\u7528\u5b89\u5168 API \u5305\u88c5 unsafe \u4ee3\u7801"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 ",(0,i.jsx)(e.strong,{children:"\u8be6\u7ec6\u6ce8\u91ca\u4e3a\u4ec0\u4e48\u9700\u8981 unsafe"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u2705 ",(0,i.jsx)(e.strong,{children:"\u5145\u5206\u6d4b\u8bd5 unsafe \u4ee3\u7801"})]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"\u4e0d\u8981\u6ee5\u7528 unsafe"})]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\ud83e\udd80\u2728"})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(u,{...n})}):u(n)}}}]);