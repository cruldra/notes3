"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[1092],{54213:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>i});var s=t(36672);const r={},o=s.createContext(r);function c(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(o.Provider,{value:n},e.children)}},88301:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/persist","title":"persist","description":"\u7b80\u4ecb","source":"@site/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/persist.mdx","sourceDirName":"FrontEnd/Zustand/\u4e2d\u95f4\u4ef6","slug":"/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/persist","permalink":"/notes3/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/persist","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/persist.mdx","tags":[],"version":"current","frontMatter":{"title":"persist","comment":false,"editLink":false,"prev":false,"next":false},"sidebar":"frontEnd","previous":{"title":"devtools","permalink":"/notes3/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/devtools"},"next":{"title":"subscribeWithSelector","permalink":"/notes3/docs/FrontEnd/Zustand/\u4e2d\u95f4\u4ef6/subscribeWithSelector"}}');var r=t(23420),o=t(54213);const c={title:"persist",comment:!1,editLink:!1,prev:!1,next:!1},i=void 0,d={},a=[{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:2},{value:"PersistOptions",id:"persistoptions",level:2},{value:"\u793a\u4f8b1-\u4f7f\u7528<code>localstorage</code>\u6301\u4e45\u5316\u72b6\u6001",id:"\u793a\u4f8b1-\u4f7f\u7528localstorage\u6301\u4e45\u5316\u72b6\u6001",level:2},{value:"\u5728<code>SSR</code>\u4e2d\u4f7f\u7528",id:"\u5728ssr\u4e2d\u4f7f\u7528",level:2}];function l(e){const n={code:"code",h2:"h2",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u7b80\u4ecb",children:"\u7b80\u4ecb"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"persist"}),"\u4e2d\u95f4\u4ef6\u7528\u4e8e\u5c06\u72b6\u6001\u6301\u4e45\u5316\u5230\u8bf8\u5982",(0,r.jsx)(n.code,{children:"localstorage"}),"\u6216",(0,r.jsx)(n.code,{children:"sessionstorage"}),"\u7b49\u5b58\u50a8\u4ecb\u8d28\u4e2d,\u8fd9\u6837\u8ba9\u7528\u6237\u4e0b\u6b21\u518d\u6253\u5f00\u5e94\u7528\u65f6\u80fd\u591f\u6062\u590d\u5230\u4ed6\u4eec\u79bb\u5f00\u65f6\u7684\u72b6\u6001."]}),"\n",(0,r.jsx)(n.h2,{id:"persistoptions",children:"PersistOptions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"PersistOptions"}),"\u63a5\u53e3\u5b9a\u4e49\u4e86\u4e00\u4e9b\u914d\u7f6e\u9879,\u8fd9\u4e9b\u914d\u7f6e\u9879\u7528\u4e8e\u63a7\u5236\u72b6\u6001\u6301\u4e45\u5316\u7684\u884c\u4e3a."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"interface PersistOptions {\n    //\u5b58\u50a8\u7684\u540d\u79f0\uff08\u5fc5\u987b\u552f\u4e00\uff09\u3002\n    name: string;\n    //\u5c06\u72b6\u6001\u5199\u5165\u6301\u4e45\u5316\u5b58\u50a8\u4ecb\u8d28\u65f6\u4f7f\u7528\u7684\u5e8f\u5217\u5316\u5668\n    serialize?: (state: StorageValue<S>) => string | Promise<string>;\n    // \u4ece\u6301\u4e45\u5316\u5b58\u50a8\u4ecb\u8d28\u4e2d\u8bfb\u53d6\u72b6\u6001\u65f6\u4f7f\u7528\u7684\u53cd\u5e8f\u5217\u5316\u5668\n    deserialize?: (str: string) => StorageValue<PersistedState> | Promise<StorageValue<PersistedState>>;\n    // \u4f7f\u7528\u81ea\u5b9a\u4e49\u6301\u4e45\u5316\u5b58\u50a8\n    storage?: PersistStorage<PersistedState> | undefined;\n    // \u7b5b\u9009\u5668\uff0c\u7528\u4e8e\u51b3\u5b9a\u54ea\u4e9b\u72b6\u6001\u7247\u6bb5\u9700\u8981\u6301\u4e45\u5316\n    partialize?: (state: S) => PersistedState;\n    //\u5728\u72b6\u6001\u91cd\u65b0\u6c34\u5408\u4e4b\u524d\u8c03\u7528\u7684\u51fd\u6570\u3002\u8fd4\u56de\u7684\u51fd\u6570\u5c06\u5728\u72b6\u6001\u91cd\u65b0\u6c34\u5408\u540e\u6216\u53d1\u751f\u9519\u8bef\u65f6\u8c03\u7528\u3002\n    onRehydrateStorage?: (state: S) => ((state?: S, error?: unknown) => void) | void;\n    //\u5982\u679c\u5b58\u50a8\u72b6\u6001\u7684\u7248\u672c\u4e0e\u6b64\u5904\u6307\u5b9a\u7684\u7248\u672c\u4e0d\u5339\u914d\uff0c\u5c06\u4e0d\u4f7f\u7528\u5b58\u50a8\u3002\u8fd9\u5728\u5411\u5b58\u50a8\u6dfb\u52a0\u7834\u574f\u6027\u66f4\u6539\u65f6\u5f88\u6709\u7528\u3002\n    version?: number;\n    // \u4e00\u4e2a\u53ef\u9009\u7684\u5e03\u5c14\u503c\uff0c\u5c06\u963b\u6b62\u6301\u4e45\u5316\u4e2d\u95f4\u4ef6\u5728\u521d\u59cb\u5316\u65f6\u89e6\u53d1\u6c34\u5408\u3002\u8fd9\u4f7f\u60a8\u53ef\u4ee5\u5728\u5e94\u7528\u7684\u6e32\u67d3\u751f\u547d\u5468\u671f\u7684\u7279\u5b9a\u70b9\u8c03\u7528rehydrate()\u3002\u8fd9\u5728SSR\u5e94\u7528\u4e2d\u5f88\u6709\u7528\u3002\n    skipHydration?: boolean;\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"\u793a\u4f8b1-\u4f7f\u7528localstorage\u6301\u4e45\u5316\u72b6\u6001",children:["\u793a\u4f8b1-\u4f7f\u7528",(0,r.jsx)(n.code,{children:"localstorage"}),"\u6301\u4e45\u5316\u72b6\u6001"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import {persist, PersistOptions} from "zustand/middleware";\nimport create from "zustand";\nimport {StateCreator} from "zustand/vanilla";\n//\u5b9a\u4e49\u72b6\u6001\u7684\u7c7b\u578b\ntype TestStore = {\n    count: number;\n    increment: () => void;\n    decrement: () => void;\n};\nconst persistOptions: PersistOptions<TestStore> = {\n    name: "TestStore",\n    version: 0,\n    storeage: localStorage\n}\n//\u521b\u5efa\u5b58\u50a8\u5e93\nconst createStore: StateCreator<TestStore, [["zustand/devtools", never]]> = (\n    set, get\n) => {\n    console.log(set)\n    return ({\n        count: 0,\n        increment: () => set((state) => ({count: state.count + 1})),\n        decrement: () => set((state) => ({count: state.count - 1})),\n    })\n};\n\nexport const useTestStore = create<TestStore>(persist(createStore, persistOptions),); \n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {useTestStore} from './store';\n\nexport default () => {\n    const [count, increment, decrement] = useTestStore((s) => [\n        s.count,\n        s.increment,\n        s.decrement,\n    ]);\n    return <div>\n        <h1>{count}</h1>\n        <button onClick={increment}>+</button>\n        <button onClick={decrement}>-</button>\n    </div>;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6253\u5f00\u63a7\u5236\u53f0,\u70b9\u51fb",(0,r.jsx)(n.code,{children:"+"}),"\u6216\u8005",(0,r.jsx)(n.code,{children:"-"}),"\u6309\u94ae,\u53ef\u4ee5\u770b\u5230",(0,r.jsx)(n.code,{children:"count"}),"\u503c\u88ab\u5b9e\u65f6\u4fdd\u5b58\u5230\u4e86",(0,r.jsx)(n.code,{children:"localstorage"}),"\u4e2d:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://cdn.jsdelivr.net/gh/hhypygy/images@master/20240204/image.3uw0ojqnwac0.png",alt:""})}),"\n",(0,r.jsxs)(n.h2,{id:"\u5728ssr\u4e2d\u4f7f\u7528",children:["\u5728",(0,r.jsx)(n.code,{children:"SSR"}),"\u4e2d\u4f7f\u7528"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"persist"}),"\u4e2d\u95f4\u4ef6\u9ed8\u8ba4\u4f1a\u5728\u521d\u59cb\u5316\u65f6\u89e6\u53d1",(0,r.jsx)(n.code,{children:"\u6c34\u5408(\u6307\u4ece\u6301\u4e45\u5316\u5b58\u50a8\u4ecb\u8d28\u4e2d\u8bfb\u53d6\u72b6\u6001)"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u9875\u9762\u6216\u8005\u7ec4\u4ef6\u4f7f\u7528\u7684\u662f",(0,r.jsx)(n.code,{children:"SSR"}),"\u6e32\u67d3,\u6b64\u65f6\u5c31\u4f1a\u62a5\u9519,\u56e0\u4e3a",(0,r.jsx)(n.code,{children:"localstorage"}),"\u662f\u6d4f\u89c8\u5668\u73af\u5883\u4e0b\u7684",(0,r.jsx)(n.code,{children:"API"}),",\u5728",(0,r.jsx)(n.code,{children:"SSR"}),"\u73af\u5883\u4e0b\u662f\u4e0d\u53ef\u7528\u7684."]}),"\n",(0,r.jsxs)(n.p,{children:["\u6240\u4ee5\u5bf9\u4e8e\u90a3\u4e9b\u53ef\u80fd\u4f1a\u88ab\u4f7f\u7528",(0,r.jsx)(n.code,{children:"SSR"}),"\u6e32\u67d3\u7684\u7ec4\u4ef6\u8bbf\u95ee\u7684\u5b58\u50a8\u5e93,\u8981\u901a\u8fc7",(0,r.jsx)(n.code,{children:"skipHydration"}),"\u9009\u9879\u6765\u963b\u6b62",(0,r.jsx)(n.code,{children:"persist"}),"\u4e2d\u95f4\u4ef6\u5728\u521d\u59cb\u5316\u65f6\u89e6\u53d1",(0,r.jsx)(n.code,{children:"\u6c34\u5408"}),"\n,\u7136\u540e\u7531\u5ba2\u6237\u7aef\u5728\u5408\u9002\u7684\u65f6\u673a\u624b\u52a8\u8c03\u7528",(0,r.jsx)(n.code,{children:"rehydrate"}),"\u65b9\u6cd5\u6765\u89e6\u53d1",(0,r.jsx)(n.code,{children:"\u6c34\u5408"})]}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u9762\u6211\u4eec\u6a21\u62df\u8fd9\u79cd\u60c5\u51b5:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import {persist, PersistOptions} from "zustand/middleware";\nimport create from "zustand";\nimport {StateCreator} from "zustand/vanilla";\n//\u5b9a\u4e49\u72b6\u6001\u7684\u7c7b\u578b\ntype TestStore = {\n    count: number;\n    increment: () => void;\n    decrement: () => void;\n};\nconst persistOptions: PersistOptions<TestStore> = {\n    name: "TestStore",\n    version: 0,\n    storeage: localStorage,\n    skipHydration: true\n}\n//\u521b\u5efa\u5b58\u50a8\u5e93\nconst createStore: StateCreator<TestStore, [["zustand/devtools", never]]> = (\n    set, get\n) => {\n    console.log(set)\n    return ({\n        count: 0,\n        increment: () => set((state) => ({count: state.count + 1})),\n        decrement: () => set((state) => ({count: state.count - 1})),\n    })\n};\n\nexport const useTestStore = create<TestStore>(persist(createStore, persistOptions),); \n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0a\u9762\u7684\u4f8b\u5b50\u7ed9",(0,r.jsx)(n.code,{children:"persistOptions"}),"\u6dfb\u52a0\u4e86",(0,r.jsx)(n.code,{children:"skipHydration: true"}),"\u9009\u9879,\u8fd9\u6837\u5c31\u4f1a\u963b\u6b62",(0,r.jsx)(n.code,{children:"persist"}),"\u4e2d\u95f4\u4ef6\u5728\u521d\u59cb\u5316\u65f6\u89e6\u53d1",(0,r.jsx)(n.code,{children:"\u6c34\u5408"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u73b0\u5728\u6211\u4eec\u5c06",(0,r.jsx)(n.code,{children:"count"}),"\u7684\u503c\u901a\u8fc7",(0,r.jsx)(n.code,{children:"+"}),"\u8c03\u6574\u4e3a",(0,r.jsx)(n.code,{children:"3"}),",\u7136\u540e\u518d\u5237\u65b0\u9875\u9762\u4f1a\u53d1\u73b0",(0,r.jsx)(n.code,{children:"count"}),"\u7684\u503c\u53c8\u53d8\u6210\u4e86\u521d\u59cb\u503c",(0,r.jsx)(n.code,{children:"0"}),",\u8bf4\u660e",(0,r.jsx)(n.code,{children:"skipHydration:true"}),"\u751f\u6548\u4e86"]}),"\n",(0,r.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\u5728",(0,r.jsx)(n.code,{children:"useEffect"}),"\u4e2d\u624b\u52a8\u8c03\u7528",(0,r.jsx)(n.code,{children:"rehydrate"}),"\u65b9\u6cd5\u6765\u89e6\u53d1",(0,r.jsx)(n.code,{children:"\u6c34\u5408"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"useEffect(() => {\n     useTestStore.persist.rehydrate()\n }, [])\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b8c\u6574\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import {useTestStore} from './store';\nimport {useEffect} from 'react'\nexport default () => {\n    const [count, increment, decrement] = useTestStore((s) => [\n        s.count,\n        s.increment,\n        s.decrement,\n    ]);\n     useEffect(() => {\n         useTestStore.persist.rehydrate()\n     }, [])\n    return <div>\n        <h1>{count}</h1>\n        <button onClick={increment}>+</button>\n        <button onClick={decrement}>-</button>\n    </div>;\n}\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);