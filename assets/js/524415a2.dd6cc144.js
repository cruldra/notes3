"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[8265],{42958:(e,n,r)=>{r.d(n,{A:()=>s});var t=r(36672);const a={collapsible:"collapsible_JxWL",toggle:"toggle_uR_2",title:"title_mZU1",icon:"icon_gZcb",content:"content_NVz9",open:"open_r_EU",codeWrapper:"codeWrapper_yFMm"};var o=r(23420);function s(e){let{children:n,title:r="\u5c55\u5f00\u4ee3\u7801",defaultOpen:s=!1,maxHeight:l=500,showLineNumbers:c=!0,language:i}=e;const[d,h]=(0,t.useState)(s),x=(0,t.useRef)(null),[u,p]=(0,t.useState)(0);return(0,t.useEffect)((()=>{x.current&&p(x.current.scrollHeight)}),[n]),(0,o.jsxs)("div",{className:a.collapsible,children:[(0,o.jsxs)("button",{className:a.toggle,onClick:()=>h(!d),"aria-expanded":d,children:[(0,o.jsx)("span",{className:a.title,children:r}),(0,o.jsx)("span",{className:a.icon,children:d?"\u25bc":"\u25b6"})]}),(0,o.jsx)("div",{ref:x,className:`${a.content} ${d?a.open:""}`,style:{maxHeight:d?`${l}px`:0},children:(0,o.jsx)("div",{className:a.codeWrapper,children:t.Children.map(n,(e=>t.isValidElement(e)&&"pre"===e.type?t.cloneElement(e,{className:`${e.props.className||""} ${c?"line-numbers":""}`,...i&&{"data-language":i}}):e))})})]})}},54118:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>x,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"JVM/Libraries/\u8eab\u4efd\u8ba4\u8bc1/Sa-Token","title":"Sa-Token","description":"Sa-Token\u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u4e14\u529f\u80fd\u5f3a\u5927\u7684Java\u6743\u9650\u8ba4\u8bc1\u6846\u67b6.","source":"@site/docs/JVM/Libraries/\u8eab\u4efd\u8ba4\u8bc1/Sa-Token.mdx","sourceDirName":"JVM/Libraries/\u8eab\u4efd\u8ba4\u8bc1","slug":"/JVM/Libraries/\u8eab\u4efd\u8ba4\u8bc1/Sa-Token","permalink":"/notes3/docs/JVM/Libraries/\u8eab\u4efd\u8ba4\u8bc1/Sa-Token","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/JVM/Libraries/\u8eab\u4efd\u8ba4\u8bc1/Sa-Token.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"jvmEcosystem","previous":{"title":"\u8eab\u4efd\u8ba4\u8bc1","permalink":"/notes3/docs/category/\u8eab\u4efd\u8ba4\u8bc1"},"next":{"title":"Maven Model","permalink":"/notes3/docs/JVM/Libraries/Maven Model"}}');var a=r(23420),o=r(54213),s=r(42958);const l={},c=void 0,i={},d=[{value:"\u548cWeb\u6846\u67b6\u96c6\u6210",id:"\u548cweb\u6846\u67b6\u96c6\u6210",level:2},{value:"Javalin",id:"javalin",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://sa-token.cc/doc.html#/",children:"Sa-Token"}),"\u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u4e14\u529f\u80fd\u5f3a\u5927\u7684",(0,a.jsx)(n.code,{children:"Java"}),"\u6743\u9650\u8ba4\u8bc1\u6846\u67b6."]}),"\n",(0,a.jsx)(n.h2,{id:"\u548cweb\u6846\u67b6\u96c6\u6210",children:"\u548cWeb\u6846\u67b6\u96c6\u6210"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://sa-token.cc/doc.html#/",children:"Sa-Token"}),"\u53ef\u4ee5\u901a\u8fc7",(0,a.jsx)(n.a,{href:"https://sa-token.cc/v/v1.28.0/doc/index.html#/fun/sa-token-context?id=%e8%87%aa%e5%ae%9a%e4%b9%89-satokencontext-%e6%8c%87%e5%8d%97",children:"\u81ea\u5b9a\u4e49SaTokenContext"}),"\u6765\u548c\u4e0d\u540c\u7684",(0,a.jsx)(n.code,{children:"Web"}),"\u6846\u67b6\u96c6\u6210."]}),"\n",(0,a.jsx)(n.h3,{id:"javalin",children:"Javalin"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"Javalin"}),"\u4f7f\u7528\u7684\u662f",(0,a.jsx)(n.code,{children:"Jetty"}),"\u4f5c\u4e3a",(0,a.jsx)(n.code,{children:"Web"}),"\u670d\u52a1\u5668,\u9075\u5faa",(0,a.jsx)(n.code,{children:"Jakarta Servlet API"}),"\u89c4\u8303."]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:"<dependency>\r\n    <groupId>cn.dev33</groupId>\r\n    <artifactId>sa-token-jakarta-servlet</artifactId>\r\n    <version>1.39.0</version>\r\n</dependency>\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsxs)(n.li,{children:["\u5728",(0,a.jsx)(n.code,{children:"Javalin"}),"\u4e2d\u5b9e\u73b0\u7c7b\u4f3c",(0,a.jsx)(n.code,{children:"SpringMVCUtil.getRequest()"}),"\u7684\u6548\u679c"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:'object JavalinRequestHolder {\r\n    private val contextThreadLocal = ThreadLocal<Context>()\r\n\r\n    fun setContext(ctx: Context) {\r\n        contextThreadLocal.set(ctx)\r\n    }\r\n\r\n    fun getContext(): Context {\r\n        return contextThreadLocal.get() ?: throw IllegalStateException("Context not found in current thread")\r\n    }\r\n\r\n    fun clear() {\r\n        contextThreadLocal.remove()\r\n    }\r\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"3",children:["\n",(0,a.jsxs)(n.li,{children:["\u5728\u8def\u7531\u524d\u540e\u8c03\u7528",(0,a.jsx)(n.code,{children:"SaTokenContext"}),"\u7684",(0,a.jsx)(n.code,{children:"set"}),"\u548c",(0,a.jsx)(n.code,{children:"clear"}),"\u65b9\u6cd5"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"// \u5728\u6bcf\u4e2a\u8bf7\u6c42\u5f00\u59cb\u65f6\u4fdd\u5b58 Context\r\napp.before { ctx ->\r\n    JavalinRequestHolder.setContext(ctx)\r\n}\r\n\r\n// \u5728\u6bcf\u4e2a\u8bf7\u6c42\u7ed3\u675f\u540e\u6e05\u7406 Context\r\napp.after { ctx ->\r\n    JavalinRequestHolder.clear()\r\n}\n"})}),"\n",(0,a.jsxs)(n.ol,{start:"4",children:["\n",(0,a.jsxs)(n.li,{children:["\u521b\u5efa",(0,a.jsx)(n.code,{children:"Javalin"}),"\u4e13\u7528\u7684",(0,a.jsx)(n.code,{children:"SaTokenContext"})]}),"\n"]}),"\n","\n",(0,a.jsx)(s.A,{title:"SaTokenContext.kt",defaultOpen:!1,maxHeight:1e3,showLineNumbers:!0,language:"kotlin",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"class SaTokenForJavalin : SaTokenContext {\r\n    private val pathMatcher = AntPathMatcher()\r\n    override fun getRequest(): SaRequest {\r\n        return SaRequestForServlet(JavalinRequestHolder.getContext().req())\r\n    }\r\n\r\n    override fun getResponse(): SaResponse {\r\n        return SaResponseForServlet(JavalinRequestHolder.getContext().res())\r\n    }\r\n\r\n    override fun getStorage(): SaStorage {\r\n        return SaStorageForServlet(JavalinRequestHolder.getContext().req())\r\n    }\r\n\r\n    override fun matchPath(pattern: String?, path: String?): Boolean {\r\n        // \u5982\u679cpattern\u6216path\u4e3a\u7a7a\uff0c\u8fd4\u56defalse\r\n        if (pattern.isNullOrBlank() || path.isNullOrBlank()) {\r\n            return false\r\n        }\r\n\r\n        return try {\r\n            // \u4f7f\u7528AntPathMatcher\u8fdb\u884c\u8def\u5f84\u5339\u914d\r\n            pathMatcher.match(pattern, path)\r\n        } catch (e: Exception) {\r\n            // \u53d1\u751f\u5f02\u5e38\u65f6\u8fd4\u56defalse\r\n            false\r\n        }\r\n    }\r\n\r\n}\n"})})}),"\n",(0,a.jsxs)(n.ol,{start:"5",children:["\n",(0,a.jsxs)(n.li,{children:["\u544a\u8bc9",(0,a.jsx)(n.code,{children:"Sa-Token"}),"\u4f7f\u7528",(0,a.jsx)(n.code,{children:"Javalin"}),"\u4e13\u7528\u7684",(0,a.jsx)(n.code,{children:"SaTokenContext"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:'object SaTokenConfigManager {\r\n    fun init() {\r\n        // \u6ce8\u518c\u4e0a\u4e0b\u6587\r\n        SaManager.setConfig(SaTokenConfig())\r\n        SaManager.setSaTokenContext(SaTokenForJavalin())\r\n\r\n        // \u914d\u7f6eSa-Token\r\n        val config = SaTokenConfig().apply {\r\n            tokenName = "satoken"     // token\u540d\u79f0\r\n            timeout = 2592000         // token\u6709\u6548\u671f\uff0c\u5355\u4f4ds \u9ed8\u8ba430\u5929\r\n            activeTimeout = -1      // token\u4e34\u65f6\u6709\u6548\u671f\r\n            isConcurrent = true       // \u662f\u5426\u5141\u8bb8\u540c\u4e00\u8d26\u53f7\u5e76\u53d1\u767b\u5f55\r\n            isShare = true            // \u5728\u591a\u4eba\u767b\u5f55\u540c\u4e00\u8d26\u53f7\u65f6\uff0c\u662f\u5426\u5171\u7528\u4e00\u4e2atoken\r\n            tokenStyle = "uuid"       // token\u98ce\u683c\r\n            isLog = false             // \u662f\u5426\u8f93\u51fa\u64cd\u4f5c\u65e5\u5fd7\r\n        }\r\n        SaManager.setConfig(config)\r\n    }\r\n}\n'})}),"\n",(0,a.jsxs)(n.ol,{start:"6",children:["\n",(0,a.jsxs)(n.li,{children:["\u5728\u521b\u5efa",(0,a.jsx)(n.code,{children:"Javalin"}),"\u5b9e\u4f8b\u524d\u521d\u59cb\u5316"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",children:"SaTokenConfigManager.init()\r\nval app = Javalin.create { config ->\r\n    ...\r\n}.start(7001)\n"})})]})}function x(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},54213:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>l});var t=r(36672);const a={},o=t.createContext(a);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);