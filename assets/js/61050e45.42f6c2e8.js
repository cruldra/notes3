"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[61681],{54213:(n,r,e)=>{e.d(r,{R:()=>o,x:()=>i});var s=e(36672);const t={},a=s.createContext(t);function o(n){const r=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function i(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),s.createElement(a.Provider,{value:r},n.children)}},58751:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"CodeSnippets/Uniapp","title":"Uniapp","description":"\u9879\u76ee\u7ed3\u6784","source":"@site/docs/CodeSnippets/Uniapp.mdx","sourceDirName":"CodeSnippets","slug":"/CodeSnippets/Uniapp","permalink":"/notes3/docs/CodeSnippets/Uniapp","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CodeSnippets/Uniapp.mdx","tags":[],"version":"current","frontMatter":{}}');var t=e(23420),a=e(54213);const o={},i=void 0,l={},c=[{value:"\u9879\u76ee\u7ed3\u6784",id:"\u9879\u76ee\u7ed3\u6784",level:2},{value:"\u670d\u52a1\u7c7b",id:"\u670d\u52a1\u7c7b",level:2},{value:"\u9875\u9762",id:"\u9875\u9762",level:2},{value:"\u4e0a\u62c9\u52a0\u8f7d\u4e0b\u62c9\u5237\u65b0",id:"\u4e0a\u62c9\u52a0\u8f7d\u4e0b\u62c9\u5237\u65b0",level:3},{value:"websocket",id:"websocket",level:3},{value:"sse",id:"sse",level:3}];function u(n){const r={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"\u9879\u76ee\u7ed3\u6784",children:"\u9879\u76ee\u7ed3\u6784"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-text",children:"\ud83d\udce6 projectRoot/\r\n\u251c\u2500\u2500 \ud83d\udcc2 src/\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 components/\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 Component1.tsx\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 Component2.tsx\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 index.ts\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 pages/\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc2 [resource]/\r\n\u2502   \u2502       \u251c\u2500\u2500 \ud83d\udcc4 page1.vue\r\n\u2502   \u2502       \u2514\u2500\u2500 \ud83d\udcc4 page2.vue\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 subpkg/\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc2 [resource]/\r\n\u2502   \u2502       \u251c\u2500\u2500 \ud83d\udcc4 page1.vue\r\n\u2502   \u2502       \u2514\u2500\u2500 \ud83d\udcc4 page2.vue\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 services/\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 [Resource]Service.ts\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 index.ts\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 stores/\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 [Resource]Store.ts\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 index.ts\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 types/\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 [Resource].ts\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 index.ts\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc2 utils/\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 util1.ts\r\n\u2502   \u2502   \u251c\u2500\u2500 \ud83d\udcc4 util2.ts\r\n\u2502   \u2502   \u2514\u2500\u2500 \ud83d\udcc4 index.ts\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 App.vue\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 main.ts\r\n\u2502   \u251c\u2500\u2500 \ud83d\udcc4 manifest.json\r\n\u2502   \u2514\u2500\u2500 \ud83d\udcc4 pages.json\r\n\u251c\u2500\u2500 \ud83d\udcc4 .env\r\n\u251c\u2500\u2500 \ud83d\udcc4 .env.development\r\n\u251c\u2500\u2500 \ud83d\udcc4 .env.production\r\n\u251c\u2500\u2500 \ud83d\udcc4 index.html\r\n\u251c\u2500\u2500 \ud83d\udce6 package.json\r\n\u251c\u2500\u2500 \u2699\ufe0f tsconfig.json\r\n\u251c\u2500\u2500 \u2699\ufe0f vite.config.mjs\r\n\u2514\u2500\u2500 \ud83c\udfa8 unocss.config.ts\n"})}),"\n",(0,t.jsx)(r.h2,{id:"\u670d\u52a1\u7c7b",children:"\u670d\u52a1\u7c7b"}),"\n",(0,t.jsxs)(r.p,{children:["\u670d\u52a1\u7c7b\u7528\u4e8e\u548c\u540e\u7aef\u4ea4\u4e92,\u91c7\u7528",(0,t.jsx)(r.code,{children:"retrofit"}),"\u683c\u5f0f"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import {createApi, DefaultApiImpl, Get, Path, Query} from "@dongjak-extensions/http-client";\r\nimport {request} from "@/utils/http.ts";\r\nimport type {ResponsePayloads} from "@/types/common.ts";\r\nimport type {Course} from "@/types/course.ts";\r\n\r\nclass CourseService extends DefaultApiImpl {\r\n\r\n\r\n    /**\r\n     * \u67e5\u8be2\u8bfe\u7a0b\u5217\u8868\r\n     * @param type  \u7c7b\u578b\r\n     * @param offset \u6570\u636e\u504f\u79fb\u91cf\r\n     * @param limit \u6570\u636e\u957f\u5ea6\r\n     */\r\n    @Get(\'/courses\')\r\n    getCourses(@Query("type") type: string, @Query("offset") offset: number, @Query("limit") limit: number): Promise<ResponsePayloads<Array<Course>>> {\r\n        return Promise.resolve() as any\r\n    }\r\n\r\n    /**\r\n     * \u67e5\u8be2\u63a8\u8350\u8bfe\u7a0b\r\n     */\r\n    @Get(\'/courses/recommended\')\r\n    getRecommendedCourses(): Promise<ResponsePayloads<Array<Course>>> {\r\n        return Promise.resolve() as any\r\n    }\r\n\r\n    /**\r\n     * \u67e5\u8be2\u8bfe\u7a0b\u8be6\u60c5\r\n     * @param id \u8bfe\u7a0bID\r\n     */\r\n    @Get(\'/courses/:id\')\r\n    getCourseDetail(@Path("id") id: string): Promise<ResponsePayloads<Course>> {\r\n        return Promise.resolve() as any\r\n    }\r\n\r\n    /**\r\n     * \u67e5\u8be2\u5df2\u8d2d\u4e70\u7684\u8bfe\u7a0b\r\n     */\r\n    @Get(\'/courses/my/purchased\')\r\n    getPurchasedCourses(): Promise<ResponsePayloads<Array<Course>>> {\r\n        return Promise.resolve() as any\r\n    }\r\n\r\n\r\n}\r\n\r\nexport const courseService = createApi(CourseService, request)\n'})}),"\n",(0,t.jsx)(r.h2,{id:"\u9875\u9762",children:"\u9875\u9762"}),"\n",(0,t.jsx)(r.h3,{id:"\u4e0a\u62c9\u52a0\u8f7d\u4e0b\u62c9\u5237\u65b0",children:"\u4e0a\u62c9\u52a0\u8f7d\u4e0b\u62c9\u5237\u65b0"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-html",children:'<template>\r\n  <scroll-view\r\n    class="scroll-container"\r\n    scroll-y\r\n    @scrolltolower="onLoadMore"\r\n    @refresherrefresh="onRefresh"\r\n    :refresher-enabled="true"\r\n    :refresher-triggered="isRefreshing"\r\n  >\r\n    <div class="list">\r\n      \x3c!-- \u5217\u8868\u5185\u5bb9 --\x3e\r\n      <div class="item" v-for="(item, index) in list" :key="index">\r\n        {{ item.title }}\r\n      </div>\r\n\r\n      \x3c!-- \u52a0\u8f7d\u72b6\u6001 --\x3e\r\n      <div v-if="list.length" class="loading-text">\r\n        {{ pageParams.hasMore ? \'\u6b63\u5728\u52a0\u8f7d...\' : \'\u6ca1\u6709\u66f4\u591a\u4e86\' }}\r\n      </div>\r\n    </div>\r\n  </scroll-view>\r\n</template>\r\n\r\n<script setup lang="ts">\r\nimport { ref } from \'vue\'\r\nimport { listApi } from \'@/services\'\r\n\r\n// \u5217\u8868\u6570\u636e\r\nconst list = ref([])\r\n\r\n// \u5237\u65b0\u72b6\u6001\r\nconst isRefreshing = ref(false)\r\n\r\n// \u5206\u9875\u53c2\u6570\r\nconst pageParams = ref({\r\n  offset: 0,\r\n  limit: 10,\r\n  isLoading: false,\r\n  hasMore: true\r\n})\r\n\r\n// \u83b7\u53d6\u5217\u8868\u6570\u636e\r\nconst getList = async () => {\r\n  if (!pageParams.value.hasMore || pageParams.value.isLoading) return\r\n  pageParams.value.isLoading = true\r\n\r\n  try {\r\n    const res = await listApi.getList(pageParams.value.offset, pageParams.value.limit)\r\n\r\n    if (pageParams.value.offset === 0) {\r\n      list.value = res.data || []\r\n    } else {\r\n      list.value.push(...(res.data || []))\r\n    }\r\n\r\n    pageParams.value.hasMore = (res.data || []).length === pageParams.value.limit\r\n    pageParams.value.offset += pageParams.value.limit\r\n  } finally {\r\n    pageParams.value.isLoading = false\r\n  }\r\n}\r\n\r\n// \u5237\u65b0\r\nconst onRefresh = async () => {\r\n  isRefreshing.value = true\r\n  try {\r\n    pageParams.value.offset = 0\r\n    pageParams.value.hasMore = true\r\n    await getList()\r\n  } finally {\r\n    isRefreshing.value = false\r\n  }\r\n}\r\n\r\n// \u52a0\u8f7d\u66f4\u591a\r\nconst onLoadMore = async () => {\r\n  await getList()\r\n}\r\n<\/script>\r\n\r\n<style scoped>\r\n.scroll-container {\r\n  height: 100vh;\r\n}\r\n\r\n.loading-text {\r\n  text-align: center;\r\n  font-size: 24rpx;\r\n  color: #999;\r\n  padding: 20rpx 0;\r\n}\r\n</style>\n'})}),"\n",(0,t.jsx)(r.h3,{id:"websocket",children:"websocket"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-html",children:'<template>\r\n  <div class="chat-container">\r\n    \x3c!-- \u804a\u5929\u6d88\u606f\u5217\u8868 --\x3e\r\n    <scroll-view\r\n      class="message-list"\r\n      scroll-y\r\n      :scroll-top="scrollTop"\r\n      :scroll-with-animation="true"\r\n    >\r\n      <div class="message-inner">\r\n        <div v-for="(msg, index) in messageList" :key="index"\r\n             :class="[\'message\', msg.type === \'user\' ? \'user\' : \'ai\']">\r\n          {{ msg.content }}\r\n        </div>\r\n        \x3c!-- \u751f\u6210\u4e2d\u63d0\u793a --\x3e\r\n        <div v-if="isGenerating" class="generating">\r\n          AI\u6b63\u5728\u601d\u8003...\r\n          <div class="stop-btn" @tap="stopGenerate">\u505c\u6b62</div>\r\n        </div>\r\n      </div>\r\n    </scroll-view>\r\n\r\n    \x3c!-- \u8f93\u5165\u6846 --\x3e\r\n    <div class="input-box">\r\n      <input\r\n        v-model="inputText"\r\n        class="input"\r\n        placeholder="\u8bf7\u8f93\u5165\u5185\u5bb9..."\r\n      />\r\n      <button @tap="sendMessage" class="send-btn">\u53d1\u9001</button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang="ts">\r\nimport { ref, nextTick } from \'vue\'\r\n\r\nconst messageList = ref<Array<{type: string, content: string}>>([])\r\nconst inputText = ref(\'\')\r\nconst scrollTop = ref(0)\r\nconst isGenerating = ref(false)\r\nconst ws = ref<any>(null)\r\nconst currentTaskId = ref(\'\')\r\n\r\n// \u8fde\u63a5WebSocket\r\nfunction connectWebSocket() {\r\n  ws.value = uni.connectSocket({\r\n    url: `${import.meta.env.VITE_WS_URL}ws/chat/1`, // \u8fd9\u91cc\u6539\u6210\u4f60\u7684WS\u5730\u5740 [[1]](https://poe.com/citation?message_id=330921017671&citation=1)\r\n    success: () => console.log(\'WebSocket connected\')\r\n  })\r\n\r\n  ws.value.onOpen(() => {\r\n    console.log(\'\u8fde\u63a5\u6210\u529f\')\r\n  })\r\n\r\n  ws.value.onMessage((res: any) => {\r\n    try {\r\n      const data = JSON.parse(res.data)\r\n      currentTaskId.value = data.task_id\r\n\r\n      // \u5904\u7406\u505c\u6b62\r\n      if(data.stopped) {\r\n        isGenerating.value = false\r\n        return\r\n      }\r\n\r\n      // \u5904\u7406\u9519\u8bef\r\n      if(data.error) {\r\n        uni.showToast({ title: data.error, icon: \'none\' })\r\n        isGenerating.value = false\r\n        return\r\n      }\r\n\r\n      // \u5904\u7406\u7ed3\u675f\r\n      if(data.end) {\r\n        isGenerating.value = false\r\n        return\r\n      }\r\n\r\n      // \u5904\u7406\u56de\u7b54\r\n      if(data.answer) {\r\n        isGenerating.value = true\r\n        const lastMsg = messageList.value[messageList.value.length - 1]\r\n\r\n        if(!lastMsg || lastMsg.type === \'user\') {\r\n          messageList.value.push({\r\n            type: \'ai\',\r\n            content: data.answer\r\n          })\r\n        } else {\r\n          lastMsg.content += data.answer\r\n        }\r\n        scrollToBottom()\r\n      }\r\n    } catch (error) {\r\n      console.error(\'Parse message error:\', error)\r\n    }\r\n  })\r\n}\r\n\r\n// \u53d1\u9001\u6d88\u606f\r\nfunction sendMessage() {\r\n  if(!inputText.value) return\r\n\r\n  messageList.value.push({\r\n    type: \'user\',\r\n    content: inputText.value\r\n  })\r\n\r\n  ws.value?.send({\r\n    data: JSON.stringify({\r\n      query: inputText.value,\r\n      user_id: 1  // \u66ff\u6362\u6210\u5b9e\u9645\u7528\u6237ID\r\n    })\r\n  })\r\n\r\n  inputText.value = \'\'\r\n  scrollToBottom()\r\n}\r\n\r\n// \u505c\u6b62\u751f\u6210\r\nfunction stopGenerate() {\r\n  if(isGenerating.value && currentTaskId.value) {\r\n    uni.request({\r\n      url: `${import.meta.env.VITE_BASE_URL}chat/stop`,\r\n      method: \'POST\',\r\n      data: {\r\n        task_id: currentTaskId.value\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n// \u6eda\u52a8\u5230\u5e95\u90e8\r\nfunction scrollToBottom() {\r\n  nextTick(() => {\r\n    const query = uni.createSelectorQuery()\r\n    query.select(\'.message-inner\').boundingClientRect((data: any) => {\r\n      if(data) {\r\n        scrollTop.value = data.height\r\n      }\r\n    }).exec()\r\n  })\r\n}\r\n\r\n// \u521d\u59cb\u5316\u8fde\u63a5\r\nonMounted(() => {\r\n  connectWebSocket()\r\n})\r\n\r\n// \u7ec4\u4ef6\u9500\u6bc1\u65f6\u5173\u95ed\u8fde\u63a5\r\nonUnmounted(() => {\r\n  if(ws.value) {\r\n    ws.value.close()\r\n    ws.value = null\r\n  }\r\n})\r\n<\/script>\r\n\r\n<style lang="scss" scoped>\r\n</style>\n'})}),"\n",(0,t.jsx)(r.h3,{id:"sse",children:"sse"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-html",children:"// page.vue\r\n<template>\r\n  <view class=\"container\">\r\n    \x3c!-- \u663e\u793a\u63a5\u6536\u5230\u7684\u6d88\u606f --\x3e\r\n    <view class=\"message\" v-if=\"message\">\r\n      {{ message }}\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { ref, onUnmounted } from 'vue'\r\nimport { Base64 } from './base64'\r\n\r\nconst message = ref('')\r\nlet requestTask: any = null\r\n\r\n// \u521d\u59cb\u5316SSE\u8fde\u63a5\r\nconst initSSE = () => {\r\n  const token = uni.getStorageSync('token')\r\n\r\n  // #ifdef MP-WEIXIN\r\n  //@ts-ignore\r\n  requestTask = wx.request({\r\n    url: `${import.meta.env.VITE_BASE_URL}/your-sse-endpoint`,\r\n    header: {\r\n      \"Authorization\": `Bearer ${token}`\r\n    },\r\n    enableChunked: true, // \u542f\u7528\u5206\u5757\u4f20\u8f93\r\n    success: (res: any) => {\r\n      console.log('SSE\u8fde\u63a5\u6210\u529f')\r\n    },\r\n    fail: (err: any) => {\r\n      console.error('SSE\u8fde\u63a5\u5931\u8d25:', err)\r\n    }\r\n  })\r\n\r\n  // \u76d1\u542c\u5206\u5757\u6570\u636e\r\n  requestTask.onChunkReceived((res: any) => {\r\n    try {\r\n      //@ts-ignore\r\n      const base64Str = wx.arrayBufferToBase64(res.data)\r\n      const text = new Base64().decode(base64Str)\r\n\r\n      if (text) {\r\n        // \u89e3\u6790SSE\u6d88\u606f\r\n        const lines = text.split('\\n')\r\n        for (const line of lines) {\r\n          if (line.startsWith('data: ')) {\r\n            const data = JSON.parse(line.slice(6))\r\n            // \u5904\u7406\u63a5\u6536\u5230\u7684\u6570\u636e\r\n            message.value = data\r\n          }\r\n        }\r\n      }\r\n    } catch (e: any) {\r\n      uni.showModal({\r\n        title: \"\u9519\u8bef\",\r\n        content: e.message,\r\n        showCancel: false\r\n      });\r\n    }\r\n  })\r\n  // #endif\r\n}\r\n\r\nonLoaded(() => {\r\n  initSSE()\r\n})\r\n\r\n// \u9875\u9762\u5378\u8f7d\u65f6\u6e05\u7406\r\nonUnmounted(() => {\r\n  if (requestTask) {\r\n    requestTask.offChunkReceived()\r\n    requestTask = null\r\n  }\r\n})\r\n<\/script>\r\n\r\n<style lang=\"scss\" scoped>\r\n</style>\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.strong,{children:["\u53e6\u5916\u8fd8\u6709\u5f88\u591a\u5751\u53c2\u8003",(0,t.jsx)(r.a,{href:"/notes3/docs/FrontEnd/Miniapp/Uniapp/%E8%B8%A9%E8%BF%87%E7%9A%84%E5%9D%91",children:"\u8fd9\u91cc"})]})})]})}function d(n={}){const{wrapper:r}={...(0,a.R)(),...n.components};return r?(0,t.jsx)(r,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}}}]);