"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[52760],{1614:(s,e,a)=>{a.r(e),a.d(e,{assets:()=>m,contentTitle:()=>r,default:()=>d,frontMatter:()=>t,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"AI/Pytorch/\u4f18\u5316/\u7b80\u4ecb","title":"\u7b80\u4ecb","description":"\u6458\u8981\uff1atorch.optim \u662f PyTorch \u4e2d\u5b9e\u73b0\u5404\u79cd\u4f18\u5316\u7b97\u6cd5\u7684\u6838\u5fc3\u5e93\uff0c\u6db5\u76d6\u4e86\u4ece\u7ecf\u5178\u7684 SGD \u5230\u73b0\u4ee3\u7684 AdamW\u3001RAdam \u7b49\u591a\u79cd\u4f18\u5316\u5668\uff0c\u5e76\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\uff08LR Scheduler\uff09\u3002\u672c\u6587\u5c06\u4ece\u67b6\u6784\u8bbe\u8ba1\u3001\u5e95\u5c42\u539f\u7406\u53ca\u5de5\u7a0b\u5b9e\u8df5\u4e09\u4e2a\u7ef4\u5ea6\uff0c\u5bf9 torch.optim \u8fdb\u884c\u5168\u9762\u89e3\u6790\u3002","source":"@site/docs/AI/Pytorch/\u4f18\u5316/\u7b80\u4ecb.md","sourceDirName":"AI/Pytorch/\u4f18\u5316","slug":"/AI/Pytorch/\u4f18\u5316/\u7b80\u4ecb","permalink":"/notes3/docs/AI/Pytorch/\u4f18\u5316/\u7b80\u4ecb","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/Pytorch/\u4f18\u5316/\u7b80\u4ecb.md","tags":[],"version":"current","frontMatter":{},"sidebar":"ai","previous":{"title":"outer","permalink":"/notes3/docs/AI/Pytorch/outer"},"next":{"title":"DistributedDataParallel","permalink":"/notes3/docs/AI/Pytorch/\u5206\u5e03\u5f0f\u8bad\u7ec3/DistributedDataParallel"}}');var l=a(23420),i=a(54213);const t={},r=void 0,m={},c=[{value:"1. \u6a21\u5757\u6982\u89c8",id:"1-\u6a21\u5757\u6982\u89c8",level:2},{value:"1.1 \u67b6\u6784\u8bbe\u8ba1",id:"11-\u67b6\u6784\u8bbe\u8ba1",level:3},{value:"2. \u6838\u5fc3\u7ec4\u4ef6\u8be6\u89e3",id:"2-\u6838\u5fc3\u7ec4\u4ef6\u8be6\u89e3",level:2},{value:"2.1 Optimizer \u57fa\u7c7b",id:"21-optimizer-\u57fa\u7c7b",level:3},{value:"2.2 \u5e38\u7528\u4f18\u5316\u5668\u5bf9\u6bd4",id:"22-\u5e38\u7528\u4f18\u5316\u5668\u5bf9\u6bd4",level:3},{value:"2.3 \u5b66\u4e60\u7387\u8c03\u5ea6\u5668 (LR Scheduler)",id:"23-\u5b66\u4e60\u7387\u8c03\u5ea6\u5668-lr-scheduler",level:3},{value:"3. \u7b97\u6cd5\u539f\u7406\u4e0e\u5b9e\u73b0\u7ec6\u8282",id:"3-\u7b97\u6cd5\u539f\u7406\u4e0e\u5b9e\u73b0\u7ec6\u8282",level:2},{value:"3.1 Adam vs AdamW",id:"31-adam-vs-adamw",level:3},{value:"3.2 \u68af\u5ea6\u6e05\u96f6 (zero_grad)",id:"32-\u68af\u5ea6\u6e05\u96f6-zero_grad",level:3},{value:"4. \u5de5\u7a0b\u5b9e\u8df5\u4e0e\u4ee3\u7801\u8303\u5f0f",id:"4-\u5de5\u7a0b\u5b9e\u8df5\u4e0e\u4ee3\u7801\u8303\u5f0f",level:2},{value:"4.1 \u57fa\u7840\u8bad\u7ec3\u5faa\u73af",id:"41-\u57fa\u7840\u8bad\u7ec3\u5faa\u73af",level:3},{value:"4.2 \u5dee\u5f02\u5316\u53c2\u6570\u8bbe\u7f6e (Per-layer Learning Rate)",id:"42-\u5dee\u5f02\u5316\u53c2\u6570\u8bbe\u7f6e-per-layer-learning-rate",level:3},{value:"5. \u6700\u4f73\u5b9e\u8df5",id:"5-\u6700\u4f73\u5b9e\u8df5",level:2},{value:"6. \u53c2\u8003\u8d44\u6599",id:"6-\u53c2\u8003\u8d44\u6599",level:2}];function h(s){const e={a:"a",annotation:"annotation",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",math:"math",mermaid:"mermaid",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mover:"mover",mrow:"mrow",msqrt:"msqrt",msub:"msub",msup:"msup",mtext:"mtext",ol:"ol",p:"p",path:"path",pre:"pre",semantics:"semantics",span:"span",strong:"strong",svg:"svg",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...s.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u6458\u8981"}),"\uff1a",(0,l.jsx)(e.code,{children:"torch.optim"})," \u662f PyTorch \u4e2d\u5b9e\u73b0\u5404\u79cd\u4f18\u5316\u7b97\u6cd5\u7684\u6838\u5fc3\u5e93\uff0c\u6db5\u76d6\u4e86\u4ece\u7ecf\u5178\u7684 SGD \u5230\u73b0\u4ee3\u7684 AdamW\u3001RAdam \u7b49\u591a\u79cd\u4f18\u5316\u5668\uff0c\u5e76\u63d0\u4f9b\u4e86\u7075\u6d3b\u7684\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\uff08LR Scheduler\uff09\u3002\u672c\u6587\u5c06\u4ece\u67b6\u6784\u8bbe\u8ba1\u3001\u5e95\u5c42\u539f\u7406\u53ca\u5de5\u7a0b\u5b9e\u8df5\u4e09\u4e2a\u7ef4\u5ea6\uff0c\u5bf9 ",(0,l.jsx)(e.code,{children:"torch.optim"})," \u8fdb\u884c\u5168\u9762\u89e3\u6790\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"1-\u6a21\u5757\u6982\u89c8",children:"1. \u6a21\u5757\u6982\u89c8"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"torch.optim"})," \u7684\u8bbe\u8ba1\u9075\u5faa\u4e86 ",(0,l.jsx)(e.strong,{children:'"\u4f18\u5316\u5668\u4e0e\u6a21\u578b\u89e3\u8026"'})," \u7684\u539f\u5219\u3002\u4f18\u5316\u5668\u4ec5\u8d1f\u8d23\u66f4\u65b0\u53c2\u6570\uff0c\u800c\u4e0d\u9700\u8981\u77e5\u9053\u6a21\u578b\u7684\u5177\u4f53\u7ed3\u6784\uff0c\u8fd9\u901a\u8fc7\u7ba1\u7406\u53c2\u6570\u7ec4\uff08Parameter Groups\uff09\u6765\u5b9e\u73b0\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"11-\u67b6\u6784\u8bbe\u8ba1",children:"1.1 \u67b6\u6784\u8bbe\u8ba1"}),"\n",(0,l.jsx)(e.mermaid,{value:'graph TB\n    subgraph Model["\u6a21\u578b\u5c42"]\n        Params["\u53c2\u6570<br/>Weights/Biases"]\n        Grads["\u68af\u5ea6<br/>Gradients"]\n    end\n\n    subgraph Optim["torch.optim \u4f18\u5316\u5668"]\n        Base["Optimizer \u57fa\u7c7b"]\n        State["\u4f18\u5316\u5668\u72b6\u6001<br/>Momentum, Variances"]\n        Groups["\u53c2\u6570\u7ec4<br/>Param Groups"]\n        \n        subgraph Algos["\u5177\u4f53\u7b97\u6cd5"]\n            SGD["SGD"]\n            Adam["Adam"]\n            AdamW["AdamW"]\n            RMSprop["RMSprop"]\n        end\n    end\n\n    subgraph Scheduler["\u5b66\u4e60\u7387\u8c03\u5ea6\u5668"]\n        LRS["Learning Rate Policy"]\n    end\n\n    Params --\x3e|backward| Grads\n    Params --\x3e Groups\n    Grads --\x3e Groups\n    Groups --\x3e Base\n    State --\x3e Base\n    Base --\x3e Algos\n    LRS --\x3e|adjust lr| Groups\n    Algos --\x3e|step| Params'}),"\n",(0,l.jsx)(e.h2,{id:"2-\u6838\u5fc3\u7ec4\u4ef6\u8be6\u89e3",children:"2. \u6838\u5fc3\u7ec4\u4ef6\u8be6\u89e3"}),"\n",(0,l.jsx)(e.h3,{id:"21-optimizer-\u57fa\u7c7b",children:"2.1 Optimizer \u57fa\u7c7b"}),"\n",(0,l.jsxs)(e.p,{children:["\u6240\u6709\u4f18\u5316\u5668\u90fd\u7ee7\u627f\u81ea ",(0,l.jsx)(e.code,{children:"torch.optim.Optimizer"}),"\uff0c\u5176\u6838\u5fc3\u804c\u8d23\u5305\u62ec\uff1a"]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsxs)(e.strong,{children:["\u7ba1\u7406\u53c2\u6570\u7ec4 (",(0,l.jsx)(e.code,{children:"param_groups"}),")"]}),"\uff1a\u5141\u8bb8\u5bf9\u6a21\u578b\u7684\u4e0d\u540c\u90e8\u5206\uff08\u5982\u7279\u5f81\u63d0\u53d6\u5c42\u4e0e\u5206\u7c7b\u5934\uff09\u8bbe\u7f6e\u4e0d\u540c\u7684\u8d85\u53c2\u6570\uff08\u5982\u5b66\u4e60\u7387\u3001\u6743\u91cd\u8870\u51cf\uff09\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsxs)(e.strong,{children:["\u7ef4\u62a4\u72b6\u6001 (",(0,l.jsx)(e.code,{children:"state"}),")"]}),"\uff1a\u5b58\u50a8\u52a8\u91cf\uff08Momentum\uff09\u3001\u4e8c\u9636\u77e9\uff08Variance\uff09\u7b49\u5386\u53f2\u4fe1\u606f\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsxs)(e.strong,{children:["\u6267\u884c\u66f4\u65b0 (",(0,l.jsx)(e.code,{children:"step"}),")"]}),"\uff1a\u6839\u636e\u68af\u5ea6\u548c\u72b6\u6001\u66f4\u65b0\u53c2\u6570\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"22-\u5e38\u7528\u4f18\u5316\u5668\u5bf9\u6bd4",children:"2.2 \u5e38\u7528\u4f18\u5316\u5668\u5bf9\u6bd4"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"\u4f18\u5316\u5668"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"\u7279\u70b9"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"\u9002\u7528\u573a\u666f"}),(0,l.jsx)(e.th,{style:{textAlign:"left"},children:"\u5173\u952e\u516c\u5f0f"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"SGD"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u968f\u673a\u68af\u5ea6\u4e0b\u964d\uff0c\u652f\u6301\u52a8\u91cf"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u8ba1\u7b97\u673a\u89c6\u89c9 (CV)\uff0c\u9700\u7cbe\u7ec6\u8c03\u53c2"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{children:"t"}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mn,{children:"1"})]})]}),(0,l.jsx)(e.mo,{children:"="}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsx)(e.mi,{children:"t"})]}),(0,l.jsx)(e.mo,{children:"\u2212"}),(0,l.jsx)(e.mi,{children:"\u03b7"}),(0,l.jsx)(e.mo,{children:"\u22c5"}),(0,l.jsx)(e.mo,{stretchy:"false",children:"("}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"g"}),(0,l.jsx)(e.mi,{children:"t"})]}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mi,{children:"\u03bc"}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"v"}),(0,l.jsx)(e.mi,{children:"t"})]}),(0,l.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"w_{t+1} = w_t - \\eta \\cdot (g_t + \\mu v_t)"})]})})}),(0,l.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.2083em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,l.jsx)(e.span,{className:"mord mtight",children:"1"})]})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2083em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,l.jsx)(e.span,{className:"mrel",children:"="}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.7333em",verticalAlign:"-0.15em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03b7"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u22c5"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,l.jsx)(e.span,{className:"mopen",children:"("}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"+"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bc"}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mclose",children:")"})]})]})]})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"Adam"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u81ea\u9002\u5e94\u5b66\u4e60\u7387\uff0c\u7ed3\u5408\u52a8\u91cf\u4e0eRMSProp"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u81ea\u7136\u8bed\u8a00\u5904\u7406 (NLP)\uff0c\u5feb\u901f\u6536\u655b"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{children:"t"}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mn,{children:"1"})]})]}),(0,l.jsx)(e.mo,{children:"="}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsx)(e.mi,{children:"t"})]}),(0,l.jsx)(e.mo,{children:"\u2212"}),(0,l.jsx)(e.mi,{children:"\u03b7"}),(0,l.jsxs)(e.mfrac,{children:[(0,l.jsxs)(e.msub,{children:[(0,l.jsxs)(e.mover,{accent:"true",children:[(0,l.jsx)(e.mi,{children:"m"}),(0,l.jsx)(e.mo,{children:"^"})]}),(0,l.jsx)(e.mi,{children:"t"})]}),(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.msqrt,{children:(0,l.jsxs)(e.msub,{children:[(0,l.jsxs)(e.mover,{accent:"true",children:[(0,l.jsx)(e.mi,{children:"v"}),(0,l.jsx)(e.mo,{children:"^"})]}),(0,l.jsx)(e.mi,{children:"t"})]})}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mi,{children:"\u03f5"})]})]})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"w_{t+1} = w_t - \\eta \\frac{\\hat{m}_t}{\\sqrt{\\hat{v}_t} + \\epsilon}"})]})})}),(0,l.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.2083em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,l.jsx)(e.span,{className:"mord mtight",children:"1"})]})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2083em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,l.jsx)(e.span,{className:"mrel",children:"="}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.7333em",verticalAlign:"-0.15em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1.4342em",verticalAlign:"-0.538em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03b7"}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,l.jsx)(e.span,{className:"mfrac",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.8962em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.5836em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord sqrt mtight",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.8663em"},children:[(0,l.jsxs)(e.span,{className:"svg-align",style:{top:"-3em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"mord mtight",style:{paddingLeft:"0.833em"},children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord accent mtight",children:(0,l.jsx)(e.span,{className:"vlist-t",children:(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.6944em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.7em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03588em"},children:"v"})]}),(0,l.jsxs)(e.span,{style:{top:"-2.7em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"accent-body",style:{left:"-0.2222em"},children:(0,l.jsx)(e.span,{className:"mord mtight",children:"^"})})]})]})})})}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2963em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.357em",marginLeft:"-0.0359em",marginRight:"0.0714em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.143em"},children:(0,l.jsx)(e.span,{})})})]})})]})})]}),(0,l.jsxs)(e.span,{style:{top:"-2.8263em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"hide-tail mtight",style:{minWidth:"0.853em",height:"1.08em"},children:(0,l.jsx)(e.svg,{xmlns:"http://www.w3.org/2000/svg",width:"400em",height:"1.08em",viewBox:"0 0 400000 1080",preserveAspectRatio:"xMinYMin slice",children:(0,l.jsx)(e.path,{d:"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z"})})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.1737em"},children:(0,l.jsx)(e.span,{})})})]})}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"\u03f5"})]})})]}),(0,l.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,l.jsxs)(e.span,{style:{top:"-3.4101em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord accent mtight",children:(0,l.jsx)(e.span,{className:"vlist-t",children:(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsxs)(e.span,{className:"vlist",style:{height:"0.6944em"},children:[(0,l.jsxs)(e.span,{style:{top:"-2.7em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"m"})]}),(0,l.jsxs)(e.span,{style:{top:"-2.7em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"accent-body",style:{left:"-0.25em"},children:(0,l.jsx)(e.span,{className:"mord mtight",children:"^"})})]})]})})})}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2963em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.357em",marginLeft:"0em",marginRight:"0.0714em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.5em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size3 size1 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.143em"},children:(0,l.jsx)(e.span,{})})})]})})]})})})]})]}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.538em"},children:(0,l.jsx)(e.span,{})})})]})}),(0,l.jsx)(e.span,{className:"mclose nulldelimiter"})]})]})]})]})})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"AdamW"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"Adam + \u89e3\u8026\u6743\u91cd\u8870\u51cf (Decoupled Weight Decay)"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"Transformer, \u5927\u6a21\u578b\u8bad\u7ec3 (Standard)"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u4fee\u590d\u4e86 Adam \u4e2d L2 \u6b63\u5219\u5316\u7684\u5b9e\u73b0\u95ee\u9898"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{style:{textAlign:"left"},children:(0,l.jsx)(e.strong,{children:"RMSprop"})}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u81ea\u9002\u5e94\u5b66\u4e60\u7387\uff0c\u4ec5\u4f7f\u7528\u4e8c\u9636\u77e9"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"RNN, \u5f3a\u5316\u5b66\u4e60 (RL)"}),(0,l.jsx)(e.td,{style:{textAlign:"left"},children:"\u9002\u7528\u4e8e\u975e\u5e73\u7a33\u76ee\u6807\u51fd\u6570"})]})]})]}),"\n",(0,l.jsx)(e.h3,{id:"23-\u5b66\u4e60\u7387\u8c03\u5ea6\u5668-lr-scheduler",children:"2.3 \u5b66\u4e60\u7387\u8c03\u5ea6\u5668 (LR Scheduler)"}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"torch.optim.lr_scheduler"})," \u63d0\u4f9b\u4e86\u52a8\u6001\u8c03\u6574\u5b66\u4e60\u7387\u7684\u7b56\u7565\uff0c\u8fd9\u5bf9\u4e8e\u6a21\u578b\u6536\u655b\u81f3\u5173\u91cd\u8981\u3002"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"StepLR / MultiStepLR"}),"\uff1a\u9636\u68af\u5f0f\u8870\u51cf\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"CosineAnnealingLR"}),"\uff1a\u4f59\u5f26\u9000\u706b\uff0c\u5e38\u7528\u4e8e\u4ece\u5934\u8bad\u7ec3\u5927\u6a21\u578b\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"ReduceLROnPlateau"}),"\uff1a\u5f53\u9a8c\u8bc1\u96c6\u6307\u6807\u4e0d\u518d\u63d0\u5347\u65f6\u964d\u4f4e\u5b66\u4e60\u7387\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"OneCycleLR / LinearLR"}),"\uff1a\u5305\u542b\u9884\u70ed\uff08Warmup\uff09\u9636\u6bb5\uff0c\u9632\u6b62\u8bad\u7ec3\u521d\u671f\u68af\u5ea6\u7206\u70b8\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"3-\u7b97\u6cd5\u539f\u7406\u4e0e\u5b9e\u73b0\u7ec6\u8282",children:"3. \u7b97\u6cd5\u539f\u7406\u4e0e\u5b9e\u73b0\u7ec6\u8282"}),"\n",(0,l.jsx)(e.h3,{id:"31-adam-vs-adamw",children:"3.1 Adam vs AdamW"}),"\n",(0,l.jsxs)(e.p,{children:["Adam \u7684\u6743\u91cd\u8870\u51cf\uff08Weight Decay\uff09\u901a\u5e38\u88ab\u5b9e\u73b0\u4e3a L2 \u6b63\u5219\u5316\uff08\u5373\u5728 Loss \u4e0a\u52a0 ",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{children:"\u03bb"}),(0,l.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,l.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,l.jsxs)(e.msup,{children:[(0,l.jsx)(e.mi,{mathvariant:"normal",children:"\u2223"}),(0,l.jsx)(e.mn,{children:"2"})]})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\lambda ||w||^2"})]})})}),(0,l.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1.0641em",verticalAlign:"-0.25em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bb"}),(0,l.jsx)(e.span,{className:"mord",children:"\u2223\u2223"}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"mord",children:"\u2223"}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord",children:"\u2223"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsx)(e.span,{className:"vlist-t",children:(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.8141em"},children:(0,l.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})})]}),"\uff09\u3002\u4f46\u5728\u81ea\u9002\u5e94\u5b66\u4e60\u7387\u7b97\u6cd5\u4e2d\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5bfc\u81f4\u6743\u91cd\u8870\u51cf\u4e0e\u68af\u5ea6\u66f4\u65b0\u8026\u5408\u3002\n",(0,l.jsx)(e.strong,{children:"AdamW"})," \u5c06\u6743\u91cd\u8870\u51cf\u9879\u76f4\u63a5\u4f5c\u7528\u4e8e\u53c2\u6570\u66f4\u65b0\u6b65\u9aa4\uff1a\n",(0,l.jsxs)(e.span,{className:"katex",children:[(0,l.jsx)(e.span,{className:"katex-mathml",children:(0,l.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,l.jsxs)(e.semantics,{children:[(0,l.jsxs)(e.mrow,{children:[(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsxs)(e.mrow,{children:[(0,l.jsx)(e.mi,{children:"t"}),(0,l.jsx)(e.mo,{children:"+"}),(0,l.jsx)(e.mn,{children:"1"})]})]}),(0,l.jsx)(e.mo,{children:"="}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsx)(e.mi,{children:"t"})]}),(0,l.jsx)(e.mo,{children:"\u2212"}),(0,l.jsx)(e.mi,{children:"\u03b7"}),(0,l.jsx)(e.mo,{stretchy:"false",children:"("}),(0,l.jsx)(e.mo,{children:"\u2026"}),(0,l.jsx)(e.mtext,{children:"\u2009"}),(0,l.jsx)(e.mo,{stretchy:"false",children:")"}),(0,l.jsx)(e.mo,{children:"\u2212"}),(0,l.jsx)(e.mi,{children:"\u03b7"}),(0,l.jsx)(e.mi,{children:"\u03bb"}),(0,l.jsxs)(e.msub,{children:[(0,l.jsx)(e.mi,{children:"w"}),(0,l.jsx)(e.mi,{children:"t"})]})]}),(0,l.jsx)(e.annotation,{encoding:"application/x-tex",children:"w_{t+1} = w_t - \\eta (\\dots) - \\eta \\lambda w_t"})]})})}),(0,l.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.2083em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsxs)(e.span,{className:"mord mtight",children:[(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,l.jsx)(e.span,{className:"mbin mtight",children:"+"}),(0,l.jsx)(e.span,{className:"mord mtight",children:"1"})]})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2083em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,l.jsx)(e.span,{className:"mrel",children:"="}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.7333em",verticalAlign:"-0.15em"}}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(e.span,{})})})]})})]}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03b7"}),(0,l.jsx)(e.span,{className:"mopen",children:"("}),(0,l.jsx)(e.span,{className:"minner",children:"\u2026"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,l.jsx)(e.span,{className:"mclose",children:")"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,l.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,l.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,l.jsxs)(e.span,{className:"base",children:[(0,l.jsx)(e.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03b7"}),(0,l.jsx)(e.span,{className:"mord mathnormal",children:"\u03bb"}),(0,l.jsxs)(e.span,{className:"mord",children:[(0,l.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,l.jsx)(e.span,{className:"msupsub",children:(0,l.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,l.jsxs)(e.span,{className:"vlist-r",children:[(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,l.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,l.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,l.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,l.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,l.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,l.jsx)(e.span,{className:"vlist-r",children:(0,l.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,l.jsx)(e.span,{})})})]})})]})]})]})]}),"\n\u8fd9\u79cd\u89e3\u8026\u4f7f\u5f97 AdamW \u5728 Transformer \u7b49\u6a21\u578b\u4e0a\u7684\u6cdb\u5316\u80fd\u529b\u663e\u8457\u4f18\u4e8e Adam\u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"32-\u68af\u5ea6\u6e05\u96f6-zero_grad",children:"3.2 \u68af\u5ea6\u6e05\u96f6 (zero_grad)"}),"\n",(0,l.jsxs)(e.p,{children:["PyTorch \u9ed8\u8ba4\u4f1a",(0,l.jsx)(e.strong,{children:"\u7d2f\u52a0\u68af\u5ea6"}),"\uff08",(0,l.jsx)(e.code,{children:"grad += ..."}),"\uff09\uff0c\u8fd9\u5728\u591a\u4efb\u52a1\u5b66\u4e60\u6216\u68af\u5ea6\u7d2f\u79ef\uff08Gradient Accumulation\uff09\u573a\u666f\u4e0b\u975e\u5e38\u6709\u7528\u3002\u4f46\u5728\u5e38\u89c4\u8bad\u7ec3\u4e2d\uff0c\u5fc5\u987b\u5728 ",(0,l.jsx)(e.code,{children:"backward()"})," \u524d\u8c03\u7528 ",(0,l.jsx)(e.code,{children:"optimizer.zero_grad()"}),"\u3002"]}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.strong,{children:"\u6027\u80fd\u4f18\u5316"}),"\uff1a\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"optimizer.zero_grad(set_to_none=True)"})," \u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u5c06 ",(0,l.jsx)(e.code,{children:".grad"})," \u8bbe\u4e3a ",(0,l.jsx)(e.code,{children:"None"})," \u6765\u8282\u7701\u663e\u5b58\u8bbf\u95ee\u5f00\u9500\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"4-\u5de5\u7a0b\u5b9e\u8df5\u4e0e\u4ee3\u7801\u8303\u5f0f",children:"4. \u5de5\u7a0b\u5b9e\u8df5\u4e0e\u4ee3\u7801\u8303\u5f0f"}),"\n",(0,l.jsx)(e.h3,{id:"41-\u57fa\u7840\u8bad\u7ec3\u5faa\u73af",children:"4.1 \u57fa\u7840\u8bad\u7ec3\u5faa\u73af"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:"import torch\nimport torch.nn as nn\nimport torch.optim as optim\n\n# 1. \u5b9a\u4e49\u6a21\u578b\u4e0e\u6570\u636e\nmodel = nn.Linear(10, 1)\ndata_loader = ... \n\n# 2. \u5b9a\u4e49\u4f18\u5316\u5668\noptimizer = optim.AdamW(model.parameters(), lr=1e-3, weight_decay=0.01)\n\n# 3. \u5b9a\u4e49\u5b66\u4e60\u7387\u8c03\u5ea6\u5668\nscheduler = optim.lr_scheduler.CosineAnnealingLR(optimizer, T_max=100)\n\n# 4. \u8bad\u7ec3\u5faa\u73af\nfor epoch in range(100):\n    for inputs, targets in data_loader:\n        # \u6e05\u96f6\u68af\u5ea6 (\u63a8\u8350 set_to_none=True)\n        optimizer.zero_grad(set_to_none=True)\n        \n        # \u524d\u5411 + \u53cd\u5411\n        outputs = model(inputs)\n        loss = nn.MSELoss()(outputs, targets)\n        loss.backward()\n        \n        # \u68af\u5ea6\u88c1\u526a (\u9632\u6b62\u68af\u5ea6\u7206\u70b8)\n        torch.nn.utils.clip_grad_norm_(model.parameters(), max_norm=1.0)\n        \n        # \u53c2\u6570\u66f4\u65b0\n        optimizer.step()\n    \n    # \u66f4\u65b0\u5b66\u4e60\u7387\n    scheduler.step()\n"})}),"\n",(0,l.jsx)(e.h3,{id:"42-\u5dee\u5f02\u5316\u53c2\u6570\u8bbe\u7f6e-per-layer-learning-rate",children:"4.2 \u5dee\u5f02\u5316\u53c2\u6570\u8bbe\u7f6e (Per-layer Learning Rate)"}),"\n",(0,l.jsx)(e.p,{children:"\u5bf9\u4e8e\u5fae\u8c03\uff08Fine-tuning\uff09\u4efb\u52a1\uff0c\u901a\u5e38\u5e0c\u671b\u5e95\u5c42\u7684\u5b66\u4e60\u7387\u8f83\u5c0f\uff08\u4fdd\u7559\u9884\u8bad\u7ec3\u7279\u5f81\uff09\uff0c\u9876\u5c42\u5b66\u4e60\u7387\u8f83\u5927\u3002"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-python",children:"# \u533a\u5206\u53c2\u6570\u7ec4\nbackbone_params = [p for n, p in model.named_parameters() if \"backbone\" in n]\nhead_params = [p for n, p in model.named_parameters() if \"head\" in n]\n\noptimizer = optim.SGD([\n    {'params': backbone_params, 'lr': 1e-4}, # \u5e95\u5c42 LR \u8f83\u5c0f\n    {'params': head_params, 'lr': 1e-2}      # \u9876\u5c42 LR \u8f83\u5927\n], momentum=0.9)\n"})}),"\n",(0,l.jsx)(e.h2,{id:"5-\u6700\u4f73\u5b9e\u8df5",children:"5. \u6700\u4f73\u5b9e\u8df5"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u9996\u9009 AdamW"}),"\uff1a\u5bf9\u4e8e\u5927\u591a\u6570\u6df1\u5ea6\u5b66\u4e60\u4efb\u52a1\uff08\u5c24\u5176\u662f Transformer\uff09\uff0cAdamW \u662f\u9ed8\u8ba4\u4e14\u7a33\u5065\u7684\u9009\u62e9\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4f7f\u7528 Warmup"}),"\uff1a\u914d\u5408 ",(0,l.jsx)(e.code,{children:"LinearLR"})," \u6216 ",(0,l.jsx)(e.code,{children:"OneCycleLR"})," \u8fdb\u884c\u5b66\u4e60\u7387\u9884\u70ed\uff0c\u80fd\u6709\u6548\u63d0\u9ad8\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u68af\u5ea6\u88c1\u526a"}),"\uff1a\u59cb\u7ec8\u4f7f\u7528 ",(0,l.jsx)(e.code,{children:"clip_grad_norm_"}),"\uff0c\u7279\u522b\u662f\u5728\u8bad\u7ec3 LSTM \u6216\u6df1\u5c42 Transformer \u65f6\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u4fdd\u5b58\u72b6\u6001"}),"\uff1a\u4fdd\u5b58 Checkpoint \u65f6\uff0c\u4e0d\u4ec5\u8981\u4fdd\u5b58 ",(0,l.jsx)(e.code,{children:"model.state_dict()"}),"\uff0c\u8fd8\u8981\u4fdd\u5b58 ",(0,l.jsx)(e.code,{children:"optimizer.state_dict()"}),"\uff0c\u4ee5\u4fbf\u6062\u590d\u52a8\u91cf\u4fe1\u606f\u3002"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"6-\u53c2\u8003\u8d44\u6599",children:"6. \u53c2\u8003\u8d44\u6599"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://docs.pytorch.org/docs/stable/optim.html",children:"PyTorch Documentation - torch.optim"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://pytorch.org/tutorials/beginner/basics/optimization_tutorial.html",children:"PyTorch Tutorial - Optimizing Model Parameters"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://arxiv.org/abs/1711.05101",children:"Decoupled Weight Decay Regularization (AdamW Paper)"})}),"\n"]})]})}function d(s={}){const{wrapper:e}={...(0,i.R)(),...s.components};return e?(0,l.jsx)(e,{...s,children:(0,l.jsx)(h,{...s})}):h(s)}},54213:(s,e,a)=>{a.d(e,{R:()=>t,x:()=>r});var n=a(36672);const l={},i=n.createContext(l);function t(s){const e=n.useContext(i);return n.useMemo((function(){return"function"==typeof s?s(e):{...e,...s}}),[e,s])}function r(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(l):s.components||l:t(s.components),n.createElement(i.Provider,{value:e},s.children)}}}]);