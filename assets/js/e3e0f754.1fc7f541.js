"use strict";(self.webpackChunknotes_3=self.webpackChunknotes_3||[]).push([[4702],{42283:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>g,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"AI/CrewAI/\u53ef\u89c2\u6d4b\u6027/MLflow","title":"MLflow","description":"\u8fd9\u662f CrewAI \u5b98\u65b9\u6587\u6863\u4e2d\u5173\u4e8e\u201cMLflow Integration\uff08MLflow \u96c6\u6210\uff09\u201d\u90e8\u5206\u7684\u4e2d\u6587\u7ffb\u8bd1\u3002","source":"@site/docs/AI/CrewAI/\u53ef\u89c2\u6d4b\u6027/MLflow.mdx","sourceDirName":"AI/CrewAI/\u53ef\u89c2\u6d4b\u6027","slug":"/AI/CrewAI/\u53ef\u89c2\u6d4b\u6027/MLflow","permalink":"/notes3/docs/AI/CrewAI/\u53ef\u89c2\u6d4b\u6027/MLflow","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/AI/CrewAI/\u53ef\u89c2\u6d4b\u6027/MLflow.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"ai","previous":{"title":"\u534f\u4f5c","permalink":"/notes3/docs/AI/CrewAI/\u534f\u4f5c"},"next":{"title":"\u8ffd\u8e2a","permalink":"/notes3/docs/AI/CrewAI/\u53ef\u89c2\u6d4b\u6027/\u8ffd\u8e2a"}}');var s=r(23420),i=r(54213);const l={},o=void 0,a={},c=[{value:"\u529f\u80fd\u7279\u6027 (Features)",id:"\u529f\u80fd\u7279\u6027-features",level:3},{value:"\u8bbe\u7f6e\u6307\u5357 (Setup Instructions)",id:"\u8bbe\u7f6e\u6307\u5357-setup-instructions",level:2},{value:"\u6b65\u9aa4 1: \u5b89\u88c5 MLflow \u5305",id:"\u6b65\u9aa4-1-\u5b89\u88c5-mlflow-\u5305",level:3},{value:"\u6b65\u9aa4 2: \u542f\u52a8 MLflow \u8ffd\u8e2a\u670d\u52a1\u5668",id:"\u6b65\u9aa4-2-\u542f\u52a8-mlflow-\u8ffd\u8e2a\u670d\u52a1\u5668",level:3},{value:"\u6b65\u9aa4 3: \u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u521d\u59cb\u5316 MLflow",id:"\u6b65\u9aa4-3-\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u521d\u59cb\u5316-mlflow",level:3},{value:"\u6b65\u9aa4 4: \u53ef\u89c6\u5316 Agent \u6d3b\u52a8",id:"\u6b65\u9aa4-4-\u53ef\u89c6\u5316-agent-\u6d3b\u52a8",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u8fd9\u662f CrewAI \u5b98\u65b9\u6587\u6863\u4e2d\u5173\u4e8e\u201cMLflow Integration\uff08MLflow \u96c6\u6210\uff09\u201d\u90e8\u5206\u7684\u4e2d\u6587\u7ffb\u8bd1\u3002"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h1,{id:"mlflow-\u96c6\u6210-mlflow-integration",children:"MLflow \u96c6\u6210 (MLflow Integration)"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u5feb\u901f\u5f00\u59cb\u4f7f\u7528 MLflow \u76d1\u63a7\u60a8\u7684 Agent\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.h1,{id:"mlflow-\u6982\u89c8-mlflow-overview",children:"MLflow \u6982\u89c8 (MLflow Overview)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://mlflow.org/",children:"MLflow"})," \u662f\u4e00\u4e2a\u5f00\u6e90\u5e73\u53f0\uff0c\u65e8\u5728\u534f\u52a9\u673a\u5668\u5b66\u4e60\u4ece\u4e1a\u8005\u548c\u56e2\u961f\u5904\u7406\u673a\u5668\u5b66\u4e60\u8fc7\u7a0b\u4e2d\u7684\u590d\u6742\u6027\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u8ffd\u8e2a\uff08Tracing\uff09\u529f\u80fd\uff0c\u901a\u8fc7\u6355\u83b7\u6709\u5173\u5e94\u7528\u7a0b\u5e8f\u670d\u52a1\u6267\u884c\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u589e\u5f3a\u4e86\u751f\u6210\u5f0f AI \u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684 LLM \u53ef\u89c2\u6d4b\u6027\u3002\r\n\u8ffd\u8e2a\u63d0\u4f9b\u4e86\u4e00\u79cd\u8bb0\u5f55\u4e0e\u8bf7\u6c42\u7684\u6bcf\u4e2a\u4e2d\u95f4\u6b65\u9aa4\u76f8\u5173\u7684\u8f93\u5165\u3001\u8f93\u51fa\u548c\u5143\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u4f7f\u60a8\u80fd\u591f\u8f7b\u677e\u67e5\u660e\u9519\u8bef\u548c\u610f\u5916\u884c\u4e3a\u7684\u6839\u6e90\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://mintcdn.com/crewai/qVjgZHKAyEOgSSUS/images/mlflow-tracing.gif?s=be88ff36aec776c005102164d804322a",alt:"Overview of MLflow crewAI tracing usage"})}),"\n",(0,s.jsx)(n.h3,{id:"\u529f\u80fd\u7279\u6027-features",children:"\u529f\u80fd\u7279\u6027 (Features)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8ffd\u8e2a\u4eea\u8868\u677f (Tracing Dashboard)"}),"\uff1a\u901a\u8fc7\u5305\u542b Spans\uff08\u8de8\u5ea6\uff09\u7684\u8f93\u5165\u3001\u8f93\u51fa\u548c\u5143\u6570\u636e\u7684\u8be6\u7ec6\u4eea\u8868\u677f\uff0c\u76d1\u63a7 crewAI Agent \u7684\u6d3b\u52a8\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u81ea\u52a8\u8ffd\u8e2a (Automated Tracing)"}),"\uff1a\u4e0e crewAI \u7684\u5b8c\u5168\u81ea\u52a8\u5316\u96c6\u6210\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c ",(0,s.jsx)(n.code,{children:"mlflow.crewai.autolog()"})," \u6765\u542f\u7528\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u4f4e\u5de5\u4f5c\u91cf\u7684\u624b\u52a8\u8ffd\u8e2a\u63d2\u6869 (Manual Trace Instrumentation with minor efforts)"}),"\uff1a\u901a\u8fc7 MLflow \u7684\u9ad8\u7ea7\u6d41\u5f0f API\uff08\u5982\u88c5\u9970\u5668\u3001\u51fd\u6570\u5305\u88c5\u5668\u548c\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\uff09\u81ea\u5b9a\u4e49\u8ffd\u8e2a\u63d2\u6869\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OpenTelemetry \u517c\u5bb9\u6027 (OpenTelemetry Compatibility)"}),"\uff1aMLflow Tracing \u652f\u6301\u5c06\u8ffd\u8e2a\u6570\u636e\u5bfc\u51fa\u5230 OpenTelemetry Collector\uff0c\u7136\u540e\u53ef\u4ee5\u4f7f\u7528\u5b83\u5c06\u8ffd\u8e2a\u6570\u636e\u5bfc\u51fa\u5230\u5404\u79cd\u540e\u7aef\uff0c\u5982 Jaeger\u3001Zipkin \u548c AWS X-Ray\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6253\u5305\u548c\u90e8\u7f72 Agent (Package and Deploy Agents)"}),"\uff1a\u5c06\u60a8\u7684 crewAI Agent \u6253\u5305\u5e76\u90e8\u7f72\u5230\u5177\u6709\u591a\u79cd\u90e8\u7f72\u76ee\u6807\u7684\u63a8\u7406\u670d\u52a1\u5668\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5b89\u5168\u5730\u6258\u7ba1 LLM (Securely Host LLMs)"}),"\uff1a\u901a\u8fc7 MLflow \u7f51\u5173\u5728\u4e00\u4e2a\u7edf\u4e00\u7684\u7aef\u70b9\u4e2d\u6258\u7ba1\u6765\u81ea\u4e0d\u540c\u63d0\u4f9b\u5546\u7684\u591a\u4e2a LLM\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8bc4\u4f30 (Evaluation)"}),"\uff1a\u4f7f\u7528\u4fbf\u6377\u7684 API ",(0,s.jsx)(n.code,{children:"mlflow.evaluate()"})," \u901a\u8fc7\u5e7f\u6cdb\u7684\u6307\u6807\u8bc4\u4f30\u60a8\u7684 crewAI Agent\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u8bbe\u7f6e\u6307\u5357-setup-instructions",children:"\u8bbe\u7f6e\u6307\u5357 (Setup Instructions)"}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4-1-\u5b89\u88c5-mlflow-\u5305",children:"\u6b65\u9aa4 1: \u5b89\u88c5 MLflow \u5305"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# crewAI \u96c6\u6210\u5728 mlflow>=2.19.0 \u7248\u672c\u4e2d\u53ef\u7528\r\npip install mlflow\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4-2-\u542f\u52a8-mlflow-\u8ffd\u8e2a\u670d\u52a1\u5668",children:"\u6b65\u9aa4 2: \u542f\u52a8 MLflow \u8ffd\u8e2a\u670d\u52a1\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u6b64\u8fc7\u7a0b\u662f\u53ef\u9009\u7684\uff0c\u4f46\u5efa\u8bae\u4f7f\u7528 MLflow \u8ffd\u8e2a\u670d\u52a1\u5668\u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u53ef\u89c6\u5316\u6548\u679c\u548c\u66f4\u5e7f\u6cdb\u7684\u529f\u80fd\u3002\r\nmlflow server\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4-3-\u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u521d\u59cb\u5316-mlflow",children:"\u6b65\u9aa4 3: \u5728\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u521d\u59cb\u5316 MLflow"}),"\n",(0,s.jsx)(n.p,{children:"\u5c06\u4ee5\u4e0b\u4e24\u884c\u6dfb\u52a0\u5230\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u4e2d\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import mlflow\r\n\r\nmlflow.crewai.autolog()\r\n\r\n# \u53ef\u9009\uff1a\u5982\u679c\u60a8\u6709\u8ffd\u8e2a\u670d\u52a1\u5668\uff0c\u8bf7\u8bbe\u7f6e\u8ffd\u8e2a URI \u548c\u5b9e\u9a8c\u540d\u79f0\r\nmlflow.set_tracking_uri("http://localhost:5000")\r\nmlflow.set_experiment("CrewAI")\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u8ffd\u8e2a CrewAI Agent \u7684\u4f7f\u7528\u793a\u4f8b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from crewai import Agent, Crew, Task\r\nfrom crewai.knowledge.source.string_knowledge_source import StringKnowledgeSource\r\nfrom crewai_tools import SerperDevTool, WebsiteSearchTool\r\n\r\nfrom textwrap import dedent\r\n\r\ncontent = "Users name is John. He is 30 years old and lives in San Francisco."\r\nstring_source = StringKnowledgeSource(\r\n    content=content, metadata={"preference": "personal"}\r\n)\r\n\r\nsearch_tool = WebsiteSearchTool()\r\n\r\n\r\nclass TripAgents:\r\n    def city_selection_agent(self):\r\n        return Agent(\r\n            role="City Selection Expert",\r\n            goal="Select the best city based on weather, season, and prices",\r\n            backstory="An expert in analyzing travel data to pick ideal destinations",\r\n            tools=[\r\n                search_tool,\r\n            ],\r\n            verbose=True,\r\n        )\r\n\r\n    def local_expert(self):\r\n        return Agent(\r\n            role="Local Expert at this city",\r\n            goal="Provide the BEST insights about the selected city",\r\n            backstory="""A knowledgeable local guide with extensive information\r\n        about the city, it\'s attractions and customs""",\r\n            tools=[search_tool],\r\n            verbose=True,\r\n        )\r\n\r\n\r\nclass TripTasks:\r\n    def identify_task(self, agent, origin, cities, interests, range):\r\n        return Task(\r\n            description=dedent(\r\n                f"""\r\n                Analyze and select the best city for the trip based\r\n                on specific criteria such as weather patterns, seasonal\r\n                events, and travel costs. This task involves comparing\r\n                multiple cities, considering factors like current weather\r\n                conditions, upcoming cultural or seasonal events, and\r\n                overall travel expenses.\r\n                Your final answer must be a detailed\r\n                report on the chosen city, and everything you found out\r\n                about it, including the actual flight costs, weather\r\n                forecast and attractions.\r\n\r\n                Traveling from: {origin}\r\n                City Options: {cities}\r\n                Trip Date: {range}\r\n                Traveler Interests: {interests}\r\n            """\r\n            ),\r\n            agent=agent,\r\n            expected_output="Detailed report on the chosen city including flight costs, weather forecast, and attractions",\r\n        )\r\n\r\n    def gather_task(self, agent, origin, interests, range):\r\n        return Task(\r\n            description=dedent(\r\n                f"""\r\n                As a local expert on this city you must compile an\r\n                in-depth guide for someone traveling there and wanting\r\n                to have THE BEST trip ever!\r\n                Gather information about key attractions, local customs,\r\n                special events, and daily activity recommendations.\r\n                Find the best spots to go to, the kind of place only a\r\n                local would know.\r\n                This guide should provide a thorough overview of what\r\n                the city has to offer, including hidden gems, cultural\r\n                hotspots, must-visit landmarks, weather forecasts, and\r\n                high level costs.\r\n                The final answer must be a comprehensive city guide,\r\n                rich in cultural insights and practical tips,\r\n                tailored to enhance the travel experience.\r\n\r\n                Trip Date: {range}\r\n                Traveling from: {origin}\r\n                Traveler Interests: {interests}\r\n            """\r\n            ),\r\n            agent=agent,\r\n            expected_output="Comprehensive city guide including hidden gems, cultural hotspots, and practical travel tips",\r\n        )\r\n\r\n\r\nclass TripCrew:\r\n    def __init__(self, origin, cities, date_range, interests):\r\n        self.cities = cities\r\n        self.origin = origin\r\n        self.interests = interests\r\n        self.date_range = date_range\r\n\r\n    def run(self):\r\n        agents = TripAgents()\r\n        tasks = TripTasks()\r\n\r\n        city_selector_agent = agents.city_selection_agent()\r\n        local_expert_agent = agents.local_expert()\r\n\r\n        identify_task = tasks.identify_task(\r\n            city_selector_agent,\r\n            self.origin,\r\n            self.cities,\r\n            self.interests,\r\n            self.date_range,\r\n        )\r\n        gather_task = tasks.gather_task(\r\n            local_expert_agent, self.origin, self.interests, self.date_range\r\n        )\r\n\r\n        crew = Crew(\r\n            agents=[city_selector_agent, local_expert_agent],\r\n            tasks=[identify_task, gather_task],\r\n            verbose=True,\r\n            memory=True,\r\n            knowledge={\r\n                "sources": [string_source],\r\n                "metadata": {"preference": "personal"},\r\n            },\r\n        )\r\n\r\n        result = crew.kickoff()\r\n        return result\r\n\r\n\r\ntrip_crew = TripCrew("California", "Tokyo", "Dec 12 - Dec 20", "sports")\r\nresult = trip_crew.run()\r\n\r\nprint(result)\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6709\u5173\u66f4\u591a\u914d\u7f6e\u548c\u7528\u4f8b\uff0c\u8bf7\u53c2\u9605 ",(0,s.jsx)(n.a,{href:"https://mlflow.org/docs/latest/llms/tracing/index.html",children:"MLflow \u8ffd\u8e2a\u6587\u6863"}),"\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6b65\u9aa4-4-\u53ef\u89c6\u5316-agent-\u6d3b\u52a8",children:"\u6b65\u9aa4 4: \u53ef\u89c6\u5316 Agent \u6d3b\u52a8"}),"\n",(0,s.jsx)(n.p,{children:"\u73b0\u5728\uff0cMLflow \u5df2\u7ecf\u6355\u83b7\u4e86\u60a8\u7684 crewAI Agent \u7684\u8ffd\u8e2a\u4fe1\u606f\u3002\r\n\u8ba9\u6211\u4eec\u8bbf\u95ee MLflow \u8ffd\u8e2a\u670d\u52a1\u5668\u4ee5\u67e5\u770b\u8ffd\u8e2a\u5e76\u6df1\u5165\u4e86\u89e3\u60a8\u7684 Agent\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 ",(0,s.jsx)(n.code,{children:"127.0.0.1:5000"})," \u4ee5\u8bbf\u95ee MLflow \u8ffd\u8e2a\u670d\u52a1\u5668\u3002"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"MLflow \u8ffd\u8e2a\u4eea\u8868\u677f"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://mintcdn.com/crewai/qVjgZHKAyEOgSSUS/images/mlflow1.png?fit=max&auto=format&n=qVjgZHKAyEOgSSUS&q=85&s=0685aeb79319ad21ff842053ce5303c9",alt:"MLflow tracing example with crewai"})})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},54213:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var t=r(36672);const s={},i=t.createContext(s);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);